this.mfModules=this.mfModules||{},this.mfModules["tests.mobilefrontend"]=(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{"./node_modules/@sinonjs/formatio/lib/formatio.js":function(e,t,n){(function(i){var r,s,o;!function(a,l){"use strict";s=[n("./node_modules/samsam/lib/samsam.js")],void 0===(o="function"==typeof(r=function(e){var t={excludeConstructors:["Object",/^.$/],quoteStrings:!0,limitChildrenCount:0},n=[];void 0!==i&&n.push({object:i,value:"[object global]"});"undefined"!=typeof document&&n.push({object:document,value:"[object HTMLDocument]"});"undefined"!=typeof window&&n.push({object:window,value:"[object Window]"});function r(e){if(!e)return"";if(e.displayName)return e.displayName;if(e.name)return e.name;var t=e.toString().match(/function\s+([^\(]+)/m);return t&&t[1]||""}function s(e,n){var i,s,o=r(n&&n.constructor),a=e.excludeConstructors||t.excludeConstructors||[];for(i=0,s=a.length;i<s;++i){if("string"==typeof a[i]&&a[i]===o)return"";if(a[i].test&&a[i].test(o))return""}return o}function o(e,t){if("object"!=typeof e)return!1;var n,i;for(n=0,i=t.length;n<i;++n)if(t[n]===e)return!0;return!1}function a(t,i,r,s){if("string"==typeof i){if(0===i.length)return"(empty string)";var l=t.quoteStrings;return r||("boolean"!=typeof l||l)?'"'+i+'"':i}if("function"==typeof i&&!(i instanceof RegExp))return a.func(i);if(o(i,r=r||[]))return"[Circular]";if("[object Array]"===Object.prototype.toString.call(i))return a.array.call(t,i,r);if(!i)return String(1/i==-1/0?"-0":i);if(e.isElement(i))return a.element(i);if("function"==typeof i.toString&&i.toString!==Object.prototype.toString)return i.toString();var c,u;for(c=0,u=n.length;c<u;c++)if(i===n[c].object)return n[c].value;return"undefined"!=typeof Set&&i instanceof Set?a.set.call(t,i,r):a.object.call(t,i,r,s)}function l(e){for(var t in e)this[t]=e[t]}return a.func=function(e){return"function "+r(e)+"() {}"},a.array=function(e,t,n){(t=t||[]).push(e);var i,r,s=[];for(r=this.limitChildrenCount>0?Math.min(this.limitChildrenCount,e.length):e.length,i=0;i<r;++i)s.push(a(this,e[i],t));return r<e.length&&s.push("[... "+(e.length-r)+" more elements]"),function(e,t){return(t=t||["[","]"])[0]+e+t[1]}(s.join(", "),n)},a.set=function(e,t){return a.array.call(this,Array.from(e),t,["Set {","}"])},a.object=function(t,n,i){(n=n||[]).push(t),i=i||0;var r,l,c,u,d,h,p=[],f=e.keys(t).sort(),m=3;for(h=this.limitChildrenCount>0?Math.min(this.limitChildrenCount,f.length):f.length,u=0;u<h;++u)l=o(c=t[r=f[u]],n)?"[Circular]":a(this,c,n,i+2),m+=(l=(/\s/.test(r)?'"'+r+'"':r)+": "+l).length,p.push(l);var g=s(this,t),b=g?"["+g+"] ":"",v="";for(u=0,d=i;u<d;++u)v+=" ";return h<f.length&&p.push("[... "+(f.length-h)+" more elements]"),m+i>80?b+"{\n  "+v+p.join(",\n  "+v)+"\n"+v+"}":b+"{ "+p.join(", ")+" }"},a.element=function(e){var t,n,i,r,s,o=e.tagName.toLowerCase(),a=e.attributes,l=[];for(i=0,r=a.length;i<r;++i)n=(t=a.item(i)).nodeName.toLowerCase().replace("html:",""),s=t.nodeValue,"contenteditable"===n&&"inherit"===s||s&&l.push(n+'="'+s+'"');var c="<"+o+(l.length>0?" ":""),u=e.innerHTML||"";return u.length>20&&(u=u.substr(0,20)+"[...]"),(c+l.join(" ")+">"+u+"</"+o+">").replace(/ contentEditable="inherit"/,"")},l.prototype={functionName:r,configure:function(e){return new l(e)},constructorName:function(e){return s(this,e)},ascii:function(e,t,n){return a(this,e,t,n)}},l.prototype})?r.apply(t,s):r)||(e.exports=o)}("undefined"!=typeof self&&self)}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./node_modules/@wikimedia/mw-node-qunit/index.js":function(e,t,n){(function(t){const i=n("./node_modules/@wikimedia/mw-node-qunit/src/dom.js"),r=n("./node_modules/@wikimedia/mw-node-qunit/src/jQuery.js"),s=n("./node_modules/@wikimedia/mw-node-qunit/src/mw.js"),o=n("./node_modules/sinon/lib/sinon.js"),a=n("./node_modules/@wikimedia/mw-node-qunit/src/oo.js"),l=n("./node_modules/@wikimedia/mw-node-qunit/src/mustache.js");e.exports={dom:i,jQuery:r,mw:s,mustache:l,oojs:a,sinon:o,setUp:function(){const e=o.sandbox.create();return i.setUp(e,t),r.setUp(e,t),s.setUp(e,t),t.mediaWiki=t.mw,t.jQuery=t.$,e}}}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./node_modules/@wikimedia/mw-node-qunit/src/dom.js":function(e,t,n){var i="object"!=typeof window,r=i&&n("jsdom");e.exports={setUp:function(e,t){if(i){const n=(new r.JSDOM).window,i=n.document;t.window=n||void 0,t.document=i||void 0,e.stub(t,"window").callsFake(()=>n),e.stub(t,"document").callsFake(()=>i),t.Image=t.window.Image,t.Event=t.window.Event,t.navigator=t.window.navigator}}}},"./node_modules/@wikimedia/mw-node-qunit/src/jQuery.js":function(e,t,n){var i="object"!=typeof window;e.exports={setUp:function(e,t){if(i){const i=n("jquery");t.$=i||void 0,e.stub(t,"$").callsFake(i)}},tearDown:function(){i&&delete n.c.jquery}}},"./node_modules/@wikimedia/mw-node-qunit/src/mustache.js":function(e,t,n){var i="object"!=typeof window;e.exports={setUp:function(e,t){if(i){const i=n("./node_modules/mustache/mustache.js");t.Mustache=i||void 0,e.stub(t,"Mustache").callsFake(()=>i)}}}},"./node_modules/@wikimedia/mw-node-qunit/src/mw.js":function(e,t,n){var i="object"!=typeof window,r=n("./tests/node-qunit/utils/blank.js");e.exports={setUp:function(e,t){const n=r();i&&(t.mw=n||void 0,e.stub(t,"mw").callsFake(()=>n))}}},"./node_modules/@wikimedia/mw-node-qunit/src/oo.js":function(e,t,n){var i="object"!=typeof window;e.exports={setUp:function(e,t){var r;i&&((r=n("oojs")).ui={Element:{static:{getClosestScrollableContainer:function(){}}},Tool:function(){}},t.OO=r||void 0,e.stub(t,"OO").callsFake(()=>r))}}},"./node_modules/lodash.get/index.js":function(e,t,n){(function(t){var n=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,i=/^\w*$/,r=/^\./,s=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,o=/\\(\\)?/g,a=/^\[object .+?Constructor\]$/,l="object"==typeof t&&t&&t.Object===Object&&t,c="object"==typeof self&&self&&self.Object===Object&&self,u=l||c||Function("return this")();var d,h=Array.prototype,p=Function.prototype,f=Object.prototype,m=u["__core-js_shared__"],g=(d=/[^.]+$/.exec(m&&m.keys&&m.keys.IE_PROTO||""))?"Symbol(src)_1."+d:"",b=p.toString,v=f.hasOwnProperty,w=f.toString,y=RegExp("^"+b.call(v).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),k=u.Symbol,j=h.splice,x=P(u,"Map"),E=P(Object,"create"),T=k?k.prototype:void 0,q=T?T.toString:void 0;function S(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function _(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function C(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function A(e,t){for(var n,i,r=e.length;r--;)if((n=e[r][0])===(i=t)||n!=n&&i!=i)return r;return-1}function O(e,t){for(var r,s=0,o=(t=function(e,t){if(L(e))return!1;var r=typeof e;if("number"==r||"symbol"==r||"boolean"==r||null==e||B(e))return!0;return i.test(e)||!n.test(e)||null!=t&&e in Object(t)}(t,e)?[t]:L(r=t)?r:I(r)).length;null!=e&&s<o;)e=e[$(t[s++])];return s&&s==o?e:void 0}function M(e){return!(!F(e)||(t=e,g&&g in t))&&(function(e){var t=F(e)?w.call(e):"";return"[object Function]"==t||"[object GeneratorFunction]"==t}(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}(e)?y:a).test(function(e){if(null!=e){try{return b.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(e));var t}function U(e,t){var n,i,r=e.__data__;return("string"==(i=typeof(n=t))||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==n:null===n)?r["string"==typeof t?"string":"hash"]:r.map}function P(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return M(n)?n:void 0}S.prototype.clear=function(){this.__data__=E?E(null):{}},S.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},S.prototype.get=function(e){var t=this.__data__;if(E){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return v.call(t,e)?t[e]:void 0},S.prototype.has=function(e){var t=this.__data__;return E?void 0!==t[e]:v.call(t,e)},S.prototype.set=function(e,t){return this.__data__[e]=E&&void 0===t?"__lodash_hash_undefined__":t,this},_.prototype.clear=function(){this.__data__=[]},_.prototype.delete=function(e){var t=this.__data__,n=A(t,e);return!(n<0)&&(n==t.length-1?t.pop():j.call(t,n,1),!0)},_.prototype.get=function(e){var t=this.__data__,n=A(t,e);return n<0?void 0:t[n][1]},_.prototype.has=function(e){return A(this.__data__,e)>-1},_.prototype.set=function(e,t){var n=this.__data__,i=A(n,e);return i<0?n.push([e,t]):n[i][1]=t,this},C.prototype.clear=function(){this.__data__={hash:new S,map:new(x||_),string:new S}},C.prototype.delete=function(e){return U(this,e).delete(e)},C.prototype.get=function(e){return U(this,e).get(e)},C.prototype.has=function(e){return U(this,e).has(e)},C.prototype.set=function(e,t){return U(this,e).set(e,t),this};var I=D((function(e){var t;e=null==(t=e)?"":function(e){if("string"==typeof e)return e;if(B(e))return q?q.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(t);var n=[];return r.test(e)&&n.push(""),e.replace(s,(function(e,t,i,r){n.push(i?r.replace(o,"$1"):t||e)})),n}));function $(e){if("string"==typeof e||B(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function D(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var i=arguments,r=t?t.apply(this,i):i[0],s=n.cache;if(s.has(r))return s.get(r);var o=e.apply(this,i);return n.cache=s.set(r,o),o};return n.cache=new(D.Cache||C),n}D.Cache=C;var L=Array.isArray;function F(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function B(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==w.call(e)}e.exports=function(e,t,n){var i=null==e?void 0:O(e,t);return void 0===i?n:i}}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./node_modules/lolex/lolex.js":function(module,exports,__webpack_require__){(function(global){var require,require,f;f=function(){var define,module,exports;return function e(t,n,i){function r(o,a){if(!n[o]){if(!t[o]){if(!a&&"function"==typeof require&&require)return require(o,!0);if(s)return s(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[o]={exports:{}};t[o][0].call(c.exports,(function(e){return r(t[o][1][e]||e)}),c,c.exports,e,t,n,i)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}({1:[function(require,module,exports){(function(global){"use strict";function withGlobal(_global){var userAgent=_global.navigator&&_global.navigator.userAgent,isRunningInIE=userAgent&&userAgent.indexOf("MSIE ")>-1,maxTimeout=Math.pow(2,31)-1;isRunningInIE&&(_global.setTimeout=_global.setTimeout,_global.clearTimeout=_global.clearTimeout,_global.setInterval=_global.setInterval,_global.clearInterval=_global.clearInterval,_global.Date=_global.Date),void 0!==_global.setImmediate&&(_global.setImmediate=_global.setImmediate,_global.clearImmediate=_global.clearImmediate);var NOOP=function(){},timeoutResult=_global.setTimeout(NOOP,0),addTimerReturnsObject="object"==typeof timeoutResult,hrtimePresent=_global.process&&"function"==typeof _global.process.hrtime,nextTickPresent=_global.process&&"function"==typeof _global.process.nextTick,performancePresent=_global.performance&&"function"==typeof _global.performance.now,hasPerformancePrototype=_global.Performance&&(typeof _global.Performance).match(/^(function|object)$/),requestAnimationFramePresent=_global.requestAnimationFrame&&"function"==typeof _global.requestAnimationFrame,cancelAnimationFramePresent=_global.cancelAnimationFrame&&"function"==typeof _global.cancelAnimationFrame;_global.clearTimeout(timeoutResult);var NativeDate=_global.Date,uniqueTimerId=1;function isNumberFinite(e){return Number.isFinite?Number.isFinite(e):"number"==typeof e&&isFinite(e)}function parseTime(e){if(!e)return 0;var t,n=e.split(":"),i=n.length,r=i,s=0;if(i>3||!/^(\d\d:){0,2}\d\d?$/.test(e))throw new Error("tick only understands numbers, 'm:s' and 'h:m:s'. Each part must be two digits");for(;r--;){if((t=parseInt(n[r],10))>=60)throw new Error("Invalid time "+e);s+=t*Math.pow(60,i-r-1)}return 1e3*s}function fixedFloor(e){return e>=0?Math.floor(e):Math.ceil(e)}function fixedModulo(e,t){return Math.round((e%t+t)%t)}function getEpoch(e){if(!e)return 0;if("function"==typeof e.getTime)return e.getTime();if("number"==typeof e)return e;throw new TypeError("now should be milliseconds since UNIX epoch")}function inRange(e,t,n){return n&&n.callAt>=e&&n.callAt<=t}function mirrorDateProperties(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return t.now?e.now=function(){return e.clock.now}:delete e.now,t.toSource?e.toSource=function(){return t.toSource()}:delete e.toSource,e.toString=function(){return t.toString()},e.prototype=t.prototype,e.parse=t.parse,e.UTC=t.UTC,e.prototype.toUTCString=t.prototype.toUTCString,e}function createDate(){return mirrorDateProperties((function e(t,n,i,r,s,o,a){switch(arguments.length){case 0:return new NativeDate(e.clock.now);case 1:return new NativeDate(t);case 2:return new NativeDate(t,n);case 3:return new NativeDate(t,n,i);case 4:return new NativeDate(t,n,i,r);case 5:return new NativeDate(t,n,i,r,s);case 6:return new NativeDate(t,n,i,r,s,o);default:return new NativeDate(t,n,i,r,s,o,a)}}),NativeDate)}function enqueueJob(e,t){e.jobs||(e.jobs=[]),e.jobs.push(t)}function runJobs(e){if(e.jobs){for(var t=0;t<e.jobs.length;t++){var n=e.jobs[t];if(n.func.apply(null,n.args),e.loopLimit&&t>e.loopLimit)throw new Error("Aborting after running "+e.loopLimit+" timers, assuming an infinite loop!")}e.jobs=[]}}function addTimer(e,t){if(void 0===t.func)throw new Error("Callback must be provided to timer calls");if(t.type=t.immediate?"Immediate":"Timeout",t.hasOwnProperty("delay")&&(isNumberFinite(t.delay)||(t.delay=0),t.delay=t.delay>maxTimeout?1:t.delay,t.delay=Math.max(0,t.delay)),t.hasOwnProperty("interval")&&(t.type="Interval",t.interval=t.interval>maxTimeout?1:t.interval),t.hasOwnProperty("animation")&&(t.type="AnimationFrame",t.animation=!0),e.timers||(e.timers={}),t.id=uniqueTimerId++,t.createdAt=e.now,t.callAt=e.now+(parseInt(t.delay)||(e.duringTick?1:0)),e.timers[t.id]=t,addTimerReturnsObject){var n={id:t.id,ref:function(){return n},unref:function(){return n},refresh:function(){return n}};return n}return t.id}function compareTimers(e,t){return e.callAt<t.callAt?-1:e.callAt>t.callAt?1:e.immediate&&!t.immediate?-1:!e.immediate&&t.immediate?1:e.createdAt<t.createdAt?-1:e.createdAt>t.createdAt?1:e.id<t.id?-1:e.id>t.id?1:void 0}function firstTimerInRange(e,t,n){var i,r=e.timers,s=null;for(i in r)r.hasOwnProperty(i)&&(!inRange(t,n,r[i])||s&&1!==compareTimers(s,r[i])||(s=r[i]));return s}function firstTimer(e){var t,n=e.timers,i=null;for(t in n)n.hasOwnProperty(t)&&(i&&1!==compareTimers(i,n[t])||(i=n[t]));return i}function lastTimer(e){var t,n=e.timers,i=null;for(t in n)n.hasOwnProperty(t)&&(i&&-1!==compareTimers(i,n[t])||(i=n[t]));return i}function callTimer(clock,timer){"number"==typeof timer.interval?clock.timers[timer.id].callAt+=timer.interval:delete clock.timers[timer.id],"function"==typeof timer.func?timer.func.apply(null,timer.args):eval(timer.func)}function clearTimer(e,t,n){if(t&&(e.timers||(e.timers={}),"object"==typeof t&&(t=t.id),e.timers.hasOwnProperty(t))){var i=e.timers[t];if(i.type!==n){var r="AnimationFrame"===n?"cancelAnimationFrame":"clear"+n,s="AnimationFrame"===i.type?"requestAnimationFrame":"set"+i.type;throw new Error("Cannot clear timer: timer created with "+s+"() but cleared with "+r+"()")}delete e.timers[t]}}function uninstall(e,t,n){var i,r,s;for(r=0,s=e.methods.length;r<s;r++)if("hrtime"===(i=e.methods[r])&&t.process)t.process.hrtime=e._hrtime;else if("nextTick"===i&&t.process)t.process.nextTick=e._nextTick;else if("performance"===i)t[i]=e["_"+i];else if(t[i]&&t[i].hadOwnProperty)t[i]=e["_"+i],"clearInterval"===i&&!0===n.shouldAdvanceTime&&t[i](e.attachedInterval);else try{delete t[i]}catch(e){}return e.methods=[],e.timers?Object.keys(e.timers).map((function(t){return e.timers[t]})):[]}function hijackMethod(e,t,n){var i;if(n[t].hadOwnProperty=Object.prototype.hasOwnProperty.call(e,t),n["_"+t]=e[t],"Date"===t){var r=mirrorDateProperties(n[t],e[t]);e[t]=r}else if("performance"===t)e[t]=n[t];else for(i in e[t]=function(){return n[t].apply(n,arguments)},n[t])n[t].hasOwnProperty(i)&&(e[t][i]=n[t][i]);e[t].clock=n}function doIntervalTick(e,t){e.tick(t)}var timers={setTimeout:_global.setTimeout,clearTimeout:_global.clearTimeout,setImmediate:_global.setImmediate,clearImmediate:_global.clearImmediate,setInterval:_global.setInterval,clearInterval:_global.clearInterval,Date:_global.Date};hrtimePresent&&(timers.hrtime=_global.process.hrtime),nextTickPresent&&(timers.nextTick=_global.process.nextTick),performancePresent&&(timers.performance=_global.performance),requestAnimationFramePresent&&(timers.requestAnimationFrame=_global.requestAnimationFrame),cancelAnimationFramePresent&&(timers.cancelAnimationFrame=_global.cancelAnimationFrame);var keys=Object.keys||function(e){var t,n=[];for(t in e)e.hasOwnProperty(t)&&n.push(t);return n};function createClock(e,t){if(e=e||0,t=t||1e3,void 0===NativeDate)throw new Error("The global scope doesn't have a `Date` object (see https://github.com/sinonjs/sinon/issues/1852#issuecomment-419622780)");var n={now:getEpoch(e),hrNow:0,timeouts:{},Date:createDate(),loopLimit:t};function i(){return 16-(n.now-e)%16}function r(e){n.hrNow+=e-n.now}if(n.Date.clock=n,n.setTimeout=function(e,t){return addTimer(n,{func:e,args:Array.prototype.slice.call(arguments,2),delay:t})},n.clearTimeout=function(e){return clearTimer(n,e,"Timeout")},n.nextTick=function(e){return enqueueJob(n,{func:e,args:Array.prototype.slice.call(arguments,1)})},n.setInterval=function(e,t){return t=parseInt(t,10),addTimer(n,{func:e,args:Array.prototype.slice.call(arguments,2),delay:t,interval:t})},n.clearInterval=function(e){return clearTimer(n,e,"Interval")},n.setImmediate=function(e){return addTimer(n,{func:e,args:Array.prototype.slice.call(arguments,1),immediate:!0})},n.clearImmediate=function(e){return clearTimer(n,e,"Immediate")},n.requestAnimationFrame=function(e){var t=addTimer(n,{func:e,delay:i(),args:[n.now+i()],animation:!0});return t.id||t},n.cancelAnimationFrame=function(e){return clearTimer(n,e,"AnimationFrame")},n.runMicrotasks=function(){runJobs(n)},n.tick=function(e){e="number"==typeof e?e:parseTime(e);var t,i,s,o=n.now,a=n.now+e,l=n.now;for(n.duringTick=!0,s=n.now,runJobs(n),s!==n.now&&(o+=n.now-s,a+=n.now-s),t=firstTimerInRange(n,o,a);t&&o<=a;){if(n.timers[t.id]){r(t.callAt),o=t.callAt,n.now=t.callAt,s=n.now;try{runJobs(n),callTimer(n,t)}catch(e){i=i||e}s!==n.now&&(o+=n.now-s,a+=n.now-s,l+=n.now-s)}t=firstTimerInRange(n,l,a),l=o}if(s=n.now,runJobs(n),s!==n.now&&(o+=n.now-s,a+=n.now-s),n.duringTick=!1,t=firstTimerInRange(n,o,a))try{n.tick(a-n.now)}catch(e){i=i||e}else r(a),n.now=a;if(i)throw i;return n.now},n.next=function(){runJobs(n);var e=firstTimer(n);if(!e)return n.now;n.duringTick=!0;try{return r(e.callAt),n.now=e.callAt,callTimer(n,e),runJobs(n),n.now}finally{n.duringTick=!1}},n.runAll=function(){var e;for(runJobs(n),e=0;e<n.loopLimit;e++){if(!n.timers)return n.now;if(0===keys(n.timers).length)return n.now;n.next()}throw new Error("Aborting after running "+n.loopLimit+" timers, assuming an infinite loop!")},n.runToFrame=function(){return n.tick(i())},n.runToLast=function(){var e=lastTimer(n);return e?n.tick(e.callAt-n.now):(runJobs(n),n.now)},n.reset=function(){n.timers={},n.jobs=[],n.now=getEpoch(e),n.hrNow=0},n.setSystemTime=function(e){var t,i,r=getEpoch(e),s=r-n.now;for(t in n.now=r,n.timers)n.timers.hasOwnProperty(t)&&((i=n.timers[t]).createdAt+=s,i.callAt+=s)},performancePresent){if(n.performance=Object.create(null),hasPerformancePrototype){var s=_global.Performance.prototype;Object.getOwnPropertyNames(s).forEach((function(e){n.performance[e]=NOOP}))}n.performance.now=function(){return n.hrNow}}return hrtimePresent&&(n.hrtime=function(e){if(Array.isArray(e)){var t=e[0]+e[1]/1e9,i=n.hrNow/1e3-t;return[fixedFloor(i),fixedModulo(1e9*i,1e9)]}return[fixedFloor(n.hrNow/1e3),fixedModulo(1e6*n.hrNow,1e9)]}),n}function install(e){if(arguments.length>1||e instanceof Date||Array.isArray(e)||"number"==typeof e)throw new TypeError("lolex.install called with "+String(e)+" lolex 2.0+ requires an object parameter - see https://github.com/sinonjs/lolex");var t,n;(e=void 0!==e?e:{}).shouldAdvanceTime=e.shouldAdvanceTime||!1,e.advanceTimeDelta=e.advanceTimeDelta||20;var i=e.target||_global,r=createClock(e.now,e.loopLimit);for(r.uninstall=function(){return uninstall(r,i,e)},r.methods=e.toFake||[],0===r.methods.length&&(r.methods=keys(timers).filter((function(e){return"nextTick"!==e}))),t=0,n=r.methods.length;t<n;t++)if("hrtime"===r.methods[t])i.process&&"function"==typeof i.process.hrtime&&hijackMethod(i.process,r.methods[t],r);else if("nextTick"===r.methods[t])i.process&&"function"==typeof i.process.nextTick&&hijackMethod(i.process,r.methods[t],r);else{if("setInterval"===r.methods[t]&&!0===e.shouldAdvanceTime){var s=doIntervalTick.bind(null,r,e.advanceTimeDelta),o=i[r.methods[t]](s,e.advanceTimeDelta);r.attachedInterval=o}hijackMethod(i,r.methods[t],r)}return r}return{timers:timers,createClock:createClock,install:install,withGlobal:withGlobal}}var defaultImplementation=withGlobal(global||window);exports.timers=defaultImplementation.timers,exports.createClock=defaultImplementation.createClock,exports.install=defaultImplementation.install,exports.withGlobal=withGlobal}).call(this,void 0!==global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)},module.exports=f()}).call(this,__webpack_require__("./node_modules/webpack/buildin/global.js"))},"./node_modules/mustache/mustache.js":function(e,t,n){var i,r,s,o;
/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */o=function(e){var t=Object.prototype.toString,n=Array.isArray||function(e){return"[object Array]"===t.call(e)};function i(e){return"function"==typeof e}function r(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function s(e,t){return null!=e&&"object"==typeof e&&t in e}var o=RegExp.prototype.test,a=/\S/;function l(e){return!function(e,t){return o.call(e,t)}(a,e)}var c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},u=/\s*/,d=/\s+/,h=/\s*=/,p=/\s*\}/,f=/#|\^|\/|>|\{|&|=|!/;function m(e){this.string=e,this.tail=e,this.pos=0}function g(e,t){this.view=e,this.cache={".":this.view},this.parent=t}function b(){this.cache={}}m.prototype.eos=function(){return""===this.tail},m.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},m.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=t.length,t},g.prototype.push=function(e){return new g(e,this)},g.prototype.lookup=function(e){var t,n,r,o=this.cache;if(o.hasOwnProperty(e))t=o[e];else{for(var a,l,c,u=this,d=!1;u;){if(e.indexOf(".")>0)for(a=u.view,l=e.split("."),c=0;null!=a&&c<l.length;)c===l.length-1&&(d=s(a,l[c])||(n=a,r=l[c],null!=n&&"object"!=typeof n&&n.hasOwnProperty&&n.hasOwnProperty(r))),a=a[l[c++]];else a=u.view[e],d=s(u.view,e);if(d){t=a;break}u=u.parent}o[e]=t}return i(t)&&(t=t.call(this.view)),t},b.prototype.clearCache=function(){this.cache={}},b.prototype.parse=function(t,i){var s=this.cache,o=t+":"+(i||e.tags).join(":"),a=s[o];return null==a&&(a=s[o]=function(t,i){if(!t)return[];var s,o,a,c=[],g=[],b=[],v=!1,w=!1;function y(){if(v&&!w)for(;b.length;)delete g[b.pop()];else b=[];v=!1,w=!1}function k(e){if("string"==typeof e&&(e=e.split(d,2)),!n(e)||2!==e.length)throw new Error("Invalid tags: "+e);s=new RegExp(r(e[0])+"\\s*"),o=new RegExp("\\s*"+r(e[1])),a=new RegExp("\\s*"+r("}"+e[1]))}k(i||e.tags);for(var j,x,E,T,q,S,_=new m(t);!_.eos();){if(j=_.pos,E=_.scanUntil(s))for(var C=0,A=E.length;C<A;++C)l(T=E.charAt(C))?b.push(g.length):w=!0,g.push(["text",T,j,j+1]),j+=1,"\n"===T&&y();if(!_.scan(s))break;if(v=!0,x=_.scan(f)||"name",_.scan(u),"="===x?(E=_.scanUntil(h),_.scan(h),_.scanUntil(o)):"{"===x?(E=_.scanUntil(a),_.scan(p),_.scanUntil(o),x="&"):E=_.scanUntil(o),!_.scan(o))throw new Error("Unclosed tag at "+_.pos);if(q=[x,E,j,_.pos],g.push(q),"#"===x||"^"===x)c.push(q);else if("/"===x){if(!(S=c.pop()))throw new Error('Unopened section "'+E+'" at '+j);if(S[1]!==E)throw new Error('Unclosed section "'+S[1]+'" at '+j)}else"name"===x||"{"===x||"&"===x?w=!0:"="===x&&k(E)}if(S=c.pop())throw new Error('Unclosed section "'+S[1]+'" at '+_.pos);return function(e){for(var t,n=[],i=n,r=[],s=0,o=e.length;s<o;++s)switch((t=e[s])[0]){case"#":case"^":i.push(t),r.push(t),i=t[4]=[];break;case"/":r.pop()[5]=t[2],i=r.length>0?r[r.length-1][4]:n;break;default:i.push(t)}return n}(function(e){for(var t,n,i=[],r=0,s=e.length;r<s;++r)(t=e[r])&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(i.push(t),n=t));return i}(g))}(t,i)),a},b.prototype.render=function(e,t,n,i){var r=this.parse(e,i),s=t instanceof g?t:new g(t);return this.renderTokens(r,s,n,e,i)},b.prototype.renderTokens=function(e,t,n,i,r){for(var s,o,a,l="",c=0,u=e.length;c<u;++c)a=void 0,"#"===(o=(s=e[c])[0])?a=this.renderSection(s,t,n,i):"^"===o?a=this.renderInverted(s,t,n,i):">"===o?a=this.renderPartial(s,t,n,r):"&"===o?a=this.unescapedValue(s,t):"name"===o?a=this.escapedValue(s,t):"text"===o&&(a=this.rawValue(s)),void 0!==a&&(l+=a);return l},b.prototype.renderSection=function(e,t,r,s){var o=this,a="",l=t.lookup(e[1]);if(l){if(n(l))for(var c=0,u=l.length;c<u;++c)a+=this.renderTokens(e[4],t.push(l[c]),r,s);else if("object"==typeof l||"string"==typeof l||"number"==typeof l)a+=this.renderTokens(e[4],t.push(l),r,s);else if(i(l)){if("string"!=typeof s)throw new Error("Cannot use higher-order sections without the original template");null!=(l=l.call(t.view,s.slice(e[3],e[5]),(function(e){return o.render(e,t,r)})))&&(a+=l)}else a+=this.renderTokens(e[4],t,r,s);return a}},b.prototype.renderInverted=function(e,t,i,r){var s=t.lookup(e[1]);if(!s||n(s)&&0===s.length)return this.renderTokens(e[4],t,i,r)},b.prototype.renderPartial=function(e,t,n,r){if(n){var s=i(n)?n(e[1]):n[e[1]];return null!=s?this.renderTokens(this.parse(s,r),t,n,s):void 0}},b.prototype.unescapedValue=function(e,t){var n=t.lookup(e[1]);if(null!=n)return n},b.prototype.escapedValue=function(t,n){var i=n.lookup(t[1]);if(null!=i)return e.escape(i)},b.prototype.rawValue=function(e){return e[1]},e.name="mustache.js",e.version="3.0.1",e.tags=["{{","}}"];var v=new b;return e.clearCache=function(){return v.clearCache()},e.parse=function(e,t){return v.parse(e,t)},e.render=function(e,t,i,r){if("string"!=typeof e)throw new TypeError('Invalid template! Template should be a "string" but "'+(n(s=e)?"array":typeof s)+'" was given as the first argument for mustache#render(template, view, partials)');var s;return v.render(e,t,i,r)},e.to_html=function(t,n,r,s){var o=e.render(t,n,r);if(!i(s))return o;s(o)},e.escape=function(e){return String(e).replace(/[&<>"'`=\/]/g,(function(e){return c[e]}))},e.Scanner=m,e.Context=g,e.Writer=b,e},t&&"string"!=typeof t.nodeName?o(t):(r=[t],void 0===(s="function"==typeof(i=o)?i.apply(t,r):i)||(e.exports=s))},"./node_modules/nise/nise.js":function(module,exports,__webpack_require__){(function(global){var require,require,f;f=function(){var define,module,exports;return function e(t,n,i){function r(o,a){if(!n[o]){if(!t[o]){if(!a&&"function"==typeof require&&require)return require(o,!0);if(s)return s(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[o]={exports:{}};t[o][0].call(c.exports,(function(e){var n=t[o][1][e];return r(n||e)}),c,c.exports,e,t,n,i)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}({1:[function(e,t,n){"use strict";var i=setTimeout;t.exports=function(e){return(e=e||{}).hasOwnProperty("logger")||(e.logger=function(){}),e.hasOwnProperty("useImmediateExceptions")||(e.useImmediateExceptions=!0),e.hasOwnProperty("setTimeout")||(e.setTimeout=i),function(t,n){var i=t+" threw exception: ",r={name:n.name||t,message:n.message||n.toString(),stack:n.stack};function s(){throw r.message=i+r.message,r}e.logger(i+"["+r.name+"] "+r.message),r.stack&&e.logger(r.stack),e.useImmediateExceptions?s():e.setTimeout(s,0)}}},{}],2:[function(e,t,n){"use strict";var i=e("./event");function r(e,t,n){this.initEvent(e,!1,!1,n),this.detail=t.detail||null}r.prototype=new i,r.prototype.constructor=r,t.exports=r},{"./event":4}],3:[function(e,t,n){"use strict";function i(e){return e!==Object(e)?{capture:Boolean(e),once:!1,passive:!1}:{capture:Boolean(e.capture),once:Boolean(e.once),passive:Boolean(e.passive)}}function r(e,t){return function(n){return n.capture===t&&n.listener===e}}var s={addEventListener:function(e,t,n){var s=i(n);null!=t&&(this.eventListeners=this.eventListeners||{},this.eventListeners[e]=this.eventListeners[e]||[],this.eventListeners[e].some(r(t,s.capture))||this.eventListeners[e].push({listener:t,capture:s.capture,once:s.once}))},removeEventListener:function(e,t,n){if(this.eventListeners&&this.eventListeners[e]){var s,o=i(n);this.eventListeners[e]=this.eventListeners[e].filter((s=r(t,o.capture),function(){return!s.apply(this,arguments)}))}},dispatchEvent:function(e){if(!this.eventListeners||!this.eventListeners[e.type])return Boolean(e.defaultPrevented);var t=this,n=e.type,i=t.eventListeners[n];return t.eventListeners[n]=i.filter((function(e){return!e.once})),i.forEach((function(n){var i=n.listener;"function"==typeof i?i.call(t,e):i.handleEvent(e)})),Boolean(e.defaultPrevented)}};t.exports=s},{}],4:[function(e,t,n){"use strict";function i(e,t,n,i){this.initEvent(e,t,n,i)}i.prototype={initEvent:function(e,t,n,i){this.type=e,this.bubbles=t,this.cancelable=n,this.target=i,this.currentTarget=i},stopPropagation:function(){},preventDefault:function(){this.defaultPrevented=!0}},t.exports=i},{}],5:[function(e,t,n){"use strict";t.exports={Event:e("./event"),ProgressEvent:e("./progress-event"),CustomEvent:e("./custom-event"),EventTarget:e("./event-target")}},{"./custom-event":2,"./event":4,"./event-target":3,"./progress-event":6}],6:[function(e,t,n){"use strict";var i=e("./event");function r(e,t,n){this.initEvent(e,!1,!1,n),this.loaded="number"==typeof t.loaded?t.loaded:null,this.total="number"==typeof t.total?t.total:null,this.lengthComputable=!!t.total}r.prototype=new i,r.prototype.constructor=r,t.exports=r},{"./event":4}],7:[function(e,t,n){"use strict";var i=e("lolex"),r=e("./index");function s(){}s.prototype=r;var o=new s;o.addRequest=function(e){if(e.async&&("object"==typeof setTimeout.clock?this.clock=setTimeout.clock:(this.clock=i.install(),this.resetClock=!0),!this.longestTimeout)){var t=this.clock.setTimeout,n=this.clock.setInterval,s=this;this.clock.setTimeout=function(e,n){return s.longestTimeout=Math.max(n,s.longestTimeout||0),t.apply(this,arguments)},this.clock.setInterval=function(e,t){return s.longestTimeout=Math.max(t,s.longestTimeout||0),n.apply(this,arguments)}}return r.addRequest.call(this,e)},o.respond=function(){var e=r.respond.apply(this,arguments);return this.clock&&(this.clock.tick(this.longestTimeout||0),this.longestTimeout=0,this.resetClock&&(this.clock.uninstall(),this.resetClock=!1)),e},o.restore=function(){return this.clock&&this.clock.uninstall(),r.restore.apply(this,arguments)},t.exports=o},{"./index":9,lolex:45}],8:[function(e,t,n){"use strict";var i=e("@sinonjs/formatio").configure({quoteStrings:!1,limitChildrenCount:250});t.exports=function(){return i.ascii.apply(i,arguments)}},{"@sinonjs/formatio":24}],9:[function(e,t,n){"use strict";var i=e("../fake-xhr"),r=[].push,s=e("./format"),o=e("../configure-logger"),a=e("path-to-regexp"),l="undefined"!=typeof ArrayBuffer;function c(e){var t=e;if("[object Array]"!==Object.prototype.toString.call(e)&&(t=[200,{},e]),"string"!=typeof t[2]){if(!l)throw new TypeError("Fake server response body should be a string, but was "+typeof t[2]);if(!(t[2]instanceof ArrayBuffer))throw new TypeError("Fake server response body should be a string or ArrayBuffer, but was "+typeof t[2])}return t}function u(e,t){var n="undefined"==typeof window?{host:"localhost",protocol:"http"}:void 0!==window.location?window.location:void 0!==window.window&&void 0!==window.window.location?window.window.location:{host:"localhost",protocol:"http"},i=new RegExp("^"+n.protocol+"//"+n.host),r=t.url;if(/^https?:\/\//.test(r)&&!i.test(r)||(r=r.replace(i,"")),function(e,t,n){var i=e.method,r=!i||i.toLowerCase()===t.toLowerCase(),s=e.url,o=!s||s===n||"function"==typeof s.test&&s.test(n);return r&&o}(e,this.getHTTPMethod(t),r)){if("function"==typeof e.response){var s=e.url,o=[t].concat(s&&"function"==typeof s.exec?s.exec(r).slice(1):[]);return e.response.apply(e,o)}return!0}return!1}function d(){var e=++this.requestCount;this.requested=!0,this.requestedOnce=1===e,this.requestedTwice=2===e,this.requestedThrice=3===e,this.firstRequest=this.getRequest(0),this.secondRequest=this.getRequest(1),this.thirdRequest=this.getRequest(2),this.lastRequest=this.getRequest(e-1)}var h={create:function(e){var t=Object.create(this);return t.configure(e),this.xhr=i.useFakeXMLHttpRequest(),t.requests=[],t.requestCount=0,t.queue=[],t.responses=[],this.xhr.onCreate=function(e){e.unsafeHeadersEnabled=function(){return!(!1===t.unsafeHeadersEnabled)},t.addRequest(e)},t},configure:function(e){var t=this,n={autoRespond:!0,autoRespondAfter:!0,respondImmediately:!0,fakeHTTPMethods:!0,logger:!0,unsafeHeadersEnabled:!0};e=e||{},Object.keys(e).forEach((function(i){i in n&&(t[i]=e[i])})),t.logError=o(e)},addRequest:function(e){var t=this;r.call(this.requests,e),d.call(this),e.onSend=function(){t.handleRequest(this),t.respondImmediately?t.respond():t.autoRespond&&!t.responding&&(setTimeout((function(){t.responding=!1,t.respond()}),t.autoRespondAfter||10),t.responding=!0)}},getHTTPMethod:function(e){if(this.fakeHTTPMethods&&/post/i.test(e.method)){var t=(e.requestBody||"").match(/_method=([^\b;]+)/);return t?t[1]:e.method}return e.method},handleRequest:function(e){e.async?r.call(this.queue,e):this.processRequest(e)},logger:function(){},logError:o({}),log:function(e,t){var n;n="Request:\n"+s(t)+"\n\n",n+="Response:\n"+s(e)+"\n\n","function"==typeof this.logger&&this.logger(n)},respondWith:function(e,t,n){1!==arguments.length||"function"==typeof e?(1===arguments.length&&(n=e,t=e=null),2===arguments.length&&(n=t,t=e,e=null),r.call(this.responses,{method:e,url:"string"==typeof t&&""!==t?a(t):t,response:"function"==typeof n?n:c(n)})):this.response=c(e)},respond:function(){arguments.length>0&&this.respondWith.apply(this,arguments);var e=this.queue||[],t=e.splice(0,e.length),n=this;t.forEach((function(e){n.processRequest(e)}))},respondAll:function(){var e;if(!this.respondImmediately)for(this.queue=this.requests.slice(0);e=this.queue.shift();)this.processRequest(e)},processRequest:function(e){try{if(e.aborted)return;var t=this.response||[404,{},""];if(this.responses)for(var n=this.responses.length-1;n>=0;n--)if(u.call(this,this.responses[n],e)){t=this.responses[n].response;break}4!==e.readyState&&(this.log(t,e),e.respond(t[0],t[1],t[2]))}catch(e){this.logError("Fake server request processing",e)}},restore:function(){return this.xhr.restore&&this.xhr.restore.apply(this.xhr,arguments)},getRequest:function(e){return this.requests[e]||null},reset:function(){this.resetBehavior(),this.resetHistory()},resetBehavior:function(){this.responses.length=this.queue.length=0},resetHistory:function(){this.requests.length=this.requestCount=0,this.requestedOnce=this.requestedTwice=this.requestedThrice=this.requested=!1,this.firstRequest=this.secondRequest=this.thirdRequest=this.lastRequest=null}};t.exports=h},{"../configure-logger":1,"../fake-xhr":11,"./format":8,"path-to-regexp":46}],10:[function(e,t,n){"use strict";n.isSupported=function(){try{return!!new Blob}catch(e){return!1}}()},{}],11:[function(e,t,n){"use strict";var i="undefined"!=typeof TextEncoder?TextEncoder:e("@sinonjs/text-encoding").TextEncoder,r=e("../configure-logger"),s=e("../event"),o=e("just-extend"),a="undefined"!=typeof ProgressEvent,l="undefined"!=typeof CustomEvent,c="undefined"!=typeof FormData,u="undefined"!=typeof ArrayBuffer,d=e("./blob").isSupported,h={"Accept-Charset":!0,"Access-Control-Request-Headers":!0,"Access-Control-Request-Method":!0,"Accept-Encoding":!0,Connection:!0,"Content-Length":!0,Cookie:!0,Cookie2:!0,"Content-Transfer-Encoding":!0,Date:!0,DNT:!0,Expect:!0,Host:!0,"Keep-Alive":!0,Origin:!0,Referer:!0,TE:!0,Trailer:!0,"Transfer-Encoding":!0,Upgrade:!0,"User-Agent":!0,Via:!0};function p(){var e=this;["loadstart","progress","abort","error","load","timeout","loadend"].forEach((function(t){e.addEventListener(t,(function(n){var i=e["on"+t];i&&"function"==typeof i&&i.call(this,n)}))}))}function f(e,t){return Object.keys(e).filter((function(e){return e.toLowerCase()===t.toLowerCase()}))[0]||null}function m(e){return!/^Set-Cookie2?$/i.test(e)}function g(e,t){return e instanceof ArrayBuffer?e:new i(t||"utf-8").encode(e).buffer}function b(e){return!e||/(text\/xml)|(application\/xml)|(\+xml)/.test(e)}function v(e){""===e.responseType||"text"===e.responseType?e.response=e.responseText="":e.response=e.responseText=null,e.responseXML=null}function w(e){var t=e.navigator&&"ReactNative"===e.navigator.product,n={XMLHttpRequest:e.XMLHttpRequest};function i(e){p.call(this),this.readyState=i.UNSENT,this.requestHeaders={},this.requestBody=null,this.status=0,this.statusText="",this.upload=new p,this.responseType="",this.response="",this.logError=r(e),n.supportsTimeout&&(this.timeout=0),n.supportsCORS&&(this.withCredentials=!1),"function"==typeof i.onCreate&&i.onCreate(this)}function w(e){if(e.readyState!==i.OPENED)throw new Error("INVALID_STATE_ERR");if(e.sendFlag)throw new Error("INVALID_STATE_ERR")}n.GlobalXMLHttpRequest=e.XMLHttpRequest,n.GlobalActiveXObject=e.ActiveXObject,n.supportsActiveX=void 0!==n.GlobalActiveXObject,n.supportsXHR=void 0!==n.GlobalXMLHttpRequest,n.workingXHR=function(e){return void 0!==e.XMLHttpRequest?e.XMLHttpRequest:!(void 0===e.ActiveXObject)&&function(){return new e.ActiveXObject("MSXML2.XMLHTTP.3.0")}}(e),n.supportsTimeout=n.supportsXHR&&"timeout"in new n.GlobalXMLHttpRequest,n.supportsCORS=t||n.supportsXHR&&"withCredentials"in new n.GlobalXMLHttpRequest;var y=function(e,t,n){switch(n.length){case 0:return e[t]();case 1:return e[t](n[0]);case 2:return e[t](n[0],n[1]);case 3:return e[t](n[0],n[1],n[2]);case 4:return e[t](n[0],n[1],n[2],n[3]);case 5:return e[t](n[0],n[1],n[2],n[3],n[4]);default:throw new Error("Unhandled case")}};function k(e){if(e.readyState!==i.OPENED)throw new Error("INVALID_STATE_ERR - "+e.readyState)}function j(e){v(e),e.errorFlag=!0,e.requestHeaders={},e.responseHeaders={},e.readyState!==i.UNSENT&&e.sendFlag&&e.readyState!==i.DONE&&(e.readyStateChange(i.DONE),e.sendFlag=!1)}i.filters=[],i.addFilter=function(e){this.filters.push(e)},i.defake=function(e,t){var r=new n.workingXHR;["open","setRequestHeader","abort","getResponseHeader","getAllResponseHeaders","addEventListener","overrideMimeType","removeEventListener"].forEach((function(t){e[t]=function(){return y(r,t,arguments)}})),e.send=function(){return r.responseType!==e.responseType&&(r.responseType=e.responseType),y(r,"send",arguments)};var s=function(t){t.forEach((function(t){e[t]=r[t]}))},o=function(){e.readyState=r.readyState,r.readyState>=i.HEADERS_RECEIVED&&s(["status","statusText"]),r.readyState>=i.LOADING&&(s(["response"]),""!==r.responseType&&"text"!==r.responseType||s(["responseText"])),r.readyState!==i.DONE||""!==r.responseType&&"document"!==r.responseType||s(["responseXML"])},a=function(){e.onreadystatechange&&e.onreadystatechange.call(e,{target:e,currentTarget:e})};r.addEventListener?(r.addEventListener("readystatechange",o),Object.keys(e.eventListeners).forEach((function(t){e.eventListeners[t].forEach((function(e){r.addEventListener(t,e.listener,{capture:e.capture,once:e.once})}))})),r.addEventListener("readystatechange",a)):r.onreadystatechange=function(){o(),a()},y(r,"open",t)},i.useFilters=!1,i.parseXML=function(e){if(""!==e)try{if("undefined"!=typeof DOMParser){var t,n=new DOMParser,i="";try{var r=n.parseFromString("INVALID","text/xml").getElementsByTagName("parsererror");r.length&&(i=r[0].namespaceURI)}catch(e){}try{t=n.parseFromString(e,"text/xml")}catch(e){return null}return t.getElementsByTagNameNS(i,"parsererror").length?null:t}var s=new window.ActiveXObject("Microsoft.XMLDOM");return s.async="false",s.loadXML(e),0!==s.parseError.errorCode?null:s}catch(e){}return null},i.statusCodes={100:"Continue",101:"Switching Protocols",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",300:"Multiple Choice",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported"},o(i.prototype,s.EventTarget,{async:!0,open:function(e,t,n,r,s){if(this.method=e,this.url=t,this.async="boolean"!=typeof n||n,this.username=r,this.password=s,v(this),this.requestHeaders={},this.sendFlag=!1,!0===i.useFilters){var o=arguments,a=i.filters.some((function(e){return e.apply(this,o)}));if(a)return void i.defake(this,arguments)}this.readyStateChange(i.OPENED)},readyStateChange:function(e){this.readyState=e;var t,n,r=new s.Event("readystatechange",!1,!1,this);if("function"==typeof this.onreadystatechange)try{this.onreadystatechange(r)}catch(e){this.logError("Fake XHR onreadystatechange handler",e)}this.readyState===i.DONE&&(this.timedOut||this.aborted||0===this.status?(n={loaded:0,total:0},t=(this.timedOut?"timeout":this.aborted&&"abort")||"error"):(n={loaded:100,total:100},t="load"),a&&(this.upload.dispatchEvent(new s.ProgressEvent("progress",n,this)),this.upload.dispatchEvent(new s.ProgressEvent(t,n,this)),this.upload.dispatchEvent(new s.ProgressEvent("loadend",n,this))),this.dispatchEvent(new s.ProgressEvent("progress",n,this)),this.dispatchEvent(new s.ProgressEvent(t,n,this)),this.dispatchEvent(new s.ProgressEvent("loadend",n,this))),this.dispatchEvent(r)},setRequestHeader:function(e,t){if("string"!=typeof t)throw new TypeError("By RFC7230, section 3.2.4, header values should be strings. Got "+typeof t);w(this);var n=!0;if("function"==typeof this.unsafeHeadersEnabled&&(n=this.unsafeHeadersEnabled()),n&&(null!==f(h,e)||/^(Sec-|Proxy-)/i.test(e)))throw new Error('Refused to set unsafe header "'+e+'"');t=function(e){return e.replace(/^[\x09\x0A\x0D\x20]+|[\x09\x0A\x0D\x20]+$/g,"")}(t);var i=f(this.requestHeaders,e);i?this.requestHeaders[i]+=", "+t:this.requestHeaders[e]=t},setStatus:function(e){var t="number"==typeof e?e:200;k(this),this.status=t,this.statusText=i.statusCodes[t]},setResponseHeaders:function(e){k(this);var t=this.responseHeaders={};Object.keys(e).forEach((function(n){t[n]=e[n]})),this.async?this.readyStateChange(i.HEADERS_RECEIVED):this.readyState=i.HEADERS_RECEIVED},send:function(e){if(w(this),!/^(head)$/i.test(this.method)){var t=f(this.requestHeaders,"Content-Type");if(this.requestHeaders[t]){var r=this.requestHeaders[t].split(";");this.requestHeaders[t]=r[0]+";charset=utf-8"}else!c||e instanceof FormData||(this.requestHeaders["Content-Type"]="text/plain;charset=utf-8");this.requestBody=e}if(this.errorFlag=!1,this.sendFlag=this.async,v(this),"function"==typeof this.onSend&&this.onSend(this),n.supportsTimeout&&"object"==typeof setInterval.clock&&"object"==typeof Date.clock)var o=Date.now(),a=this,l=setInterval((function(){a.readyState===i.UNSENT||a.readyState===i.DONE?clearInterval(l):"number"==typeof a.timeout&&a.timeout>0&&Date.now()>=o+a.timeout&&(a.triggerTimeout(),clearInterval(l))}),1);this.dispatchEvent(new s.Event("loadstart",!1,!1,this))},abort:function(){this.aborted=!0,j(this),this.readyState=i.UNSENT},error:function(){v(this),this.errorFlag=!0,this.requestHeaders={},this.responseHeaders={},this.readyStateChange(i.DONE)},triggerTimeout:function(){n.supportsTimeout&&(this.timedOut=!0,j(this))},getResponseHeader:function(e){return this.readyState<i.HEADERS_RECEIVED||/^Set-Cookie2?$/i.test(e)?null:(e=f(this.responseHeaders,e),this.responseHeaders[e]||null)},getAllResponseHeaders:function(){if(this.readyState<i.HEADERS_RECEIVED)return"";var e=this.responseHeaders;return Object.keys(e).filter(m).reduce((function(t,n){return t+(n+": ")+e[n]+"\r\n"}),"")},setResponseBody:function(e){!function(e){if(e.readyState===i.DONE)throw new Error("Request done")}(this),function(e){if(e.async&&e.readyState!==i.HEADERS_RECEIVED)throw new Error("No headers received")}(this),function(e,t){var n=null,i="string"==typeof e;if("arraybuffer"===t?i||e instanceof ArrayBuffer||((n=new Error("Attempted to respond to fake XMLHttpRequest with "+e+", which is not a string or ArrayBuffer.")).name="InvalidBodyException"):i||((n=new Error("Attempted to respond to fake XMLHttpRequest with "+e+", which is not a string.")).name="InvalidBodyException"),n)throw n}(e,this.responseType);var t=this.overriddenMimeType||this.getResponseHeader("Content-Type"),n=""===this.responseType||"text"===this.responseType;if(v(this),this.async){var r=this.chunkSize||10,s=0;do{this.readyStateChange(i.LOADING),n&&(this.responseText=this.response+=e.substring(s,s+r)),s+=r}while(s<e.length)}this.response=function(e,t,n){if(""===e||"text"===e)return n;if(u&&"arraybuffer"===e)return g(n);if("json"===e)try{return JSON.parse(n)}catch(e){return null}else{if(d&&"blob"===e){var r={};return t&&(r.type=t),new Blob([g(n)],r)}if("document"===e)return b(t)?i.parseXML(n):null}throw new Error("Invalid responseType "+e)}(this.responseType,t,e),n&&(this.responseText=this.response),"document"===this.responseType?this.responseXML=this.response:""===this.responseType&&b(t)&&(this.responseXML=i.parseXML(this.responseText)),this.readyStateChange(i.DONE)},respond:function(e,t,n){this.setStatus(e),this.setResponseHeaders(t||{}),this.setResponseBody(n||"")},uploadProgress:function(e){a&&this.upload.dispatchEvent(new s.ProgressEvent("progress",e,this.upload))},downloadProgress:function(e){a&&this.dispatchEvent(new s.ProgressEvent("progress",e,this))},uploadError:function(e){l&&this.upload.dispatchEvent(new s.CustomEvent("error",{detail:e}))},overrideMimeType:function(e){if(this.readyState>=i.LOADING)throw new Error("INVALID_STATE_ERR");this.overriddenMimeType=e}});var x={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4};return o(i,x),o(i.prototype,x),{xhr:n,FakeXMLHttpRequest:i,useFakeXMLHttpRequest:function(){return i.restore=function(t){n.supportsXHR&&(e.XMLHttpRequest=n.GlobalXMLHttpRequest),n.supportsActiveX&&(e.ActiveXObject=n.GlobalActiveXObject),delete i.restore,!0!==t&&delete i.onCreate},n.supportsXHR&&(e.XMLHttpRequest=i),n.supportsActiveX&&(e.ActiveXObject=function(e){return"Microsoft.XMLHTTP"===e||/^Msxml2\.XMLHTTP/i.test(e)?new i:new n.GlobalActiveXObject(e)}),i}}}p.prototype=s.EventTarget;var y=void 0!==global?global:window;t.exports=o(w(y),{fakeXMLHttpRequestFor:w})},{"../configure-logger":1,"../event":5,"./blob":10,"@sinonjs/text-encoding":41,"just-extend":43}],12:[function(e,t,n){"use strict";t.exports={fakeServer:e("./fake-server"),fakeServerWithClock:e("./fake-server/fake-server-with-clock"),fakeXhr:e("./fake-xhr")}},{"./fake-server":9,"./fake-server/fake-server-with-clock":7,"./fake-xhr":11}],13:[function(e,t,n){"use strict";t.exports=function(e,t){var n=!0;try{e.forEach((function(){if(!t.apply(this,arguments))throw new Error}))}catch(e){n=!1}return n}},{}],14:[function(e,t,n){"use strict";t.exports=function(e){return e.displayName||e.name||(String(e).match(/function ([^\s\(]+)/)||[])[1]}},{}],15:[function(e,t,n){"use strict";t.exports={every:e("./every"),functionName:e("./function-name"),prototypes:e("./prototypes"),typeOf:e("./type-of"),valueToString:e("./value-to-string")}},{"./every":13,"./function-name":14,"./prototypes":19,"./type-of":22,"./value-to-string":23}],16:[function(e,t,n){"use strict";var i=e("./copy-prototype");t.exports=i(Array.prototype)},{"./copy-prototype":17}],17:[function(e,t,n){"use strict";var i=Function.call;t.exports=function(e){return Object.getOwnPropertyNames(e).reduce((function(t,n){return"size"!==n&&"caller"!==n&&"callee"!==n&&"arguments"!==n&&"function"==typeof e[n]&&(t[n]=i.bind(e[n])),t}),Object.create(null))}},{}],18:[function(e,t,n){"use strict";var i=e("./copy-prototype");t.exports=i(Function.prototype)},{"./copy-prototype":17}],19:[function(e,t,n){"use strict";t.exports={array:e("./array"),function:e("./function"),object:e("./object"),string:e("./string")}},{"./array":16,"./function":18,"./object":20,"./string":21}],20:[function(e,t,n){"use strict";var i=e("./copy-prototype");t.exports=i(Object.prototype)},{"./copy-prototype":17}],21:[function(e,t,n){"use strict";var i=e("./copy-prototype");t.exports=i(String.prototype)},{"./copy-prototype":17}],22:[function(e,t,n){"use strict";var i=e("type-detect");t.exports=function(e){return i(e).toLowerCase()}},{"type-detect":47}],23:[function(e,t,n){"use strict";t.exports=function(e){return e&&e.toString?e.toString():String(e)}},{}],24:[function(e,t,n){"use strict";var i=e("@sinonjs/samsam"),r={excludeConstructors:["Object",/^.$/],quoteStrings:!0,limitChildrenCount:0},s=[];function o(e){if(!e)return"";if(e.displayName)return e.displayName;if(e.name)return e.name;var t=e.toString().match(/function\s+([^\(]+)/m);return t&&t[1]||""}function a(e,t){var n,i,s=o(t&&t.constructor),a=e.excludeConstructors||r.excludeConstructors||[];for(n=0,i=a.length;n<i;++n){if("string"==typeof a[n]&&a[n]===s)return"";if(a[n].test&&a[n].test(s))return""}return s}function l(e,t){if("object"!=typeof e)return!1;var n,i;for(n=0,i=t.length;n<i;++n)if(t[n]===e)return!0;return!1}function c(e,t,n,r){if("string"==typeof t){if(0===t.length)return"(empty string)";var o=e.quoteStrings;return n||"boolean"!=typeof o||o?'"'+t+'"':t}if("function"==typeof t&&!(t instanceof RegExp))return c.func(t);if(l(t,n=n||[]))return"[Circular]";if("[object Array]"===Object.prototype.toString.call(t))return c.array.call(e,t,n);if(!t)return String(1/t==-1/0?"-0":t);if(i.isElement(t))return c.element(t);if("function"==typeof t.toString&&t.toString!==Object.prototype.toString)return t.toString();var a,u;for(a=0,u=s.length;a<u;a++)if(t===s[a].object)return s[a].value;return"undefined"!=typeof Set&&t instanceof Set?c.set.call(e,t,n):c.object.call(e,t,n,r)}function u(e){for(var t in e)this[t]=e[t]}void 0!==global&&s.push({object:global,value:"[object global]"}),"undefined"!=typeof document&&s.push({object:document,value:"[object HTMLDocument]"}),"undefined"!=typeof window&&s.push({object:window,value:"[object Window]"}),c.func=function(e){return"function "+o(e)+"() {}"},c.array=function(e,t,n){(t=t||[]).push(e);var i,r,s=[];for(r=this.limitChildrenCount>0?Math.min(this.limitChildrenCount,e.length):e.length,i=0;i<r;++i)s.push(c(this,e[i],t));return r<e.length&&s.push("[... "+(e.length-r)+" more elements]"),function(e,t){return(t=t||["[","]"])[0]+e+t[1]}(s.join(", "),n)},c.set=function(e,t){return c.array.call(this,Array.from(e),t,["Set {","}"])},c.object=function(e,t,n){(t=t||[]).push(e),n=n||0;var i,r,s,o,u,d,h=[],p=Object.keys(e).sort(),f=3;for(d=this.limitChildrenCount>0?Math.min(this.limitChildrenCount,p.length):p.length,o=0;o<d;++o)r=l(s=e[i=p[o]],t)?"[Circular]":c(this,s,t,n+2),f+=(r=(/\s/.test(i)?'"'+i+'"':i)+": "+r).length,h.push(r);var m=a(this,e),g=m?"["+m+"] ":"",b="";for(o=0,u=n;o<u;++o)b+=" ";return d<p.length&&h.push("[... "+(p.length-d)+" more elements]"),f+n>80?g+"{\n  "+b+h.join(",\n  "+b)+"\n"+b+"}":g+"{ "+h.join(", ")+" }"},c.element=function(e){var t,n,i,r,s,o=e.tagName.toLowerCase(),a=e.attributes,l=[];for(i=0,r=a.length;i<r;++i)n=(t=a.item(i)).nodeName.toLowerCase().replace("html:",""),s=t.nodeValue,"contenteditable"===n&&"inherit"===s||s&&l.push(n+'="'+s+'"');var c="<"+o+(l.length>0?" ":""),u=e.innerHTML||"";return u.length>20&&(u=u.substr(0,20)+"[...]"),(c+l.join(" ")+">"+u+"</"+o+">").replace(/ contentEditable="inherit"/,"")},u.prototype={functionName:o,configure:function(e){return new u(e)},constructorName:function(e){return a(this,e)},ascii:function(e,t,n){return c(this,e,t,n)}},t.exports=u.prototype},{"@sinonjs/samsam":40}],25:[function(e,t,n){"use strict";var i=e("./get-class"),r=e("./identical"),s=e("./is-arguments"),o=e("./is-date"),a=e("./is-element"),l=e("./is-nan"),c=e("./is-object"),u=e("./is-set"),d=e("./is-subset"),h=e("./get-class-name"),p=Array.prototype.every,f=Date.prototype.getTime,m=Object.prototype.hasOwnProperty,g=Array.prototype.indexOf,b=Object.keys;function v(e,t,n){var v=[],w=[],y=[],k=[],j={};return function e(t,x,E,T){if(n&&n.isMatcher(x))return n.isMatcher(t)?t===x:x.test(t);var q=typeof t,S=typeof x;if(t===x||l(t)||l(x)||null==t||null==x||"object"!==q||"object"!==S)return r(t,x);if(a(t)||a(x))return!1;var _=o(t),C=o(x);if((_||C)&&(!_||!C||f.call(t)!==f.call(x)))return!1;if(t instanceof RegExp&&x instanceof RegExp&&t.toString()!==x.toString())return!1;if(t instanceof Error&&x instanceof Error&&(t.constructor!==x.constructor||t.message!==x.message||t.stack!==x.stack))return!1;var A=i(t),O=i(x),M=b(t),U=b(x),P=h(t),I=h(x);if(s(t)||s(x)){if(t.length!==x.length)return!1}else if(q!==S||A!==O||M.length!==U.length||P&&I&&P!==I)return!1;return u(t)||u(x)?!(!u(t)||!u(x)||t.size!==x.size)&&d(t,x,e):p.call(M,(function(n){if(!m.call(x,n))return!1;var i=t[n],r=x[n],s=c(i),o=c(r),a=s?g.call(v,i):-1,l=o?g.call(w,r):-1,u=-1!==a?y[a]:E+"["+JSON.stringify(n)+"]",d=-1!==l?k[l]:T+"["+JSON.stringify(n)+"]",h=u+d;return!!j[h]||(-1===a&&s&&(v.push(i),y.push(u)),-1===l&&o&&(w.push(r),k.push(d)),s&&o&&(j[h]=!0),e(i,r,u,d))}))}(e,t,"$1","$2")}v.use=function(e){return function(t,n){return v(t,n,e)}},t.exports=v},{"./get-class":27,"./get-class-name":26,"./identical":28,"./is-arguments":29,"./is-date":30,"./is-element":31,"./is-nan":32,"./is-object":34,"./is-set":35,"./is-subset":36}],26:[function(e,t,n){"use strict";var i=/function (\w+)\s*\(/;t.exports=function(e){if(e.constructor&&"name"in e.constructor)return e.constructor.name;if("function"==typeof e.constructor){var t=e.constructor.toString().match(i);if(t.length>1)return t[1]}return null}},{}],27:[function(e,t,n){"use strict";var i=Object.prototype;t.exports=function(e){return i.toString.call(e).split(/[ \]]/)[1]}},{}],28:[function(e,t,n){"use strict";var i=e("./is-nan"),r=e("./is-neg-zero");t.exports=function(e,t){return!!(e===t||i(e)&&i(t))&&(0!==e||r(e)===r(t))}},{"./is-nan":32,"./is-neg-zero":33}],29:[function(e,t,n){"use strict";var i=e("./get-class");t.exports=function(e){if("Arguments"===i(e))return!0;if("object"!=typeof e||"number"!=typeof e.length||"Array"===i(e))return!1;if("function"==typeof e.callee)return!0;try{e[e.length]=6,delete e[e.length]}catch(e){return!0}return!1}},{"./get-class":27}],30:[function(e,t,n){"use strict";t.exports=function(e){return e instanceof Date}},{}],31:[function(e,t,n){"use strict";var i="undefined"!=typeof document&&document.createElement("div");t.exports=function(e){if(!e||1!==e.nodeType||!i)return!1;try{e.appendChild(i),e.removeChild(i)}catch(e){return!1}return!0}},{}],32:[function(e,t,n){"use strict";t.exports=function(e){return"number"==typeof e&&e!=e}},{}],33:[function(e,t,n){"use strict";t.exports=function(e){return 0===e&&1/e==-1/0}},{}],34:[function(e,t,n){"use strict";t.exports=function(e){return!("object"!=typeof e||null===e||e instanceof Boolean||e instanceof Date||e instanceof Error||e instanceof Number||e instanceof RegExp||e instanceof String)}},{}],35:[function(e,t,n){"use strict";t.exports=function(e){return"undefined"!=typeof Set&&e instanceof Set||!1}},{}],36:[function(e,t,n){"use strict";t.exports=function(e,t,n){var i=!0;return e.forEach((function(e){var r=!1;t.forEach((function(t){n(t,e)&&(r=!0)})),i=i&&r})),i}},{}],37:[function(e,t,n){"use strict";var i=e("@sinonjs/commons").prototypes.string.slice,r=e("@sinonjs/commons").typeOf;t.exports=function(e){var t="";function n(e){return"string"==typeof e?"'"+e+"'":String(e)}return"map"===r(e)?(e.forEach((function(e,i){t+="["+n(i)+","+n(e)+"],"})),t=i(t,0,-1)):(e.forEach((function(e){t+=n(e)+","})),t=i(t,0,-1))}},{"@sinonjs/commons":15}],38:[function(e,t,n){"use strict";var i=e("./deep-equal").use(c),r=e("./get-class"),s=e("./is-date"),o=e("./is-set"),a=e("./is-subset"),l=e("./matcher");function c(e,t){if(t&&"function"==typeof t.test)return t.test(e);if("function"==typeof t)return!0===t(e);if("string"==typeof t)return t=t.toLowerCase(),("string"==typeof e||!!e)&&String(e).toLowerCase().indexOf(t)>=0;if("number"==typeof t)return t===e;if("boolean"==typeof t)return t===e;if(void 0===t)return void 0===e;if(null===t)return null===e;if(null===e)return!1;if(o(e))return a(t,e,c);if("Array"===r(e)&&"Array"===r(t))return function(e,t,n){if(0===t.length)return!0;var i,r,s,o;for(i=0,r=e.length;i<r;++i)if(n(e[i],t[0])){for(s=0,o=t.length;s<o;++s){if(i+s>=r)return!1;if(!n(e[i+s],t[s]))return!1}return!0}return!1}(e,t,c);if(s(t))return s(e)&&e.getTime()===t.getTime();if(t&&"object"==typeof t){if(t===e)return!0;if("object"!=typeof e)return!1;var n;for(n in t){var l=e[n];if(void 0===l&&"function"==typeof e.getAttribute&&(l=e.getAttribute(n)),null===t[n]||void 0===t[n]){if(l!==t[n])return!1}else if(void 0===l||!i(l,t[n]))return!1}return!0}throw new Error("Matcher was not a string, a number, a function, a boolean or an object")}Object.keys(l).forEach((function(e){c[e]=l[e]})),t.exports=c},{"./deep-equal":25,"./get-class":27,"./is-date":30,"./is-set":35,"./is-subset":36,"./matcher":39}],39:[function(e,t,n){"use strict";var i=e("@sinonjs/commons").prototypes.array,r=e("./deep-equal").use(T),s=e("@sinonjs/commons").every,o=e("@sinonjs/commons").functionName,a=e("lodash.get"),l=e("./iterable-to-string"),c=e("@sinonjs/commons").prototypes.object,u=e("@sinonjs/commons").prototypes.string,d=e("@sinonjs/commons").typeOf,h=e("@sinonjs/commons").valueToString,p=i.indexOf,f=i.every,m=i.join,g=i.map,b=i.some,v=c.hasOwnProperty,w=c.isPrototypeOf,y=u.indexOf;function k(e,t,n){var i=d(e);if(i!==t)throw new TypeError("Expected type of "+n+" to be "+t+", but was "+i)}var j={toString:function(){return this.message}};function x(e){return w(j,e)}var E={function:function(e,t,n){e.test=t,e.message=n||"match("+o(t)+")"},number:function(e,t){e.test=function(e){return t==e}},object:function(e,t){var n;return"function"==typeof t.test?(e.test=function(e){return!0===t.test(e)},e.message="match("+o(t.test)+")",e):(n=g(Object.keys(t),(function(e){return e+": "+h(t[e])})),e.test=function(e){return function e(t,n){return null!=t&&f(Object.keys(n),(function(i){var s=n[i],o=t[i];if(x(s)){if(!s.test(o))return!1}else if("object"===d(s)){if(!e(o,s))return!1}else if(!r(o,s))return!1;return!0}))}(e,t)},e.message="match("+m(n,", ")+")",e)},regexp:function(e,t){e.test=function(e){return"string"==typeof e&&t.test(e)}},string:function(e,t){e.test=function(e){return"string"==typeof e&&-1!==y(e,t)},e.message='match("'+t+'")'}};function T(e,t){var n=Object.create(j),i=d(e);return i in E?E[i](n,e,t):n.test=function(t){return r(t,e)},n.message||(n.message="match("+h(e)+")"),n}function q(e,t){return function(n,i){k(n,"string","property");var s=1===arguments.length,o=t+'("'+n+'"';return s||(o+=", "+h(i)),T((function(t){return!(null==t||!e(t,n))&&(s||r(t[n],i))}),o+=")")}}j.or=function(e){if(!arguments.length)throw new TypeError("Matcher expected");x(e)||(e=T(e));var t=this,n=Object.create(j);return n.test=function(n){return t.test(n)||e.test(n)},n.message=t.message+".or("+e.message+")",n},j.and=function(e){if(!arguments.length)throw new TypeError("Matcher expected");x(e)||(e=T(e));var t=this,n=Object.create(j);return n.test=function(n){return t.test(n)&&e.test(n)},n.message=t.message+".and("+e.message+")",n},T.isMatcher=x,T.any=T((function(){return!0}),"any"),T.defined=T((function(e){return null!=e}),"defined"),T.truthy=T((function(e){return!!e}),"truthy"),T.falsy=T((function(e){return!e}),"falsy"),T.same=function(e){return T((function(t){return e===t}),"same("+h(e)+")")},T.in=function(e){if(!Array.isArray(e))throw new TypeError("array expected");return T((function(t){return b(e,(function(e){return e===t}))}),"in("+h(e)+")")},T.typeOf=function(e){return k(e,"string","type"),T((function(t){return d(t)===e}),'typeOf("'+e+'")')},T.instanceOf=function(e){return"undefined"==typeof Symbol||void 0===Symbol.hasInstance?k(e,"function","type"):function(e,t,n,i){if(null==e[t])throw new TypeError("Expected "+n+" to have method "+i)}(e,Symbol.hasInstance,"type","[Symbol.hasInstance]"),T((function(t){return t instanceof e}),"instanceOf("+(o(e)||Object.prototype.toString.call(e))+")")},T.has=q((function(e,t){return"object"==typeof e?t in e:void 0!==e[t]}),"has"),T.hasOwn=q((function(e,t){return v(e,t)}),"hasOwn"),T.hasNested=function(e,t){k(e,"string","property");var n=1===arguments.length,i='hasNested("'+e+'"';return n||(i+=", "+h(t)),T((function(i){return null!=i&&void 0!==a(i,e)&&(n||r(a(i,e),t))}),i+=")")},T.every=function(e){if(!x(e))throw new TypeError("Matcher expected");return T((function(t){return"object"===d(t)?s(Object.keys(t),(function(n){return e.test(t[n])})):!!t&&"function"===d(t.forEach)&&s(t,(function(t){return e.test(t)}))}),"every("+e.message+")")},T.some=function(e){if(!x(e))throw new TypeError("Matcher expected");return T((function(t){return"object"===d(t)?!s(Object.keys(t),(function(n){return!e.test(t[n])})):!!t&&"function"===d(t.forEach)&&!s(t,(function(t){return!e.test(t)}))}),"some("+e.message+")")},T.array=T.typeOf("array"),T.array.deepEquals=function(e){return T((function(t){var n=t.length===e.length;return"array"===d(t)&&n&&s(t,(function(t,n){return e[n]===t}))}),"deepEquals(["+l(e)+"])")},T.array.startsWith=function(e){return T((function(t){return"array"===d(t)&&s(e,(function(e,n){return t[n]===e}))}),"startsWith(["+l(e)+"])")},T.array.endsWith=function(e){return T((function(t){var n=t.length-e.length;return"array"===d(t)&&s(e,(function(e,i){return t[n+i]===e}))}),"endsWith(["+l(e)+"])")},T.array.contains=function(e){return T((function(t){return"array"===d(t)&&s(e,(function(e){return-1!==p(t,e)}))}),"contains(["+l(e)+"])")},T.map=T.typeOf("map"),T.map.deepEquals=function(e){return T((function(t){var n=t.size===e.size;return"map"===d(t)&&n&&s(t,(function(t,n){return e.has(n)&&e.get(n)===t}))}),"deepEquals(Map["+l(e)+"])")},T.map.contains=function(e){return T((function(t){return"map"===d(t)&&s(e,(function(e,n){return t.has(n)&&t.get(n)===e}))}),"contains(Map["+l(e)+"])")},T.set=T.typeOf("set"),T.set.deepEquals=function(e){return T((function(t){var n=t.size===e.size;return"set"===d(t)&&n&&s(t,(function(t){return e.has(t)}))}),"deepEquals(Set["+l(e)+"])")},T.set.contains=function(e){return T((function(t){return"set"===d(t)&&s(e,(function(e){return t.has(e)}))}),"contains(Set["+l(e)+"])")},T.bool=T.typeOf("boolean"),T.number=T.typeOf("number"),T.string=T.typeOf("string"),T.object=T.typeOf("object"),T.func=T.typeOf("function"),T.regexp=T.typeOf("regexp"),T.date=T.typeOf("date"),T.symbol=T.typeOf("symbol"),t.exports=T},{"./deep-equal":25,"./iterable-to-string":37,"@sinonjs/commons":15,"lodash.get":44}],40:[function(e,t,n){"use strict";var i=e("./identical"),r=e("./is-arguments"),s=e("./is-element"),o=e("./is-neg-zero"),a=e("./match"),l=e("./deep-equal").use(a),c=e("./matcher");t.exports={createMatcher:c,deepEqual:l,isArguments:r,isElement:s,isNegZero:o,identical:i,match:a}},{"./deep-equal":25,"./identical":28,"./is-arguments":29,"./is-element":31,"./is-neg-zero":33,"./match":38,"./matcher":39}],41:[function(e,t,n){},{}],42:[function(e,t,n){t.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},{}],43:[function(e,t,n){function i(e){return Array.isArray(e)||"[object Object]"=={}.toString.call(e)}t.exports=function e(){var t=[].slice.call(arguments),n=!1;"boolean"==typeof t[0]&&(n=t.shift());var r=t[0];if(!r||"object"!=typeof r&&"function"!=typeof r)throw new Error("extendee must be an object");for(var s=t.slice(1),o=s.length,a=0;a<o;a++){var l=s[a];for(var c in l)if(l.hasOwnProperty(c)){var u=l[c];if(n&&i(u)){var d=Array.isArray(u)?[]:{};r[c]=e(!0,r.hasOwnProperty(c)?r[c]:d,u)}else r[c]=u}}return r}},{}],44:[function(e,t,n){var i,r=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,s=/^\w*$/,o=/^\./,a=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,l=/\\(\\)?/g,c=/^\[object .+?Constructor\]$/,u="object"==typeof global&&global&&global.Object===Object&&global,d="object"==typeof self&&self&&self.Object===Object&&self,h=u||d||Function("return this")(),p=Array.prototype,f=Function.prototype,m=Object.prototype,g=h["__core-js_shared__"],b=(i=/[^.]+$/.exec(g&&g.keys&&g.keys.IE_PROTO||""))?"Symbol(src)_1."+i:"",v=f.toString,w=m.hasOwnProperty,y=m.toString,k=RegExp("^"+v.call(w).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),j=h.Symbol,x=p.splice,E=I(h,"Map"),T=I(Object,"create"),q=j?j.prototype:void 0,S=q?q.toString:void 0;function _(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function C(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function A(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function O(e,t){for(var n,i,r=e.length;r--;)if((n=e[r][0])===(i=t)||n!=n&&i!=i)return r;return-1}function M(e,t){for(var n,i=0,o=(t=function(e,t){if(F(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!R(e))||(s.test(e)||!r.test(e)||null!=t&&e in Object(t))}(t,e)?[t]:F(n=t)?n:$(n)).length;null!=e&&i<o;)e=e[D(t[i++])];return i&&i==o?e:void 0}function U(e){return!(!B(e)||(t=e,b&&b in t))&&(function(e){var t=B(e)?y.call(e):"";return"[object Function]"==t||"[object GeneratorFunction]"==t}(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}(e)?k:c).test(function(e){if(null!=e){try{return v.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(e));var t}function P(e,t){var n,i,r=e.__data__;return("string"==(i=typeof(n=t))||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==n:null===n)?r["string"==typeof t?"string":"hash"]:r.map}function I(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return U(n)?n:void 0}_.prototype.clear=function(){this.__data__=T?T(null):{}},_.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},_.prototype.get=function(e){var t=this.__data__;if(T){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return w.call(t,e)?t[e]:void 0},_.prototype.has=function(e){var t=this.__data__;return T?void 0!==t[e]:w.call(t,e)},_.prototype.set=function(e,t){return this.__data__[e]=T&&void 0===t?"__lodash_hash_undefined__":t,this},C.prototype.clear=function(){this.__data__=[]},C.prototype.delete=function(e){var t=this.__data__,n=O(t,e);return!(n<0||(n==t.length-1?t.pop():x.call(t,n,1),0))},C.prototype.get=function(e){var t=this.__data__,n=O(t,e);return n<0?void 0:t[n][1]},C.prototype.has=function(e){return O(this.__data__,e)>-1},C.prototype.set=function(e,t){var n=this.__data__,i=O(n,e);return i<0?n.push([e,t]):n[i][1]=t,this},A.prototype.clear=function(){this.__data__={hash:new _,map:new(E||C),string:new _}},A.prototype.delete=function(e){return P(this,e).delete(e)},A.prototype.get=function(e){return P(this,e).get(e)},A.prototype.has=function(e){return P(this,e).has(e)},A.prototype.set=function(e,t){return P(this,e).set(e,t),this};var $=L((function(e){var t;e=null==(t=e)?"":function(e){if("string"==typeof e)return e;if(R(e))return S?S.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(t);var n=[];return o.test(e)&&n.push(""),e.replace(a,(function(e,t,i,r){n.push(i?r.replace(l,"$1"):t||e)})),n}));function D(e){if("string"==typeof e||R(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function L(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var i=arguments,r=t?t.apply(this,i):i[0],s=n.cache;if(s.has(r))return s.get(r);var o=e.apply(this,i);return n.cache=s.set(r,o),o};return n.cache=new(L.Cache||A),n}L.Cache=A;var F=Array.isArray;function B(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function R(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==y.call(e)}t.exports=function(e,t,n){var i=null==e?void 0:M(e,t);return void 0===i?n:i}},{}],45:[function(require,module,exports){"use strict";var userAgent=global.navigator&&global.navigator.userAgent,isRunningInIE=userAgent&&userAgent.indexOf("MSIE ")>-1,maxTimeout=Math.pow(2,31)-1;isRunningInIE&&(global.setTimeout=global.setTimeout,global.clearTimeout=global.clearTimeout,global.setInterval=global.setInterval,global.clearInterval=global.clearInterval,global.Date=global.Date),void 0!==global.setImmediate&&(global.setImmediate=global.setImmediate,global.clearImmediate=global.clearImmediate);var NOOP=function(){},timeoutResult=setTimeout(NOOP,0),addTimerReturnsObject="object"==typeof timeoutResult,hrtimePresent=global.process&&"function"==typeof global.process.hrtime,nextTickPresent=global.process&&"function"==typeof global.process.nextTick,performancePresent=global.performance&&"function"==typeof global.performance.now,requestAnimationFramePresent=global.requestAnimationFrame&&"function"==typeof global.requestAnimationFrame,cancelAnimationFramePresent=global.cancelAnimationFrame&&"function"==typeof global.cancelAnimationFrame;clearTimeout(timeoutResult);var NativeDate=Date,uniqueTimerId=1;function parseTime(e){if(!e)return 0;var t,n=e.split(":"),i=n.length,r=i,s=0;if(i>3||!/^(\d\d:){0,2}\d\d?$/.test(e))throw new Error("tick only understands numbers, 'm:s' and 'h:m:s'. Each part must be two digits");for(;r--;){if((t=parseInt(n[r],10))>=60)throw new Error("Invalid time "+e);s+=t*Math.pow(60,i-r-1)}return 1e3*s}function fixedFloor(e){return e>=0?Math.floor(e):Math.ceil(e)}function fixedModulo(e,t){return(e%t+t)%t}function getEpoch(e){if(!e)return 0;if("function"==typeof e.getTime)return e.getTime();if("number"==typeof e)return e;throw new TypeError("now should be milliseconds since UNIX epoch")}function inRange(e,t,n){return n&&n.callAt>=e&&n.callAt<=t}function mirrorDateProperties(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return t.now?e.now=function(){return e.clock.now}:delete e.now,t.toSource?e.toSource=function(){return t.toSource()}:delete e.toSource,e.toString=function(){return t.toString()},e.prototype=t.prototype,e.parse=t.parse,e.UTC=t.UTC,e.prototype.toUTCString=t.prototype.toUTCString,e}function createDate(){return mirrorDateProperties((function e(t,n,i,r,s,o,a){switch(arguments.length){case 0:return new NativeDate(e.clock.now);case 1:return new NativeDate(t);case 2:return new NativeDate(t,n);case 3:return new NativeDate(t,n,i);case 4:return new NativeDate(t,n,i,r);case 5:return new NativeDate(t,n,i,r,s);case 6:return new NativeDate(t,n,i,r,s,o);default:return new NativeDate(t,n,i,r,s,o,a)}}),NativeDate)}function enqueueJob(e,t){e.jobs||(e.jobs=[]),e.jobs.push(t)}function runJobs(e){if(e.jobs){for(var t=0;t<e.jobs.length;t++){var n=e.jobs[t];n.func.apply(null,n.args)}e.jobs=[]}}function addTimer(e,t){if(void 0===t.func)throw new Error("Callback must be provided to timer calls");return t.type=t.immediate?"Immediate":"Timeout",t.hasOwnProperty("delay")&&(t.delay=t.delay>maxTimeout?1:t.delay,t.delay=Math.max(0,t.delay)),t.hasOwnProperty("interval")&&(t.type="Interval",t.interval=t.interval>maxTimeout?1:t.interval),t.hasOwnProperty("animation")&&(t.type="AnimationFrame",t.animation=!0),e.timers||(e.timers={}),t.id=uniqueTimerId++,t.createdAt=e.now,t.callAt=e.now+(parseInt(t.delay)||(e.duringTick?1:0)),e.timers[t.id]=t,addTimerReturnsObject?{id:t.id,ref:NOOP,unref:NOOP}:t.id}function compareTimers(e,t){return e.callAt<t.callAt?-1:e.callAt>t.callAt?1:e.immediate&&!t.immediate?-1:!e.immediate&&t.immediate?1:e.createdAt<t.createdAt?-1:e.createdAt>t.createdAt?1:e.id<t.id?-1:e.id>t.id?1:void 0}function firstTimerInRange(e,t,n){var i,r=e.timers,s=null;for(i in r)r.hasOwnProperty(i)&&(!inRange(t,n,r[i])||s&&1!==compareTimers(s,r[i])||(s=r[i]));return s}function firstTimer(e){var t,n=e.timers,i=null;for(t in n)n.hasOwnProperty(t)&&(i&&1!==compareTimers(i,n[t])||(i=n[t]));return i}function lastTimer(e){var t,n=e.timers,i=null;for(t in n)n.hasOwnProperty(t)&&(i&&-1!==compareTimers(i,n[t])||(i=n[t]));return i}function callTimer(clock,timer){"number"==typeof timer.interval?clock.timers[timer.id].callAt+=timer.interval:delete clock.timers[timer.id],"function"==typeof timer.func?timer.func.apply(null,timer.args):eval(timer.func)}function clearTimer(e,t,n){if(t&&(e.timers||(e.timers=[]),"object"==typeof t&&(t=t.id),e.timers.hasOwnProperty(t))){var i=e.timers[t];if(i.type!==n){var r="AnimationFrame"===n?"cancelAnimationFrame":"clear"+n,s="AnimationFrame"===i.type?"requestAnimationFrame":"set"+i.type;throw new Error("Cannot clear timer: timer created with "+s+"() but cleared with "+r+"()")}delete e.timers[t]}}function uninstall(e,t,n){var i,r,s;for(r=0,s=e.methods.length;r<s;r++)if("hrtime"===(i=e.methods[r])&&t.process)t.process.hrtime=e._hrtime;else if("nextTick"===i&&t.process)t.process.nextTick=e._nextTick;else if(t[i]&&t[i].hadOwnProperty)t[i]=e["_"+i],"clearInterval"===i&&!0===n.shouldAdvanceTime&&t[i](e.attachedInterval);else try{delete t[i]}catch(e){}return e.methods=[],e.timers?Object.keys(e.timers).map((function(t){return e.timers[t]})):[]}function hijackMethod(e,t,n){var i;if(n[t].hadOwnProperty=Object.prototype.hasOwnProperty.call(e,t),n["_"+t]=e[t],"Date"===t){var r=mirrorDateProperties(n[t],e[t]);e[t]=r}else for(i in e[t]=function(){return n[t].apply(n,arguments)},n[t])n[t].hasOwnProperty(i)&&(e[t][i]=n[t][i]);e[t].clock=n}function doIntervalTick(e,t){e.tick(t)}var timers={setTimeout:setTimeout,clearTimeout:clearTimeout,setImmediate:global.setImmediate,clearImmediate:global.clearImmediate,setInterval:setInterval,clearInterval:clearInterval,Date:Date};hrtimePresent&&(timers.hrtime=global.process.hrtime),nextTickPresent&&(timers.nextTick=global.process.nextTick),performancePresent&&(timers.performance=global.performance),requestAnimationFramePresent&&(timers.requestAnimationFrame=global.requestAnimationFrame),cancelAnimationFramePresent&&(timers.cancelAnimationFrame=global.cancelAnimationFrame);var keys=Object.keys||function(e){var t,n=[];for(t in e)e.hasOwnProperty(t)&&n.push(t);return n};function createClock(e,t){t=t||1e3;var n={now:getEpoch(e=e||0),hrNow:0,timeouts:{},Date:createDate(),loopLimit:t};function i(){return 16-(n.now-e)%16}function r(e){n.hrNow+=e-n.now}return n.Date.clock=n,n.setTimeout=function(e,t){return addTimer(n,{func:e,args:Array.prototype.slice.call(arguments,2),delay:t})},n.clearTimeout=function(e){return clearTimer(n,e,"Timeout")},n.nextTick=function(e){return enqueueJob(n,{func:e,args:Array.prototype.slice.call(arguments,1)})},n.setInterval=function(e,t){return addTimer(n,{func:e,args:Array.prototype.slice.call(arguments,2),delay:t,interval:t})},n.clearInterval=function(e){return clearTimer(n,e,"Interval")},n.setImmediate=function(e){return addTimer(n,{func:e,args:Array.prototype.slice.call(arguments,1),immediate:!0})},n.clearImmediate=function(e){return clearTimer(n,e,"Immediate")},n.requestAnimationFrame=function(e){var t=addTimer(n,{func:e,delay:i(),args:[n.now+i()],animation:!0});return t.id||t},n.cancelAnimationFrame=function(e){return clearTimer(n,e,"AnimationFrame")},n.tick=function(e){e="number"==typeof e?e:parseTime(e);var t,i,s,o=n.now,a=n.now+e,l=n.now;for(n.duringTick=!0,s=n.now,runJobs(n),s!==n.now&&(o+=n.now-s,a+=n.now-s),t=firstTimerInRange(n,o,a);t&&o<=a;){if(n.timers[t.id]){r(t.callAt),o=t.callAt,n.now=t.callAt,s=n.now;try{runJobs(n),callTimer(n,t)}catch(e){i=i||e}s!==n.now&&(o+=n.now-s,a+=n.now-s,l+=n.now-s)}t=firstTimerInRange(n,l,a),l=o}if(s=n.now,runJobs(n),s!==n.now&&(o+=n.now-s,a+=n.now-s),n.duringTick=!1,t=firstTimerInRange(n,o,a))try{n.tick(a-n.now)}catch(e){i=i||e}else r(a),n.now=a;if(i)throw i;return n.now},n.next=function(){runJobs(n);var e=firstTimer(n);if(!e)return n.now;n.duringTick=!0;try{return r(e.callAt),n.now=e.callAt,callTimer(n,e),runJobs(n),n.now}finally{n.duringTick=!1}},n.runAll=function(){var e;for(runJobs(n),e=0;e<n.loopLimit;e++){if(!n.timers)return n.now;if(0===keys(n.timers).length)return n.now;n.next()}throw new Error("Aborting after running "+n.loopLimit+" timers, assuming an infinite loop!")},n.runToFrame=function(){return n.tick(i())},n.runToLast=function(){var e=lastTimer(n);return e?n.tick(e.callAt):(runJobs(n),n.now)},n.reset=function(){n.timers={}},n.setSystemTime=function(e){var t,i,r=getEpoch(e),s=r-n.now;for(t in n.now=r,n.timers)n.timers.hasOwnProperty(t)&&((i=n.timers[t]).createdAt+=s,i.callAt+=s)},performancePresent&&(n.performance=Object.create(global.performance),n.performance.now=function(){return n.hrNow}),hrtimePresent&&(n.hrtime=function(e){if(Array.isArray(e)){var t=e[0]+e[1]/1e9,i=n.hrNow/1e3-t;return[fixedFloor(i),fixedModulo(1e9*i,1e9)]}return[fixedFloor(n.hrNow/1e3),fixedModulo(1e6*n.hrNow,1e9)]}),n}exports.timers=timers,exports.createClock=createClock,exports.install=function(e){if(arguments.length>1||e instanceof Date||Array.isArray(e)||"number"==typeof e)throw new TypeError("lolex.install called with "+String(e)+" lolex 2.0+ requires an object parameter - see https://github.com/sinonjs/lolex");var t,n;(e=void 0!==e?e:{}).shouldAdvanceTime=e.shouldAdvanceTime||!1,e.advanceTimeDelta=e.advanceTimeDelta||20;var i=e.target||global,r=createClock(e.now,e.loopLimit);for(r.uninstall=function(){return uninstall(r,i,e)},r.methods=e.toFake||[],0===r.methods.length&&(r.methods=keys(timers).filter((function(e){return"nextTick"!==e}))),t=0,n=r.methods.length;t<n;t++)if("hrtime"===r.methods[t])i.process&&"function"==typeof i.process.hrtime&&hijackMethod(i.process,r.methods[t],r);else if("nextTick"===r.methods[t])i.process&&"function"==typeof i.process.nextTick&&hijackMethod(i.process,r.methods[t],r);else{if("setInterval"===r.methods[t]&&!0===e.shouldAdvanceTime){var s=doIntervalTick.bind(null,r,e.advanceTimeDelta),o=i[r.methods[t]](s,e.advanceTimeDelta);r.attachedInterval=o}hijackMethod(i,r.methods[t],r)}return r}},{}],46:[function(e,t,n){var i=e("isarray");t.exports=p,t.exports.parse=s,t.exports.compile=function(e,t){return a(s(e,t))},t.exports.tokensToFunction=a,t.exports.tokensToRegExp=h;var r=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function s(e,t){for(var n,i=[],s=0,o=0,a="",u=t&&t.delimiter||"/";null!=(n=r.exec(e));){var d=n[0],h=n[1],p=n.index;if(a+=e.slice(o,p),o=p+d.length,h)a+=h[1];else{var f=e[o],m=n[2],g=n[3],b=n[4],v=n[5],w=n[6],y=n[7];a&&(i.push(a),a="");var k=null!=m&&null!=f&&f!==m,j="+"===w||"*"===w,x="?"===w||"*"===w,E=n[2]||u,T=b||v;i.push({name:g||s++,prefix:m||"",delimiter:E,optional:x,repeat:j,partial:k,asterisk:!!y,pattern:T?c(T):y?".*":"[^"+l(E)+"]+?"})}}return o<e.length&&(a+=e.substr(o)),a&&i.push(a),i}function o(e){return encodeURI(e).replace(/[\/?#]/g,(function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()}))}function a(e){for(var t=new Array(e.length),n=0;n<e.length;n++)"object"==typeof e[n]&&(t[n]=new RegExp("^(?:"+e[n].pattern+")$"));return function(n,r){for(var s="",a=n||{},l=(r||{}).pretty?o:encodeURIComponent,c=0;c<e.length;c++){var u=e[c];if("string"!=typeof u){var d,h=a[u.name];if(null==h){if(u.optional){u.partial&&(s+=u.prefix);continue}throw new TypeError('Expected "'+u.name+'" to be defined')}if(i(h)){if(!u.repeat)throw new TypeError('Expected "'+u.name+'" to not repeat, but received `'+JSON.stringify(h)+"`");if(0===h.length){if(u.optional)continue;throw new TypeError('Expected "'+u.name+'" to not be empty')}for(var p=0;p<h.length;p++){if(d=l(h[p]),!t[c].test(d))throw new TypeError('Expected all "'+u.name+'" to match "'+u.pattern+'", but received `'+JSON.stringify(d)+"`");s+=(0===p?u.prefix:u.delimiter)+d}}else{if(d=u.asterisk?encodeURI(h).replace(/[?#]/g,(function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})):l(h),!t[c].test(d))throw new TypeError('Expected "'+u.name+'" to match "'+u.pattern+'", but received "'+d+'"');s+=u.prefix+d}}else s+=u}return s}}function l(e){return e.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function c(e){return e.replace(/([=!:$\/()])/g,"\\$1")}function u(e,t){return e.keys=t,e}function d(e){return e.sensitive?"":"i"}function h(e,t,n){i(t)||(n=t||n,t=[]);for(var r=(n=n||{}).strict,s=!1!==n.end,o="",a=0;a<e.length;a++){var c=e[a];if("string"==typeof c)o+=l(c);else{var h=l(c.prefix),p="(?:"+c.pattern+")";t.push(c),c.repeat&&(p+="(?:"+h+p+")*"),o+=p=c.optional?c.partial?h+"("+p+")?":"(?:"+h+"("+p+"))?":h+"("+p+")"}}var f=l(n.delimiter||"/"),m=o.slice(-f.length)===f;return r||(o=(m?o.slice(0,-f.length):o)+"(?:"+f+"(?=$))?"),o+=s?"$":r&&m?"":"(?="+f+"|$)",u(new RegExp("^"+o,d(n)),t)}function p(e,t,n){return i(t)||(n=t||n,t=[]),n=n||{},e instanceof RegExp?function(e,t){var n=e.source.match(/\((?!\?)/g);if(n)for(var i=0;i<n.length;i++)t.push({name:i,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return u(e,t)}(e,t):i(e)?function(e,t,n){for(var i=[],r=0;r<e.length;r++)i.push(p(e[r],t,n).source);return u(new RegExp("(?:"+i.join("|")+")",d(n)),t)}(e,t,n):function(e,t,n){return h(s(e,n),t,n)}(e,t,n)}},{isarray:42}],47:[function(e,t,n){!function(e,i){"object"==typeof n&&void 0!==t?t.exports=i():"function"==typeof define&&define.amd?define(i):e.typeDetect=i()}(this,(function(){"use strict";var e="function"==typeof Promise,t="object"==typeof self?self:global,n="undefined"!=typeof Symbol,i="undefined"!=typeof Map,r="undefined"!=typeof Set,s="undefined"!=typeof WeakMap,o="undefined"!=typeof WeakSet,a="undefined"!=typeof DataView,l=n&&void 0!==Symbol.iterator,c=n&&void 0!==Symbol.toStringTag,u=r&&"function"==typeof Set.prototype.entries,d=i&&"function"==typeof Map.prototype.entries,h=u&&Object.getPrototypeOf((new Set).entries()),p=d&&Object.getPrototypeOf((new Map).entries()),f=l&&"function"==typeof Array.prototype[Symbol.iterator],m=f&&Object.getPrototypeOf([][Symbol.iterator]()),g=l&&"function"==typeof String.prototype[Symbol.iterator],b=g&&Object.getPrototypeOf(""[Symbol.iterator]());return function(n){var l=typeof n;if("object"!==l)return l;if(null===n)return"null";if(n===t)return"global";if(Array.isArray(n)&&(!1===c||!(Symbol.toStringTag in n)))return"Array";if("object"==typeof window&&null!==window){if("object"==typeof window.location&&n===window.location)return"Location";if("object"==typeof window.document&&n===window.document)return"Document";if("object"==typeof window.navigator){if("object"==typeof window.navigator.mimeTypes&&n===window.navigator.mimeTypes)return"MimeTypeArray";if("object"==typeof window.navigator.plugins&&n===window.navigator.plugins)return"PluginArray"}if(("function"==typeof window.HTMLElement||"object"==typeof window.HTMLElement)&&n instanceof window.HTMLElement){if("BLOCKQUOTE"===n.tagName)return"HTMLQuoteElement";if("TD"===n.tagName)return"HTMLTableDataCellElement";if("TH"===n.tagName)return"HTMLTableHeaderCellElement"}}var u=c&&n[Symbol.toStringTag];if("string"==typeof u)return u;var d=Object.getPrototypeOf(n);return d===RegExp.prototype?"RegExp":d===Date.prototype?"Date":e&&d===Promise.prototype?"Promise":r&&d===Set.prototype?"Set":i&&d===Map.prototype?"Map":o&&d===WeakSet.prototype?"WeakSet":s&&d===WeakMap.prototype?"WeakMap":a&&d===DataView.prototype?"DataView":i&&d===p?"Map Iterator":r&&d===h?"Set Iterator":f&&d===m?"Array Iterator":g&&d===b?"String Iterator":null===d?"Object":Object.prototype.toString.call(n).slice(8,-1)}}))},{}]},{},[12])(12)},module.exports=f()}).call(this,__webpack_require__("./node_modules/webpack/buildin/global.js"))},"./node_modules/process/browser.js":function(e,t){var n,i,r=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(e){if(n===setTimeout)return setTimeout(e,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(e){n=s}try{i="function"==typeof clearTimeout?clearTimeout:o}catch(e){i=o}}();var l,c=[],u=!1,d=-1;function h(){u&&l&&(u=!1,l.length?c=l.concat(c):d=-1,c.length&&p())}function p(){if(!u){var e=a(h);u=!0;for(var t=c.length;t;){for(l=c,c=[];++d<t;)l&&l[d].run();d=-1,t=c.length}l=null,u=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===o||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function m(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new f(e,t)),1!==c.length||u||a(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},"./node_modules/samsam/lib/samsam.js":function(e,t,n){var i,r;(function(s){void 0===(r="function"==typeof(i=s)?i.call(t,n,t,e):i)||(e.exports=r)}||function(t){e.exports=t()}||function(e){this.samsam=e()})((function(){var e=Object.prototype,t="undefined"!=typeof document&&document.createElement("div");function n(e){return"number"==typeof e&&e!==e}function i(t){return e.toString.call(t).split(/[ \]]/)[1]}function r(e){if("Arguments"===i(e))return!0;if("object"!=typeof e||"number"!=typeof e.length||"Array"===i(e))return!1;if("function"==typeof e.callee)return!0;try{e[e.length]=6,delete e[e.length]}catch(e){return!0}return!1}function s(e){if(!e||1!==e.nodeType||!t)return!1;try{e.appendChild(t),e.removeChild(t)}catch(e){return!1}return!0}function o(t){var n,i=[];for(n in t)e.hasOwnProperty.call(t,n)&&i.push(n);return i}function a(e){return"function"==typeof e.getTime&&e.getTime()==e.valueOf()}function l(e){return 0===e&&1/e==-1/0}function c(e,t){if(e===t||n(e)&&n(t))return 0!==e||l(e)===l(t)}function u(e){if("undefined"!=typeof Set&&e instanceof Set)return!0}function d(e,t,n){for(var i=Array.from(e),r=Array.from(t),s=0;s<i.length;s++){for(var o=!1,a=0;a<r.length;a++)if(n(r[a],i[s])){o=!0;break}if(!o)return!1}return!0}return{isArguments:r,isElement:s,isDate:a,isNegZero:l,identical:c,deepEqual:function(t,l){var h=[],p=[],f=[],m=[],g={};function b(e){return!("object"!=typeof e||null===e||e instanceof Boolean||e instanceof Date||e instanceof Number||e instanceof RegExp||e instanceof String)}function v(e,t){var n;for(n=0;n<e.length;n++)if(e[n]===t)return n;return-1}return function t(l,w,y,k){var j=typeof l,x=typeof w;if(l===w||n(l)||n(w)||null==l||null==w||"object"!==j||"object"!==x)return c(l,w);if(s(l)||s(w))return!1;var E=a(l),T=a(w);if((E||T)&&(!E||!T||l.getTime()!==w.getTime()))return!1;if(l instanceof RegExp&&w instanceof RegExp&&l.toString()!==w.toString())return!1;var q,S,_,C,A,O,M,U,P,I,$,D=i(l),L=i(w),F=o(l),B=o(w);if(r(l)||r(w)){if(l.length!==w.length)return!1}else if(j!==x||D!==L||F.length!==B.length)return!1;if(u(l)||u(w))return!(!u(l)||!u(w)||l.size!==w.size)&&d(l,w,t);for(S=0,_=F.length;S<_;S++){if(q=F[S],!e.hasOwnProperty.call(w,q))return!1;if(C=l[q],A=w[q],O=b(C),M=b(A),U=O?v(h,C):-1,P=M?v(p,A):-1,I=-1!==U?f[U]:y+"["+JSON.stringify(q)+"]",$=-1!==P?m[P]:k+"["+JSON.stringify(q)+"]",g[I+$])return!0;if(-1===U&&O&&(h.push(C),f.push(I)),-1===P&&M&&(p.push(A),m.push($)),O&&M&&(g[I+$]=!0),!t(C,A,I,$))return!1}return!0}(t,l,"$1","$2")},match:function e(t,n){if(n&&"function"==typeof n.test)return n.test(t);if("function"==typeof n)return!0===n(t);if("string"==typeof n)return n=n.toLowerCase(),("string"==typeof t||!!t)&&String(t).toLowerCase().indexOf(n)>=0;if("number"==typeof n)return n===t;if("boolean"==typeof n)return n===t;if(void 0===n)return void 0===t;if(null===n)return null===t;if(u(t))return d(n,t,e);if("Array"===i(t)&&"Array"===i(n))return function(e,t,n){if(0===t.length)return!0;var i,r,s,o;for(i=0,r=e.length;i<r;++i)if(n(e[i],t[0])){for(s=0,o=t.length;s<o;++s){if(i+s>=r)return!1;if(!n(e[i+s],t[s]))return!1}return!0}return!1}(t,n,e);if(a(n))return a(t)&&t.getTime()===n.getTime();if(n&&"object"==typeof n){if(n===t)return!0;var r;for(r in n){var s=t[r];if(void 0===s&&"function"==typeof t.getAttribute&&(s=t.getAttribute(r)),null===n[r]||void 0===n[r]){if(s!==n[r])return!1}else if(void 0===s||!e(s,n[r]))return!1}return!0}throw new Error("Matcher was not a string, a number, a function, a boolean or an object")},keys:o}}))},"./node_modules/setimmediate/setImmediate.js":function(e,t,n){(function(e,t){!function(e,n){"use strict";if(!e.setImmediate){var i,r,s,o,a,l=1,c={},u=!1,d=e.document,h=Object.getPrototypeOf&&Object.getPrototypeOf(e);h=h&&h.setTimeout?h:e,"[object process]"==={}.toString.call(e.process)?i=function(e){t.nextTick((function(){f(e)}))}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?e.MessageChannel?((s=new MessageChannel).port1.onmessage=function(e){f(e.data)},i=function(e){s.port2.postMessage(e)}):d&&"onreadystatechange"in d.createElement("script")?(r=d.documentElement,i=function(e){var t=d.createElement("script");t.onreadystatechange=function(){f(e),t.onreadystatechange=null,r.removeChild(t),t=null},r.appendChild(t)}):i=function(e){setTimeout(f,0,e)}:(o="setImmediate$"+Math.random()+"$",a=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(o)&&f(+t.data.slice(o.length))},e.addEventListener?e.addEventListener("message",a,!1):e.attachEvent("onmessage",a),i=function(t){e.postMessage(o+t,"*")}),h.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var r={callback:e,args:t};return c[l]=r,i(l),l++},h.clearImmediate=p}function p(e){delete c[e]}function f(e){if(u)setTimeout(f,0,e);else{var t=c[e];if(t){u=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(void 0,n)}}(t)}finally{p(e),u=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n("./node_modules/webpack/buildin/global.js"),n("./node_modules/process/browser.js"))},"./node_modules/sinon/lib/sinon.js":function(e,t,n){"use strict";t.assert=n("./node_modules/sinon/lib/sinon/assert.js"),t.collection=n("./node_modules/sinon/lib/sinon/collection.js"),t.match=n("./node_modules/sinon/lib/sinon/match.js"),t.spy=n("./node_modules/sinon/lib/sinon/spy.js"),t.spyCall=n("./node_modules/sinon/lib/sinon/call.js"),t.stub=n("./node_modules/sinon/lib/sinon/stub.js"),t.mock=n("./node_modules/sinon/lib/sinon/mock.js");var i=n("./node_modules/sinon/lib/sinon/sandbox.js");t.sandbox=i,t.expectation=n("./node_modules/sinon/lib/sinon/mock-expectation.js"),t.createStubInstance=n("./node_modules/sinon/lib/sinon/stub.js").createStubInstance,t.defaultConfig=n("./node_modules/sinon/lib/sinon/util/core/default-config.js");var r=n("./node_modules/sinon/lib/sinon/util/fake_timers.js");t.useFakeTimers=r.useFakeTimers,t.clock=r.clock,t.timers=r.timers;var s=n("./node_modules/nise/nise.js");t.xhr=s.fakeXhr.xhr,t.FakeXMLHttpRequest=s.fakeXhr.FakeXMLHttpRequest,t.useFakeXMLHttpRequest=s.fakeXhr.useFakeXMLHttpRequest,t.fakeServer=s.fakeServer,t.fakeServerWithClock=s.fakeServerWithClock,t.createSandbox=i.create,t.createFakeServer=s.fakeServer.create.bind(s.fakeServer),t.createFakeServerWithClock=s.fakeServerWithClock.create.bind(s.fakeServerWithClock);var o=n("./node_modules/sinon/lib/sinon/behavior.js");t.addBehavior=function(e,n){o.addBehavior(t.stub,e,n)};var a=n("./node_modules/sinon/lib/sinon/util/core/format.js");t.setFormatter=a.setFormatter},"./node_modules/sinon/lib/sinon/assert.js":function(e,t,n){"use strict";(function(t){var i,r=n("./node_modules/sinon/lib/sinon/util/core/called-in-order.js"),s=n("./node_modules/sinon/lib/sinon/util/core/order-by-first-call.js"),o=n("./node_modules/sinon/lib/sinon/util/core/times-in-words.js"),a=n("./node_modules/sinon/lib/sinon/util/core/format.js"),l=n("./node_modules/sinon/lib/sinon/match.js"),c=Array.prototype.slice;function u(){var e=Array.prototype.slice.call(arguments);e.forEach((function(e){e||i.fail("fake is not a spy"),e.proxy&&e.proxy.isSinonProxy?u(e.proxy):("function"!=typeof e&&i.fail(e+" is not a function"),"function"!=typeof e.getCall&&i.fail(e+" is not stubbed"))}))}function d(e,t){switch(e){case"notCalled":case"called":case"calledOnce":case"calledTwice":case"calledThrice":0!==t.length&&i.fail(e+" takes 1 argument but was called with "+(t.length+1)+" arguments")}}function h(e,n){((e=e||t).fail||i.fail).call(e,n)}function p(e,t,n){2===arguments.length&&(n=t,t=e),i[e]=function(r){u(r);var s=c.call(arguments,1);d(e,s),("function"==typeof t?!t(r):"function"==typeof r[t]?!r[t].apply(r,s):!r[t])?h(this,(r.printf||r.proxy.printf).apply(r,[n].concat(s))):i.pass(e)}}i={failException:"AssertError",fail:function(e){var t=new Error(e);throw t.name=this.failException||i.failException,t},pass:function(){},callOrder:function(){u.apply(null,arguments);var e="",t="";if(r(arguments))i.pass("callOrder");else{try{e=[].join.call(arguments,", ");for(var n=c.call(arguments),o=n.length;o;)n[--o].called||n.splice(o,1);t=s(n).join(", ")}catch(e){}h(this,"expected "+e+" to be called in order but were called as "+t)}},callCount:function(e,t){if(u(e),e.callCount!==t){var n="expected %n to be called "+o(t)+" but was called %c%C";h(this,e.printf(n))}else i.pass("callCount")},expose:function(e,t){if(!e)throw new TypeError("target is null or undefined");var n=t||{},i=void 0===n.prefix?"assert":n.prefix,r=void 0===n.includeFail||!!n.includeFail,s=this;return Object.keys(s).forEach((function(t){"expose"===t||!r&&/^(fail)/.test(t)||(e[function(e,t){return!e||/^fail/.test(t)?t:e+t.slice(0,1).toUpperCase()+t.slice(1)}(i,t)]=s[t])})),e},match:function(e,t){l(t).test(e)?i.pass("match"):h(this,["expected value to match","    expected = "+a(t),"    actual = "+a(e)].join("\n"))}},p("called","expected %n to have been called at least once but was never called"),p("notCalled",(function(e){return!e.called}),"expected %n to not have been called but was called %c%C"),p("calledOnce","expected %n to be called once but was called %c%C"),p("calledTwice","expected %n to be called twice but was called %c%C"),p("calledThrice","expected %n to be called thrice but was called %c%C"),p("calledOn","expected %n to be called with %1 as this but was called with %t"),p("alwaysCalledOn","expected %n to always be called with %1 as this but was called with %t"),p("calledWithNew","expected %n to be called with new"),p("alwaysCalledWithNew","expected %n to always be called with new"),p("calledWith","expected %n to be called with arguments %D"),p("calledWithMatch","expected %n to be called with match %D"),p("alwaysCalledWith","expected %n to always be called with arguments %D"),p("alwaysCalledWithMatch","expected %n to always be called with match %D"),p("calledWithExactly","expected %n to be called with exact arguments %D"),p("alwaysCalledWithExactly","expected %n to always be called with exact arguments %D"),p("neverCalledWith","expected %n to never be called with arguments %*%C"),p("neverCalledWithMatch","expected %n to never be called with match %*%C"),p("threw","%n did not throw exception%C"),p("alwaysThrew","%n did not always throw exception%C"),e.exports=i}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./node_modules/sinon/lib/sinon/behavior.js":function(e,t,n){"use strict";(function(t,i){var r=n("./node_modules/sinon/lib/sinon/util/core/extend.js"),s=n("./node_modules/sinon/lib/sinon/util/core/function-name.js"),o=n("./node_modules/sinon/lib/sinon/util/core/value-to-string.js"),a=Array.prototype.slice,l=Array.prototype.join,c="object"==typeof t&&"function"==typeof t.nextTick?t.nextTick:"function"==typeof i?i:function(e){setTimeout(e,0)};function u(e,t){if("number"==typeof e.callArgAt){var n=function(e,t){var n,i=e.callArgAt;if(i>=0)return t[i];-1===i&&(n=t),-2===i&&(n=a.call(t).reverse());for(var r=e.callArgProp,s=0,o=n.length;s<o;++s){if(!r&&"function"==typeof n[s])return n[s];if(r&&n[s]&&"function"==typeof n[s][r])return n[s][r]}return null}(e,t);if("function"!=typeof n)throw new TypeError(function(e,t,n){var i;return e.callArgAt<0?(i=e.callArgProp?s(e.stub)+" expected to yield to '"+o(e.callArgProp)+"', but no object with such a property was passed.":s(e.stub)+" expected to yield, but no callback was passed.",n.length>0&&(i+=" Received ["+l.call(n,", ")+"]"),i):"argument at index "+e.callArgAt+" is not a function: "+t}(e,n,t));if(!e.callbackAsync)return n.apply(e.callbackContext,e.callbackArguments);c((function(){n.apply(e.callbackContext,e.callbackArguments)}))}}var d={create:function(e){var t=r({},d);return delete t.create,delete t.addBehavior,delete t.createBehavior,t.stub=e,e.defaultBehavior&&e.defaultBehavior.promiseLibrary&&(t.promiseLibrary=e.defaultBehavior.promiseLibrary),t},isPresent:function(){return"number"==typeof this.callArgAt||this.exception||this.exceptionCreator||"number"==typeof this.returnArgAt||this.returnThis||this.resolveThis||"number"==typeof this.throwArgAt||this.fakeFn||this.returnValueDefined},invoke:function(e,t){var n=u(this,t);if(this.exception)throw this.exception;if(this.exceptionCreator)throw this.exception=this.exceptionCreator(),this.exceptionCreator=void 0,this.exception;if("number"==typeof this.returnArgAt)return t[this.returnArgAt];if(this.returnThis)return e;if("number"==typeof this.throwArgAt){if(t.length<this.throwArgAt)throw new TypeError("throwArgs failed: "+this.throwArgAt+" arguments required but only "+t.length+" present");throw t[this.throwArgAt]}return this.fakeFn?this.fakeFn.apply(e,t):this.resolveThis?(this.promiseLibrary||Promise).resolve(e):this.resolve?(this.promiseLibrary||Promise).resolve(this.returnValue):this.reject?(this.promiseLibrary||Promise).reject(this.returnValue):this.callsThrough?this.stub.wrappedMethod.apply(e,t):void 0!==this.returnValue?this.returnValue:"number"==typeof this.callArgAt?n:this.returnValue},onCall:function(e){return this.stub.onCall(e)},onFirstCall:function(){return this.stub.onFirstCall()},onSecondCall:function(){return this.stub.onSecondCall()},onThirdCall:function(){return this.stub.onThirdCall()},withArgs:function(){throw new Error('Defining a stub by invoking "stub.onCall(...).withArgs(...)" is not supported. Use "stub.withArgs(...).onCall(...)" to define sequential behavior for calls with certain arguments.')}};function h(e){return function(){return this.defaultBehavior=this.defaultBehavior||d.create(this),this.defaultBehavior[e].apply(this.defaultBehavior,arguments),this}}Object.keys(d).forEach((function(e){var t;e.match(/^(callsArg|yields)/)&&!e.match(/Async/)&&(d[e+"Async"]=(t=e,function(){var e=this[t].apply(this,arguments);return this.callbackAsync=!0,e}))})),d.addBehavior=function(e,t,n){d[t]=function(){return n.apply(this,[this].concat([].slice.call(arguments))),this.stub||this},e[t]=h(t)},d.createBehavior=h,e.exports=d}).call(this,n("./node_modules/process/browser.js"),n("./node_modules/timers-browserify/main.js").setImmediate)},"./node_modules/sinon/lib/sinon/call.js":function(e,t,n){"use strict";var i=n("./node_modules/sinon/lib/sinon/match.js"),r=n("./node_modules/sinon/lib/sinon/util/core/deep-equal.js").use(i),s=n("./node_modules/sinon/lib/sinon/util/core/function-name.js"),o=n("./node_modules/sinon/lib/sinon/util/core/format.js"),a=n("./node_modules/sinon/lib/sinon/util/core/value-to-string.js"),l=Array.prototype.slice,c=Array.prototype.filter;function u(e,t,n){var i=s(e)+t;throw n.length&&(i+=" Received ["+l.call(n).join(", ")+"]"),new Error(i)}var d={calledOn:function(e){return i&&i.isMatcher(e)?e.test(this.thisValue):this.thisValue===e},calledWith:function(){var e=this,t=l.call(arguments);return!(t.length>e.args.length)&&t.reduce((function(t,n,i){return t&&r(n,e.args[i])}),!0)},calledWithMatch:function(){var e=this,t=l.call(arguments);return!(t.length>e.args.length)&&t.reduce((function(t,n,r){var s=e.args[r];return t&&i&&i(n).test(s)}),!0)},calledWithExactly:function(){return arguments.length===this.args.length&&this.calledWith.apply(this,arguments)},notCalledWith:function(){return!this.calledWith.apply(this,arguments)},notCalledWithMatch:function(){return!this.calledWithMatch.apply(this,arguments)},returned:function(e){return r(e,this.returnValue)},threw:function(e){return void 0!==e&&this.exception?this.exception===e||this.exception.name===e:!!this.exception},calledWithNew:function(){return this.proxy.prototype&&this.thisValue instanceof this.proxy},calledBefore:function(e){return this.callId<e.callId},calledAfter:function(e){return this.callId>e.callId},calledImmediatelyBefore:function(e){return this.callId===e.callId-1},calledImmediatelyAfter:function(e){return this.callId===e.callId+1},callArg:function(e){return this.ensureArgIsAFunction(e),this.args[e]()},callArgOn:function(e,t){return this.ensureArgIsAFunction(e),this.args[e].apply(t)},callArgWith:function(e){return this.callArgOnWith.apply(this,[e,null].concat(l.call(arguments,1)))},callArgOnWith:function(e,t){this.ensureArgIsAFunction(e);var n=l.call(arguments,2);return this.args[e].apply(t,n)},throwArg:function(e){if(e>this.args.length)throw new TypeError("Not enough arguments: "+e+" required but only "+this.args.length+" present");throw this.args[e]},yield:function(){return this.yieldOn.apply(this,[null].concat(l.call(arguments,0)))},yieldOn:function(e){var t=l.call(this.args),n=c.call(t,(function(e){return"function"==typeof e}))[0];return n||u(this.proxy," cannot yield since no callback was passed.",t),n.apply(e,l.call(arguments,1))},yieldTo:function(e){return this.yieldToOn.apply(this,[e,null].concat(l.call(arguments,1)))},yieldToOn:function(e,t){var n=l.call(this.args),i=c.call(n,(function(t){return t&&"function"==typeof t[e]}))[0],r=i&&i[e];return r||u(this.proxy," cannot yield to '"+a(e)+"' since no callback was passed.",n),r.apply(t,l.call(arguments,2))},toString:function(){var e=this.proxy?this.proxy.toString()+"(":"";return this.args?(e=e+l.call(this.args).map((function(e){return o(e)})).join(", ")+")",void 0!==this.returnValue&&(e+=" => "+o(this.returnValue)),this.exception&&(e+=" !"+this.exception.name,this.exception.message&&(e+="("+this.exception.message+")")),this.stack&&(e+=(this.stack.split("\n")[3]||"unknown").replace(/^\s*(?:at\s+|@)?/," at ")),e):":("},ensureArgIsAFunction:function(e){if("function"!=typeof this.args[e])throw new TypeError("Expected argument at position "+e+" to be a Function, but was "+typeof this.args[e])}};function h(e,t,n,i,r,s,o){if("number"!=typeof s)throw new TypeError("Call id is not a number");var a=Object.create(d),l=n.length>0&&n[n.length-1]||void 0,c=l&&"function"==typeof l?l:void 0;return a.proxy=e,a.thisValue=t,a.args=n,a.lastArg=l,a.callback=c,a.returnValue=i,a.exception=r,a.callId=s,a.errorWithCallStack=o,a}Object.defineProperty(d,"stack",{enumerable:!0,configurable:!0,get:function(){return this.errorWithCallStack&&this.errorWithCallStack.stack||""}}),d.invokeCallback=d.yield,h.toString=d.toString,e.exports=h},"./node_modules/sinon/lib/sinon/collect-own-methods.js":function(e,t,n){"use strict";var i=n("./node_modules/sinon/lib/sinon/util/core/walk.js"),r=n("./node_modules/sinon/lib/sinon/util/core/get-property-descriptor.js");function s(e,t,n,i){"function"==typeof r(i,n).value&&t.hasOwnProperty(n)&&e.push(t[n])}e.exports=function(e){var t=[];return i(e,s.bind(null,t,e)),t}},"./node_modules/sinon/lib/sinon/collection.js":function(e,t,n){"use strict";var i=n("./node_modules/sinon/lib/sinon/spy.js"),r=n("./node_modules/sinon/lib/sinon/stub.js"),s=n("./node_modules/sinon/lib/sinon/mock.js"),o=n("./node_modules/sinon/lib/sinon/collect-own-methods.js"),a=n("./node_modules/sinon/lib/sinon/util/core/value-to-string.js"),l=Array.prototype.push,c=Array.prototype.filter;function u(e){return e.fakes||(e.fakes=[]),e.fakes}function d(e,t){var n=u(e);c.call(n,(function(e){return"function"==typeof e[t]})).forEach((function(e){e[t]()}))}var h={verify:function(){d(this,"verify")},restore:function(){d(this,"restore"),this.fakes=[]},reset:function(){d(this,"reset")},resetBehavior:function(){d(this,"resetBehavior")},resetHistory:function(){function e(e){var t=e.resetHistory||e.reset;t&&t.call(e)}u(this).forEach((function(t){if("function"!=typeof t){var n=[];t.get&&n.push(t.get),t.set&&n.push(t.set),n.forEach(e)}else e(t)}))},verifyAndRestore:function(){var e;try{this.verify()}catch(t){e=t}if(this.restore(),e)throw e},add:function(e){return l.call(u(this),e),e},addUsingPromise:function(e){return e.usingPromise(this.promiseLibrary),e},spy:function(){return this.add(i.apply(i,arguments))},createStubInstance:function(e){if("function"!=typeof e)throw new TypeError("The constructor should be a function.");return this.stub.call(this,Object.create(e.prototype))},stub:function(e,t){if(e&&void 0!==t&&!(t in e))throw new TypeError("Cannot stub non-existent own property "+a(t));var n=r.apply(null,arguments),i=void 0===t&&"object"==typeof e;if(i){var s=o(n);s.forEach(this.add.bind(this)),this.promiseLibrary&&s.forEach(this.addUsingPromise.bind(this))}else this.add(n),this.promiseLibrary&&n.usingPromise(this.promiseLibrary);return n},mock:function(){return this.add(s.apply(null,arguments))},inject:function(e){var t=this;return e.spy=function(){return t.spy.apply(t,arguments)},e.stub=function(){return t.stub.apply(t,arguments)},e.mock=function(){return t.mock.apply(t,arguments)},e}};e.exports=h},"./node_modules/sinon/lib/sinon/color.js":function(e,t,n){"use strict";var i=n("./node_modules/supports-color/browser.js");function r(e,t){return!1===i.stdout?e:"["+t+"m"+e+"[0m"}t.red=function(e){return r(e,31)},t.green=function(e){return r(e,32)},t.cyan=function(e){return r(e,96)},t.white=function(e){return r(e,39)},t.bold=function(e){return r(e,1)}},"./node_modules/sinon/lib/sinon/default-behaviors.js":function(e,t,n){"use strict";var i=n("./node_modules/sinon/lib/sinon/util/core/get-property-descriptor.js"),r=[].slice;function s(e,t,n){"function"==typeof t?e.exceptionCreator=t:"string"==typeof t?e.exceptionCreator=function(){var e=new Error(n||"");return e.name=t,e}:t?e.exception=t:e.exceptionCreator=function(){return new Error("Error")}}function o(e,t){var n=i(e,t);return!n||n.configurable}e.exports={callsFake:function(e,t){e.fakeFn=t},callsArg:function(e,t){if("number"!=typeof t)throw new TypeError("argument index is not number");e.callArgAt=t,e.callbackArguments=[],e.callbackContext=void 0,e.callArgProp=void 0,e.callbackAsync=!1},callsArgOn:function(e,t,n){if("number"!=typeof t)throw new TypeError("argument index is not number");e.callArgAt=t,e.callbackArguments=[],e.callbackContext=n,e.callArgProp=void 0,e.callbackAsync=!1},callsArgWith:function(e,t){if("number"!=typeof t)throw new TypeError("argument index is not number");e.callArgAt=t,e.callbackArguments=r.call(arguments,2),e.callbackContext=void 0,e.callArgProp=void 0,e.callbackAsync=!1},callsArgOnWith:function(e,t,n){if("number"!=typeof t)throw new TypeError("argument index is not number");e.callArgAt=t,e.callbackArguments=r.call(arguments,3),e.callbackContext=n,e.callArgProp=void 0,e.callbackAsync=!1},usingPromise:function(e,t){e.promiseLibrary=t},yields:function(e){e.callArgAt=-1,e.callbackArguments=r.call(arguments,1),e.callbackContext=void 0,e.callArgProp=void 0,e.callbackAsync=!1},yieldsRight:function(e){e.callArgAt=-2,e.callbackArguments=r.call(arguments,1),e.callbackContext=void 0,e.callArgProp=void 0,e.callbackAsync=!1},yieldsOn:function(e,t){e.callArgAt=-1,e.callbackArguments=r.call(arguments,2),e.callbackContext=t,e.callArgProp=void 0,e.callbackAsync=!1},yieldsTo:function(e,t){e.callArgAt=-1,e.callbackArguments=r.call(arguments,2),e.callbackContext=void 0,e.callArgProp=t,e.callbackAsync=!1},yieldsToOn:function(e,t,n){e.callArgAt=-1,e.callbackArguments=r.call(arguments,3),e.callbackContext=n,e.callArgProp=t,e.callbackAsync=!1},throws:s,throwsException:s,returns:function(e,t){e.returnValue=t,e.resolve=!1,e.reject=!1,e.returnValueDefined=!0,e.exception=void 0,e.exceptionCreator=void 0,e.fakeFn=void 0},returnsArg:function(e,t){if("number"!=typeof t)throw new TypeError("argument index is not number");e.returnArgAt=t},throwsArg:function(e,t){if("number"!=typeof t)throw new TypeError("argument index is not number");e.throwArgAt=t},returnsThis:function(e){e.returnThis=!0},resolves:function(e,t){e.returnValue=t,e.resolve=!0,e.resolveThis=!1,e.reject=!1,e.returnValueDefined=!0,e.exception=void 0,e.exceptionCreator=void 0,e.fakeFn=void 0},rejects:function(e,t,n){var i;return"string"==typeof t?(i=new Error(n||"")).name=t:i=t||new Error("Error"),e.returnValue=i,e.resolve=!1,e.resolveThis=!1,e.reject=!0,e.returnValueDefined=!0,e.exception=void 0,e.exceptionCreator=void 0,e.fakeFn=void 0,e},resolvesThis:function(e){e.returnValue=void 0,e.resolve=!1,e.resolveThis=!0,e.reject=!1,e.returnValueDefined=!1,e.exception=void 0,e.exceptionCreator=void 0,e.fakeFn=void 0},callThrough:function(e){e.callsThrough=!0},get:function(e,t){var n=e.stub||e;return Object.defineProperty(n.rootObj,n.propName,{get:t,configurable:o(n.rootObj,n.propName)}),e},set:function(e,t){var n=e.stub||e;return Object.defineProperty(n.rootObj,n.propName,{set:t,configurable:o(n.rootObj,n.propName)}),e},value:function(e,t){var n=e.stub||e;return Object.defineProperty(n.rootObj,n.propName,{value:t,enumerable:!0,configurable:o(n.rootObj,n.propName)}),e}},Object.keys(e.exports).forEach((function(t){var n;t.match(/^(callsArg|yields)/)&&!t.match(/Async/)&&(e.exports[t+"Async"]=(n=t,function(){var t=e.exports[n].apply(this,arguments);return this.callbackAsync=!0,t}))}))},"./node_modules/sinon/lib/sinon/match.js":function(e,t,n){"use strict";var i=n("./node_modules/sinon/lib/sinon/util/core/deep-equal.js").use(m),r=n("./node_modules/sinon/lib/sinon/util/core/every.js"),s=n("./node_modules/sinon/lib/sinon/util/core/function-name.js"),o=n("./node_modules/lodash.get/index.js"),a=n("./node_modules/sinon/lib/sinon/util/core/iterable-to-string.js"),l=n("./node_modules/sinon/lib/sinon/util/core/typeOf.js"),c=n("./node_modules/sinon/lib/sinon/util/core/value-to-string.js"),u=Array.prototype.indexOf;function d(e,t,n){var i=l(e);if(i!==t)throw new TypeError("Expected type of "+n+" to be "+t+", but was "+i)}var h={toString:function(){return this.message}};function p(e){return h.isPrototypeOf(e)}var f={function:function(e,t,n){e.test=t,e.message=n||"match("+s(t)+")"},number:function(e,t){e.test=function(e){return t==e}},object:function(e,t){var n=[];return"function"==typeof t.test?(e.test=function(e){return!0===t.test(e)},e.message="match("+s(t.test)+")",e):(n=Object.keys(t).map((function(e){return e+": "+c(t[e])})),e.test=function(e){return function e(t,n){return null!=n&&Object.keys(t).every((function(r){var s=t[r],o=n[r];if(p(s)){if(!s.test(o))return!1}else if("object"===l(s)){if(!e(s,o))return!1}else if(!i(s,o))return!1;return!0}))}(t,e)},e.message="match("+n.join(", ")+")",e)},regexp:function(e,t){e.test=function(e){return"string"==typeof e&&t.test(e)}},string:function(e,t){e.test=function(e){return"string"==typeof e&&-1!==e.indexOf(t)},e.message='match("'+t+'")'}};function m(e,t){var n=Object.create(h),r=l(e);return r in f?f[r](n,e,t):n.test=function(t){return i(e,t)},n.message||(n.message="match("+c(e)+")"),n}function g(e,t){return function(n,r){d(n,"string","property");var s=1===arguments.length,o=t+'("'+n+'"';return s||(o+=", "+c(r)),m((function(t){return!(null==t||!e(t,n))&&(s||i(r,t[n]))}),o+=")")}}h.or=function(e){if(!arguments.length)throw new TypeError("Matcher expected");p(e)||(e=m(e));var t=this,n=Object.create(h);return n.test=function(n){return t.test(n)||e.test(n)},n.message=t.message+".or("+e.message+")",n},h.and=function(e){if(!arguments.length)throw new TypeError("Matcher expected");p(e)||(e=m(e));var t=this,n=Object.create(h);return n.test=function(n){return t.test(n)&&e.test(n)},n.message=t.message+".and("+e.message+")",n},m.isMatcher=p,m.any=m((function(){return!0}),"any"),m.defined=m((function(e){return null!=e}),"defined"),m.truthy=m((function(e){return!!e}),"truthy"),m.falsy=m((function(e){return!e}),"falsy"),m.same=function(e){return m((function(t){return e===t}),"same("+c(e)+")")},m.typeOf=function(e){return d(e,"string","type"),m((function(t){return l(t)===e}),'typeOf("'+e+'")')},m.instanceOf=function(e){return"undefined"==typeof Symbol||void 0===Symbol.hasInstance?d(e,"function","type"):function(e,t,n,i){if(null==e[t])throw new TypeError("Expected "+n+" to have method "+i)}(e,Symbol.hasInstance,"type","[Symbol.hasInstance]"),m((function(t){return t instanceof e}),"instanceOf("+(s(e)||Object.prototype.toString.call(e))+")")},m.has=g((function(e,t){return"object"==typeof e?t in e:void 0!==e[t]}),"has"),m.hasOwn=g((function(e,t){return e.hasOwnProperty(t)}),"hasOwn"),m.hasNested=function(e,t){d(e,"string","property");var n=1===arguments.length,r='hasNested("'+e+'"';return n||(r+=", "+c(t)),m((function(r){return null!=r&&void 0!==o(r,e)&&(n||i(t,o(r,e)))}),r+=")")},m.every=function(e){if(!p(e))throw new TypeError("Matcher expected");return m((function(t){return"object"===l(t)?r(Object.keys(t),(function(n){return e.test(t[n])})):!!t&&"function"===l(t.forEach)&&r(t,(function(t){return e.test(t)}))}),"every("+e.message+")")},m.some=function(e){if(!p(e))throw new TypeError("Matcher expected");return m((function(t){return"object"===l(t)?!r(Object.keys(t),(function(n){return!e.test(t[n])})):!!t&&"function"===l(t.forEach)&&!r(t,(function(t){return!e.test(t)}))}),"some("+e.message+")")},m.array=m.typeOf("array"),m.array.deepEquals=function(e){return m((function(t){var n=t.length===e.length;return"array"===l(t)&&n&&r(t,(function(t,n){return e[n]===t}))}),"deepEquals(["+a(e)+"])")},m.array.startsWith=function(e){return m((function(t){return"array"===l(t)&&r(e,(function(e,n){return t[n]===e}))}),"startsWith(["+a(e)+"])")},m.array.endsWith=function(e){return m((function(t){var n=t.length-e.length;return"array"===l(t)&&r(e,(function(e,i){return t[n+i]===e}))}),"endsWith(["+a(e)+"])")},m.array.contains=function(e){return m((function(t){return"array"===l(t)&&r(e,(function(e){return-1!==u.call(t,e)}))}),"contains(["+a(e)+"])")},m.map=m.typeOf("map"),m.map.deepEquals=function(e){return m((function(t){var n=t.size===e.size;return"map"===l(t)&&n&&r(t,(function(t,n){return e.has(n)&&e.get(n)===t}))}),"deepEquals(Map["+a(e)+"])")},m.map.contains=function(e){return m((function(t){return"map"===l(t)&&r(e,(function(e,n){return t.has(n)&&t.get(n)===e}))}),"contains(Map["+a(e)+"])")},m.set=m.typeOf("set"),m.set.deepEquals=function(e){return m((function(t){var n=t.size===e.size;return"set"===l(t)&&n&&r(t,(function(t){return e.has(t)}))}),"deepEquals(Set["+a(e)+"])")},m.set.contains=function(e){return m((function(t){return"set"===l(t)&&r(e,(function(e){return t.has(e)}))}),"contains(Set["+a(e)+"])")},m.bool=m.typeOf("boolean"),m.number=m.typeOf("number"),m.string=m.typeOf("string"),m.object=m.typeOf("object"),m.func=m.typeOf("function"),m.regexp=m.typeOf("regexp"),m.date=m.typeOf("date"),m.symbol=m.typeOf("symbol"),e.exports=m},"./node_modules/sinon/lib/sinon/mock-expectation.js":function(e,t,n){"use strict";var i=n("./node_modules/sinon/lib/sinon/spy.js").invoke,r=n("./node_modules/sinon/lib/sinon/call.js").toString,s=n("./node_modules/sinon/lib/sinon/util/core/times-in-words.js"),o=n("./node_modules/sinon/lib/sinon/util/core/extend.js"),a=n("./node_modules/sinon/lib/sinon/match.js"),l=n("./node_modules/sinon/lib/sinon/stub.js"),c=n("./node_modules/sinon/lib/sinon/assert.js"),u=n("./node_modules/sinon/lib/sinon/util/core/deep-equal.js").use(a),d=n("./node_modules/sinon/lib/sinon/util/core/format.js"),h=n("./node_modules/sinon/lib/sinon/util/core/value-to-string.js"),p=Array.prototype.slice,f=Array.prototype.push;function m(e){return"number"==typeof e.maxCalls&&e.callCount===e.maxCalls}function g(e,t){return a&&a.isMatcher(e)&&e.test(t)||!0}var b={minCalls:1,maxCalls:1,create:function(e){var t=o(l.create(),b);return delete t.create,t.method=e,t},invoke:function(e,t,n){return this.verifyCallAllowed(t,n),i.apply(this,arguments)},atLeast:function(e){if("number"!=typeof e)throw new TypeError("'"+h(e)+"' is not number");return this.limitsSet||(this.maxCalls=null,this.limitsSet=!0),this.minCalls=e,this},atMost:function(e){if("number"!=typeof e)throw new TypeError("'"+h(e)+"' is not number");return this.limitsSet||(this.minCalls=null,this.limitsSet=!0),this.maxCalls=e,this},never:function(){return this.exactly(0)},once:function(){return this.exactly(1)},twice:function(){return this.exactly(2)},thrice:function(){return this.exactly(3)},exactly:function(e){if("number"!=typeof e)throw new TypeError("'"+h(e)+"' is not a number");return this.atLeast(e),this.atMost(e)},met:function(){return!this.failed&&(!("number"==typeof(e=this).minCalls)||e.callCount>=e.minCalls);var e},verifyCallAllowed:function(e,t){var n=this.expectedArguments;m(this)&&(this.failed=!0,b.fail(this.method+" already called "+s(this.maxCalls))),"expectedThis"in this&&this.expectedThis!==e&&b.fail(this.method+" called with "+h(e)+" as thisValue, expected "+h(this.expectedThis)),"expectedArguments"in this&&(t||b.fail(this.method+" received no arguments, expected "+d(n)),t.length<n.length&&b.fail(this.method+" received too few arguments ("+d(t)+"), expected "+d(n)),this.expectsExactArgCount&&t.length!==n.length&&b.fail(this.method+" received too many arguments ("+d(t)+"), expected "+d(n)),n.forEach((function(e,i){g(e,t[i])||b.fail(this.method+" received wrong arguments "+d(t)+", didn't match "+n.toString()),u(e,t[i])||b.fail(this.method+" received wrong arguments "+d(t)+", expected "+d(n))}),this))},allowsCall:function(e,t){var n=this.expectedArguments;return(!this.met()||!m(this))&&((!("expectedThis"in this)||this.expectedThis===e)&&(!("expectedArguments"in this)||!((t=t||[]).length<n.length)&&((!this.expectsExactArgCount||t.length===n.length)&&n.every((function(e,n){return!!g(e,t[n])&&!!u(e,t[n])})))))},withArgs:function(){return this.expectedArguments=p.call(arguments),this},withExactArgs:function(){return this.withArgs.apply(this,arguments),this.expectsExactArgCount=!0,this},on:function(e){return this.expectedThis=e,this},toString:function(){var e=(this.expectedArguments||[]).slice();this.expectsExactArgCount||f.call(e,"[...]");var t,n=r.call({proxy:this.method||"anonymous mock expectation",args:e}).replace(", [...","[, ...")+" "+function(e){var t=e.minCalls,n=e.maxCalls;if("number"==typeof t&&"number"==typeof n){var i=s(t);return t!==n&&(i="at least "+i+" and at most "+s(n)),i}return"number"==typeof t?"at least "+s(t):"at most "+s(n)}(this);return this.met()?"Expectation met: "+n:"Expected "+n+" ("+((0===(t=this.callCount)?"never called":"called "+s(t))+")")},verify:function(){return this.met()?b.pass(this.toString()):b.fail(this.toString()),!0},pass:function(e){c.pass(e)},fail:function(e){var t=new Error(e);throw t.name="ExpectationError",t}};e.exports=b},"./node_modules/sinon/lib/sinon/mock.js":function(e,t,n){"use strict";var i=n("./node_modules/sinon/lib/sinon/mock-expectation.js"),r=n("./node_modules/sinon/lib/sinon/call.js").toString,s=n("./node_modules/sinon/lib/sinon/util/core/extend.js"),o=n("./node_modules/sinon/lib/sinon/match.js"),a=n("./node_modules/sinon/lib/sinon/util/core/deep-equal.js").use(o),l=n("./node_modules/sinon/lib/sinon/util/core/wrap-method.js"),c=Array.prototype.push,u=Array.prototype.filter;function d(e){return e&&"string"!=typeof e?d.create(e):i.create(e||"Anonymous mock")}function h(e,t){(e||[]).forEach(t)}s(d,{create:function(e){if(!e)throw new TypeError("object is null");var t=s({},d);return t.object=e,delete t.create,t},expects:function(e){if(!e)throw new TypeError("method is falsy");if(this.expectations||(this.expectations={},this.proxies=[],this.failures=[]),!this.expectations[e]){this.expectations[e]=[];var t=this;l(this.object,e,(function(){return t.invokeMethod(e,this,arguments)})),c.call(this.proxies,e)}var n=i.create(e);return s(n,this.object[e]),c.call(this.expectations[e],n),n},restore:function(){var e=this.object;h(this.proxies,(function(t){"function"==typeof e[t].restore&&e[t].restore()}))},verify:function(){var e=this.expectations||{},t=this.failures?this.failures.slice():[],n=[];return h(this.proxies,(function(i){h(e[i],(function(e){e.met()?c.call(n,e.toString()):c.call(t,e.toString())}))})),this.restore(),t.length>0?i.fail(t.concat(n).join("\n")):n.length>0&&i.pass(t.concat(n).join("\n")),!0},invokeMethod:function(e,t,n){var s,o=this.expectations&&this.expectations[e]?this.expectations[e]:[],l=n||[],d=u.call(o,(function(e){var t,n,i=e.expectedArguments||[];return t=i,n=l,(!e.expectsExactArgCount||t.length===n.length)&&t.every((function(e,t){return a(e,n[t])}))})),h=u.call(d,(function(e){return!e.met()&&e.allowsCall(t,n)}));if(h.length>0)return h[0].apply(t,n);var p=[],f=0;if(d.forEach((function(e){e.allowsCall(t,n)?s=s||e:f+=1})),s&&0===f)return s.apply(t,n);o.forEach((function(e){c.call(p,"    "+e.toString())})),p.unshift("Unexpected call: "+r.call({proxy:e,args:n}));var m=new Error;if(!m.stack)try{throw m}catch(e){}this.failures.push("Unexpected call: "+r.call({proxy:e,args:n,stack:m.stack})),i.fail(p.join("\n"))}}),e.exports=d},"./node_modules/sinon/lib/sinon/sandbox.js":function(e,t,n){"use strict";var i=n("./node_modules/sinon/lib/sinon/util/core/extend.js"),r=n("./node_modules/sinon/lib/sinon/collection.js"),s=n("./node_modules/sinon/lib/sinon/match.js"),o=n("./node_modules/sinon/lib/sinon/assert.js"),a=n("./node_modules/sinon/lib/sinon/util/fake_timers.js"),l=n("./node_modules/nise/nise.js").fakeServer,c=n("./node_modules/nise/nise.js").fakeXhr,u=[].push,d=Object.create(r);function h(e,t,n,i){i&&(t.injectInto&&!(n in t.injectInto)?(t.injectInto[n]=i,e.injectedKeys.push(n)):u.call(e.args,i))}i(d,{useFakeTimers:function(e){return this.clock=a.useFakeTimers.call(null,e),this.add(this.clock)},serverPrototype:l,useFakeServer:function(){var e=this.serverPrototype||l;return e&&e.create?(this.server=e.create(),this.add(this.server)):null},useFakeXMLHttpRequest:function(){var e=c.useFakeXMLHttpRequest();return this.add(e)},inject:function(e){return r.inject.call(this,e),this.clock&&(e.clock=this.clock),this.server&&(e.server=this.server,e.requests=this.server.requests),e.match=s,e},usingPromise:function(e){return this.promiseLibrary=e,this},restore:function(){if(arguments.length)throw new Error("sandbox.restore() does not take any parameters. Perhaps you meant stub.restore()");r.restore.apply(this,arguments),this.restoreContext()},restoreContext:function(){var e=this.injectedKeys,t=this.injectInto;e&&(e.forEach((function(e){delete t[e]})),e=[])},create:function(e){if(!e)return Object.create(d);var t=function(e){var t=Object.create(d);return e.useFakeServer&&("object"==typeof e.useFakeServer&&(t.serverPrototype=e.useFakeServer),t.useFakeServer()),e.useFakeTimers&&("object"==typeof e.useFakeTimers?t.useFakeTimers.call(t,e.useFakeTimers):t.useFakeTimers()),t}(e);t.args=t.args||[],t.injectedKeys=[],t.injectInto=e.injectInto;var n=t.inject({});return e.properties?e.properties.forEach((function(i){var r=n[i]||"sandbox"===i&&t;h(t,e,i,r)})):h(t,e,"sandbox"),t},match:s,assert:o}),e.exports=d},"./node_modules/sinon/lib/sinon/spy-formatters.js":function(e,t,n){"use strict";var i=n("./node_modules/sinon/lib/sinon/color.js"),r=n("./node_modules/sinon/lib/sinon/util/core/times-in-words.js"),s=n("./node_modules/sinon/lib/sinon/util/core/format.js"),o=n("./node_modules/sinon/lib/sinon/match.js"),a=n("./node_modules/sinon/node_modules/diff/dist/diff.js"),l=Array.prototype.push;function c(e,t,n){return e.test(t)||(e.message=i.red(e.message),n&&(n=i.green(n))),n+" "+e.message}function u(e){return e.map((function(t){var n=t.value;return t.added?n=i.green(n):t.removed&&(n=i.red(n)),2===e.length&&(n+=" "),n})).join("")}e.exports={c:function(e){return r(e.callCount)},n:function(e){return e.toString()},D:function(e,t){for(var n="",i=0,r=e.callCount;i<r;++i){r>1&&(n+="\nCall "+(i+1)+":");for(var l=e.getCall(i).args,d=0;d<l.length||d<t.length;++d){n+="\n";var h=d<l.length?s(l[d]):"";if(o.isMatcher(t[d]))n+=c(t[d],l[d],h);else{var p=d<t.length?s(t[d]):"";n+=u(a.diffJson(h,p))}}}return n},C:function(e){for(var t=[],n=0,i=e.callCount;n<i;++n){var r="    "+e.getCall(n).toString();/\n/.test(t[n-1])&&(r="\n"+r),l.call(t,r)}return t.length>0?"\n"+t.join("\n"):""},t:function(e){for(var t=[],n=0,i=e.callCount;n<i;++n)l.call(t,s(e.thisValues[n]));return t.join(", ")},"*":function(e,t){return t.map((function(e){return s(e)})).join(", ")}}},"./node_modules/sinon/lib/sinon/spy.js":function(e,t,n){"use strict";var i=n("./node_modules/sinon/lib/sinon/behavior.js").create,r=n("./node_modules/sinon/lib/sinon/util/core/extend.js"),s=n("./node_modules/sinon/lib/sinon/util/core/deprecated.js"),o=n("./node_modules/sinon/lib/sinon/util/core/function-name.js"),a=n("./node_modules/sinon/lib/sinon/util/core/function-to-string.js"),l=n("./node_modules/sinon/lib/sinon/util/core/get-property-descriptor.js"),c=n("./node_modules/sinon/lib/sinon/match.js"),u=n("./node_modules/sinon/lib/sinon/util/core/deep-equal.js").use(c),d=n("./node_modules/sinon/lib/sinon/util/core/is-es-module.js"),h=n("./node_modules/sinon/lib/sinon/call.js"),p=n("./node_modules/sinon/lib/sinon/util/core/wrap-method.js"),f=n("./node_modules/sinon/lib/sinon/util/core/format.js"),m=n("./node_modules/sinon/lib/sinon/util/core/value-to-string.js"),g=Array.prototype.push,b=Array.prototype.slice,v=Array.prototype.filter,w=Error.prototype.constructor,y=Function.prototype.bind,k=0;function j(e,t,n){var i,r;if(d(e))throw new TypeError("ES Modules cannot be spied");return t||"function"!=typeof e?e||t?n?(i={},r=l(e,t),n.forEach((function(e){i[e]=j.create(r[e])})),p(e,t,i)):p(e,t,j.create(e[t])):j.create((function(){})):j.create(e)}function x(){this.called=!0,this.callCount+=1,this.notCalled=!1,this.calledOnce=1===this.callCount,this.calledTwice=2===this.callCount,this.calledThrice=3===this.callCount}function E(){this.firstCall=this.getCall(0),this.secondCall=this.getCall(1),this.thirdCall=this.getCall(2),this.lastCall=this.getCall(this.callCount-1)}var T=0,q={formatters:n("./node_modules/sinon/lib/sinon/spy-formatters.js"),resetHistory:function(){if(this.invoking){var e=new Error("Cannot reset Sinon function while invoking it. Move the call to .reset outside of the callback.");throw e.name="InvalidResetException",e}return this.called=!1,this.notCalled=!0,this.calledOnce=!1,this.calledTwice=!1,this.calledThrice=!1,this.callCount=0,this.firstCall=null,this.secondCall=null,this.thirdCall=null,this.lastCall=null,this.args=[],this.returnValues=[],this.thisValues=[],this.exceptions=[],this.callIds=[],this.errorsWithCallStack=[],this.fakes&&this.fakes.forEach((function(e){e.resetHistory?e.resetHistory():e.reset()})),this},create:function(e,t){var n;"function"!=typeof e?e=function(){}:n=o(e),t||(t=e.length);var i=function(e,t){var n;if(t)switch(t){case 1:n=function(t){return n.invoke(e,this,b.call(arguments))};break;case 2:n=function(t,i){return n.invoke(e,this,b.call(arguments))};break;case 3:n=function(t,i,r){return n.invoke(e,this,b.call(arguments))};break;case 4:n=function(t,i,r,s){return n.invoke(e,this,b.call(arguments))};break;case 5:n=function(t,i,r,s,o){return n.invoke(e,this,b.call(arguments))};break;case 6:n=function(t,i,r,s,o,a){return n.invoke(e,this,b.call(arguments))};break;case 7:n=function(t,i,r,s,o,a,l){return n.invoke(e,this,b.call(arguments))};break;case 8:n=function(t,i,r,s,o,a,l,c){return n.invoke(e,this,b.call(arguments))};break;case 9:n=function(t,i,r,s,o,a,l,c,u){return n.invoke(e,this,b.call(arguments))};break;case 10:n=function(t,i,r,s,o,a,l,c,u,d){return n.invoke(e,this,b.call(arguments))};break;case 11:n=function(t,i,r,s,o,a,l,c,u,d,h){return n.invoke(e,this,b.call(arguments))};break;case 12:n=function(t,i,r,s,o,a,l,c,u,d,h,p){return n.invoke(e,this,b.call(arguments))};break;default:n=function(){return n.invoke(e,this,b.call(arguments))}}else n=function(){return n.invoke(e,this,b.call(arguments))};return n.isSinonProxy=!0,n}(e,t);return r(i,j),delete i.create,r(i,e),i.resetHistory(),i.prototype=e.prototype,i.displayName=n||"spy",i.toString=a,i.instantiateFake=j.create,i.id="spy#"+T++,i},invoke:function(e,t,n){var i,r,s=this.matchingFakes(n),o=k++;x.call(this),g.call(this.thisValues,t),g.call(this.args,n),g.call(this.callIds,o),s.forEach((function(e){x.call(e),g.call(e.thisValues,t),g.call(e.args,n),g.call(e.callIds,o)})),E.call(this),s.forEach((function(e){E.call(e)}));try{this.invoking=!0,this.getCall(this.callCount-1).calledWithNew()?"object"!=typeof(r=new(y.apply(this.func||e,[t].concat(n))))&&(r=t):r=(this.func||e).apply(t,n)}catch(e){i=e}finally{delete this.invoking}g.call(this.exceptions,i),g.call(this.returnValues,r),s.forEach((function(e){g.call(e.exceptions,i),g.call(e.returnValues,r)}));var a=new w;try{throw a}catch(e){}if(g.call(this.errorsWithCallStack,a),s.forEach((function(e){g.call(e.errorsWithCallStack,a)})),E.call(this),s.forEach((function(e){E.call(e)})),void 0!==i)throw i;return r},named:function(e){return this.displayName=e,this},getCall:function(e){return e<0||e>=this.callCount?null:h(this,this.thisValues[e],this.args[e],this.returnValues[e],this.exceptions[e],this.callIds[e],this.errorsWithCallStack[e])},getCalls:function(){var e,t=[];for(e=0;e<this.callCount;e++)t.push(this.getCall(e));return t},calledBefore:function(e){return!!this.called&&(!e.called||this.callIds[0]<e.callIds[e.callIds.length-1])},calledAfter:function(e){return!(!this.called||!e.called)&&this.callIds[this.callCount-1]>e.callIds[0]},calledImmediatelyBefore:function(e){return!(!this.called||!e.called)&&this.callIds[this.callCount-1]===e.callIds[e.callCount-1]-1},calledImmediatelyAfter:function(e){return!(!this.called||!e.called)&&this.callIds[this.callCount-1]===e.callIds[e.callCount-1]+1},withArgs:function(){var e=b.call(arguments);if(this.fakes){var t=this.matchingFakes(e,!0).pop();if(t)return t}else this.fakes=[];var n=this,r=this.instantiateFake();return r.matchingArguments=e,r.parent=this,g.call(this.fakes,r),n.defaultBehavior&&n.defaultBehavior.promiseLibrary&&(r.defaultBehavior=r.defaultBehavior||i(r),r.defaultBehavior.promiseLibrary=n.defaultBehavior.promiseLibrary),r.withArgs=function(){return n.withArgs.apply(n,arguments)},n.args.forEach((function(e,t){r.matches(e)&&(x.call(r),g.call(r.thisValues,n.thisValues[t]),g.call(r.args,e),g.call(r.returnValues,n.returnValues[t]),g.call(r.exceptions,n.exceptions[t]),g.call(r.callIds,n.callIds[t]))})),E.call(r),r},matchingFakes:function(e,t){return v.call(this.fakes||[],(function(n){return n.matches(e,t)}))},matches:function(e,t){var n=this.matchingArguments;if(n.length<=e.length&&u(n,e.slice(0,n.length)))return!t||n.length===e.length},printf:function(e){var t,n=this,i=b.call(arguments,1);return(e||"").replace(/%(.)/g,(function(e,r){return"function"==typeof(t=q.formatters[r])?String(t.call(null,n,i)):isNaN(parseInt(r,10))?"%"+r:f(i[r-1])}))}};function S(e,t,n,i,r,s){q[e]=function(){if(!this.called)return!!r&&r.apply(this,arguments);if(void 0!==s&&this.callCount!==s)return!1;for(var o,a=0,l=[],c=0,u=this.callCount;c<u;c+=1){var d=(o=this.getCall(c))[n||e].apply(o,arguments);if(l.push(d),d&&(a+=1,t))return!0}return i?l:a===this.callCount}}q.reset=s.wrap(q.resetHistory,s.defaultMsg("reset")),S("calledOn",!0),S("alwaysCalledOn",!1,"calledOn"),S("calledWith",!0),S("calledOnceWith",!0,"calledWith",!1,void 0,1),S("calledWithMatch",!0),S("alwaysCalledWith",!1,"calledWith"),S("alwaysCalledWithMatch",!1,"calledWithMatch"),S("calledWithExactly",!0),S("calledOnceWithExactly",!0,"calledWithExactly",!1,void 0,1),S("alwaysCalledWithExactly",!1,"calledWithExactly"),S("neverCalledWith",!1,"notCalledWith",!1,(function(){return!0})),S("neverCalledWithMatch",!1,"notCalledWithMatch",!1,(function(){return!0})),S("threw",!0),S("alwaysThrew",!1,"threw"),S("returned",!0),S("alwaysReturned",!1,"returned"),S("calledWithNew",!0),S("alwaysCalledWithNew",!1,"calledWithNew"),S("callArg",!1,"callArgWith",!0,(function(){throw new Error(this.toString()+" cannot call arg since it was not yet invoked.")})),q.callArgWith=q.callArg,S("callArgOn",!1,"callArgOnWith",!0,(function(){throw new Error(this.toString()+" cannot call arg since it was not yet invoked.")})),q.callArgOnWith=q.callArgOn,S("throwArg",!1,"throwArg",!1,(function(){throw new Error(this.toString()+" cannot throw arg since it was not yet invoked.")})),S("yield",!1,"yield",!0,(function(){throw new Error(this.toString()+" cannot yield since it was not yet invoked.")})),q.invokeCallback=q.yield,S("yieldOn",!1,"yieldOn",!0,(function(){throw new Error(this.toString()+" cannot yield since it was not yet invoked.")})),S("yieldTo",!1,"yieldTo",!0,(function(e){throw new Error(this.toString()+" cannot yield to '"+m(e)+"' since it was not yet invoked.")})),S("yieldToOn",!1,"yieldToOn",!0,(function(e){throw new Error(this.toString()+" cannot yield to '"+m(e)+"' since it was not yet invoked.")})),r(j,q),j.spyCall=h,e.exports=j},"./node_modules/sinon/lib/sinon/stub-entire-object.js":function(e,t,n){"use strict";var i=n("./node_modules/sinon/lib/sinon/util/core/get-property-descriptor.js"),r=n("./node_modules/sinon/lib/sinon/util/core/walk.js");e.exports=function(e,t){return r(t||{},(function(n,r){r!==Object.prototype&&"constructor"!==n&&"function"==typeof i(r,n).value&&e(t,n)})),t}},"./node_modules/sinon/lib/sinon/stub.js":function(e,t,n){"use strict";var i=n("./node_modules/sinon/lib/sinon/behavior.js"),r=n("./node_modules/sinon/lib/sinon/default-behaviors.js"),s=n("./node_modules/sinon/lib/sinon/spy.js"),o=n("./node_modules/sinon/lib/sinon/util/core/extend.js"),a=n("./node_modules/sinon/lib/sinon/util/core/function-to-string.js"),l=n("./node_modules/sinon/lib/sinon/util/core/get-property-descriptor.js"),c=n("./node_modules/sinon/lib/sinon/util/core/is-es-module.js"),u=n("./node_modules/sinon/lib/sinon/util/core/wrap-method.js"),d=n("./node_modules/sinon/lib/sinon/stub-entire-object.js"),h=n("./node_modules/sinon/lib/sinon/throw-on-falsy-object.js"),p=n("./node_modules/sinon/lib/sinon/util/core/value-to-string.js"),f=Array.prototype.slice;function m(e,t){if(arguments.length>2)throw new TypeError("stub(obj, 'meth', fn) has been removed, see documentation");if(c(e))throw new TypeError("ES Modules cannot be stubbed");if(h.apply(null,arguments),e&&void 0!==t&&!(t in e))throw new TypeError("Cannot stub non-existent own property "+p(t));var n=l(e,t),i=void 0===t&&"object"==typeof e,r=!e&&void 0===t,s=!("object"!=typeof e&&"function"!=typeof e||void 0===t||void 0!==n&&"function"==typeof n.value||"undefined"!=typeof descriptor),o="object"==typeof e&&void 0!==n&&"function"==typeof n.value,a=o?e[t].length:0;if(i)return d(m,e);if(r)return m.create();var f=m.create(a);return f.rootObj=e,f.propName=t,f.restore=function(){void 0===n?delete e[t]:Object.defineProperty(e,t,n)},s?f:u(e,t,f)}function g(e){return e.defaultBehavior||function(e){return e.parent&&b(e.parent)}(e)||i.create(e)}function b(e){var t=e.behaviors[e.callCount-1];return t&&t.isPresent()?t:g(e)}m.createStubInstance=function(e){if("function"!=typeof e)throw new TypeError("The constructor should be a function.");return m(Object.create(e.prototype))};var v=0,w={create:function(e){var t=function(){var e=f.call(arguments),n=t.matchingFakes(e),i=n.sort((function(e,t){return e.matchingArguments.length-t.matchingArguments.length})).pop()||t;return b(i).invoke(this,arguments)};t.id="stub#"+v++;var n=t;return(t=s.create(t,e)).func=n,o(t,m),t.instantiateFake=m.create,t.displayName="stub",t.toString=a,t.defaultBehavior=null,t.behaviors=[],t},resetBehavior:function(){var e=this.fakes||[];this.defaultBehavior=null,this.behaviors=[],delete this.returnValue,delete this.returnArgAt,delete this.throwArgAt,delete this.fakeFn,this.returnThis=!1,this.resolveThis=!1,e.forEach((function(e){e.resetBehavior()}))},resetHistory:s.resetHistory,reset:function(){this.resetHistory(),this.resetBehavior()},onCall:function(e){return this.behaviors[e]||(this.behaviors[e]=i.create(this)),this.behaviors[e]},onFirstCall:function(){return this.onCall(0)},onSecondCall:function(){return this.onCall(1)},onThirdCall:function(){return this.onCall(2)}};Object.keys(i).forEach((function(e){i.hasOwnProperty(e)&&!w.hasOwnProperty(e)&&"create"!==e&&"withArgs"!==e&&"invoke"!==e&&(w[e]=i.createBehavior(e))})),Object.keys(r).forEach((function(e){r.hasOwnProperty(e)&&!w.hasOwnProperty(e)&&i.addBehavior(m,e,r[e])})),o(m,w),e.exports=m},"./node_modules/sinon/lib/sinon/throw-on-falsy-object.js":function(e,t,n){"use strict";var i=n("./node_modules/sinon/lib/sinon/util/core/value-to-string.js");e.exports=function(e,t){if(t&&!e){var n=null===e?"null":"undefined";throw new Error("Trying to stub property '"+i(t)+"' of "+n)}}},"./node_modules/sinon/lib/sinon/util/core/called-in-order.js":function(e,t,n){"use strict";var i=Array.prototype.every;e.exports=function(e){var t={};function n(e){return void 0===t[e.id]&&(t[e.id]=0),t[e.id]<e.callCount}return arguments.length>1&&(e=arguments),i.call(e,(function(i,r){var s=!0;return r!==e.length-1&&(s=i.calledBefore(e[r+1])),!(!n(i)||!s)&&(t[i.id]+=1,!0)}))}},"./node_modules/sinon/lib/sinon/util/core/deep-equal.js":function(e,t,n){"use strict";var i="undefined"!=typeof document&&document.createElement("div");function r(e){return e!=e}function s(e){return i&&e&&1===e.nodeType&&function(e){var t=!1;try{e.appendChild(i),t=i.parentNode===e}catch(e){return!1}finally{try{e.removeChild(i)}catch(e){}}return t}(e)}var o=e.exports=function e(t,n){if("object"!=typeof t||"object"!=typeof n)return r(t)&&r(n)||t===n;if(s(t)||s(n))return t===n;if(t===n)return!0;if(null===t&&null!==n||null!==t&&null===n)return!1;if(t instanceof RegExp&&n instanceof RegExp)return t.source===n.source&&t.global===n.global&&t.ignoreCase===n.ignoreCase&&t.multiline===n.multiline;if(t instanceof Error&&n instanceof Error)return t===n;var i,o=Object.prototype.toString.call(t);if(o!==Object.prototype.toString.call(n))return!1;if("[object Date]"===o)return t.valueOf()===n.valueOf();var a=0,l=0;if("[object Array]"===o&&t.length!==n.length)return!1;for(i in t)if(Object.prototype.hasOwnProperty.call(t,i)){if(a+=1,!(i in n))return!1;if(!(arguments[2]||e)(t[i],n[i]))return!1}for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(l+=1);return a===l};o.use=function(e){return function t(n,i){return e.isMatcher(n)?e.isMatcher(i)?n===i:n.test(i):o(n,i,t)}}},"./node_modules/sinon/lib/sinon/util/core/default-config.js":function(e,t,n){"use strict";e.exports={injectIntoThis:!0,injectInto:null,properties:["spy","stub","mock","clock","server","requests"],useFakeTimers:!0,useFakeServer:!0}},"./node_modules/sinon/lib/sinon/util/core/deprecated.js":function(e,t,n){"use strict";t.wrap=function(e,n){var i=function(){return t.printWarning(n),e.apply(this,arguments)};return e.prototype&&(i.prototype=e.prototype),i},t.defaultMsg=function(e){return"sinon."+e+" is deprecated and will be removed from the public API in a future version of sinon."},t.printWarning=function(e){"undefined"!=typeof console&&(console.info?console.info(e):console.log(e))}},"./node_modules/sinon/lib/sinon/util/core/every.js":function(e,t,n){"use strict";e.exports=function(e,t){var n=!0;try{e.forEach((function(){if(!t.apply(this,arguments))throw new Error}))}catch(e){n=!1}return n}},"./node_modules/sinon/lib/sinon/util/core/extend.js":function(e,t,n){"use strict";var i=function(){var e={constructor:function(){return"0"},toString:function(){return"1"},valueOf:function(){return"2"},toLocaleString:function(){return"3"},prototype:function(){return"4"},isPrototypeOf:function(){return"5"},propertyIsEnumerable:function(){return"6"},hasOwnProperty:function(){return"7"},length:function(){return"8"},unique:function(){return"9"}},t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]());return"0123456789"!==t.join("")}();e.exports=function(e){var t,n,r,s=Array.prototype.slice.call(arguments,1);for(n=0;n<s.length;n++){for(r in t=s[n])t.hasOwnProperty(r)&&(e[r]=t[r]);i&&t.hasOwnProperty("toString")&&t.toString!==e.toString&&(e.toString=t.toString)}return e}},"./node_modules/sinon/lib/sinon/util/core/format.js":function(e,t,n){"use strict";var i,r=n("./node_modules/@sinonjs/formatio/lib/formatio.js").configure({quoteStrings:!1,limitChildrenCount:250});function s(){return i?i.apply(null,arguments):r.ascii.apply(r,arguments)}s.setFormatter=function(e){if("function"!=typeof e)throw new Error("format.setFormatter must be called with a function");i=e},e.exports=s},"./node_modules/sinon/lib/sinon/util/core/function-name.js":function(e,t,n){"use strict";e.exports=function(e){var t,n=e.displayName||e.name;return!n&&(t=e.toString().match(/function ([^\s\(]+)/))&&(n=t[1]),n}},"./node_modules/sinon/lib/sinon/util/core/function-to-string.js":function(e,t,n){"use strict";e.exports=function(){var e,t,n;if(this.getCall&&this.callCount)for(e=this.callCount;e--;)for(t in n=this.getCall(e).thisValue)if(n[t]===this)return t;return this.displayName||"sinon fake"}},"./node_modules/sinon/lib/sinon/util/core/get-property-descriptor.js":function(e,t,n){"use strict";e.exports=function(e,t){for(var n,i=e;i&&!(n=Object.getOwnPropertyDescriptor(i,t));)i=Object.getPrototypeOf(i);return n}},"./node_modules/sinon/lib/sinon/util/core/is-es-module.js":function(e,t,n){"use strict";e.exports=function(e){return e&&"undefined"!=typeof Symbol&&"Module"===e[Symbol.toStringTag]}},"./node_modules/sinon/lib/sinon/util/core/iterable-to-string.js":function(e,t,n){"use strict";var i=n("./node_modules/sinon/lib/sinon/util/core/typeOf.js");e.exports=function(e){var t="";function n(e){return"string"==typeof e?"'"+e+"'":String(e)}return"map"===i(e)?(e.forEach((function(e,i){t+="["+n(i)+","+n(e)+"],"})),t=t.slice(0,-1)):(e.forEach((function(e){t+=n(e)+","})),t=t.slice(0,-1))}},"./node_modules/sinon/lib/sinon/util/core/order-by-first-call.js":function(e,t,n){"use strict";e.exports=function(e){return e.sort((function(e,t){var n=e.getCall(0),i=t.getCall(0);return(n&&n.callId||-1)<(i&&i.callId||-1)?-1:1}))}},"./node_modules/sinon/lib/sinon/util/core/times-in-words.js":function(e,t,n){"use strict";var i=[null,"once","twice","thrice"];e.exports=function(e){return i[e]||(e||0)+" times"}},"./node_modules/sinon/lib/sinon/util/core/typeOf.js":function(e,t,n){"use strict";var i=n("./node_modules/type-detect/type-detect.js");e.exports=function(e){return i(e).toLowerCase()}},"./node_modules/sinon/lib/sinon/util/core/value-to-string.js":function(e,t,n){"use strict";e.exports=function(e){return e&&e.toString?e.toString():String(e)}},"./node_modules/sinon/lib/sinon/util/core/walk.js":function(e,t,n){"use strict";e.exports=function(e,t,n){return function e(t,n,i,r,s){var o,a;if("function"==typeof Object.getOwnPropertyNames)Object.getOwnPropertyNames(t).forEach((function(e){if(!0!==s[e]){s[e]=!0;var o="function"==typeof Object.getOwnPropertyDescriptor(t,e).get?r:t;n.call(i,e,o)}})),(o=Object.getPrototypeOf(t))&&e(o,n,i,r,s);else for(a in t)n.call(i,t[a],a,t)}(e,t,n,e,{})}},"./node_modules/sinon/lib/sinon/util/core/wrap-method.js":function(e,t,n){"use strict";var i=n("./node_modules/sinon/lib/sinon/util/core/get-property-descriptor.js"),r=n("./node_modules/sinon/lib/sinon/util/core/value-to-string.js"),s=Object.prototype.hasOwnProperty;function o(e,t){for(var n in t)s.call(e,n)||(e[n]=t[n])}var a="keys"in Object;e.exports=function(e,t,n){if(!e)throw new TypeError("Should wrap property of object");if("function"!=typeof n&&"object"!=typeof n)throw new TypeError("Method wrapper should be a function or a property descriptor");function l(e){var n,i;if("function"==typeof(i=e)||i&&i.constructor&&i.call&&i.apply){if(e.restore&&e.restore.sinon)n=new TypeError("Attempted to wrap "+r(t)+" which is already wrapped");else if(e.calledBefore){var s=e.returns?"stubbed":"spied on";n=new TypeError("Attempted to wrap "+r(t)+" which is already "+s)}}else n=new TypeError("Attempted to wrap "+typeof e+" property "+r(t)+" as function");if(n)throw e&&e.stackTraceError&&(n.stack+="\n--------------\n"+e.stackTraceError.stack),n}var c,u,d;function h(){l(u=e[t]),e[t]=n,n.displayName=t}var p=e.hasOwnProperty?e.hasOwnProperty(t):s.call(e,t);if(a){var f="function"==typeof n?{value:n}:n,m=i(e,t);if(m?m.restore&&m.restore.sinon&&(c=new TypeError("Attempted to wrap "+t+" which is already wrapped")):c=new TypeError("Attempted to wrap "+typeof u+" property "+t+" as function"),c)throw m&&m.stackTraceError&&(c.stack+="\n--------------\n"+m.stackTraceError.stack),c;var g=Object.keys(f);for(d=0;d<g.length;d++)l(u=m[g[d]]);for(o(f,m),d=0;d<g.length;d++)o(f[g[d]],m[g[d]]);Object.defineProperty(e,t,f),"function"==typeof n&&e[t]!==n&&(delete e[t],h())}else h();return n.displayName=t,n.stackTraceError=new Error("Stack Trace for original"),n.restore=function(){if(p)a&&Object.defineProperty(e,t,m);else try{delete e[t]}catch(e){}if(a){var r=i(e,t);r&&r.value===n&&(e[t]=u)}else e[t]===n&&(e[t]=u)},n.wrappedMethod=u,n.restore.sinon=!0,a||o(n,u),n}},"./node_modules/sinon/lib/sinon/util/fake_timers.js":function(e,t,n){"use strict";(function(e,i){var r=n("./node_modules/lolex/lolex.js");t.useFakeTimers=function(e){var t={};if(null==e)t.now=0;else if(("number"==typeof e||e instanceof Date)&&1===arguments.length)t.now=e;else{if(null===e||"object"!=typeof e||1!==arguments.length)throw new TypeError("useFakeTimers expected epoch or config object. See https://github.com/sinonjs/sinon");for(var n=Object.keys(e),i=0;i<n.length;i++)e.hasOwnProperty(n[i])&&(t[n[i]]=e[n[i]])}var s=r.install(t);return s.restore=s.uninstall,s},t.clock={create:function(e){return r.createClock(e)}},t.timers={setTimeout:setTimeout,clearTimeout:clearTimeout,setImmediate:void 0!==e?e:void 0,clearImmediate:void 0!==i?i:void 0,setInterval:setInterval,clearInterval:clearInterval,Date:Date}}).call(this,n("./node_modules/timers-browserify/main.js").setImmediate,n("./node_modules/timers-browserify/main.js").clearImmediate)},"./node_modules/sinon/node_modules/diff/dist/diff.js":function(e,t,n){
/*!

 diff v3.5.0

Software License Agreement (BSD License)

Copyright (c) 2009-2015, Kevin Decker <kpdecker@gmail.com>

All rights reserved.

Redistribution and use of this software in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

* Redistributions of source code must retain the above
  copyright notice, this list of conditions and the
  following disclaimer.

* Redistributions in binary form must reproduce the above
  copyright notice, this list of conditions and the
  following disclaimer in the documentation and/or other
  materials provided with the distribution.

* Neither the name of Kevin Decker nor the names of its
  contributors may be used to endorse or promote products
  derived from this software without specific prior
  written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR
IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER
IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
@license
*/
var i;i=function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,n),r.loaded=!0,r.exports}return n.m=e,n.c=t,n.p="",n(0)}([function(e,t,n){"use strict";t.__esModule=!0,t.canonicalize=t.convertChangesToXML=t.convertChangesToDMP=t.merge=t.parsePatch=t.applyPatches=t.applyPatch=t.createPatch=t.createTwoFilesPatch=t.structuredPatch=t.diffArrays=t.diffJson=t.diffCss=t.diffSentences=t.diffTrimmedLines=t.diffLines=t.diffWordsWithSpace=t.diffWords=t.diffChars=t.Diff=void 0;var i,r=n(1),s=(i=r)&&i.__esModule?i:{default:i},o=n(2),a=n(3),l=n(5),c=n(6),u=n(7),d=n(8),h=n(9),p=n(10),f=n(11),m=n(13),g=n(14),b=n(16),v=n(17);t.Diff=s.default,t.diffChars=o.diffChars,t.diffWords=a.diffWords,t.diffWordsWithSpace=a.diffWordsWithSpace,t.diffLines=l.diffLines,t.diffTrimmedLines=l.diffTrimmedLines,t.diffSentences=c.diffSentences,t.diffCss=u.diffCss,t.diffJson=d.diffJson,t.diffArrays=h.diffArrays,t.structuredPatch=g.structuredPatch,t.createTwoFilesPatch=g.createTwoFilesPatch,t.createPatch=g.createPatch,t.applyPatch=p.applyPatch,t.applyPatches=p.applyPatches,t.parsePatch=f.parsePatch,t.merge=m.merge,t.convertChangesToDMP=b.convertChangesToDMP,t.convertChangesToXML=v.convertChangesToXML,t.canonicalize=d.canonicalize},function(e,t){"use strict";function n(){}function i(e,t,n,i,r){for(var s=0,o=t.length,a=0,l=0;s<o;s++){var c=t[s];if(c.removed){if(c.value=e.join(i.slice(l,l+c.count)),l+=c.count,s&&t[s-1].added){var u=t[s-1];t[s-1]=t[s],t[s]=u}}else{if(!c.added&&r){var d=n.slice(a,a+c.count);d=d.map((function(e,t){var n=i[l+t];return n.length>e.length?n:e})),c.value=e.join(d)}else c.value=e.join(n.slice(a,a+c.count));a+=c.count,c.added||(l+=c.count)}}var h=t[o-1];return o>1&&"string"==typeof h.value&&(h.added||h.removed)&&e.equals("",h.value)&&(t[o-2].value+=h.value,t.pop()),t}function r(e){return{newPos:e.newPos,components:e.components.slice(0)}}t.__esModule=!0,t.default=n,n.prototype={diff:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=n.callback;"function"==typeof n&&(s=n,n={}),this.options=n;var o=this;function a(e){return s?(setTimeout((function(){s(void 0,e)}),0),!0):e}e=this.castInput(e),t=this.castInput(t),e=this.removeEmpty(this.tokenize(e));var l=(t=this.removeEmpty(this.tokenize(t))).length,c=e.length,u=1,d=l+c,h=[{newPos:-1,components:[]}],p=this.extractCommon(h[0],t,e,0);if(h[0].newPos+1>=l&&p+1>=c)return a([{value:this.join(t),count:t.length}]);function f(){for(var n=-1*u;n<=u;n+=2){var s=void 0,d=h[n-1],p=h[n+1],f=(p?p.newPos:0)-n;d&&(h[n-1]=void 0);var m=d&&d.newPos+1<l,g=p&&0<=f&&f<c;if(m||g){if(!m||g&&d.newPos<p.newPos?(s=r(p),o.pushComponent(s.components,void 0,!0)):((s=d).newPos++,o.pushComponent(s.components,!0,void 0)),f=o.extractCommon(s,t,e,n),s.newPos+1>=l&&f+1>=c)return a(i(o,s.components,t,e,o.useLongestToken));h[n]=s}else h[n]=void 0}u++}if(s)!function e(){setTimeout((function(){if(u>d)return s();f()||e()}),0)}();else for(;u<=d;){var m=f();if(m)return m}},pushComponent:function(e,t,n){var i=e[e.length-1];i&&i.added===t&&i.removed===n?e[e.length-1]={count:i.count+1,added:t,removed:n}:e.push({count:1,added:t,removed:n})},extractCommon:function(e,t,n,i){for(var r=t.length,s=n.length,o=e.newPos,a=o-i,l=0;o+1<r&&a+1<s&&this.equals(t[o+1],n[a+1]);)o++,a++,l++;return l&&e.components.push({count:l}),e.newPos=o,a},equals:function(e,t){return this.options.comparator?this.options.comparator(e,t):e===t||this.options.ignoreCase&&e.toLowerCase()===t.toLowerCase()},removeEmpty:function(e){for(var t=[],n=0;n<e.length;n++)e[n]&&t.push(e[n]);return t},castInput:function(e){return e},tokenize:function(e){return e.split("")},join:function(e){return e.join("")}}},function(e,t,n){"use strict";t.__esModule=!0,t.characterDiff=void 0,t.diffChars=function(e,t,n){return o.diff(e,t,n)};var i,r=n(1),s=(i=r)&&i.__esModule?i:{default:i},o=t.characterDiff=new s.default},function(e,t,n){"use strict";t.__esModule=!0,t.wordDiff=void 0,t.diffWords=function(e,t,n){return n=(0,o.generateOptions)(n,{ignoreWhitespace:!0}),c.diff(e,t,n)},t.diffWordsWithSpace=function(e,t,n){return c.diff(e,t,n)};var i,r=n(1),s=(i=r)&&i.__esModule?i:{default:i},o=n(4),a=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,l=/\S/,c=t.wordDiff=new s.default;c.equals=function(e,t){return this.options.ignoreCase&&(e=e.toLowerCase(),t=t.toLowerCase()),e===t||this.options.ignoreWhitespace&&!l.test(e)&&!l.test(t)},c.tokenize=function(e){for(var t=e.split(/(\s+|\b)/),n=0;n<t.length-1;n++)!t[n+1]&&t[n+2]&&a.test(t[n])&&a.test(t[n+2])&&(t[n]+=t[n+2],t.splice(n+1,2),n--);return t}},function(e,t){"use strict";t.__esModule=!0,t.generateOptions=function(e,t){if("function"==typeof e)t.callback=e;else if(e)for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}},function(e,t,n){"use strict";t.__esModule=!0,t.lineDiff=void 0,t.diffLines=function(e,t,n){return a.diff(e,t,n)},t.diffTrimmedLines=function(e,t,n){var i=(0,o.generateOptions)(n,{ignoreWhitespace:!0});return a.diff(e,t,i)};var i,r=n(1),s=(i=r)&&i.__esModule?i:{default:i},o=n(4),a=t.lineDiff=new s.default;a.tokenize=function(e){var t=[],n=e.split(/(\n|\r\n)/);n[n.length-1]||n.pop();for(var i=0;i<n.length;i++){var r=n[i];i%2&&!this.options.newlineIsToken?t[t.length-1]+=r:(this.options.ignoreWhitespace&&(r=r.trim()),t.push(r))}return t}},function(e,t,n){"use strict";t.__esModule=!0,t.sentenceDiff=void 0,t.diffSentences=function(e,t,n){return o.diff(e,t,n)};var i,r=n(1),s=(i=r)&&i.__esModule?i:{default:i},o=t.sentenceDiff=new s.default;o.tokenize=function(e){return e.split(/(\S.+?[.!?])(?=\s+|$)/)}},function(e,t,n){"use strict";t.__esModule=!0,t.cssDiff=void 0,t.diffCss=function(e,t,n){return o.diff(e,t,n)};var i,r=n(1),s=(i=r)&&i.__esModule?i:{default:i},o=t.cssDiff=new s.default;o.tokenize=function(e){return e.split(/([{}:;,]|\s+)/)}},function(e,t,n){"use strict";t.__esModule=!0,t.jsonDiff=void 0;var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.diffJson=function(e,t,n){return c.diff(e,t,n)},t.canonicalize=u;var r,s=n(1),o=(r=s)&&r.__esModule?r:{default:r},a=n(5),l=Object.prototype.toString,c=t.jsonDiff=new o.default;function u(e,t,n,r,s){t=t||[],n=n||[],r&&(e=r(s,e));var o=void 0;for(o=0;o<t.length;o+=1)if(t[o]===e)return n[o];var a=void 0;if("[object Array]"===l.call(e)){for(t.push(e),a=new Array(e.length),n.push(a),o=0;o<e.length;o+=1)a[o]=u(e[o],t,n,r,s);return t.pop(),n.pop(),a}if(e&&e.toJSON&&(e=e.toJSON()),"object"===(void 0===e?"undefined":i(e))&&null!==e){t.push(e),a={},n.push(a);var c=[],d=void 0;for(d in e)e.hasOwnProperty(d)&&c.push(d);for(c.sort(),o=0;o<c.length;o+=1)a[d=c[o]]=u(e[d],t,n,r,d);t.pop(),n.pop()}else a=e;return a}c.useLongestToken=!0,c.tokenize=a.lineDiff.tokenize,c.castInput=function(e){var t=this.options,n=t.undefinedReplacement,i=t.stringifyReplacer,r=void 0===i?function(e,t){return void 0===t?n:t}:i;return"string"==typeof e?e:JSON.stringify(u(e,null,null,r),r,"  ")},c.equals=function(e,t){return o.default.prototype.equals.call(c,e.replace(/,([\r\n])/g,"$1"),t.replace(/,([\r\n])/g,"$1"))}},function(e,t,n){"use strict";t.__esModule=!0,t.arrayDiff=void 0,t.diffArrays=function(e,t,n){return o.diff(e,t,n)};var i,r=n(1),s=(i=r)&&i.__esModule?i:{default:i},o=t.arrayDiff=new s.default;o.tokenize=function(e){return e.slice()},o.join=o.removeEmpty=function(e){return e}},function(e,t,n){"use strict";t.__esModule=!0,t.applyPatch=a,t.applyPatches=function(e,t){"string"==typeof e&&(e=(0,r.parsePatch)(e));var n=0;!function i(){var r=e[n++];if(!r)return t.complete();t.loadFile(r,(function(e,n){if(e)return t.complete(e);var s=a(n,r,t);t.patched(r,s,(function(e){if(e)return t.complete(e);i()}))}))}()};var i,r=n(11),s=n(12),o=(i=s)&&i.__esModule?i:{default:i};function a(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("string"==typeof t&&(t=(0,r.parsePatch)(t)),Array.isArray(t)){if(t.length>1)throw new Error("applyPatch only works with a single input.");t=t[0]}var i=e.split(/\r\n|[\n\v\f\r\x85]/),s=e.match(/\r\n|[\n\v\f\r\x85]/g)||[],a=t.hunks,l=n.compareLine||function(e,t,n,i){return t===i},c=0,u=n.fuzzFactor||0,d=0,h=0,p=void 0,f=void 0;function m(e,t){for(var n=0;n<e.lines.length;n++){var r=e.lines[n],s=r.length>0?r[0]:" ",o=r.length>0?r.substr(1):r;if(" "===s||"-"===s){if(!l(t+1,i[t],s,o)&&++c>u)return!1;t++}}return!0}for(var g=0;g<a.length;g++){for(var b=a[g],v=i.length-b.oldLines,w=0,y=h+b.oldStart-1,k=(0,o.default)(y,d,v);void 0!==w;w=k())if(m(b,y+w)){b.offset=h+=w;break}if(void 0===w)return!1;d=b.offset+b.oldStart+b.oldLines}for(var j=0,x=0;x<a.length;x++){var E=a[x],T=E.oldStart+E.offset+j-1;j+=E.newLines-E.oldLines,T<0&&(T=0);for(var q=0;q<E.lines.length;q++){var S=E.lines[q],_=S.length>0?S[0]:" ",C=S.length>0?S.substr(1):S,A=E.linedelimiters[q];if(" "===_)T++;else if("-"===_)i.splice(T,1),s.splice(T,1);else if("+"===_)i.splice(T,0,C),s.splice(T,0,A),T++;else if("\\"===_){var O=E.lines[q-1]?E.lines[q-1][0]:null;"+"===O?p=!0:"-"===O&&(f=!0)}}}if(p)for(;!i[i.length-1];)i.pop(),s.pop();else f&&(i.push(""),s.push("\n"));for(var M=0;M<i.length-1;M++)i[M]=i[M]+s[M];return i.join("")}},function(e,t){"use strict";t.__esModule=!0,t.parsePatch=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.split(/\r\n|[\n\v\f\r\x85]/),i=e.match(/\r\n|[\n\v\f\r\x85]/g)||[],r=[],s=0;function o(){var e={};for(r.push(e);s<n.length;){var i=n[s];if(/^(\-\-\-|\+\+\+|@@)\s/.test(i))break;var o=/^(?:Index:|diff(?: -r \w+)+)\s+(.+?)\s*$/.exec(i);o&&(e.index=o[1]),s++}for(a(e),a(e),e.hunks=[];s<n.length;){var c=n[s];if(/^(Index:|diff|\-\-\-|\+\+\+)\s/.test(c))break;if(/^@@/.test(c))e.hunks.push(l());else{if(c&&t.strict)throw new Error("Unknown line "+(s+1)+" "+JSON.stringify(c));s++}}}function a(e){var t=/^(---|\+\+\+)\s+(.*)$/.exec(n[s]);if(t){var i="---"===t[1]?"old":"new",r=t[2].split("\t",2),o=r[0].replace(/\\\\/g,"\\");/^".*"$/.test(o)&&(o=o.substr(1,o.length-2)),e[i+"FileName"]=o,e[i+"Header"]=(r[1]||"").trim(),s++}}function l(){for(var e=s,r=n[s++].split(/@@ -(\d+)(?:,(\d+))? \+(\d+)(?:,(\d+))? @@/),o={oldStart:+r[1],oldLines:+r[2]||1,newStart:+r[3],newLines:+r[4]||1,lines:[],linedelimiters:[]},a=0,l=0;s<n.length&&!(0===n[s].indexOf("--- ")&&s+2<n.length&&0===n[s+1].indexOf("+++ ")&&0===n[s+2].indexOf("@@"));s++){var c=0==n[s].length&&s!=n.length-1?" ":n[s][0];if("+"!==c&&"-"!==c&&" "!==c&&"\\"!==c)break;o.lines.push(n[s]),o.linedelimiters.push(i[s]||"\n"),"+"===c?a++:"-"===c?l++:" "===c&&(a++,l++)}if(a||1!==o.newLines||(o.newLines=0),l||1!==o.oldLines||(o.oldLines=0),t.strict){if(a!==o.newLines)throw new Error("Added line count did not match for hunk at line "+(e+1));if(l!==o.oldLines)throw new Error("Removed line count did not match for hunk at line "+(e+1))}return o}for(;s<n.length;)o();return r}},function(e,t){"use strict";t.__esModule=!0,t.default=function(e,t,n){var i=!0,r=!1,s=!1,o=1;return function a(){if(i&&!s){if(r?o++:i=!1,e+o<=n)return o;s=!0}if(!r)return s||(i=!0),t<=e-o?-o++:(r=!0,a())}}},function(e,t,n){"use strict";t.__esModule=!0,t.calcLineCount=a,t.merge=function(e,t,n){e=l(e,n),t=l(t,n);var i={};(e.index||t.index)&&(i.index=e.index||t.index),(e.newFileName||t.newFileName)&&(c(e)?c(t)?(i.oldFileName=u(i,e.oldFileName,t.oldFileName),i.newFileName=u(i,e.newFileName,t.newFileName),i.oldHeader=u(i,e.oldHeader,t.oldHeader),i.newHeader=u(i,e.newHeader,t.newHeader)):(i.oldFileName=e.oldFileName,i.newFileName=e.newFileName,i.oldHeader=e.oldHeader,i.newHeader=e.newHeader):(i.oldFileName=t.oldFileName||e.oldFileName,i.newFileName=t.newFileName||e.newFileName,i.oldHeader=t.oldHeader||e.oldHeader,i.newHeader=t.newHeader||e.newHeader)),i.hunks=[];for(var r=0,s=0,o=0,a=0;r<e.hunks.length||s<t.hunks.length;){var f=e.hunks[r]||{oldStart:1/0},m=t.hunks[s]||{oldStart:1/0};if(d(f,m))i.hunks.push(h(f,o)),r++,a+=f.newLines-f.oldLines;else if(d(m,f))i.hunks.push(h(m,a)),s++,o+=m.newLines-m.oldLines;else{var g={oldStart:Math.min(f.oldStart,m.oldStart),oldLines:0,newStart:Math.min(f.newStart+o,m.oldStart+a),newLines:0,lines:[]};p(g,f.oldStart,f.lines,m.oldStart,m.lines),s++,r++,i.hunks.push(g)}}return i};var i=n(14),r=n(11),s=n(15);function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function a(e){var t=function e(t){var n=0,i=0;return t.forEach((function(t){if("string"!=typeof t){var r=e(t.mine),s=e(t.theirs);void 0!==n&&(r.oldLines===s.oldLines?n+=r.oldLines:n=void 0),void 0!==i&&(r.newLines===s.newLines?i+=r.newLines:i=void 0)}else void 0===i||"+"!==t[0]&&" "!==t[0]||i++,void 0===n||"-"!==t[0]&&" "!==t[0]||n++})),{oldLines:n,newLines:i}}(e.lines),n=t.oldLines,i=t.newLines;void 0!==n?e.oldLines=n:delete e.oldLines,void 0!==i?e.newLines=i:delete e.newLines}function l(e,t){if("string"==typeof e){if(/^@@/m.test(e)||/^Index:/m.test(e))return(0,r.parsePatch)(e)[0];if(!t)throw new Error("Must provide a base reference or pass in a patch");return(0,i.structuredPatch)(void 0,void 0,t,e)}return e}function c(e){return e.newFileName&&e.newFileName!==e.oldFileName}function u(e,t,n){return t===n?t:(e.conflict=!0,{mine:t,theirs:n})}function d(e,t){return e.oldStart<t.oldStart&&e.oldStart+e.oldLines<t.oldStart}function h(e,t){return{oldStart:e.oldStart,oldLines:e.oldLines,newStart:e.newStart+t,newLines:e.newLines,lines:e.lines}}function p(e,t,n,i,r){var s={offset:t,lines:n,index:0},l={offset:i,lines:r,index:0};for(b(e,s,l),b(e,l,s);s.index<s.lines.length&&l.index<l.lines.length;){var c=s.lines[s.index],u=l.lines[l.index];if("-"!==c[0]&&"+"!==c[0]||"-"!==u[0]&&"+"!==u[0])if("+"===c[0]&&" "===u[0]){var d;(d=e.lines).push.apply(d,o(w(s)))}else if("+"===u[0]&&" "===c[0]){var h;(h=e.lines).push.apply(h,o(w(l)))}else"-"===c[0]&&" "===u[0]?m(e,s,l):"-"===u[0]&&" "===c[0]?m(e,l,s,!0):c===u?(e.lines.push(c),s.index++,l.index++):g(e,w(s),w(l));else f(e,s,l)}v(e,s),v(e,l),a(e)}function f(e,t,n){var i=w(t),r=w(n);if(y(i)&&y(r)){var a,l;if((0,s.arrayStartsWith)(i,r)&&k(n,i,i.length-r.length))return void(a=e.lines).push.apply(a,o(i));if((0,s.arrayStartsWith)(r,i)&&k(t,r,r.length-i.length))return void(l=e.lines).push.apply(l,o(r))}else if((0,s.arrayEqual)(i,r)){var c;return void(c=e.lines).push.apply(c,o(i))}g(e,i,r)}function m(e,t,n,i){var r,s=w(t),a=function(e,t){for(var n=[],i=[],r=0,s=!1,o=!1;r<t.length&&e.index<e.lines.length;){var a=e.lines[e.index],l=t[r];if("+"===l[0])break;if(s=s||" "!==a[0],i.push(l),r++,"+"===a[0])for(o=!0;"+"===a[0];)n.push(a),a=e.lines[++e.index];l.substr(1)===a.substr(1)?(n.push(a),e.index++):o=!0}if("+"===(t[r]||"")[0]&&s&&(o=!0),o)return n;for(;r<t.length;)i.push(t[r++]);return{merged:i,changes:n}}(n,s);a.merged?(r=e.lines).push.apply(r,o(a.merged)):g(e,i?a:s,i?s:a)}function g(e,t,n){e.conflict=!0,e.lines.push({conflict:!0,mine:t,theirs:n})}function b(e,t,n){for(;t.offset<n.offset&&t.index<t.lines.length;){var i=t.lines[t.index++];e.lines.push(i),t.offset++}}function v(e,t){for(;t.index<t.lines.length;){var n=t.lines[t.index++];e.lines.push(n)}}function w(e){for(var t=[],n=e.lines[e.index][0];e.index<e.lines.length;){var i=e.lines[e.index];if("-"===n&&"+"===i[0]&&(n="+"),n!==i[0])break;t.push(i),e.index++}return t}function y(e){return e.reduce((function(e,t){return e&&"-"===t[0]}),!0)}function k(e,t,n){for(var i=0;i<n;i++){var r=t[t.length-n+i].substr(1);if(e.lines[e.index+i]!==" "+r)return!1}return e.index+=n,!0}},function(e,t,n){"use strict";t.__esModule=!0,t.structuredPatch=s,t.createTwoFilesPatch=o,t.createPatch=function(e,t,n,i,r,s){return o(e,e,t,n,i,r,s)};var i=n(5);function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function s(e,t,n,s,o,a,l){l||(l={}),void 0===l.context&&(l.context=4);var c=(0,i.diffLines)(n,s,l);function u(e){return e.map((function(e){return" "+e}))}c.push({value:"",lines:[]});for(var d=[],h=0,p=0,f=[],m=1,g=1,b=function(e){var t=c[e],i=t.lines||t.value.replace(/\n$/,"").split("\n");if(t.lines=i,t.added||t.removed){var o;if(!h){var a=c[e-1];h=m,p=g,a&&(f=l.context>0?u(a.lines.slice(-l.context)):[],h-=f.length,p-=f.length)}(o=f).push.apply(o,r(i.map((function(e){return(t.added?"+":"-")+e})))),t.added?g+=i.length:m+=i.length}else{if(h)if(i.length<=2*l.context&&e<c.length-2){var b;(b=f).push.apply(b,r(u(i)))}else{var v,w=Math.min(i.length,l.context);(v=f).push.apply(v,r(u(i.slice(0,w))));var y={oldStart:h,oldLines:m-h+w,newStart:p,newLines:g-p+w,lines:f};if(e>=c.length-2&&i.length<=l.context){var k=/\n$/.test(n),j=/\n$/.test(s);0!=i.length||k?k&&j||f.push("\\ No newline at end of file"):f.splice(y.oldLines,0,"\\ No newline at end of file")}d.push(y),h=0,p=0,f=[]}m+=i.length,g+=i.length}},v=0;v<c.length;v++)b(v);return{oldFileName:e,newFileName:t,oldHeader:o,newHeader:a,hunks:d}}function o(e,t,n,i,r,o,a){var l=s(e,t,n,i,r,o,a),c=[];e==t&&c.push("Index: "+e),c.push("==================================================================="),c.push("--- "+l.oldFileName+(void 0===l.oldHeader?"":"\t"+l.oldHeader)),c.push("+++ "+l.newFileName+(void 0===l.newHeader?"":"\t"+l.newHeader));for(var u=0;u<l.hunks.length;u++){var d=l.hunks[u];c.push("@@ -"+d.oldStart+","+d.oldLines+" +"+d.newStart+","+d.newLines+" @@"),c.push.apply(c,d.lines)}return c.join("\n")+"\n"}},function(e,t){"use strict";function n(e,t){if(t.length>e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}t.__esModule=!0,t.arrayEqual=function(e,t){return e.length===t.length&&n(e,t)},t.arrayStartsWith=n},function(e,t){"use strict";t.__esModule=!0,t.convertChangesToDMP=function(e){for(var t=[],n=void 0,i=void 0,r=0;r<e.length;r++)n=e[r],i=n.added?1:n.removed?-1:0,t.push([i,n.value]);return t}},function(e,t){"use strict";t.__esModule=!0,t.convertChangesToXML=function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];i.added?t.push("<ins>"):i.removed&&t.push("<del>"),t.push((r=i.value,void 0,r.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"))),i.added?t.push("</ins>"):i.removed&&t.push("</del>")}var r;return t.join("")}}])},e.exports=i()},"./node_modules/supports-color/browser.js":function(e,t,n){"use strict";e.exports={stdout:!1,stderr:!1}},"./node_modules/timers-browserify/main.js":function(e,t,n){(function(e){var i=void 0!==e&&e||"undefined"!=typeof self&&self||window,r=Function.prototype.apply;function s(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new s(r.call(setTimeout,i,arguments),clearTimeout)},t.setInterval=function(){return new s(r.call(setInterval,i,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},s.prototype.unref=s.prototype.ref=function(){},s.prototype.close=function(){this._clearFn.call(i,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n("./node_modules/setimmediate/setImmediate.js"),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./node_modules/type-detect/type-detect.js":function(e,t,n){(function(t){var n;n=function(){"use strict";var e="function"==typeof Promise,n="object"==typeof self?self:t,i="undefined"!=typeof Symbol,r="undefined"!=typeof Map,s="undefined"!=typeof Set,o="undefined"!=typeof WeakMap,a="undefined"!=typeof WeakSet,l="undefined"!=typeof DataView,c=i&&void 0!==Symbol.iterator,u=i&&void 0!==Symbol.toStringTag,d=s&&"function"==typeof Set.prototype.entries,h=r&&"function"==typeof Map.prototype.entries,p=d&&Object.getPrototypeOf((new Set).entries()),f=h&&Object.getPrototypeOf((new Map).entries()),m=c&&"function"==typeof Array.prototype[Symbol.iterator],g=m&&Object.getPrototypeOf([][Symbol.iterator]()),b=c&&"function"==typeof String.prototype[Symbol.iterator],v=b&&Object.getPrototypeOf(""[Symbol.iterator]());return function(t){var i=typeof t;if("object"!==i)return i;if(null===t)return"null";if(t===n)return"global";if(Array.isArray(t)&&(!1===u||!(Symbol.toStringTag in t)))return"Array";if("object"==typeof window&&null!==window){if("object"==typeof window.location&&t===window.location)return"Location";if("object"==typeof window.document&&t===window.document)return"Document";if("object"==typeof window.navigator){if("object"==typeof window.navigator.mimeTypes&&t===window.navigator.mimeTypes)return"MimeTypeArray";if("object"==typeof window.navigator.plugins&&t===window.navigator.plugins)return"PluginArray"}if(("function"==typeof window.HTMLElement||"object"==typeof window.HTMLElement)&&t instanceof window.HTMLElement){if("BLOCKQUOTE"===t.tagName)return"HTMLQuoteElement";if("TD"===t.tagName)return"HTMLTableDataCellElement";if("TH"===t.tagName)return"HTMLTableHeaderCellElement"}}var c=u&&t[Symbol.toStringTag];if("string"==typeof c)return c;var d=Object.getPrototypeOf(t);return d===RegExp.prototype?"RegExp":d===Date.prototype?"Date":e&&d===Promise.prototype?"Promise":s&&d===Set.prototype?"Set":r&&d===Map.prototype?"Map":a&&d===WeakSet.prototype?"WeakSet":o&&d===WeakMap.prototype?"WeakMap":l&&d===DataView.prototype?"DataView":r&&d===f?"Map Iterator":s&&d===p?"Set Iterator":m&&d===g?"Array Iterator":b&&d===v?"String Iterator":null===d?"Object":Object.prototype.toString.call(t).slice(8,-1)}},e.exports=n()}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./node_modules/webpack/buildin/global.js":function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},"./src/mobile.categories.overlays/CategoryGateway.js":function(e,t,n){var i,r=n("./src/mobile.startup/actionParams.js"),s=n("./src/mobile.startup/util.js"),o=n("./src/mobile.startup/search/SearchGateway.js");function a(){a.parent.apply(this,arguments)}i={continueParams:{},canContinue:!0,searchNamespace:14,save:function(e,t){return this.api.postWithToken("csrf",{action:"edit",title:e,appendtext:t,summary:mw.msg("mobile-frontend-categories-summary")})},getCategories:function(e){var t,n=this;return!1!==this.canContinue&&(t=s.extend({},{prop:"categories",titles:e,clprop:"hidden",cllimit:50},this.continueParams),this.api.get(r(t)).then((function(e){return void 0!==e.continue?n.continueParams=e.continue:n.canContinue=!1,e})))}},OO.inheritClass(a,o),s.extend(a.prototype,i),e.exports=a},"./src/mobile.editor.overlay/BlockMessageDetails.js":function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=c(e);if(t){var r=c(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l(this,n)}}function l(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var u=n("./src/mobile.startup/Button.js"),d=n("./src/mobile.startup/View.js"),h=n("./src/mobile.startup/Icon.js"),p=n("./src/mobile.startup/util.js"),f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(c,e);var t,n,i,l=a(c);function c(){return r(this,c),l.apply(this,arguments)}return t=c,(n=[{key:"isTemplateMode",get:function(){return!0}},{key:"defaults",get:function(){return{createDetailsAnchorHref:function(){return function(e,t){return mw.util.getUrl("Special:BlockList",{wpTarget:"#"+t(e)})}},createDetailsAnchorLabel:function(){return mw.msg("mobile-frontend-editor-blocked-drawer-help")},createTitle:function(){var e="mobile-frontend-editor-blocked-drawer-title";return mw.user.isAnon()&&(e+="-ip"),this.partial&&(e+="-partial"),mw.msg(e)},createBody:function(){var e="";return mw.user.isAnon()&&this.anonOnly?(e="mobile-frontend-editor-blocked-drawer-body",this.noCreateAccount?e+="-login":e+="-login-createaccount",this.partial&&(e+="-partial")):this.partial&&(e="mobile-frontend-editor-blocked-drawer-body-partial"),e?mw.msg(e):e},seeMoreLink:mw.msg("mobile-frontend-editor-blocked-drawer-body-link"),reasonHeader:mw.msg("mobile-frontend-editor-blocked-drawer-reason-header"),creatorHeader:function(){return mw.msg("mobile-frontend-editor-blocked-drawer-creator-header",mw.user.options.get("gender"))},expiryHeader:mw.msg("mobile-frontend-editor-blocked-drawer-expiry-header")}}},{key:"getButtonConfig",value:function(){var e=!0,t={progressive:!0},n=mw.config.get("wgDBname");return mw.user.isAnon()&&this.options.anonOnly?(t.label=mw.msg("mobile-frontend-editor-blocked-drawer-action-login"),t.href=new mw.Title("Special:UserLogin").getUrl()):this.options.partial?(t.label=mw.msg("mobile-frontend-editor-blocked-drawer-action-randompage"),t.href=new mw.Title("Special:Random").getUrl(),t.quiet=!0):(t.tagName="button",t.label=mw.msg("mobile-frontend-editor-blocked-drawer-action-ok"),t.additionalClassNames="cancel",e=!1),e&&mw.config.get("wgMFTrackBlockNotices")&&(mw.track("counter.MediaWiki.BlockNotices."+n+".MobileFrontend.ctaShown",1),t.events={click:function(){mw.track("counter.MediaWiki.BlockNotices."+n+".MobileFrontend.ctaClicked",1)}}),t}},{key:"postRender",value:function(){var e=this;this.$el.find(".block-message-buttons").prepend(new u(this.getButtonConfig()).$el),this.$el.find(".block-message-icon").prepend(new h({name:"block-destructive",additionalClassNames:"mw-ui-icon-flush-top"}).$el),this.options.parsedReason.then((function(t){e.$el.find(".block-message-reason div").html(t)}))}},{key:"template",get:function(){return p.template('\n<div class="block-message block-message-container">\n  <div class="block-message-icon"></div>\n  <div class="block-message-info">\n    <div class="block-message-item block-message-title">\n      <h5>{{ createTitle }}</h5>\n    </div>\n    <div class="block-message-data">\n      <div class="block-message-item">\n        <p>\n          {{ createBody }}\n          <a class ="block-message-see-more" href="#">{{ seeMoreLink }}</a>\n        </p>\n      </div>\n      <div class="block-message-item block-message-creator">\n        {{#creator.name}}\n          <p>\n            {{ creatorHeader }}\n            <strong>\n              {{#creator.url}}\n                <a href="{{ creator.url }}">{{ creator.name }}</a>\n              {{/creator.url}}\n              {{^creator.url}}\n                {{ creator.name }}\n              {{/creator.url}}\n            </strong>\n          </p>\n        {{/creator.name}}\n      </div>\n      {{#duration}}\n        <div class="block-message-item">\n          <p>\n            {{ expiryHeader }}\n            <strong>{{ duration }}</strong>\n          </p>\n        </div>\n      {{/duration}}\n      {{#blockId}}\n        <div class="block-message-item">\n          <a href="{{#createDetailsAnchorHref}}{{ blockId }}{{/createDetailsAnchorHref}}">\n            {{ createDetailsAnchorLabel }}\n          </a>\n        </div>\n      {{/blockId}}\n    </div>\n  </div>\n  {{#reason}}\n    <div class="block-message-item block-message-reason">\n      <h5>{{ reasonHeader }}</h5>\n      <div><p>{{{ reason }}}</p></div>\n    </div>\n  {{/reason}}\n  <div class="block-message-buttons">\n  </div>\n</div>')}}])&&s(t.prototype,n),i&&s(t,i),c}(d);e.exports=f},"./src/mobile.editor.overlay/EditorGateway.js":function(e,t,n){var i=n("./src/mobile.startup/util.js"),r=n("./src/mobile.startup/actionParams.js");function s(e){this.api=e.api,this.title=e.title,this.sectionId=e.sectionId,this.oldId=e.oldId,this.content=e.isNewPage?"":void 0,this.fromModified=e.fromModified,this.hasChanged=e.fromModified}s.prototype={getBlockInfo:function(e){var t;return e.actions&&e.actions.edit&&Array.isArray(e.actions.edit)&&(e.actions.edit.some((function(e){return-1!==["blocked","autoblocked"].indexOf(e.code)&&(t=e,!0)})),t&&t.data&&t.data.blockinfo)?t.data.blockinfo:null},getContent:function(){var e,t=this;function n(){return i.Deferred().resolve({text:t.content||"",blockinfo:t.blockinfo})}return void 0!==this.content?n():(e=r({prop:["revisions","info"],rvprop:["content","timestamp"],titles:t.title,intestactions:"edit",intestactionsdetail:"full"}),this.oldId&&(e.rvstartid=this.oldId),this.sectionId&&(e.rvsection=this.sectionId),this.api.get(e).then((function(e){var r,s;return e.error?i.Deferred().reject(e.error.code):(void 0!==(s=e.query.pages[0]).missing?t.content="":(r=s.revisions[0],t.content=r.content,t.timestamp=r.timestamp),t.originalContent=t.content,t.blockinfo=t.getBlockInfo(s),n())})))},setContent:function(e){this.originalContent!==e||this.fromModified?this.hasChanged=!0:this.hasChanged=!1,this.content=e},setPrependText:function(e){this.prependtext=e,this.hasChanged=!0},save:function(e){var t,n=this,r=i.Deferred();return e=e||{},t={action:"edit",errorformat:"html",errorlang:mw.config.get("wgUserLanguage"),errorsuselocal:1,formatversion:2,title:n.title,summary:e.summary,captchaid:e.captchaId,captchaword:e.captchaWord,basetimestamp:n.timestamp,starttimestamp:n.timestamp},void 0!==n.content?t.text=n.content:n.prependtext&&(t.prependtext=n.prependtext),n.sectionId&&(t.section=n.sectionId),n.api.postWithToken("csrf",t).then((function(e){e&&e.edit&&"Success"===e.edit.result?(n.hasChanged=!1,r.resolve(e.edit.newrevid)):r.reject(e)}),(function(e,t){r.reject(t)})),r},abortPreview:function(){this._pending&&this._pending.abort()},getPreview:function(e){var t="",n="",r=this;return i.extend(e,{action:"parse",sectionpreview:!0,disableeditsection:!0,pst:!0,mobileformat:!0,title:this.title,prop:["text","sections"]}),this.abortPreview(),this._pending=this.api.post(e),this._pending.then((function(e){return e&&e.parse&&e.parse.text?(r.sectionId&&"0"!==r.sectionId&&void 0!==e.parse.sections&&void 0!==e.parse.sections[0]&&(void 0!==e.parse.sections[0].anchor&&(n=e.parse.sections[0].anchor),void 0!==e.parse.sections[0].line&&(t=e.parse.sections[0].line)),{text:e.parse.text["*"],id:n,line:t}):i.Deferred().reject()})).promise({abort:function(){r._pending.abort()}})}},e.exports=s},"./src/mobile.editor.overlay/EditorOverlayBase.js":function(e,t,n){var i=n("./src/mobile.startup/Overlay.js"),r=n("./src/mobile.startup/util.js"),s=n("./src/mobile.editor.overlay/parseBlockInfo.js"),o=n("./src/mobile.startup/headers.js"),a=n("./src/mobile.startup/PageGateway.js"),l=n("./src/mobile.startup/icons.js"),c=n("./src/mobile.startup/Button.js"),u=n("./src/mobile.startup/Icon.js"),d=n("./src/mobile.startup/showOnPageReload.js"),h=n("./src/mobile.startup/mfExtend.js"),p=n("./src/mobile.editor.overlay/blockMessageDrawer.js"),f=n("./src/mobile.startup/MessageBox.js"),m=mw.user;function g(e,t){(t=t||{}).classes=["visual-editor"],g.super.call(this,e,t)}function b(e){var t=r.extend(!0,{onBeforeExit:this.onBeforeExit.bind(this),className:"overlay editor-overlay",isBorderBox:!1},e,{events:r.extend({"click .back":"onClickBack","click .continue":"onClickContinue","click .submit":"onClickSubmit","click .anonymous":"onClickAnonymous"},e.events)});t.isNewPage&&(t.placeholder=mw.msg("mobile-frontend-editor-placeholder-new-page",m)),0!==mw.config.get("wgNamespaceNumber")&&(t.summaryRequestMsg=mw.msg("mobile-frontend-editor-summary")),this.pageGateway=new a(t.api),this.editCount=t.editCount,this.isNewPage=t.isNewPage,this.isNewEditor=0===t.editCount,this.sectionId=t.sectionId,this.sessionId=t.sessionId,this.overlayManager=t.overlayManager,i.call(this,t)}OO.inheritClass(g,OO.ui.Tool),g.static.name="editVe",g.static.icon="edit",g.static.group="editorSwitcher",g.static.title=mw.msg("mobile-frontend-editor-switch-visual-editor"),g.prototype.onSelect=function(){},g.prototype.onUpdateState=function(){},h(b,i,{defaults:r.extend({},i.prototype.defaults,{hasToolbar:!1,continueMsg:mw.msg("mobile-frontend-editor-continue"),closeMsg:mw.msg("mobile-frontend-editor-keep-editing"),summaryRequestMsg:mw.msg("mobile-frontend-editor-summary-request"),summaryMsg:mw.msg("mobile-frontend-editor-summary-placeholder"),placeholder:mw.msg("mobile-frontend-editor-placeholder"),captchaMsg:mw.msg("mobile-frontend-account-create-captcha-placeholder"),captchaTryAgainMsg:mw.msg("mobile-frontend-editor-captcha-try-again"),switchMsg:mw.msg("mobile-frontend-editor-switch-editor"),confirmMsg:mw.msg("mobile-frontend-editor-cancel-confirm"),licenseMsg:void 0}),template:r.template('\n<div class="overlay-header-container header-container position-fixed"></div>\n\n<div class="overlay-content">\n\t<div class="panels">\n\t\t<div class="save-panel panel hideable hidden">\n\t\t\t<div id="error-notice-container"></div>\n\t\t\t<h2 class="summary-request">{{{summaryRequestMsg}}}</h2>\n\t\t\t<textarea rows="2" class="mw-ui-input summary" placeholder="{{summaryMsg}}"></textarea>\n\t\t\t{{#licenseMsg}}<div class="license">{{{licenseMsg}}}</div>{{/licenseMsg}}\n\t\t</div>\n\t\t<div class="captcha-panel panel hideable hidden">\n\t\t\t<div class="captcha-box">\n\t\t\t\t<img id="image" src="">\n\t\t\t\t<div id="question"></div>\n\t\t\t\t<input class="captcha-word mw-ui-input" placeholder="{{captchaMsg}}" />\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t{{>content}}\n</div>\n<div class="overlay-footer-container position-fixed">\n\t{{>footer}}\n</div>\n\t'),sectionId:"",log:function(e){mw.track("mf.schemaEditAttemptStep",r.extend(e,{editor_interface:this.editor,editing_session_id:this.sessionId}))},logFeatureUse:function(e){mw.track("mf.schemaVisualEditorFeatureUse",r.extend(e,{editor_interface:this.editor,editing_session_id:this.sessionId}))},confirmSave:function(){return!(this.isNewPage&&!window.confirm(mw.msg("mobile-frontend-editor-new-page-confirm",m)))},onSaveComplete:function(e){var t,n=r.getWindow(),i=this.options.title;this.saved=!0,this.pageGateway.invalidatePage(i),t=this.isNewPage?mw.msg("mobile-frontend-editor-success-new-page"):this.isNewEditor?mw.msg("mobile-frontend-editor-success-landmark-1"):mw.msg("mobile-frontend-editor-success"),mw.hook("postEditMobile").fire(),mw.config.get("wgPostEditConfirmationDisabled")||d.showOnPageReload(t,{type:"success"}),this.log({action:"saveSuccess",revision_id:e}),this.sectionId?window.location.hash="#"+this.sectionId:window.location.hash="#",n.off("beforeunload.mfeditorwarning"),window.location.reload()},onSaveFailure:function(e){var t=e&&e.errors&&e.errors[0]&&e.errors[0].code;e.edit&&e.edit.captcha&&(t="captcha"),this.log({action:"saveFailure",message:t,type:{badtoken:"userBadToken",assertanonfailed:"userNewUser",assertuserfailed:"userNewUser",assertnameduserfailed:"userNewUser","abusefilter-disallowed":"extensionAbuseFilter","abusefilter-warning":"extensionAbuseFilter",captcha:"extensionCaptcha",spamblacklist:"extensionSpamBlacklist","titleblacklist-forbidden":"extensionTitleBlacklist",pagedeleted:"editPageDeleted",editconflict:"editConflict"}[t]||"responseUnknown"})},reportError:function(e){var t=new f({className:"errorbox",msg:e,heading:mw.msg("mobile-frontend-editor-error")});this.$errorNoticeContainer.html(t.$el)},hideErrorNotice:function(){this.$errorNoticeContainer.empty()},onStageChanges:function(){this.showHidden(".save-header, .save-panel"),this.hideErrorNotice(),this.log({action:"saveIntent"}),window.scrollTo(0,1)},onSaveBegin:function(){this.confirmAborted=!1,this.hideErrorNotice(),this.confirmSave()?this.log({action:"saveAttempt"}):this.confirmAborted=!0},preRender:function(){var e=this.options;this.options.headers=[o.formHeader(r.template('\n{{^hasToolbar}}\n<div class="overlay-title">\n\t<h2>{{{editingMsg}}}</h2>\n</div>\n{{/hasToolbar}}\n{{#hasToolbar}}<div class="toolbar"></div>{{/hasToolbar}}\n{{#editSwitcher}}\n\t<div class="switcher-container">\n\t</div>\n{{/editSwitcher}}\n\t\t\t\t').render({hasToolbar:e.hasToolbar,editSwitcher:e.editSwitcher,editingMsg:e.editingMsg}),e.readOnly?[]:[new u({tagName:"button",name:"next-invert",additionalClassNames:"continue",disabled:!0,title:e.continueMsg})],l.cancel(),"initial-header"),o.saveHeader(e.previewingMsg,"save-header hidden"),o.savingHeader(mw.msg("mobile-frontend-editor-wait"))]},postRender:function(){this.$errorNoticeContainer=this.$el.find("#error-notice-container"),i.prototype.postRender.apply(this),this.showHidden(".initial-header")},show:function(){var e=this;this.allowCloseWindow=mw.confirmCloseWindow({test:function(){return e.hasChanged()},message:mw.msg("mobile-frontend-editor-cancel-confirm"),namespace:"editwarning"}),this.saved=!1,i.prototype.show.call(this),mw.hook("mobileFrontend.editorOpened").fire(this.editor)},onClickBack:function(){},onClickSubmit:function(){this.onSaveBegin()},onClickContinue:function(){this.onStageChanges()},onClickAnonymous:function(){},onBeforeExit:function(e,t){var n=this;if(this.hasChanged()&&!this.switching)return this.windowManager||(this.windowManager=OO.ui.getWindowManager(),this.windowManager.addWindows([new mw.widgets.AbandonEditDialog])),this.windowManager.openWindow("abandonedit").closed.then((function(t){t&&"discard"===t.action&&(n.log({action:"abort",mechanism:"cancel",type:"abandon"}),n.allowCloseWindow&&n.allowCloseWindow.release(),mw.hook("mobileFrontend.editorClosed").fire(),e())})),void t();this.switching||this.saved||this.log({action:"abort",mechanism:"cancel",type:this.target&&this.target.edited?"abandon":"nochange"}),this.allowCloseWindow&&this.allowCloseWindow.release(),mw.hook("mobileFrontend.editorClosed").fire(),e()},createAnonWarning:function(e){var t=$("<div>").addClass("actions"),n=$("<div>").addClass("anonwarning content").append(new f({className:"warningbox anon-msg",msg:mw.msg("mobile-frontend-editor-anonwarning")}).$el,t),i=r.extend({returnto:e.returnTo||mw.config.get("wgPageName"),returntoquery:"action=edit&section="+e.sectionId,warning:"mobile-frontend-edit-login-action"},e.queryParams),s=r.extend({type:"signup",warning:"mobile-frontend-edit-signup-action"},e.signupQueryParams),o=[new c({label:mw.msg("mobile-frontend-editor-anon"),block:!0,additionalClassNames:"anonymous progressive",progressive:!0}),new c({block:!0,href:mw.util.getUrl("Special:UserLogin",i),label:mw.msg("mobile-frontend-watchlist-cta-button-login")}),new c({block:!0,href:mw.util.getUrl("Special:UserLogin",r.extend(i,s)),label:mw.msg("mobile-frontend-watchlist-cta-button-signup")})];return t.append(o.map((function(e){return e.$el}))),n},getOptionsForSwitch:function(){return{switched:!0,overlayManager:this.options.overlayManager,currentPageHTMLParser:this.options.currentPageHTMLParser,fakeScroll:this.options.fakeScroll,api:this.options.api,licenseMsg:this.options.licenseMsg,title:this.options.title,titleObj:this.options.titleObj,isAnon:this.options.isAnon,isNewPage:this.options.isNewPage,editCount:this.options.editCount,oldId:this.options.oldId,contentLang:this.options.contentLang,contentDir:this.options.contentDir,sessionId:this.options.sessionId,sectionId:this.options.sectionId}},hasChanged:function(){},getLoadingPromise:function(){return this.dataPromise.then((function(e){return e&&e.blockinfo?mw.loader.using("moment").then((function(){var t=s(e.blockinfo),n=p(t);return r.Deferred().reject(n)})):e}))},handleCaptcha:function(e){var t=this,n=this.$el.find(".captcha-word");this.captchaShown&&(n.val(""),n.attr("placeholder",this.options.captchaTryAgainMsg),setTimeout((function(){n.attr("placeholder",t.options.captchaMsg)}),2e3)),0===e.mime.indexOf("image/")?(this.$el.find(".captcha-panel#question").detach(),this.$el.find(".captcha-panel img").attr("src",e.url)):(this.$el.find(".captcha-panel #image").detach(),0===e.mime.indexOf("text/html")?this.$el.find(".captcha-panel #question").html(e.question):this.$el.find(".captcha-panel #question").text(e.question)),this.showHidden(".save-header, .captcha-panel"),this.captchaShown=!0}}),e.exports=b},"./src/mobile.editor.overlay/SourceEditorOverlay.js":function(e,t,n){var i=n("./src/mobile.editor.overlay/EditorOverlayBase.js"),r=n("./src/mobile.startup/util.js"),s=n("./src/mobile.startup/icons.js"),o=n("./src/mobile.startup/Section.js"),a=n("./src/mobile.editor.overlay/saveFailureMessage.js"),l=n("./src/mobile.editor.overlay/EditorGateway.js"),c=n("./src/mobile.init/fakeToolbar.js"),u=n("./src/mobile.startup/mfExtend.js"),d=n("./src/mobile.editor.overlay/setPreferredEditor.js"),h=n("./src/mobile.editor.overlay/VisualEditorOverlay.js");function p(e,t){this.isFirefox=/firefox/i.test(window.navigator.userAgent),this.visualEditorConfig=e.visualEditorConfig||mw.config.get("wgVisualEditorConfig")||{},this.gateway=new l({api:e.api,title:e.title,sectionId:e.sectionId,oldId:e.oldId,isNewPage:e.isNewPage,fromModified:!!t}),this.readOnly=!!e.oldId,this.dataPromise=t||this.gateway.getContent(),this.isVisualEditorEnabled()&&(e.editSwitcher=!0),this.readOnly?(e.readOnly=!0,e.editingMsg=mw.msg("mobile-frontend-editor-viewing-source-page",e.title)):e.editingMsg=mw.msg("mobile-frontend-editor-editing-page",e.title),e.previewingMsg=mw.msg("mobile-frontend-editor-previewing-page",e.title),i.call(this,r.extend(!0,{events:{"input .wikitext-editor":"onInputWikitextEditor"}},e))}u(p,i,{templatePartials:r.extend({},i.prototype.templatePartials,{content:r.template('\n<div lang="{{contentLang}}" dir="{{contentDir}}" class="editor-container content">\n\t<textarea class="wikitext-editor" id="wikitext-editor" cols="40" rows="10" placeholder="{{placeholder}}"></textarea>\n\t<div class="preview"></div>\n</div>\n\t\t')}),editor:"wikitext",sectionLine:"",show:function(){i.prototype.show.apply(this,arguments),this._resizeEditor()},isVisualEditorEnabled:function(){var e=this.visualEditorConfig.namespaces;return e&&e.indexOf(mw.config.get("wgNamespaceNumber"))>-1&&"translation"!==mw.config.get("wgTranslatePageTranslation")&&"wikitext"===mw.config.get("wgPageContentModel")},onInputWikitextEditor:function(){this.gateway.setContent(this.$el.find(".wikitext-editor").val()),this.$el.find(".continue, .submit").prop("disabled",!1)},onClickBack:function(){i.prototype.onClickBack.apply(this,arguments),this._hidePreview()},postRender:function(){var e=this,t=this.visualEditorConfig,n=this.options,r=n.isAnon&&!n.switched;this.log({action:"ready"}),this.log({action:"loaded"}),this.isVisualEditorEnabled()&&mw.loader.using("ext.visualEditor.switching").then((function(){var n,i,r,s=new OO.ui.ToolFactory,o=new OO.ui.ToolGroupFactory;s.register(mw.libs.ve.MWEditModeVisualTool),s.register(mw.libs.ve.MWEditModeSourceTool),(n=new OO.ui.Toolbar(s,o,{classes:["editor-switcher"]})).on("switchEditor",(function(n){var s=t.fullRestbaseUrl||t.allowLossySwitching;"visual"===n&&(e.gateway.hasChanged?s?e._switchToVisualEditor(e.gateway.content):(i=new OO.ui.WindowManager,r=new mw.libs.ve.SwitchConfirmDialog,i.$element.appendTo(document.body),i.addWindows([r]),i.openWindow(r,{mode:"simple"}).closed.then((function(t){t&&"discard"===t.action&&e._switchToVisualEditor(),i.destroy()}))):e._switchToVisualEditor())})),n.setup([{name:"editMode",type:"list",icon:"edit",title:mw.msg("visualeditor-mweditmode-tooltip"),include:["editModeVisual","editModeSource"]}]),e.$el.find(".switcher-container").html(n.$element),n.emit("updateState")})),i.prototype.postRender.apply(this),this.$el.find(".overlay-content").append(s.spinner().$el),this.hideSpinner(),this.$preview=this.$el.find(".preview"),this.$content=this.$el.find(".wikitext-editor"),this.$content.addClass("mw-editfont-"+mw.user.options.get("editfont")),r&&(this.$anonWarning=this.createAnonWarning(n),this.$el.find(".editor-container").append(this.$anonWarning),this.$content.hide(),this.$anonHiddenButtons=this.$el.find(".overlay-header .continue, .editor-switcher").hide()),this.$el.find(".license a").attr("target","_blank"),this.readOnly&&this.$content.prop("readonly",!0),this.$content.on("input",this._resizeEditor.bind(this)).one("input",(function(){e.log({action:"firstChange"})})),this.isFirefox&&this.$content.on("mousedown",(function(){var e=document.documentElement,t=e.scrollTop;function n(){e.scrollTop=t}window.addEventListener("scroll",n),setTimeout((function(){window.removeEventListener("scroll",n)}),1e3)})),r||this._loadContent()},onClickAnonymous:function(){this.$anonWarning.hide(),this.$anonHiddenButtons.show(),this._loadContent()},onStageChanges:function(){var e=this,t={text:this.getContent()};function n(){e.hideSpinner(),e.$preview.show()}this.scrollTop=r.getDocument().find("body").scrollTop(),this.$content.hide(),this.showSpinner(),mw.config.get("wgIsMainPage")&&(t.mainpage=1),this.gateway.getPreview(t).then((function(t){var i=t.text,r=t.line;e.sectionId=t.id,e.sectionLine=e.parseHTML("<div>").html(r).text(),new o({el:e.$preview,text:i}).$el.find("a").on("click",!1),n()}),(function(){e.$preview.addClass("errorbox").text(mw.msg("mobile-frontend-editor-error-preview")),n()})),i.prototype.onStageChanges.apply(this,arguments)},_hidePreview:function(){this.gateway.abortPreview(),this.hideSpinner(),this.$preview.removeClass("errorbox").hide(),this.$content.show(),window.scrollTo(0,this.scrollTop),this.showHidden(".initial-header")},_resizeEditor:function(){var e,t,n;this.$scrollContainer?n=this.$scrollContainer:(t=OO.ui.Element.static.getClosestScrollableContainer(this.$content[0]),n=this.$el.find(t).length?this.$el.find(t):r.getDocument(),this.$scrollContainer=n,this.$content.css("padding-bottom",.6*this.$scrollContainer.height())),this.$content.prop("scrollHeight")&&n.length&&(e=n.scrollTop(),this.$content.css("height","auto").css("height",this.$content.prop("scrollHeight")+2+"px"),n.scrollTop(e))},setContent:function(e){this.$content.show().val(e),this._resizeEditor()},getContent:function(){return this.$content.val()},_loadContent:function(){var e=this;this.$content.hide(),this.getLoadingPromise().then((function(t){var n=t.text;e.setContent(n),e.gateway.fromModified&&e.onInputWikitextEditor()}))},_switchToVisualEditor:function(e){var t=this;this.log({action:"abort",type:"switchnochange",mechanism:"navigate"}),this.logFeatureUse({feature:"editor-switch",action:"visual-mobile"}),d("VisualEditor"),this.$el.addClass("switching"),this.$el.find(".overlay-header-container").hide(),this.$el.append(c()),this.$content.prop("readonly",!0),mw.loader.using("ext.visualEditor.targetLoader").then((function(){return mw.libs.ve.targetLoader.addPlugin("mobile.editor.ve"),mw.libs.ve.targetLoader.loadModules("visual")})).then((function(){var n,i=t.getOptionsForSwitch();i.SourceEditorOverlay=p,e?i.dataPromise=mw.libs.ve.targetLoader.requestPageData("visual",mw.config.get("wgRelevantPageName"),{section:i.sectionId,oldId:i.oldId||mw.config.get("wgRevisionId"),targetName:"mobile",modified:!0,wikitext:e}):delete i.dataPromise,(n=new h(i)).getLoadingPromise().then((function(){t.switching=!0,t.overlayManager.replaceCurrent(n),t.switching=!1}))}),(function(){t.$el.removeClass("switching"),t.$el.find(".overlay-header-container").show(),t.$el.find(".ve-mobile-fakeToolbar-container").remove(),t.$content.prop("readonly",!1)}))},onSaveBegin:function(){var e=this,t={summary:this.$el.find(".summary").val()};""!==e.sectionLine&&(t.summary="/* "+e.sectionLine+" */"+t.summary),i.prototype.onSaveBegin.apply(this,arguments),this.confirmAborted||(this.captchaId&&(t.captchaId=this.captchaId,t.captchaWord=this.$el.find(".captcha-word").val()),this.showHidden(".saving-header"),this.gateway.save(t).then((function(t){var n=e.options.title;mw.config.get("wgIsMainPage")?window.location=mw.util.getUrl(n):e.onSaveComplete(t)}),(function(t){e.onSaveFailure(t)})))},onSaveFailure:function(e){var t;e.edit&&e.edit.captcha?(this.captchaId=e.edit.captcha.id,this.handleCaptcha(e.edit.captcha)):(t=a(e),this.reportError(t),this.showHidden(".save-header, .save-panel"),e.errors&&e.errors.some((function(e){return"abusefilter-disallowed"===e.code}))&&this.$el.find(".continue, .submit").prop("disabled",!0)),i.prototype.onSaveFailure.apply(this,arguments)},hasChanged:function(){return this.gateway.hasChanged}}),e.exports=p},"./src/mobile.editor.overlay/VisualEditorOverlay.js":function(e,t,n){var i=n("./src/mobile.editor.overlay/EditorOverlayBase.js"),r=n("./src/mobile.editor.overlay/EditorGateway.js"),s=n("./src/mobile.init/fakeToolbar.js"),o=n("./src/mobile.startup/mfExtend.js"),a=mw.loader.require("mediawiki.router"),l=n("./src/mobile.editor.overlay/identifyLeadParagraph.js"),c=n("./src/mobile.editor.overlay/setPreferredEditor.js"),u=n("./src/mobile.startup/util.js");function d(e){var t=u.Deferred();i.call(this,u.extend({editSwitcher:!1,hasToolbar:!0,onBeforeExit:this.onBeforeExit.bind(this),isBorderBox:!1,className:"overlay editor-overlay editor-overlay-ve"},e)),this.SourceEditorOverlay=e.SourceEditorOverlay,this.isNewPage=e.isNewPage,this.fromModified=e.dataPromise&&e.switched,this.gateway=new r({api:e.api,title:e.title,sectionId:e.sectionId,oldId:e.oldId,isNewPage:e.isNewPage}),this.origDataPromise=this.options.dataPromise||mw.libs.ve.targetLoader.requestPageData("visual",e.titleObj.getPrefixedDb(),{sessionStore:!0,section:e.sectionId||null,oldId:e.oldId||void 0,targetName:ve.init.mw.MobileArticleTarget.static.trackingName}),this.target=ve.init.mw.targetFactory.create("article",this,{$element:this.$el,section:this.options.sectionId||null}),this.target.once("surfaceReady",function(){t.resolve(),this.target.getSurface().getModel().getDocument().once("transact",function(){this.log({action:"firstChange"})}.bind(this))}.bind(this)),this.target.load(this.origDataPromise),this.dataPromise=this.origDataPromise.then((function(e){return t.then((function(){return e&&e.visualeditor}))}))}o(d,i,{templatePartials:u.extend({},i.prototype.templatePartials,{editHeader:u.template('\n<div class="overlay-header header initial-header hideable hidden">\n\t<div class="toolbar"></div>\n</div>\n\t\t'),content:u.template('\n<div class="surface" lang="{{contentLang}}" dir="{{contentDir}}">\n</div>\n\t\t')}),editor:"visualeditor",destroyTarget:function(){this.target&&(this.target.destroy(),this.target=null)},show:function(){var e=this.options,t=e.isAnon&&!e.switched;i.prototype.show.apply(this,arguments),this.log({action:"ready"}),this.log({action:"loaded"}),t?(this.$anonWarning=this.createAnonWarning(this.options),this.$el.append(this.$anonWarning),this.$el.find(".overlay-content").hide()):this.redoTargetInit(),this.emit("editor-loaded")},redoTargetInit:function(){this.target&&(this.target.adjustContentPadding(),this.target.restoreEditSection(),this.scrollToLeadParagraph())},scrollToLeadParagraph:function(){var e,t,n,i,r,s=this.options.currentPageHTMLParser,o=this.options.fakeScroll,a=$(window),c=this.target.section,u=this.target.getSurface(),d=u.getMode();null!==c&&"0"!==c||"visual"!==d||(e=l(u.getView().$attachedRootNode),s.getLeadSectionElement()&&(n=l(s.getLeadSectionElement())),e&&n&&(i=$(e).offset().top-($(n).offset().top-o),(t=$(e).data("view"))&&(u.getModel().setLinearSelection(new ve.Range(t.getModel().getRange().start)),r=u.getView().getSelection().getSelectionBoundingRect().top,u.$element.css("min-height",a.height()+r-u.padding.top)),a.scrollTop(i)))},onBeforeExit:function(e,t){var n=this;i.prototype.onBeforeExit.call(this,(function(){e(),n.destroyTarget()}),t)},onClickBack:function(){i.prototype.onClickBack.apply(this,arguments),this.switchToEditor()},onClickAnonymous:function(){this.$anonWarning.hide(),this.$el.find(".overlay-content").show(),this.redoTargetInit()},switchToEditor:function(){this.showHidden(".initial-header")},switchToSourceEditor:function(e){var t,n=this,i=this.SourceEditorOverlay,r=this.getOptionsForSwitch();this.log({action:"abort",type:"switchnochange",mechanism:"navigate"}),this.logFeatureUse({feature:"editor-switch",action:"source-mobile"}),c("SourceEditor"),this.$el.addClass("switching"),this.$el.find(".overlay-header-container").hide(),this.$el.append(s()),this.target.getSurface().setReadOnly(!0),e&&(r.sectionId=null,a.navigateTo(document.title,{path:"#/editor/all",useReplaceState:!0})),(t=new i(r,e)).getLoadingPromise().then((function(){n.switching=!0,n.overlayManager.replaceCurrent(t),n.switching=!1}))},onSaveComplete:function(){i.prototype.onSaveComplete.apply(this,arguments),this.destroyTarget()},hasChanged:function(){return!this.saved&&(this.fromModified||this.target&&this.target.getSurface()&&this.target.getSurface().getModel().hasBeenModified())}}),e.exports=d},"./src/mobile.editor.overlay/blockMessageDrawer.js":function(e,t,n){var i=n("./src/mobile.startup/Drawer.js"),r=n("./src/mobile.editor.overlay/BlockMessageDetails.js");e.exports=function(e){var t=new i({className:"drawer block-message",onBeforeHide:function(e){e.$el.remove()},onShow:function(){var e=t.$el.find(".drawer.block-message"),n=e.offset().top-100,i=t.$el.find(".block-message-creator").offset().top-100,r=t.$el.find(".block-message-buttons").offset().top-100,s=t.$el.find(".block-message-see-more"),o=mw.config.get("wgDBname");e.css("top",n+(r-i)),s.on("click",(function(){var n=t.$el.find(".block-message-container");e.css("top",0),n.css("overflow-y","auto"),n.css("height",r-n.offset().top),s.hide(),mw.config.get("wgMFTrackBlockNotices")&&mw.track("counter.MediaWiki.BlockNotices."+o+".MobileFrontend.reasonShown",1)})),mw.config.get("wgMFTrackBlockNotices")&&mw.track("counter.MediaWiki.BlockNotices."+o+".MobileFrontend.shown",1)},children:[new r(e).$el]});return t}},"./src/mobile.editor.overlay/identifyLeadParagraph.js":function(e,t){e.exports=function(e){var t,n,i;function r(e){return e=e.cloneNode(!0),$(e).find(".ve-ce-branchNode-inlineSlug, .ve-ce-focusableNode-invisible, style, span#coordinates").remove(),!function(e){return!/^[\s↵➞]*$/.test(e.textContent)}(e)}for(t=e.children("p"),n=0;n<t.length;n++)if(!r(i=t[n]))return i;return null}},"./src/mobile.editor.overlay/parseBlockInfo.js":function(e,t,n){var i=n("./src/mobile.startup/util.js");e.exports=function(e){var t={partial:e.blockpartial||!1,noCreateAccount:e.blocknocreate||!1,anonOnly:void 0===e.blockanononly||e.blockanononly,creator:{name:e.blockedby,url:null},expiry:null,duration:null,reason:"",blockId:e.blockid},n=e.blockexpiry,r=e.blockreason,s=window.moment;function o(e){var t=new mw.jqueryMsg.parser;try{var n=t.wikiTextToAst(e);return t.emitter.emit(n).html()}catch(e){return!1}}return 0===e.blockedbyid?t.creator.url="":t.creator.url=mw.Title.makeTitle(mw.config.get("wgNamespaceIds").user,t.creator.name).getUrl(),-1===["infinite","indefinite","infinity","never"].indexOf(n)&&s&&(s(n).diff(s(),"seconds")<=86400?t.expiry=mw.message("parentheses",s(n).format("LL, LT")).escaped():t.expiry=mw.message("parentheses",s(n).format("LL")).escaped(),t.duration=s().to(n,!0)),r?(t.reason=o(r)||mw.html.escape(r),t.parsedReason=(new mw.Api).get({action:"parse",formatversion:2,text:r,contentmodel:"wikitext"}).then((function(e){return e.parse.text})).catch((function(){return o(r)||mw.html.escape(r)}))):(t.reason=mw.message("mobile-frontend-editor-generic-block-reason").escaped(),t.parsedReason=i.Deferred().resolve(t.reason).promise()),t}},"./src/mobile.editor.overlay/saveFailureMessage.js":function(e,t){e.exports=function(e){var t=e&&e.errors&&e.errors[0]&&e.errors[0].code;return"editconflict"===t?mw.msg("mobile-frontend-editor-error-conflict"):"readonly"===t?e.errors[0].html+"<br>"+e.errors[0].data.readonlyreason:e.errors&&e.errors[0]?e.errors[0].html:""}},"./src/mobile.editor.overlay/setPreferredEditor.js":function(e,t){e.exports=function(e){mw.user.isAnon()?mw.storage.set("preferredEditor",e):(new mw.Api).saveOption("mobile-editor",e).then((function(){mw.user.options.set("mobile-editor",e)}))}},"./src/mobile.init/editorLoadingOverlay.js":function(e,t,n){var i=n("./src/mobile.init/fakeToolbar.js"),r=n("./src/mobile.startup/Overlay.js");e.exports=function(e,t){var n=i(),s=new r({className:"overlay overlay-loading",noHeader:!0,isBorderBox:!1,onBeforeExit:function(e){e(),t()}});return s.show=function(){r.prototype.show.call(this),e()},n.appendTo(s.$el.find(".overlay-content")),n.addClass("toolbar-hidden"),setTimeout((function(){n.addClass("toolbar-shown"),setTimeout((function(){n.addClass("toolbar-shown-done")}),250)})),s}},"./src/mobile.init/fakeToolbar.js":function(e,t,n){var i=n("./src/mobile.startup/icons.js");e.exports=function(){var e,t;return e=i.cancel(null,{tagName:"a"}).$el.attr("tabindex","0").attr("role","button"),t=i.spinner({tagName:"span",hasText:!0,additionalClassNames:"",label:mw.msg("mobile-frontend-editor-loading")}).$el,$("<div>").addClass("ve-mobile-fakeToolbar-container").append($("<div>").addClass("ve-mobile-fakeToolbar-header").addClass("header").append($("<div>").addClass("ve-mobile-fakeToolbar").append(e,t)))}},"./src/mobile.languages.structured/LanguageSearcher.js":function(e,t,n){var i=n("./src/mobile.startup/View.js"),r=n("./src/mobile.startup/util.js"),s=n("./src/mobile.languages.structured/util.js");function o(e){var t=s.getStructuredLanguages(e.languages,e.variants,s.getFrequentlyUsedLanguages(),e.showSuggestedLanguages,e.deviceLanguage);i.call(this,r.extend({className:"language-searcher",events:{"click a":"onLinkClick","input .search":"onSearchInput"},inputPlaceholder:mw.msg("mobile-frontend-languages-structured-overlay-search-input-placeholder"),allLanguagesHeader:mw.msg("mobile-frontend-languages-structured-overlay-all-languages-header").toLocaleUpperCase(),suggestedLanguagesHeader:mw.msg("mobile-frontend-languages-structured-overlay-suggested-languages-header").toLocaleUpperCase(),allLanguages:t.all,allLanguagesCount:t.all.length,suggestedLanguages:t.suggested,suggestedLanguagesCount:t.suggested.length},e))}n("./src/mobile.startup/mfExtend.js")(o,i,{template:r.template('\n<div class="panel">\n\t<div class="panel-body search-box">\n\t\t<input type="search" class="search" placeholder="{{inputPlaceholder}}">\n\t</div>\n</div>\n\n<div class="overlay-content-body">\n\t{{#suggestedLanguagesCount}}\n\t<h3 class="list-header">{{suggestedLanguagesHeader}}</h3>\n\t<ol class="site-link-list suggested-languages">\n\t\t{{#suggestedLanguages}}\n\t\t\t<li>\n\t\t\t\t<a href="{{url}}" class="{{lang}}" hreflang="{{lang}}" lang="{{lang}}" dir="{{dir}}">\n\t\t\t\t\t<span class="autonym">{{autonym}}</span>\n\t\t\t\t\t{{#title}}\n\t\t\t\t\t\t<span class="title">{{title}}</span>\n\t\t\t\t\t{{/title}}\n\t\t\t\t</a>\n\t\t\t</li>\n\t\t{{/suggestedLanguages}}\n\t</ol>\n\t{{/suggestedLanguagesCount}}\n\n\t{{#allLanguagesCount}}\n\t<h3 class="list-header">{{allLanguagesHeader}} ({{allLanguagesCount}})</h3>\n\t<ul class="site-link-list all-languages">\n\t\t{{#allLanguages}}\n\t\t\t<li>\n\t\t\t\t<a href="{{url}}" class="{{lang}}" hreflang="{{lang}}" lang="{{lang}}" dir="{{dir}}">\n\t\t\t\t\t<span class="autonym">{{autonym}}</span>\n\t\t\t\t\t{{#title}}\n\t\t\t\t\t\t<span class="title">{{title}}</span>\n\t\t\t\t\t{{/title}}\n\t\t\t\t</a>\n\t\t\t</li>\n\t\t{{/allLanguages}}\n\t</ul>\n\t{{/allLanguagesCount}}\n</div>\n\t'),postRender:function(){this.$siteLinksList=this.$el.find(".site-link-list"),this.$languageItems=this.$siteLinksList.find("a"),this.$subheaders=this.$el.find("h3")},onLinkClick:function(e){var t=this.$el.find(e.currentTarget).attr("lang");mw.hook("mobileFrontend.languageSearcher.linkClick").fire(t),s.saveLanguageUsageCount(t,s.getFrequentlyUsedLanguages())},onSearchInput:function(e){this.filterLanguages(this.$el.find(e.target).val().toLowerCase())},filterLanguages:function(e){var t=[];e?(this.options.languages.forEach((function(n){var i=n.langname;(n.autonym.toLowerCase().indexOf(e)>-1||i&&i.toLowerCase().indexOf(e)>-1||n.lang.toLowerCase().indexOf(e)>-1)&&t.push(n.lang)})),this.options.variants&&this.options.variants.forEach((function(n){(n.autonym.toLowerCase().indexOf(e)>-1||n.lang.toLowerCase().indexOf(e)>-1)&&t.push(n.lang)})),this.$languageItems.addClass("hidden"),t.length&&this.$siteLinksList.find("."+t.join(",.")).removeClass("hidden"),this.$siteLinksList.addClass("filtered"),this.$subheaders.addClass("hidden")):(this.$languageItems.removeClass("hidden"),this.$siteLinksList.removeClass("filtered"),this.$subheaders.removeClass("hidden"))}}),e.exports=o},"./src/mobile.languages.structured/rtlLanguages.js":function(e,t){e.exports=["aeb","aeb-arab","ar","arc","arq","arz","azb","bcc","bgn","bqi","ckb","dv","fa","glk","he","khw","kk-arab","kk-cn","ks","ks-arab","ku-arab","lki","lrc","luz","mzn","nqo","pnb","ps","sd","sdh","skr","skr-arab","ug","ug-arab","ur","yi"]},"./src/mobile.languages.structured/util.js":function(e,t,n){var i=mw.log,r=n("./src/mobile.startup/util.js"),s=n("./src/mobile.languages.structured/rtlLanguages.js");e.exports={getDir:function(e){var t=s.indexOf(e.lang)>-1?"rtl":"ltr";return r.extend({},e,{dir:t})},getStructuredLanguages:function(e,t,n,r,s){var o=Object.prototype.hasOwnProperty,a=0,l=0,c=0,u=[],d=[],h=this;function p(e){return e.dir?e:(c++,h.getDir(e))}return(s=function(e,t){var n,i,r=Object.prototype.hasOwnProperty,s={};if(t)return-1!==(i=t.indexOf("-"))&&(n=t.slice(0,i)),e.forEach((function(e){e.lang!==n&&e.lang!==t||(s[e.lang]=!0)})),r.call(s,t)?t:r.call(s,n)?n:void 0}(e,s))&&(Object.keys(n).forEach((function(e){var t=n[e];a=a<t?t:a,l=l>t?t:l})),n[s]=a+1),r?e.map(p).forEach((function(e){o.call(n,e.lang)?(e.frequency=n[e.lang],u.push(e)):d.push(e)})):d=e.map(p),t&&r&&t.map(p).forEach((function(e){o.call(n,e.lang)?e.frequency=n[e.lang]:e.frequency=l-1,u.push(e)})),u=u.sort((function(e,t){return t.frequency-e.frequency})),d=d.sort((function(e,t){return e.autonym.toLocaleLowerCase()<t.autonym.toLocaleLowerCase()?-1:1})),i.warn(0===c?"Direction is provided. Please remove handling in getStructuredLanguages":"`dir` attribute was missing from languages. Is T74153 resolved?"),{suggested:u,all:d}},getFrequentlyUsedLanguages:function(){var e=mw.storage.get("langMap");return e?JSON.parse(e):{}},saveFrequentlyUsedLanguages:function(e){mw.storage.set("langMap",JSON.stringify(e))},saveLanguageUsageCount:function(e,t){var n=t[e]||0;n+=1,t[e]=n>100?100:n,this.saveFrequentlyUsedLanguages(t)}}},"./src/mobile.mediaViewer/ImageCarousel.js":function(e,t,n){var i=n("./src/mobile.startup/View.js"),r=n("./src/mobile.startup/util.js"),s=n("./src/mobile.startup/mfExtend.js"),o=n("./src/mobile.startup/Icon.js"),a=n("./src/mobile.startup/icons.js"),l=new(n("./src/mobile.startup/Button.js"))({label:mw.msg("mobile-frontend-media-details"),additionalClassNames:"button",progressive:!0}),c=new o({rotation:90,name:"expand-invert"}),u=new o({rotation:-90,name:"expand-invert"}),d=n("./src/mobile.mediaViewer/LoadErrorMessage.js"),h=n("./src/mobile.mediaViewer/ImageGateway.js"),p=mw.loader.require("mediawiki.router");function f(e){this.gateway=e.gateway||new h({api:e.api}),this.router=e.router||p,this.eventBus=e.eventBus,this.hasLoadError=!1,i.call(this,r.extend({className:"image-carousel",events:{"click .image-wrapper":"onToggleDetails","click .slider-button":"onSlide"}},e))}s(f,i,{template:r.template('\n<button class="prev slider-button"></button>\n<div class="main">\n\t<div class="image-wrapper">\n\t\t<div class="image"></div>\n\t</div>\n\t\x3c!-- cancel button will go here --\x3e\n\t<div class="image-details">\n\t\t\x3c!-- details button will go here --\x3e\n\t\t<p class="truncated-text">{{caption}}</p>\n\t\t<p class="license"><a href="#">{{licenseLinkMsg}}</a></p>\n\t</div>\n</div>\n<button class="next slider-button"></button>\n\t'),defaults:r.extend({},i.prototype.defaults,{licenseLinkMsg:mw.msg("mobile-frontend-media-license-link"),thumbnails:[]}),onSlide:function(e){var t,n=this.$el.find(e.target).closest(".slider-button").data("thumbnail"),i=n.options.filename;this.router.navigateTo(null,{path:"#/media/"+i,useReplaceState:!0}),this.options.title=n.options.filename,t=new f(this.options),this.$el.replaceWith(t.$el),this.$el=t.$el},preRender:function(){var e=this;this.options.thumbnails.forEach((function(t,n){t.getFileName()===e.options.title&&(e.options.caption=t.getDescription(),e.galleryOffset=n)}))},_enableArrowImages:function(e){var t,n,i=this.galleryOffset;void 0===this.galleryOffset?(t=e[e.length-1],n=e[0]):(t=e[0===i?e.length-1:i-1],n=e[i===e.length-1?0:i+1]),this.$el.find(".prev").data("thumbnail",t),this.$el.find(".next").data("thumbnail",n)},_disableArrowImages:function(){this.$el.find(".prev, .next").remove()},_handleRetry:function(){this.router.emit("hashchange")},postRender:function(){var e,t=this.$el,n=a.spinner().$el,i=this.options.thumbnails||[],r=this;function s(){r.hasLoadError=!0,n.hide(),t.find(".image img").hide(),0===t.find(".load-fail-msg").length&&new d({retryPath:r.router.getPath()}).on("retry",r._handleRetry.bind(r)).prependTo(t.find(".image"))}function o(){e.addClass("image-loaded")}i.length<2?this._disableArrowImages():this._enableArrowImages(i),this.$details=t.find(".image-details"),t.find(".image").append(n),this.$details.prepend(l.$el),this.gateway.getThumb(r.options.title).then((function(i){var a,l=i.descriptionurl+"#mw-jump-to-license";n.hide(),r.thumbWidth=i.thumbwidth,r.thumbHeight=i.thumbheight,r.imgRatio=i.thumbwidth/i.thumbheight,(e=r.parseHTML("<img>",document)).on("load",o).on("error",s),e.attr("src",i.thumburl).attr("alt",r.options.caption),t.find(".image").append(e),r.$details.addClass("is-visible"),r._positionImage(),t.find(".image-details a").attr("href",l),i.extmetadata&&(i.extmetadata.LicenseShortName&&t.find(".license a").text(i.extmetadata.LicenseShortName.value).attr("href",l),i.extmetadata.Artist&&(a=i.extmetadata.Artist.value.replace(/<.*?>/g,""),t.find(".license").prepend(a+" &bull; "))),r.adjustDetails()}),(function(){s()})),this.eventBus.on("resize:throttled",this._positionImage.bind(this)),this._positionImage()},onToggleDetails:function(){this.hasLoadError||(this.$el.find(".cancel, .slider-button").toggle(),this.$details.toggle(),this._positionImage())},_positionImage:function(){var e,t,n,i,s,o=r.getWindow();this.adjustDetails(),e=this.$details.is(":visible")?this.$details.outerHeight():0,i=(t=o.width())/(n=o.height()-e),s=this.$el.find("img"),this.imgRatio>i?t<this.thumbWidth&&s.css({width:t,height:"auto"}):n<this.thumbHeight&&s.css({width:"auto",height:n}),this.$el.find(".image-wrapper").css("bottom",e),this.$el.find(".slider-button.prev").append(c.$el),this.$el.find(".slider-button.next").append(u.$el)},adjustDetails:function(){var e=r.getWindow().height();this.$el.find(".image-details").height()>.5*e&&this.$el.find(".image-details").css("max-height",.5*e)}}),e.exports=f},"./src/mobile.mediaViewer/ImageGateway.js":function(e,t,n){var i=[320,640,800,1024,1280,1920,2560,2880],r=n("./src/mobile.startup/actionParams.js"),s=n("./src/mobile.startup/util.js");function o(e){for(var t=0;e>i[t]&&t<i.length-1;)++t;return i[t]}function a(e){this._cache={},this.api=e.api}a.prototype.getThumb=function(e){var t=this._cache[e],n=s.getWindow(),i=window.devicePixelRatio&&window.devicePixelRatio>1?window.devicePixelRatio:1;return t||(this._cache[e]=this.api.get(r({prop:"imageinfo",titles:e,iiprop:["url","extmetadata"],iiurlwidth:o(n.width()*i),iiurlheight:o(n.height()*i)})).then((function(e){if(e.query&&e.query.pages&&e.query.pages[0]&&e.query.pages[0].imageinfo)return e.query.pages[0].imageinfo[0];throw new Error("The API failed to return any pages matching the titles.")}))),this._cache[e]},a._findSizeBucket=o,e.exports=a},"./src/mobile.mediaViewer/LoadErrorMessage.js":function(e,t,n){var i=n("./src/mobile.startup/util.js"),r=n("./src/mobile.startup/mfExtend.js"),s=n("./src/mobile.startup/icons.js"),o=n("./src/mobile.startup/View.js");function a(e){o.call(this,{events:{"click .load-fail-msg-link a":"onRetry"}},e)}r(a,o,{template:i.template('\n<div class="load-fail-msg">\n  <div class="load-fail-msg-text">{{msgToUser}}</div>\n  <div class="load-fail-msg-link">\n    <a href="#">{{retryTxt}}</a>\n  </div>\n</div>\n\t'),isTemplateMode:!0,defaults:i.extend({},a.prototype.defaults,{msgToUser:mw.msg("mobile-frontend-media-load-fail-message"),retryTxt:mw.msg("mobile-frontend-media-load-fail-retry")}),postRender:function(){this.$el.prepend(s.error().$el),this.$el.find(".load-fail-msg-link a").attr("href","#"+this.options.retryPath)},onRetry:function(){return this.emit("retry"),!1}}),e.exports=a},"./src/mobile.special.nearby.scripts/NearbyGateway.js":function(e,t,n){var i=n("./src/mobile.startup/page/pageJSONParser.js"),r=mw.config.get("wgContentNamespaces"),s=n("./src/mobile.startup/util.js"),o=n("./src/mobile.startup/extendSearchParams.js");function a(e){this.api=e.api}a.prototype={_distanceMessage:function(e){if(e<1){if(e*=100,1e3!==(e=10*Math.ceil(e)))return mw.msg("mobile-frontend-nearby-distance-meters",mw.language.convertNumber(e));e=1}else e>2?(e*=10,e=(e=Math.ceil(e)/10).toFixed(1)):(e*=100,e=(e=Math.ceil(e)/100).toFixed(2));return mw.msg("mobile-frontend-nearby-distance",mw.language.convertNumber(e))},getPages:function(e,t,n){return this._search({ggscoord:[e.latitude,e.longitude]},t,n)},getPagesAroundPage:function(e,t){return this._search({ggspage:e},t,e)},_search:function(e,t,n){var a,l=s.Deferred(),c=this;return a=o("nearby",{colimit:"max",prop:["coordinates"],generator:"geosearch",ggsradius:t,ggsnamespace:r,ggslimit:50},e),e.ggscoord?a.codistancefrompoint=e.ggscoord:e.ggspage&&(a.codistancefrompage=e.ggspage),this.api.ajax(a).then((function(e){var t;(t=(t=e.query&&e.query.pages||[]).map((function(e,t){var r,s;return(s=i.parse(e)).anchor="item_"+t,e.coordinates?(r=e.coordinates[0],s.dist=r.dist/1e3,s.latitude=r.lat,s.longitude=r.lon,s.proximity=c._distanceMessage(s.dist)):s.dist=0,n!==e.title?s:null})).filter((function(e){return!!e}))).sort((function(e,t){return e.dist>t.dist?1:-1})),0===t.length?l.reject("empty"):l.resolve(t)}),(function(e){l.reject(e)})),l}},e.exports=a},"./src/mobile.special.watchlist.scripts/WatchList.js":function(e,t,n){var i=n("./src/mobile.startup/mfExtend.js"),r=n("./src/mobile.startup/PageList.js"),s=n("./src/mobile.startup/watchstar/WatchstarPageList.js"),o=n("./src/mobile.startup/ScrollEndEventEmitter.js"),a=n("./src/mobile.startup/util.js"),l=n("./src/mobile.special.watchlist.scripts/WatchListGateway.js");function c(e){var t,n=a.extend({},{isBorderBox:!1},e);this.scrollEndEventEmitter=new o(n.eventBus),this.scrollEndEventEmitter.on(o.EVENT_SCROLL_END,this._loadPages.bind(this)),n.el&&(t=this.getLastTitle(n.el)),this.gateway=new l(n.api,t),s.call(this,n)}i(c,s,{preRender:function(){this.scrollEndEventEmitter.disable(),this.scrollEndEventEmitter.setElement(this.$el)},postRender:function(){var e,t;r.prototype.postRender.apply(this),e=this.queryUnitializedItems(),t=Object.keys(this.parsePagesFromItems(e)).reduce((function(e,t){return e[t]=!0,e}),{}),this.renderItems(e,t),this.scrollEndEventEmitter.enable()},_loadPages:function(){this.gateway.loadWatchlist().then(function(e){e.forEach(function(e){this.appendPage(e)}.bind(this)),this.render()}.bind(this))},appendPage:function(e){var t=a.extend({},e,{wikidataDescription:void 0});this.$el.append(this.templatePartials.item.render(t))},getLastTitle:function(e){return e.find("li").last().attr("title")}}),e.exports=c},"./src/mobile.special.watchlist.scripts/WatchListGateway.js":function(e,t,n){var i=n("./src/mobile.startup/page/pageJSONParser.js"),r=n("./src/mobile.startup/util.js"),s=n("./src/mobile.startup/extendSearchParams.js");function o(e,t){this.api=e,this.limit=50,t?(this.continueParams={continue:"gwrcontinue||",gwrcontinue:"0|"+t.replace(/ /g,"_")},this.shouldSkipFirstTitle=!0):(this.continueParams={continue:""},this.shouldSkipFirstTitle=!1),this.canContinue=!0}o.prototype={loadWatchlist:function(){var e=this,t=s("watchlist",{prop:["info","revisions"],rvprop:"timestamp|user",generator:"watchlistraw",gwrnamespace:"0",gwrlimit:this.limit},this.continueParams);return!1===this.canContinue?r.Deferred().resolve([]):this.api.get(t,{url:this.apiUrl}).then((function(t){return void 0!==t.continue?e.continueParams=t.continue:e.canContinue=!1,e.parseData(t)}))},parseData:function(e){var t;return e.query&&e.query.pages?((t=e.query.pages).sort((function(e,t){return e.title===t.title?0:e.title<t.title?-1:1})),this.shouldSkipFirstTitle&&(t=t.slice(1),this.shouldSkipFirstTitle=!1),t.map(i.parse)):[]}},e.exports=o},"./src/mobile.startup/Anchor.js":function(e,t,n){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=c(e);if(t){var r=c(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l(this,n)}}function l(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var u=n("./src/mobile.startup/View.js"),d=n("./src/mobile.startup/util.js"),h=function(e){"use strict";!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(c,e);var t,n,i,l=a(c);function c(){return r(this,c),l.apply(this,arguments)}return t=c,(n=[{key:"isTemplateMode",get:function(){return!0}},{key:"defaults",get:function(){return{progressive:void 0,destructive:void 0,additionalClassNames:"",href:void 0,label:void 0}}},{key:"template",get:function(){return d.template('\n<a {{#href}}href="{{href}}"{{/href}} class="mw-ui-anchor\n\t{{#progressive}} mw-ui-progressive{{/progressive}}\n\t{{#destructive}} mw-ui-destructive{{/destructive}}\n\t {{additionalClassNames}}">{{label}}</a>\n\t')}}])&&s(t.prototype,n),i&&s(t,i),c}(u);e.exports=h},"./src/mobile.startup/Browser.js":function(e,t,n){var i,r=n("./src/mobile.startup/util.js");function s(e){var t=function t(){var n=this["__cache"+t.cacheId]||(this["__cache"+t.cacheId]={}),i=[].join.call(arguments,"|");return Object.prototype.hasOwnProperty.call(n,i)?n[i]:n[i]=e.apply(this,arguments)};return t.cacheId=Date.now().toString()+Math.random().toString(),t}function o(e,t){this.userAgent=e,this.$el=t}o.prototype={isIos:s((function(e){var t=this.userAgent,n=/ipad|iphone|ipod/i.test(t);if(!n||!e)return n;switch(e){case 8:return/OS 8_/.test(t)||/Version\/8/.test(t);case 4:return/OS 4_/.test(t);case 5:return/OS 5_/.test(t);default:return!1}})),isWideScreen:s((function(){var e=parseInt(mw.config.get("wgMFDeviceWidthTablet"),10);return window.innerWidth>=e})),supportsTouchEvents:s((function(){return"ontouchstart"in window})),supportsGeoLocation:s((function(){return"geolocation"in window.navigator}))},o.getSingleton=function(){var e;return i||(e=r.getDocument(),i=new o(window.navigator.userAgent,e)),i},e.exports=o},"./src/mobile.startup/Button.js":function(e,t,n){var i=n("./src/mobile.startup/mfExtend.js"),r=n("./src/mobile.startup/util.js"),s=n("./src/mobile.startup/View.js");function o(e){e.href&&(e.tagName="a"),s.call(this,e)}i(o,s,{isTemplateMode:!0,defaults:{tagName:"a",disabled:!1,block:void 0,progressive:void 0,destructive:void 0,quiet:void 0,additionalClassNames:"",href:void 0,label:void 0},template:r.template('<{{tagName}} {{#disabled}}disabled{{/disabled}}\n{{#href}}href="{{href}}"{{/href}}\nclass="mw-ui-button {{#progressive}}mw-ui-progressive{{/progressive}}\n\t{{#block}}mw-ui-block{{/block}}\n\t{{#quiet}}mw-ui-quiet{{/quiet}}\n\t{{#destructive}}mw-ui-destructive{{/destructive}} {{additionalClassNames}}\n">{{label}}</{{tagName}}>')}),e.exports=o},"./src/mobile.startup/CtaDrawer.js":function(e,t,n){var i=n("./src/mobile.startup/Drawer.js"),r=n("./src/mobile.startup/util.js"),s=n("./src/mobile.startup/Button.js"),o=n("./src/mobile.startup/Anchor.js");function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=l(e.queryParams,e.returnTo);return new i(r.extend({children:[r.parseHTML("<p>").text(e.content),new s(r.extend({progressive:!0,href:mw.util.getUrl("Special:UserLogin",t),label:mw.msg("mobile-frontend-watchlist-cta-button-login")},e.progressiveButton)).$el,r.parseHTML("<div>").addClass("cta-drawer__anchors").append(new o(r.extend({href:mw.util.getUrl("Special:UserLogin",c(t,e.signupQueryParams)),progressive:!0,label:mw.msg("mobile-frontend-watchlist-cta-button-signup")},e.actionAnchor)).$el)]},e))}function l(e,t){return r.extend({returnto:t||mw.config.get("wgPageName")},e)}function c(){return[].push.call(arguments,{type:"signup"}),r.extend.apply(r,arguments)}a.prototype.test={redirectParams:l,signUpParams:c},e.exports=a},"./src/mobile.startup/Drawer.js":function(e,t,n){var i=n("./src/mobile.startup/mfExtend.js"),r=n("./src/mobile.startup/View.js"),s=n("./src/mobile.startup/util.js"),o=n("./src/mobile.startup/Icon.js");function a(e){this.drawerClassName=e.className||"",this.collapseIcon=new o({name:"expand",additionalClassNames:"cancel"}),r.call(this,s.extend({onBeforeHide:function(){},showCollapseIcon:!0},e,{className:"drawer-container"},{events:s.extend({"click .drawer-container__mask":function(){this.hide()}.bind(this),"click .cancel":function(e){e.preventDefault(),this.hide()}.bind(this),click:function(e){e.stopPropagation()}},e.events)}))}i(a,r,{minHideDelay:100,show:function(){var e=s.Deferred();return this.$el.find(".drawer-container__mask").addClass("drawer-container__mask--visible"),this.$el.find(".drawer").hasClass("visible")?e.resolve():setTimeout(function(){this.$el.find(".drawer").addClass("visible"),this.options.onShow&&this.options.onShow(e),setTimeout((function(){e.resolve()}),this.minHideDelay)}.bind(this),this.minHideDelay),e.promise()},hide:function(){this.$el.find(".drawer-container__mask").removeClass("drawer-container__mask--visible"),this.$el.find(".drawer").removeClass("visible"),setTimeout(function(){this.$el.find(".drawer").removeClass("visible"),this.options.onBeforeHide(this)}.bind(this),this.minHideDelay)},postRender:function(){var e=this.options,t=s.parseHTML("<div>").addClass("drawer-container__mask"),n=s.parseHTML("<div>").addClass("drawer drawer-container__drawer position-fixed ".concat(this.drawerClassName).trim());e.showCollapseIcon&&n.prepend(this.collapseIcon.$el),e.children&&n.append(e.children),this.$el.append(t),this.$el.append(n)}}),e.exports=a},"./src/mobile.startup/Icon.js":function(e,t,n){var i=n("./src/mobile.startup/mfExtend.js"),r=n("./src/mobile.startup/util.js"),s=n("./src/mobile.startup/View.js");function o(e){e.hasText&&(e.modifier="mw-ui-icon-before ".concat(e.modifier||"")),e.href&&(e.tagName="a"),"button"===e.tagName&&(e.isTypeButton=!0),s.call(this,e)}i(o,s,{preRender:function(){this.setRotationClass()},setRotationClass:function(){var e=this.options;if(e.rotation)switch(e.rotation){case-180:case 180:e._rotationClass="mf-mw-ui-icon-rotate-flip";break;case-90:e._rotationClass="mf-mw-ui-icon-rotate-anti-clockwise";break;case 90:e._rotationClass="mf-mw-ui-icon-rotate-clockwise";break;case 0:break;default:throw new Error("Bad value for rotation given. Must be ±90, 0 or ±180.")}},isTemplateMode:!0,defaults:{rotation:0,hasText:!1,href:void 0,glyphPrefix:"mf",tagName:"div",disabled:!1,isSmall:!1,base:"mw-ui-icon",name:"",modifier:"mw-ui-icon-element",title:""},getClassName:function(){return this.$el.attr("class")},getGlyphClassName:function(){return this.options.base+"-"+this.options.glyphPrefix+"-"+this.options.name},template:r.template('<{{tagName}} {{#disabled}}disabled{{/disabled}} {{#isTypeButton}}type="button"{{/isTypeButton}} class="{{base}} {{base}}-{{glyphPrefix}}-{{name}} {{modifier}} {{#isSmall}}mw-ui-icon-small{{/isSmall}} {{#_rotationClass}}{{_rotationClass}}{{/_rotationClass}} {{additionalClassNames}}" {{#id}}id="{{id}}"{{/id}} {{#href}}href="{{href}}"{{/href}} {{#title}}title="{{title}}"{{/title}}>{{#hasText}}<span>{{/hasText}}{{label}}{{#hasText}}</span>{{/hasText}}</{{tagName}}>')}),e.exports=o},"./src/mobile.startup/MessageBox.js":function(e,t,n){var i=n("./src/mobile.startup/View.js"),r=n("./src/mobile.startup/util.js");function s(){i.apply(this,arguments)}n("./src/mobile.startup/mfExtend.js")(s,i,{isTemplateMode:!0,defaults:{},template:r.template('\n<div class="{{className}}">\n\t{{#heading}}<h2>{{heading}}</h2>{{/heading}}\n\t{{{msg}}}\n</div>\n\t')}),e.exports=s},"./src/mobile.startup/Overlay.js":function(e,t,n){var i=n("./src/mobile.startup/View.js"),r=n("./src/mobile.startup/headers.js").header,s=n("./src/mobile.startup/Anchor.js"),o=n("./src/mobile.startup/util.js"),a=n("./src/mobile.startup/Browser.js").getSingleton();function l(e){this.isIos=a.isIos(),i.call(this,o.extend(!0,{headerChrome:!1,className:"overlay"},e,{events:o.extend({"click .cancel, .confirm, .initial-header .back":"onExitClick",click:function(e){e.stopPropagation()}},e.events)}))}n("./src/mobile.startup/mfExtend.js")(l,i,{template:o.template('\n{{^noHeader}}\n<div class="overlay-header-container header-container{{#headerChrome}}\n\theader-chrome{{/headerChrome}} position-fixed">\n</div>\n{{/noHeader}}\n<div class="overlay-content">\n\t{{>content}}\n</div>\n<div class="overlay-footer-container position-fixed"></div>\n\t'),hideTimeout:null,showSpinner:function(){this.$el.find(".spinner").removeClass("hidden")},hideSpinner:function(){this.$el.find(".spinner").addClass("hidden")},postRender:function(){var e=this.options.footerAnchor;this.$overlayContent=this.$el.find(".overlay-content"),this.isIos&&this.$el.addClass("overlay-ios"),e&&this.$el.find(".overlay-footer-container").append(new s(e).$el);var t=this.options.headers||[r(this.options.heading,this.options.headerActions)];this.$el.find(".overlay-header-container").append(t)},onExitClick:function(e){var t=function(){this.hide()}.bind(this);e.preventDefault(),e.stopPropagation(),this.options.onBeforeExit?this.options.onBeforeExit(t,(function(){})):t()},show:function(){var e=o.getDocument();this.scrollTop=window.pageYOffset,e.addClass("overlay-enabled"),window.scrollTo(0,1),this.$el.addClass("visible"),null!==this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=null)},hide:function(){return o.getDocument().removeClass("overlay-enabled"),window.scrollTo(window.pageXOffset,this.scrollTop),this.hideTimeout=setTimeout(function(){this.$el.detach(),this.hideTimeout=null}.bind(this),0),this.emit("hide"),!0},showHidden:function(e){this.$el.find(".hideable").addClass("hidden"),this.$el.find(e).removeClass("hidden")}}),l.make=function(e,t){var n=new l(e);return n.$el.find(".overlay-content").append(t.$el),n},e.exports=l},"./src/mobile.startup/OverlayManager.js":function(e,t,n){var i=n("./src/mobile.startup/util.js"),r=null,s="MobileFrontend OverlayManager was here!";function o(e,t){e.on("route",this._checkRoute.bind(this)),this.router=e,this.entries={},this.stack=[],this.hideCurrent=!0,this.container=t}function a(e){e.on("hide",(function(){e.emit("_om_hide")}))}o.prototype={_onHideOverlayOutsideOverlayManager:function(){if(this.stack.length){var e=this.stack[0].route,t="string"==typeof e,n=this.router.getPath(),i=t&&n===e||n.match(e);this.hideCurrent=!1,i&&this.router.back()}},_attachOverlay:function(e){e.$el.parents().length||this.container.appendChild(e.$el[0])},_show:function(e){window.history.replaceState(s,null,window.location.href),e.once("_om_hide",this._onHideOverlayOutsideOverlayManager.bind(this)),this._attachOverlay(e),e.show()},_hideOverlay:function(e,t){var n;function i(){n=!0,e.hide()}return e.off("_om_hide"),e.options&&e.options.onBeforeExit?e.options.onBeforeExit(i,t):i(),n||e.once("_om_hide",this._onHideOverlayOutsideOverlayManager.bind(this)),n},_processMatch:function(e){var t;e&&(e.overlay?this._show(e.overlay):(t=e.factoryResult)&&(e.overlay=t,a(e.overlay),this._show(t)))},_checkRoute:function(e){var t=this.stack[0];if(t||(this.scrollTop=window.pageYOffset),!t||void 0===t.overlay||!this.hideCurrent||this._hideOverlay(t.overlay,(function(){e.preventDefault()}))){var n=Object.keys(this.entries).reduce(function(t,n){return t||this._matchRoute(e.path,this.entries[n])}.bind(this),null);n||(this.stack=[],window.scrollTo(window.pageXOffset,this.scrollTop)),this.hideCurrent=!0,this._processMatch(n)}},_matchRoute:function(e,t){var n,i,r,s,o=this.stack[1],a=this;return"string"==typeof t.route?(i=t.route===e,r=[]):(s=e.match(t.route),r=(i=!!s)?s.slice(1):[]),i?o&&o.path===e?(a.stack.shift(),o):(n={path:e,route:t.route,factoryResult:t.factory.apply(a,r)},this.stack[0]&&n.path===this.stack[0].path?a.stack[0]=n:a.stack.unshift(n),n):null},add:function(e,t){var n=this,r={route:e,factory:t};this.entries[e]=r,i.docReady((function(){n._processMatch(n._matchRoute(n.router.getPath(),r))}))},replaceCurrent:function(e){if(0===this.stack.length)throw new Error("Trying to replace OverlayManager's current overlay, but stack is empty");var t=this.stack[0].overlay;t&&this._hideOverlay(t),this.stack[0].overlay=e,a(e),this._show(e)}},o.getSingleton=function(){if(!r){var e=mw.loader.require("mediawiki.router"),t=document.createElement("div"),n=e.getPath(),i=window.history.state;t.className="mw-overlays-container",document.body.appendChild(t),n&&i!==s&&(window.history.replaceState(null,null,"#"),window.history.pushState(s,null,"#".concat(n))),r=new o(e,t)}return r},o.test={MANAGED_STATE:s,__clearCache:function(){r=null}},e.exports=o},"./src/mobile.startup/Page.js":function(e,t,n){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var r=mw.html,s=n("./src/mobile.startup/util.js"),o=n("./src/mobile.startup/Section.js"),a=function(){"use strict";function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n=t.title||"";s.extend(this,{id:t.id||0,title:n,relevantTitle:t.relevantTitle||n,titleObj:t.titleObj,displayTitle:t.displayTitle||r.escape(n),namespaceNumber:t.namespaceNumber||0,protection:t.protection,sections:[],url:t.url||mw.util.getUrl(n),wikidataDescription:t.wikidataDescription,_isMainPage:t.isMainPage||!1,isMissing:void 0!==t.isMissing?t.isMissing:0===t.id,lastModified:t.lastModified,anchor:t.anchor,revId:t.revId,_isWatched:t.isWatched,thumbnail:!!Object.prototype.hasOwnProperty.call(t,"thumbnail")&&t.thumbnail,_sectionLookup:{}}),(t.sections||[]).forEach(function(e){var t=new o(e);this.sections.push(t),this._sectionLookup[t.id]=t}.bind(this)),this.thumbnail&&this.thumbnail.width&&(this.thumbnail.isLandscape=this.thumbnail.width>this.thumbnail.height)}var t,n,a;return t=e,(n=[{key:"getDisplayTitle",value:function(){return this.displayTitle}},{key:"inNamespace",value:function(e){return this.namespaceNumber===mw.config.get("wgNamespaceIds")[e]}},{key:"isWikiText",value:function(){return"wikitext"===mw.config.get("wgPageContentModel")}},{key:"isMainPage",value:function(){return this._isMainPage}},{key:"isWatched",value:function(){return this._isWatched}},{key:"getRevisionId",value:function(){return this.revId}},{key:"getTitle",value:function(){return this.title}},{key:"getNamespaceId",value:function(){var e=this.title.split(":");return e[1]&&mw.config.get("wgNamespaceIds")[e[0].toLowerCase().replace(" ","_")]||0}},{key:"getSection",value:function(e){return this._sectionLookup[e]}},{key:"getSections",value:function(){return this.sections}}])&&i(t.prototype,n),a&&i(t,a),e}();e.exports=a},"./src/mobile.startup/PageGateway.js":function(e,t,n){var i=n("./src/mobile.startup/util.js"),r=n("./src/mobile.startup/Section.js").prototype.template,s=n("./src/mobile.startup/actionParams.js"),o={};function a(e){var t,n=e.map((function(e){return e.level})).filter((function(e){return!!e})),i=Math.min.apply(this,n).toString(),s=[];return e.forEach((function(e){e.subsections=[],!t||!e.level||e.level===i||t.subsections.length&&t.subsections[0].level>e.level||t.level&&t.level>=e.level?(s.push(e),t=e):(!function e(t,n){var i;0===t.length?t.push(n):(i=t[t.length-1],parseInt(i.level,10)===parseInt(n.level,10)?t.push(n):e(i.subsections,n))}(t.subsections,e),t.text+=r.render(e))})),s}function l(e){this.api=e}l.prototype={invalidatePage:function(e){delete o[e]},_getLanguageVariantsFromApiResponse:function(e,t){var n=t.query.general,i=n.variantarticlepath,r=[];return!!n.variants&&(Object.keys(n.variants).forEach((function(t){var s=n.variants[t],o={autonym:s.name,lang:s.code};o.url=i?i.replace("$1",e).replace("$2",s.code):mw.util.getUrl(e,{variant:s.code}),r.push(o)})),r)},getPageLanguages:function(e,t){var n=this,r=s({meta:"siteinfo",siprop:"general",prop:"langlinks",lllimit:"max",titles:e});return t?(r.llprop="url|autonym|langname",r.llinlanguagecode=t):r.llprop="url|autonym",this.api.get(r).then((function(t){return{languages:t.query.pages[0].langlinks||[],variants:n._getLanguageVariantsFromApiResponse(e,t)}}),(function(){return i.Deferred().reject()}))},_getAPIResponseFromHTML:function(e){var t=e.find("h1,h2,h3,h4,h5,h6"),n=[];return t.each((function(){var t=this.tagName.substr(1),i=e.find(this).find(".mw-headline");i.length&&n.push({level:t,line:i.html(),anchor:i.attr("id")||"",text:""})})),n},getSectionsFromHTML:function(e){return a(this._getAPIResponseFromHTML(e))}},e.exports=l},"./src/mobile.startup/PageHTMLParser.js":function(e,t,n){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var r=n("./src/mobile.startup/Thumbnail.js"),s=mw.config.get("wgMFMobileFormatterHeadings",["h1","h2","h3","h4","h5"]).join(","),o=["noviewer","metadata"],a=function(){"use strict";function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$el=t,this.$headings=this.$el.find(s)}var t,n,a;return t=e,(n=[{key:"findSectionHeadingByIndex",value:function(e){return e<1?$([]):this.$headings.filter('.mw-parser-output > *, [class^="mf-section-"] > *').eq(e-1)}},{key:"findChildInSectionLead",value:function(e,t){var n,i,r,o,a=s;function l(e){return e.find(t).addBack()}return 0===e?(o=this.getLeadSectionElement())&&o.length?l(o.children(t)):(n=this.findSectionHeadingByIndex(1)).length?l(n.prevAll(t)):this.$el.find(t):(n=this.findSectionHeadingByIndex(e)).hasClass("section-heading")?(i=(r=n.next()).find(a).eq(0)).length?l(i.prevAll(t)):l(r.children(t)):(i=n.eq(0).nextAll(a).eq(0),n.nextUntil(i,t))}},{key:"getLeadSectionElement",value:function(){var e=this.$el.find(".mf-section-0");return e.length?e:null}},{key:"getThumbnails",value:function(e){var t="."+o.join(",."),n=[];return(e=e||this.$el).find("a.image, a.thumbimage").not(t).each((function(){var i=e.find(this),s=i.find(".lazy-image-placeholder"),a=0===i.parents(t).length&&0===i.find(t).length,l=i.attr("href"),c=l&&l.match(/title=([^/&]+)/),u=l&&l.match(/[^/]+$/);s.length&&a&&(a=!new RegExp("\\b("+o.join("|")+")\\b").test(s.data("class"))),a&&(c||u)&&n.push(new r({el:i,filename:decodeURIComponent(c?c[1]:u[0])}))})),n}},{key:"getRedLinks",value:function(){return this.$el.find(".new")}}])&&i(t.prototype,n),a&&i(t,a),e}();a.HEADING_SELECTOR=s,e.exports=a},"./src/mobile.startup/PageList.js":function(e,t,n){var i=n("./src/mobile.startup/util.js"),r=n("./src/mobile.startup/mfExtend.js"),s=n("./src/mobile.startup/View.js"),o=n("./src/mobile.startup/Browser.js").getSingleton();function a(){s.apply(this,arguments)}r(a,s,{defaults:{pages:[]},renderPageImages:function(){var e=this;setTimeout((function(){e.$el.find(".list-thumb").each((function(){var t=e.$el.find(this).data("style");e.$el.find(this).attr("style",t)}))}),o.isWideScreen()?0:1e3)},postRender:function(){this.renderPageImages()},template:i.template('\n<ul class="page-list thumbs actionable">\n\t{{#pages}}\n\t\t{{>item}}\n\t{{/pages}}\n</ul>\n\t'),templatePartials:{item:i.template('\n<li title="{{title}}" data-id="{{id}}" class="page-summary">\n  <a href="{{url}}" class="title {{#isMissing}}new{{/isMissing}}"\n    {{#anchor}}name="{{anchor}}"{{/anchor}}\n    {{#latitude}}data-latlng="{{latitude}},{{longitude}}"{{/latitude}}\n    data-title="{{title}}">\n    <div class="list-thumb\n      {{^thumbnail}}list-thumb-none list-thumb-x{{/thumbnail}}\n      {{#thumbnail.isLandscape}}list-thumb-y{{/thumbnail.isLandscape}}\n      {{^thumbnail.isLandscape}}list-thumb-x{{/thumbnail.isLandscape}}"\n      {{#thumbnail}}data-style="background-image: url( {{thumbnail.source}} )"{{/thumbnail}}></div>\n    <h3>{{{displayTitle}}}</h3>\n    {{#wikidataDescription}}\n    <div class="wikidata-description">{{wikidataDescription}}</div>\n    {{/wikidataDescription}}\n    {{#lastModified}}\n    <div class="info">{{lastModified}}</div>\n    {{/lastModified}}\n    {{#proximity}}\n    <div class="info proximity">{{proximity}}</div>\n    {{/proximity}}\n  </a>\n</li>\n\t')}}),e.exports=a},"./src/mobile.startup/ScrollEndEventEmitter.js":function(e,t,n){var i=n("./src/mobile.startup/util.js"),r=n("./src/mobile.startup/mfExtend.js");function s(e,t){this.threshold=t||100,this.eventBus=e,this.enable(),OO.EventEmitter.call(this)}OO.mixinClass(s,OO.EventEmitter),s.EVENT_SCROLL_END="ScrollEndEventEmitter-scrollEnd",r(s,{_bindScroll:function(){this._scrollHandler||(this._scrollHandler=this._onScroll.bind(this),this.eventBus.on("scroll:throttled",this._scrollHandler))},_unbindScroll:function(){this._scrollHandler&&(this.eventBus.off("scroll:throttled",this._scrollHandler),this._scrollHandler=null)},_onScroll:function(){this.$el&&this.enabled&&this.scrollNearEnd()&&(this.disable(),this.emit(s.EVENT_SCROLL_END))},scrollNearEnd:function(){var e=i.getWindow(),t=e.scrollTop()+e.height(),n=this.$el.offset().top+this.$el.outerHeight();return t+this.threshold>n},enable:function(){this.enabled=!0,this._bindScroll()},disable:function(){this.enabled=!1,this._unbindScroll()},setElement:function(e){this.$el=e}}),e.exports=s},"./src/mobile.startup/Section.js":function(e,t,n){var i=n("./src/mobile.startup/util.js"),r=n("./src/mobile.startup/mfExtend.js"),s=n("./src/mobile.startup/View.js");function o(e){var t=this;e.tag="h"+e.level,this.line=e.line,this.text=e.text,this.hasReferences=e.hasReferences||!1,this.id=e.id||null,this.anchor=e.anchor,this.subsections=[],(e.subsections||[]).forEach((function(e){t.subsections.push(new o(e))})),s.call(this,e)}r(o,s,{template:i.template('\n<h{{level}} id="{{anchor}}">{{{line}}}</h{{level}}>\n{{{text}}}\n\t'),defaults:{line:void 0,text:""}}),e.exports=o},"./src/mobile.startup/Thumbnail.js":function(e,t,n){var i=n("./src/mobile.startup/mfExtend.js"),r=n("./src/mobile.startup/util.js"),s=n("./src/mobile.startup/View.js");function o(e){s.call(this,r.extend({isBorderBox:!1},e))}i(o,s,{defaults:{filename:void 0},postRender:function(){this.options.description=this.$el.siblings(".thumbcaption").text()},getDescription:function(){return this.options.description},getFileName:function(){return this.options.filename}}),e.exports=o},"./src/mobile.startup/Toggler.js":function(e,t,n){var i=n("./src/mobile.startup/Browser.js").getSingleton(),r=n("./src/mobile.startup/util.js"),s=r.escapeHash,o={name:"expand",isSmall:!0,additionalClassNames:"indicator mw-ui-icon-flush-left"},a=n("./src/mobile.startup/Icon.js");function l(e){this.eventBus=e.eventBus,this._enable(e.$container,e.prefix,e.page,e.isClosed)}function c(e){var t=JSON.parse(mw.storage.session.get("expandedSections")||"{}");return t[e.title]=t[e.title]||{},t}function u(e){mw.storage.get("expandedSections")&&(mw.storage.session.set("expandedSections",JSON.stringify(mw.storage.get("expandedSections"))),mw.storage.remove("expandedSections")),mw.storage.session.set("expandedSections",JSON.stringify(e))}function d(e,t,n){var i,r,s=c(n);t.find(".section-heading span").each((function(){r=t.find(this),i=r.parents(".section-heading"),s[n.title][r.attr("id")]&&!i.hasClass("open-block")&&e.toggle(i,n)}))}function h(e){var t=(new Date).getTime(),n=c(e);Object.keys(n).forEach((function(e){var i=n[e];Object.keys(i).forEach((function(r){var s=i[r];Math.floor((t-s)/1e3/60/60/24)>=1&&delete n[e][r]}))})),u(n)}l.prototype.toggle=function(e,t){var n,r=this,s=e.is(".open-block"),l=e.find(".mw-headline"),d=e.next();e.toggleClass("open-block"),e.data("indicator").remove(),o.rotation=s?0:180,n=new a(o).prependTo(e),e.data("indicator",n),l.attr("aria-expanded",!s),d.toggleClass("open-block"),mw.requestIdleCallback((function(){r.eventBus.emit("section-toggled",{expanded:s,isReferenceSection:Boolean(d.attr("data-is-reference-section")),$heading:e})})),i.isWideScreen()||function(e,t){var n=e.find("span").attr("id"),i=e.hasClass("open-block"),r=c(t);n&&r[t.title]&&(i?r[t.title][n]=(new Date).getTime():delete r[t.title][n],u(r))}(e,t)},l.prototype.reveal=function(e,t,n){var i,r;try{(r=(i=t.find(s(e))).parents(".collapsible-heading")).length||(r=i.parents(".collapsible-block").prev(".collapsible-heading")),r.length&&!r.hasClass("open-block")&&this.toggle(r,n),r.length&&window.scrollTo(0,i.offset().top)}catch(e){}},l.prototype._enable=function(e,t,n,s){var l,c,u,p,f,m,g,b=this,v=mw.config.get("wgMFCollapseSectionsByDefault");function w(){var t,i=window.location.hash;if(0===i.indexOf("#"))try{t=decodeURIComponent(i),b.reveal(t,e,n)}catch(e){}}l=e.find("> h1,> h2,> h3,> h4,> h5,> h6,.section-heading").eq(0).prop("tagName")||"H1",void 0===v&&(v=!0),c=!v||"true"===mw.storage.get("expandSections"),e.children(l).each((function(r){var l,d=e.find(this),h=d.find(".mw-headline"),f=d.find(".indicator"),m=t+"collapsible-block-"+r;d.next().is("section")&&(p=d.next("section"),l=Boolean(p.attr("data-is-reference-section")),d.addClass("collapsible-heading ").data("section-number",r).on("click",(function(e){e.target.href||(e.preventDefault(),b.toggle(d,n))})),h.attr({tabindex:0,role:"button","aria-controls":m,"aria-expanded":"false"}),o.rotation=c?180:0,u=new a(o),f.length?f.replaceWith(u.$el):u.prependTo(d),d.data("indicator",u.$el),p.addClass("collapsible-block").eq(0).attr({id:m}),function(e,t,n){t.on("keypress",(function(i){13!==i.which&&32!==i.which||e.toggle(t,n)})).find("a").on("keypress mouseup",(function(e){e.stopPropagation()}))}(b,d,n),!l&&(!s&&i.isWideScreen()||c)&&b.toggle(d,n))})),m=mw.config.get("wgInternalRedirectTargetUrl"),(g=!!m&&m.split("#")[1])&&(window.location.hash=g,b.reveal(g,e,n)),w(),(f=e.find("a:not(.reference a)")).on("click",(function(){void 0!==f.attr("href")&&f.attr("href").indexOf("#")>-1&&w()})),r.getWindow().on("hashchange",(function(){w()})),!i.isWideScreen()&&n&&(d(this,e,n),h(n))},l._getExpandedSections=c,l._expandStoredSections=d,l._cleanObsoleteStoredSections=h,e.exports=l},"./src/mobile.startup/View.js":function(e,t,n){var i=n("./src/mobile.startup/util.js"),r=n("./src/mobile.startup/mfExtend.js"),s=/^(\S+)\s*(.*)$/,o=0;function a(){this.initialize.apply(this,arguments)}OO.mixinClass(a,OO.EventEmitter),r(a,{tagName:"div",isTemplateMode:!1,template:void 0,templatePartials:{},defaults:{},initialize:function(e){var t,n,r=this;OO.EventEmitter.call(this),e=i.extend({},this.defaults,e),this.options=e,this.cid=(t="view",n=(++o).toString(),t?t+n:n),"string"==typeof this.template&&(this.template=mw.template.compile(this.template)),e.el?this.$el=$(e.el):this.$el=this.parseHTML("<"+this.tagName+">"),this.$el.length?this._postInitialize(e):i.docReady((function(){r.$el=$(e.el),r._postInitialize(e)}))},_postInitialize:function(e){this.$el.addClass(e.className),!1!==e.isBorderBox&&this.$el.addClass("view-border-box"),this.render({})},preRender:function(){},postRender:function(){},render:function(e){var t,n;return i.extend(this.options,e),this.preRender(),this.undelegateEvents(),this.template&&!this.options.skipTemplateRender&&(n=this.template.render(this.options,this.templatePartials),this.isTemplateMode?(t=$(n),this.$el.replaceWith(t),this.$el=t):this.$el.html(n)),this.postRender(),this.delegateEvents(),this},delegateEvents:function(e){var t,n,i;if(e=e||this.options.events)for(n in this.undelegateEvents(),e)"function"!=typeof(i=e[n])&&(i=this[e[n]]),i&&(t=n.match(s),this.delegate(t[1],t[2],i.bind(this)))},delegate:function(e,t,n){this.$el.on(e+".delegateEvents"+this.cid,t,n)},undelegateEvents:function(){this.$el&&this.$el.off(".delegateEvents"+this.cid)},undelegate:function(e,t,n){this.$el.off(e+".delegateEvents"+this.cid,t,n)},parseHTML:function(e){return i.parseHTML(e,document)}}),["append","prepend","appendTo","prependTo","after","before","insertAfter","insertBefore","remove","detach"].forEach((function(e){a.prototype[e]=function(){return this.$el[e].apply(this.$el,arguments),this}})),a.make=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=new a(e);return t.forEach((function(e){n.append(e)})),n},e.exports=a},"./src/mobile.startup/actionParams.js":function(e,t,n){var i=n("./src/mobile.startup/util.js"),r={action:"query",formatversion:2};e.exports=function(e){var t=mw.config.get("wgMFContentProviderScriptPath");return i.extend({},r,{origin:t?"*":void 0},e)}},"./src/mobile.startup/amcOutreach/AmcEnableForm.js":function(e,t,n){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=c(e);if(t){var r=c(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l(this,n)}}function l(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var u=n("./src/mobile.startup/Button.js"),d=n("./src/mobile.startup/util.js"),h=function(e){"use strict";!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(c,e);var t,n,i,l=a(c);function c(){return r(this,c),l.apply(this,arguments)}return t=c,(n=[{key:"isTemplateMode",get:function(){return!0}},{key:"template",get:function(){return d.template('\n<form class="amc-enable-form" action="{{postUrl}}" method="POST">\n\t{{#fields}}\n\t\t<input type="hidden" name="{{name}}" value="{{value}}">\n\t{{/fields}}\n</form>\n\t\t')}},{key:"postRender",value:function(){this.$el.append(new u({tagName:"button",progressive:!0,label:this.options.buttonLabel}).$el)}}])&&s(t.prototype,n),i&&s(t,i),c}(n("./src/mobile.startup/View.js"));e.exports=h},"./src/mobile.startup/amcOutreach/amcOutreachDrawer.js":function(e,t,n){var i=n("./src/mobile.startup/Drawer.js"),r=n("./src/mobile.startup/Anchor.js"),s=n("./src/mobile.startup/util.js"),o=n("./src/mobile.startup/amcOutreach/AmcEnableForm.js");e.exports=function(e,t,n,a,l,c,u,d,h){return new i({className:"amc-outreach-drawer",children:[s.parseHTML("<div>").addClass("amc-outreach-image"),s.parseHTML("<p>").append(s.parseHTML("<strong>").text(n("mobile-frontend-amc-outreach-intro").text())),s.parseHTML("<p>").text(n("mobile-frontend-amc-outreach-description").text()),new o({postUrl:a.getUrl("Special:MobileOptions",{returnto:d,returntoquery:h||""}),fields:[{name:"updateSingleOption",value:"enableAMC"},{name:"enableAMC",value:"1"},{name:"token",value:c}],buttonLabel:n("mobile-frontend-amc-outreach-enable").text(),events:{submit:function(){t.makeActionIneligible(e),l.showOnPageReload(n("mobile-frontend-amc-outreach-enabled-message").text())}}}).$el,new r({href:"#",additionalClassNames:"cancel",progressive:!0,label:n("mobile-frontend-amc-outreach-no-thanks").text()}).$el],onBeforeHide:function(){t.makeActionIneligible(e),u()}})}},"./src/mobile.startup/cache.js":function(e,t){function n(){this._cache={}}function i(){}n.prototype.get=function(e){return this._cache[e]},n.prototype.set=function(e,t){this._cache[e]=t},i.prototype.get=function(){},i.prototype.set=function(){},e.exports={MemoryCache:n,NoCache:i}},"./src/mobile.startup/extendSearchParams.js":function(e,t,n){var i=n("./src/mobile.startup/util.js"),r=n("./src/mobile.startup/actionParams.js");e.exports=function(e){var t,n,s=mw.config.get("wgMFDisplayWikibaseDescriptions")||{search:!0,nearby:!0,watchlist:!0,tagline:!1},o=mw.config.get("wgMFContentProviderScriptPath");if(!Object.prototype.hasOwnProperty.call(s,e))throw new Error('"'+e+"\" isn't a feature that shows Wikibase descriptions.");return(t=Array.prototype.slice.call(arguments,1)).unshift({prop:[]}),t.push(mw.config.get("wgMFSearchAPIParams")),(n=i.extend.apply({},t)).prop=n.prop.concat(mw.config.get("wgMFQueryPropModules")),s[e]&&-1===n.prop.indexOf("description")&&n.prop.push("description"),o&&(n.origin="*"),r(n)}},"./src/mobile.startup/headers.js":function(e,t,n){var i=n("./src/mobile.startup/util.js"),r=n("./src/mobile.startup/Button.js"),s=n("./src/mobile.startup/icons.js");function o(e,t,n,r){var o="string"==typeof e?e:void 0,a={hasActions:t&&t.length,isHidden:!1,heading:o},l=i.template('\n<div class="overlay-header header '.concat(r||"",' hideable">\n\t<ul class="header-cancel">\n\t\t<li></li>\n\t</ul>\n\t{{{heading}}}\n\t{{#hasActions}}\n\t<div class="header-action"></div>\n\t{{/hasActions}}\n</div>\n\t\t')).render(a);n=n||s.cancel();var c=i.parseHTML(l);return c.find("h2 span").addClass("truncated-text"),c.find(".header-cancel li").append(n.$el),void 0===o&&e.$el.insertAfter(c.find(".header-cancel")),t&&t.length&&c.find(".header-action").append(t.map((function(e){return e.$el}))),c[0]}function a(e,t,n,i){return o(e='<div class="overlay-title"><h2>'.concat(e,"</h2></div>"),t,n,i)}e.exports={savingHeader:function(e){return a(e,[s.spinner({additionalClassNames:"savespinner loading"})],s.cancel(),"saving-header hidden")},saveHeader:function(e,t){return a(e,[new r({tagName:"button",additionalClassNames:"save submit",disabled:!0,label:i.saveButtonMessage()})],s.back(),t)},formHeader:function(e,t,n,i){return o(e,t,n,i)},header:a}},"./src/mobile.startup/icons.js":function(e,t,n){var i=n("./src/mobile.startup/Icon.js"),r=n("./src/mobile.startup/util.js");e.exports={CANCEL_GLYPH:"close",Icon:i,back:function(){return new i({tagName:"button",name:"previous-base20",additionalClassNames:"back",label:mw.msg("mobile-frontend-overlay-close")})},cancel:function(e,t){var n=e?"".concat("close","-").concat(e):"".concat("close","-base20");return new this.Icon(r.extend({tagName:"button",name:n,additionalClassNames:"cancel",label:mw.msg("mobile-frontend-overlay-close")},t||{}))},spinner:function(e){return void 0===(e=e||{}).additionalClassNames&&(e.additionalClassNames="spinner loading"),new this.Icon(r.extend(e,{name:"spinner",label:mw.msg("mobile-frontend-loading-message")}))},error:function(){return new i({name:"alert-invert",additionalClassNames:"load-fail-msg-icon"})},watchIcon:function(e){return new this.Icon(r.extend(e,{name:"star-base20",glyphPrefix:"wikimedia",additionalClassNames:"watch-this-article"}))},watchedIcon:function(e){return new this.Icon(r.extend(e,{name:"unStar-progressive",glyphPrefix:"wikimedia",additionalClassNames:"watch-this-article watched"}))}}},"./src/mobile.startup/languageOverlay/getDeviceLanguage.js":function(e,t){e.exports=function(e){var t=e.languages?e.languages[0]:e.language||e.userLanguage||e.browserLanguage||e.systemLanguage;return t?t.toLowerCase():void 0}},"./src/mobile.startup/languageOverlay/languageOverlay.js":function(e,t,n){var i=n("./src/mobile.startup/moduleLoaderSingleton.js"),r=n("./src/mobile.startup/languageOverlay/getDeviceLanguage.js"),s=n("./src/mobile.startup/Overlay.js"),o=n("./src/mobile.startup/promisedView.js");function a(e){return mw.loader.using("mobile.languages.structured").then((function(){return e.getPageLanguages(mw.config.get("wgPageName"),mw.config.get("wgUserLanguage"))})).then((function(e){return new(i.require("mobile.languages.structured/LanguageSearcher"))({languages:e.languages,variants:e.variants,showSuggestedLanguages:!0,deviceLanguage:r(navigator)})}))}function l(e){return s.make({heading:mw.msg("mobile-frontend-language-heading"),className:"overlay language-overlay"},o(a(e)))}l.test={loadLanguageSearcher:a},e.exports=l},"./src/mobile.startup/lazyImages/lazyImageLoader.js":function(e,t,n){var i=n("./src/mobile.startup/util.js");e.exports={placeholderClass:"lazy-image-placeholder",queryPlaceholders:function(e){return Array.prototype.slice.call(e.getElementsByClassName("lazy-image-placeholder"))},loadImages:function(t){return i.Promise.all(t.map((function(t){return e.exports.loadImage(t).promise})))},loadImage:function(e){var t=i.Deferred(),n=e.dataset.width||"0",r=e.dataset.height||"0",s=new Image(parseInt(n,10),parseInt(r,10));return s.className=e.dataset.class||"",s.alt=e.dataset.alt||"",s.useMap=e.dataset.usemap,s.style.cssText=e.style.cssText||"",s.addEventListener("load",(function(){s.classList.add("image-lazy-loaded"),e.parentNode&&e.parentNode.replaceChild(s,e),t.resolve("load")}),{once:!0}),s.addEventListener("error",(function(){t.resolve("error")}),{once:!0}),s.src=e.dataset.src||"",s.srcset=e.dataset.srcset||"",{promise:t,image:s}},test:{placeholderClass:"lazy-image-placeholder"}}},"./src/mobile.startup/mfExtend.js":function(e,t){e.exports=function(e,t,n){var i;for(i in n?OO.inheritClass(e,t):(OO.initClass(e),n=t),n)e.prototype[i]=n[i]}},"./src/mobile.startup/moduleLoader.js":function(e,t){function n(){this._register={}}n.prototype={require:function(e){var t,n,i=this._register;function r(){if(!Object.hasOwnProperty.call(i,e))throw new Error("MobileFrontend Module not found: "+e);return i[e]}n=e.split("/");try{return(t=mw.loader.require(n[0]))[n[1]]?t[n[1]]:r()}catch(e){return r()}},define:function(e,t){var n=this;if(Object.hasOwnProperty.call(this._register,e))throw new Error("Module already exists: "+e);return this._register[e]=t,{deprecate:function(i){n.deprecate(i,t,e)}}},deprecate:function(e,t,n){var i;n&&(i="Use "+n+" instead."),mw.log.deprecate(this._register,e,t,i)}},e.exports=n},"./src/mobile.startup/moduleLoaderSingleton.js":function(e,t,n){var i=n("./src/mobile.startup/moduleLoader.js");e.exports=new i},"./src/mobile.startup/page/pageJSONParser.js":function(e,t,n){var i=n("./src/mobile.startup/Page.js"),r=n("./src/mobile.startup/time.js"),s=n("./src/mobile.startup/util.js");e.exports={parse:function(e){var t,n,o=e.thumbnail,a=e.pageprops||{displaytitle:mw.html.escape(e.title)},l=e.terms;return(a||l)&&(n=l&&l.label?mw.html.escape(l.label[0]):a.displaytitle),e.wikidataDescription=e.description||void 0,o&&(e.thumbnail.isLandscape=o.width>o.height),e.revisions&&e.revisions[0]&&(t=e.revisions[0],e.lastModified=r.getLastModifiedMessage(new Date(t.timestamp).getTime()/1e3,t.user)),new i(s.extend(e,{id:e.pageid,isMissing:!!e.missing,url:mw.util.getUrl(e.title),displayTitle:n}))}}},"./src/mobile.startup/promisedView.js":function(e,t,n){var i=n("./src/mobile.startup/icons.js"),r=n("./src/mobile.startup/View.js");e.exports=function(e){var t=new r({className:"promised-view"});return t.$el.append(i.spinner().$el),e.then((function(e){t.$el.replaceWith(e.$el),t.$el=e.$el}),(function(e){e&&e.$el&&(t.$el.replaceWith(e.$el),t.$el=e.$el)})),t}},"./src/mobile.startup/promoCampaign/promoCampaign.js":function(e,t){e.exports=function(e,t,n,i,r,s){var o,a,l={};for(o in t)a=t[o],l[a]="mobile-frontend-".concat(n,"-ineligible-").concat(a);function c(){return i}function u(e){if(!(e in t))throw new Error("Action '".concat(e,"' not found in 'actions' object. Please add this to\n\t\t\t\tthe object when creating a campaign with promoCampaign.js if you believe\n\t\t\t\tthis is a valid action."))}function d(e){return u(e),c()&&r&&null===s.get(l[e])}return{showIfEligible:function(t){if(!d(t))return null;for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return e.apply(void 0,[t].concat(i))},makeActionIneligible:function(e){return u(e),s.set(l[e],"~")},makeAllActionsIneligible:function(){var e,n;for(e in t)n=t[e],this.makeActionIneligible(n)},isCampaignActive:c}}},"./src/mobile.startup/references/ReferencesGateway.js":function(e,t){function n(e){this.api=e}n.prototype.getReference=null,n.ERROR_NOT_EXIST="NOT_EXIST_ERROR",n.ERROR_OTHER="OTHER_ERROR",e.exports=n},"./src/mobile.startup/references/ReferencesHtmlScraperGateway.js":function(e,t,n){var i=n("./src/mobile.startup/references/ReferencesGateway.js"),r=n("./src/mobile.startup/mfExtend.js"),s=n("./src/mobile.startup/util.js");function o(){i.apply(this,arguments)}r(o,i,{EXTERNAL_LINK_CLASS:"external--reference",getReferenceFromContainer:function(e,t){var n,r,o,a=s.Deferred();return(n=t.find("#"+s.escapeSelector(e.substr(1)))).length?((r=n.closest("ol")).hasClass("mw-extended-references")&&(o=r.parent()),(o||n).find(".external").addClass(this.EXTERNAL_LINK_CLASS),a.resolve({text:this.getReferenceHtml(n),parentText:this.getReferenceHtml(o)})):a.reject(i.ERROR_NOT_EXIST),a.promise()},getReferenceHtml:function(e){return e?e.find(".mw-reference-text, .reference-text").first().html():""},getReference:function(e,t,n){try{e=decodeURIComponent(e)}catch(e){}return this.getReferenceFromContainer(e,n.$el.find("ol.references"))}}),e.exports=o},"./src/mobile.startup/references/references.js":function(e,t,n){var i,r=n("./src/mobile.startup/Drawer.js"),s=n("./src/mobile.startup/util.js"),o=n("./src/mobile.startup/icons.js"),a=n("./src/mobile.startup/references/ReferencesGateway.js"),l=n("./src/mobile.startup/Icon.js");function c(e){return function(t){var n=t.currentTarget.querySelector("a");if(n)return e(n.getAttribute("href"),n.textContent),!1}}function u(e){var t=e.error?new l({name:"error",isSmall:!0}).$el:null;return new r(s.extend({showCollapseIcon:!1,className:"drawer position-fixed text references-drawer",events:{"click sup a":function(e){e.preventDefault()},"click sup":e.onNestedReferenceClick&&c(e.onNestedReferenceClick)},children:[s.parseHTML("<div>").addClass("references-drawer__header").append([new l({isSmall:!0,name:"reference",modifier:""}).$el,s.parseHTML("<span>").addClass("references-drawer__title").text(mw.msg("mobile-frontend-references-citation")),o.cancel("gray",{isSmall:!0,modifier:"mw-ui-icon-element mw-ui-icon-flush-right"}).$el]),s.parseHTML("<div>").addClass("mw-parser-output").append([t,e.parentText?s.parseHTML("<div>").html(e.parentText):"",s.parseHTML("<sup>").text(e.title),e.text?s.parseHTML("<span>").html(" "+e.text):o.spinner().$el])]},e))}i={test:{makeOnNestedReferenceClickHandler:c},referenceDrawer:u,showReference:function(e,t,n,r,o,l,c){return o.getReference(e,t,r).then((function(e){var a=u(s.extend({title:n,text:e.text,parentText:e.parentText,onNestedReferenceClick:function(e,n){i.showReference(e,t,n,r,o).then((function(e){l.onShowNestedReference?c(a,e):(mw.log.warn("Please provide onShowNestedReferences parameter."),document.body.appendChild(e.$el[0]),a.hide(),e.show())}))}},l));return a}),(function(e){if(e!==a.ERROR_NOT_EXIST)return u({error:!0,title:n,text:mw.msg("mobile-frontend-references-citation-error")})}))}},e.exports=i},"./src/mobile.startup/search/MobileWebSearchLogger.js":function(e,t){function n(){this.userSessionToken=null,this.searchSessionToken=null}n.prototype={_newUserSession:function(){this.userSessionToken=mw.user.generateRandomSessionId()},_newSearchSession:function(){this.searchSessionToken=mw.user.generateRandomSessionId(),this.searchSessionCreatedAt=(new Date).getTime()},onSearchShow:function(){this._newUserSession()},onSearchStart:function(){this._newSearchSession(),mw.track("mf.schemaMobileWebSearch",{action:"session-start",userSessionToken:this.userSessionToken,searchSessionToken:this.searchSessionToken,timeOffsetSinceStart:0})},onSearchResults:function(e){var t=(new Date).getTime()-this.searchSessionCreatedAt;mw.track("mf.schemaMobileWebSearch",{action:"impression-results",resultSetType:"prefix",numberOfResults:e.results.length,userSessionToken:this.userSessionToken,searchSessionToken:this.searchSessionToken,timeToDisplayResults:t,timeOffsetSinceStart:t})},onSearchResultClick:function(e){var t=(new Date).getTime()-this.searchSessionCreatedAt;mw.track("mf.schemaMobileWebSearch",{action:"click-result",clickIndex:e.resultIndex+1,userSessionToken:this.userSessionToken,searchSessionToken:this.searchSessionToken,timeOffsetSinceStart:t})}},n.register=function(e){var t=new n;e.on("search-show",t.onSearchShow.bind(t)),e.on("search-start",t.onSearchStart.bind(t)),e.on("search-results",t.onSearchResults.bind(t)),e.on("search-result-click",t.onSearchResultClick.bind(t))},e.exports=n},"./src/mobile.startup/search/SearchGateway.js":function(e,t,n){var i=n("./src/mobile.startup/page/pageJSONParser.js"),r=n("./src/mobile.startup/util.js"),s=n("./src/mobile.startup/extendSearchParams.js");function o(e){this.api=e,this.searchCache={},this.generator=mw.config.get("wgMFSearchGenerator")}o.prototype={searchNamespace:0,getApiData:function(e){var t=this.generator.prefix,n=s("search",{generator:this.generator.name});return n.redirects="",n["g"+t+"search"]=e,n["g"+t+"namespace"]=this.searchNamespace,n["g"+t+"limit"]=15,n.pilimit&&(n.pilimit=15,n.pithumbsize=mw.config.get("wgMFThumbnailSizes").tiny),n},_createSearchRegEx:function(e){return e=e.replace(/[-\[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),new RegExp("^("+e+")","ig")},_highlightSearchTerm:function(e,t){return e=r.parseHTML("<span>").text(e).html(),t=r.parseHTML("<span>").text(t).html(),e.replace(this._createSearchRegEx(t),"<strong>$1</strong>")},_getPage:function(e,t){var n=i.parse(t);return n.displayTitle=this._highlightSearchTerm(t.displaytext?t.displaytext:n.title,e),n.index=t.index,n},_processData:function(e,t){var n=this,i=[];return t.query&&(i=t.query.pages||{},(i=Object.keys(i).map((function(t){return n._getPage(e,i[t])}))).sort((function(e,t){return e.index<t.index?-1:1}))),i},search:function(e){var t,n,i=this;return this.isCached(e)||(n=(t=this.api.get(this.getApiData(e))).then((function(t){return{query:e,results:i._processData(e,t)}}),(function(){i.searchCache[e]=void 0})),this.searchCache[e]=n.promise({abort:function(){t.abort()}})),this.searchCache[e]},isCached:function(e){return Boolean(this.searchCache[e])}},e.exports=o},"./src/mobile.startup/search/SearchHeaderView.js":function(e,t,n){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=l(e);if(t){var r=l(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return a(this,n)}}function a(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var c=n("./src/mobile.startup/util.js"),u=n("./src/mobile.startup/View.js"),d=n("./src/mobile.startup/Icon.js"),h=function(e){"use strict";!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(l,e);var t,n,i,a=o(l);function l(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),a.call(this,c.extend({},e,{events:{"input input":"onInput"}}))}return t=l,(n=[{key:"onInput",value:function(e){var t=e.target.value;this.options.onInput(t),t?this.clearIcon.$el.show():this.clearIcon.$el.hide()}},{key:"isTemplateMode",get:function(){return!0}},{key:"template",get:function(){return c.template('<div class="overlay-title search-header-view">\n\t\t<form method="get" action="{{action}}" class="search-box">\n\t\t<input class="search mw-ui-background-icon-search" type="search" name="search" autocomplete="off" placeholder="{{placeholderMsg}}" aria-label="{{placeholderMsg}}" value="{{searchTerm}}">\n\t\t</form>\n</div>')}},{key:"postRender",value:function(){var e=new d({tagName:"button",name:"clear",isSmall:!0,label:mw.msg("mobile-frontend-clear-search"),additionalClassNames:"clear",events:{click:function(){return this.$el.find("input").val("").trigger("focus"),this.options.onInput(""),e.$el.hide(),!1}.bind(this)}});this.clearIcon=e,e.$el.hide(),e.$el.attr("aria-hidden","true"),this.$el.find("form").append(e.$el)}}])&&r(t.prototype,n),i&&r(t,i),l}(u);e.exports=h},"./src/mobile.startup/search/SearchOverlay.js":function(e,t,n){var i=n("./src/mobile.startup/mfExtend.js"),r=n("./src/mobile.startup/Overlay.js"),s=n("./src/mobile.startup/util.js"),o=n("./src/mobile.startup/search/searchHeader.js"),a=n("./src/mobile.startup/search/SearchResultsView.js"),l=n("./src/mobile.startup/watchstar/WatchstarPageList.js");function c(e){var t=o(e.placeholderMsg,e.action||mw.config.get("wgScript"),function(e){this.performSearch(e)}.bind(this)),n=s.extend(!0,{headerChrome:!0,isBorderBox:!1,className:"overlay search-overlay",headers:[t],events:{"click .search-content":"onClickSearchContent","click .overlay-content":"onClickOverlayContent","click .overlay-content > div":function(e){e.stopPropagation()},"touchstart .results":"hideKeyboardOnScroll","mousedown .results":"hideKeyboardOnScroll","click .results a":"onClickResult"}},e);this.header=t,r.call(this,n),this.api=n.api,this.gateway=n.gateway||new n.gatewayClass(this.api),this.router=n.router}i(c,r,{onClickSearchContent:function(){var e=s.getDocument().find("body"),t=this.$el.find("form");this.parseHTML("<input>").attr({type:"hidden",name:"fulltext",value:"search"}).appendTo(t),setTimeout((function(){t.appendTo(e),t.trigger("submit")}),0)},onClickOverlayContent:function(){this.$el.find(".cancel").trigger("click")},hideKeyboardOnScroll:function(){this.$input.trigger("blur")},onClickResult:function(e){var t=this.$el.find(e.currentTarget),n=t.closest("li");this.emit("search-result-click",{result:n,resultIndex:this.$results.index(n),originalEvent:e}),e.preventDefault(),this.router.back().then((function(){window.location.href=t.attr("href")}))},postRender:function(){var e,t=this,n=new a({searchContentLabel:mw.msg("mobile-frontend-search-content"),noResultsMsg:mw.msg("mobile-frontend-search-no-results"),searchContentNoResultsMsg:mw.message("mobile-frontend-search-content-no-results").parse()});function i(){t.$spinner.hide(),clearTimeout(e)}this.$el.find(".overlay-content").append(n.$el),r.prototype.postRender.call(this),this.$input=this.$el.find(this.header).find("input"),this.$searchContent=n.$el.hide(),this.$resultContainer=n.$el.find(".results-list-container"),this.$spinner=n.$el.find(".spinner-container"),this.on("search-start",(function(n){e&&i(),e=setTimeout((function(){t.$spinner.show()}),2e3-n.delay)})),this.on("search-results",i)},showKeyboard:function(){var e=this.$input.val().length;this.$input.trigger("focus"),this.$input[0].setSelectionRange&&this.$input[0].setSelectionRange(e,e)},show:function(){r.prototype.show.apply(this,arguments),this.showKeyboard(),this.emit("search-show")},performSearch:function(e){var t=this,n=this.api,i=this.gateway.isCached(e)?0:300;e!==this.lastQuery&&(t._pendingQuery&&t._pendingQuery.abort(),clearTimeout(this.timer),e.length?this.timer=setTimeout((function(){var r;t.emit("search-start",{query:e,delay:i}),r=t.gateway.search(e),t._pendingQuery=r.then((function(e){e&&e.query===t.$input.val()&&(t.$el.toggleClass("no-results",0===e.results.length),t.$searchContent.show().find("p").hide().filter(e.results.length?".with-results":".without-results").show(),new l({api:n,funnel:"search",pages:e.results,el:t.$resultContainer}),t.$results=t.$resultContainer.find("li"),t.emit("search-results",{results:e.results}))})).promise({abort:function(){r.abort()}})}),i):t.resetSearch(),this.lastQuery=e)},resetSearch:function(){this.$el.find(".overlay-content").children().hide()}}),e.exports=c},"./src/mobile.startup/search/SearchResultsView.js":function(e,t,n){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e,t,n){return(o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=u(e);if(t){var r=u(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return c(this,n)}}function c(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var d=n("./src/mobile.startup/View.js"),h=n("./src/mobile.startup/Icon.js"),p=n("./src/mobile.startup/Anchor.js"),f=n("./src/mobile.startup/icons.js").spinner().$el,m=n("./src/mobile.startup/util.js"),g=function(e){"use strict";!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(d,e);var t,n,i,c=l(d);function d(){return r(this,d),c.apply(this,arguments)}return t=d,(n=[{key:"isTemplateMode",get:function(){return!0}},{key:"template",get:function(){return m.template('\n<div class="search-results-view">\n\t<div class="search-content overlay-header">\n\t\t<ul>\n\t\t\t<li>{{! search content icon goes here }}</li>\n\t\t</ul>\n\t\t<div class="caption">\n\t\t\t<p class="with-results">{{searchContentLabel}}</p>\n\t\t\t<p class="without-results">{{noResultsMsg}}</p>\n\t\t\t<p class="without-results">{{{searchContentNoResultsMsg}}}</p>\n\t\t</div>\n\t</div>\n\t<div class="spinner-container position-fixed"></div>\n\t<div class="results">\n\t\t<div class="results-list-container"></div>\n\t\t{{#feedback}}\n\t\t\t<div class="search-feedback">\n\t\t\t\t{{prompt}}\n\t\t\t</div>\n\t\t{{/feedback}}\n\t</div>\n</div>')}},{key:"preRender",value:function(){mw.config.get("wgCirrusSearchFeedbackLink")&&(this.options.feedback={prompt:mw.msg("mobile-frontend-search-feedback-prompt")})}},{key:"postRender",value:function(e){var t=mw.config.get("wgCirrusSearchFeedbackLink");o(u(d.prototype),"postRender",this).call(this,e),this.$el.find(".search-content li").append(new h({tagName:"a",href:"#",name:"articlesSearch",additionalClassNames:"mw-ui-icon-flush-left",label:mw.msg("mobile-frontend-search-content")}).$el),this.$el.find(".spinner-container").append(f),t&&this.$el.find(".search-feedback").append(new p({label:mw.msg("mobile-frontend-search-feedback-link-text"),href:t}).$el)}}])&&s(t.prototype,n),i&&s(t,i),d}(d);e.exports=g},"./src/mobile.startup/search/searchHeader.js":function(e,t,n){var i=n("./src/mobile.startup/headers.js").formHeader,r=n("./src/mobile.startup/search/SearchHeaderView.js"),s=n("./src/mobile.startup/icons.js");e.exports=function(e,t,n){return i(new r({placeholderMsg:e,action:t,onInput:n}),[s.cancel()],!1)}},"./src/mobile.startup/showOnPageReload.js":function(e,t){var n="mobileFrontend/toast";mw.requestIdleCallback((function(){var e=mw.storage.get(n);e&&(e=JSON.parse(e),mw.notify(e.content,e.options),mw.storage.remove(n))})),e.exports={showOnPageReload:function(e,t){mw.storage.get(n)?mw.log.warn("A pending toast message already exits. The page should have been reloaded by now."):mw.storage.set(n,JSON.stringify({content:e,options:t}))}}},"./src/mobile.startup/time.js":function(e,t,n){var i=["seconds","minutes","hours","days","months","years"],r=n("./src/mobile.startup/util.js"),s=[1,60,3600,86400,2592e3,31536e3];function o(e){for(var t=0;t<s.length&&e>s[t+1];)++t;return{value:Math.round(e/s[t]),unit:i[t]}}function a(e){return o(Math.round((new Date).getTime()/1e3)-e)}function l(e){return"seconds"===e.unit&&e.value<10}e.exports={getLastModifiedMessage:function(e,t,n,i){var s,o,c=[];return n=n||"unknown",l(s=a(e))?c.push("mobile-frontend-last-modified-with-user-just-now",n,t):c.push({seconds:"mobile-frontend-last-modified-with-user-seconds",minutes:"mobile-frontend-last-modified-with-user-minutes",hours:"mobile-frontend-last-modified-with-user-hours",days:"mobile-frontend-last-modified-with-user-days",months:"mobile-frontend-last-modified-with-user-months",years:"mobile-frontend-last-modified-with-user-years"}[s.unit],n,t,mw.language.convertNumber(s.value)),c.push(i||"#",mw.language.convertNumber(t?1:0),t?mw.util.getUrl("User:"+t):""),o=mw.message.apply(this,c).parse(),i?o:r.parseHTML("<div>").html(o).text()},getRegistrationMessage:function(e,t){var n,i=[];return t=t||"unknown",l(n=a(parseInt(e,10)))?i.push("mobile-frontend-joined-just-now",t):i.push({seconds:"mobile-frontend-joined-seconds",minutes:"mobile-frontend-joined-minutes",hours:"mobile-frontend-joined-hours",days:"mobile-frontend-joined-days",months:"mobile-frontend-joined-months",years:"mobile-frontend-joined-years"}[n.unit],t,mw.language.convertNumber(n.value)),mw.message.apply(this,i).parse()},timeAgo:o,getTimeAgoDelta:a,isNow:l,isRecent:function(e){return["seconds","minutes","hours"].indexOf(e.unit)>-1}}},"./src/mobile.startup/util.js":function(e,t){e.exports={saveButtonMessage:function(){return mw.config.get("wgEditSubmitButtonLabelPublish")?mw.msg("mobile-frontend-editor-publish"):mw.msg("mobile-frontend-editor-save")},Promise:{all:function(e){return $.when.apply($,e)}},escapeSelector:function(e){return $.escapeSelector(e)},grep:function(){return $.grep.apply($,arguments)},docReady:function(e){return $(e)},Deferred:function(){return $.Deferred()},getDocument:function(){return $(document.documentElement)},getWindow:function(){return $(window)},parseHTML:function(e,t){return t=t||document,$($.parseHTML(e,t))},isNumeric:function(){return $.isNumeric.apply($,arguments)},extend:function(){return $.extend.apply($,arguments)},escapeHash:function(e){return e.replace(/(:|\.)/g,"\\$1")},isModifiedEvent:function(e){return e.altKey||e.ctrlKey||e.metaKey||e.shiftKey},repeatEvent:function(e,t,n,i){return e.on(n,(function(e){return t.emit(n,e)}),i)},template:function(e){return{getSource:function(){return e},render:function(t,n){var i={};return Object.keys(n||{}).forEach((function(e){i[e]=n[e].getSource()})),Mustache.render(e.trim(),t,i)}}}}},"./src/mobile.startup/watchstar/WatchstarGateway.js":function(e,t,n){var i=n("./src/mobile.startup/util.js"),r=n("./src/mobile.startup/actionParams.js");function s(e){this.api=e}s.prototype={getStatuses:function(e,t){return i.Promise.all([this.getStatusesByID(e),this.getStatusesByTitle(t)]).then((function(){return i.extend.apply(i,arguments)}))},getStatusesByID:function(e){var t=this;return e.length?this.api.get({formatversion:2,action:"query",prop:"info",inprop:"watched",pageids:e}).then((function(e){return t._unmarshalGetResponse(e)})):i.Deferred().resolve({})},getStatusesByTitle:function(e){var t=this;return e.length?this.api.get(r({prop:"info",inprop:"watched",titles:e})).then((function(e){return t._unmarshalGetResponse(e)})):i.Deferred().resolve({})},postStatusesByTitle:function(e,t){var n={action:"watch",titles:e};return t||(n.unwatch=!t),this.api.postWithToken("watch",n)},_unmarshalGetResponse:function(e){return(e&&e.query&&e.query.pages||[]).reduce((function(e,t){return e[t.title]=t.watched,e}),{})}},e.exports=s},"./src/mobile.startup/watchstar/WatchstarPageList.js":function(e,t,n){var i=n("./src/mobile.startup/PageList.js"),r=n("./src/mobile.startup/watchstar/watchstar.js"),s=mw.user,o=n("./src/mobile.startup/util.js"),a=n("./src/mobile.startup/Page.js"),l=n("./src/mobile.startup/mfExtend.js"),c=n("./src/mobile.startup/watchstar/WatchstarGateway.js");function u(e){this.wsGateway=new c(e.api),i.apply(this,arguments)}l(u,i,{postRender:function(){var e,t,n=this,r=[],s=[];return i.prototype.postRender.apply(this),e=this.queryUnitializedItems(),t=this.parsePagesFromItems(e),Object.keys(t).forEach((function(e){var n=t[e];n&&"0"!==n?r.push(n):s.push(e)})),this.getPages(r,s).then((function(t){n.renderItems(e,t)}))},queryUnitializedItems:function(){return this.$el.find("li:not(.with-watchstar)")},getPages:function(e,t){return s.isAnon()?o.Deferred().resolve({}):this.wsGateway.getStatuses(e,t)},parsePagesFromItems:function(e){var t=this,n={};return e.each((function(e,i){var r=t.$el.find(i);n[r.attr("title")]=r.data("id")})),n},renderItems:function(e,t){var n=this;s.isAnon()||e.each((function(e,i){var r=n.$el.find(i),s=new a({sections:[],title:r.attr("title"),id:r.data("id")}),o=t[s.getTitle()];n._appendWatchstar(r,s,o),r.addClass("with-watchstar")}))},_appendWatchstar:function(e,t,n){r({isWatched:n,page:t}).appendTo(e)}}),e.exports=u},"./src/mobile.startup/watchstar/watchstar.js":function(e,t,n){var i=n("./src/mobile.startup/icons.js");e.exports=function(e){var t=e.isWatched,n=mw.loader.require("mediawiki.page.watch.ajax").watchstar,r=t?"unwatch":"watch",s={href:mw.Title.newFromText(e.page.title).getUrl({action:r})},o=i.watchIcon(s),a=i.watchedIcon(s),l=o.$el.attr("class"),c=a.$el.attr("class"),u=t?a:o;return n(u.$el,e.page.title,(function(e,t){e.attr("class",t?c:l)})),u}},"./src/mobile.talk.overlays/AddTopicForm.js":function(e,t,n){var i=n("./src/mobile.startup/mfExtend.js"),r=n("./src/mobile.startup/View.js"),s=n("./src/mobile.startup/util.js");function o(e){var t=new r({className:"panel"});return t.$el.append(e),t}function a(e){r.call(this,s.extend(e,{topicTitlePlaceHolder:mw.msg("mobile-frontend-talk-add-overlay-subject-placeholder"),topicContentPlaceHolder:mw.msg("mobile-frontend-talk-add-overlay-content-placeholder"),className:"add-topic-form",events:{"input .wikitext-editor, input":"onTextInput","change .wikitext-editor, input":"onTextInput"}}))}i(a,r,{postRender:function(){var e=this.options,t=e.disabled,n=s.parseHTML("<input>").attr({class:"mw-ui-input",type:"text",disabled:t,value:e.subject,placeholder:e.topicTitlePlaceHolder}),i=s.parseHTML("<textarea>").attr({class:"wikitext-editor mw-ui-input",cols:40,rows:10,disabled:t,placeholder:e.topicContentPlaceHolder}).val(e.body),a=[o(s.parseHTML("<p>").addClass("license").html(e.licenseMsg)),o(n),o(i)];this.$el.append(a.map((function(e){return e.$el}))),this.$subject=n,this.$messageBody=i,r.prototype.postRender.apply(this,arguments)},onTextInput:function(){this.options.onTextInput&&this.options.onTextInput(this.$subject.val().trim(),this.$messageBody.val().trim())}}),a.test={makePanel:o},e.exports=a},"./src/mobile.talk.overlays/TalkSectionAddOverlay.js":function(e,t,n){var i=n("./src/mobile.startup/mfExtend.js"),r=n("./src/mobile.startup/headers.js"),s=n("./src/mobile.startup/Overlay.js"),o=n("./src/mobile.startup/PageGateway.js"),a=n("./src/mobile.startup/util.js"),l=n("./src/mobile.talk.overlays/makeAddTopicForm.js");function c(e){this.editorApi=e.api,this.pageGateway=new o(e.api),s.call(this,a.extend(e,{className:"talk-overlay overlay",onBeforeExit:this.onBeforeExit.bind(this),events:{"click .save":"onSaveClick"}})),this.onSaveComplete=e.onSaveComplete,this.title=e.title,this.currentPageTitle=e.currentPageTitle,this._saveHit=!1}i(c,s,{preRender:function(){this.options.headers=[r.saveHeader(mw.msg("mobile-frontend-talk-add-overlay-submit"),"initial-header save-header"),r.savingHeader(mw.msg("mobile-frontend-talk-topic-wait"))]},postRender:function(){s.prototype.postRender.call(this);var e=l({subject:"",body:"",disabled:!1,licenseMsg:this.options.licenseMsg,onTextInput:this.onTextInput.bind(this)});this.showHidden(".initial-header"),this.$confirm=this.$el.find("button.save"),this.$el.find(".overlay-content").append(e.$el),this.$subject=e.$el.find("input"),this.$ta=e.$el.find(".wikitext-editor")},onBeforeExit:function(e){var t,n=mw.msg("mobile-frontend-editor-cancel-confirm");t=!this.$subject.val()&&!this.$ta.val(),(this._saveHit||t||window.confirm(n))&&e()},onTextInput:function(e,t){this.subject=e,this.body=t,clearTimeout(this.timer),this.timer=setTimeout(function(){t&&e?this.$confirm.prop("disabled",!1):this.$confirm.prop("disabled",!0)}.bind(this),250)},onSaveClick:function(){this.showHidden(".saving-header"),this.save().then(function(e){"ok"===e&&this.options.onSaveComplete&&this.onSaveComplete()}.bind(this),function(e){var t=mw.msg("mobile-frontend-talk-topic-error");switch(this.$confirm.prop("disabled",!1),e.details){case"protectedpage":t=mw.msg("mobile-frontend-talk-topic-error-protected");break;case"noedit":case"blocked":t=mw.msg("mobile-frontend-talk-topic-error-permission");break;case"spamdetected":t=mw.msg("mobile-frontend-talk-topic-error-spam");break;case"badtoken":t=mw.msg("mobile-frontend-talk-topic-error-badtoken");break;default:t=mw.msg("mobile-frontend-talk-topic-error")}mw.notify(t,{type:"error"}),this.showHidden(".save-header, .save-panel")}.bind(this))},save:function(){var e=this.subject,t=a.Deferred();return this.$ta.removeClass("error"),this.$subject.removeClass("error"),this._saveHit=!0,this.$el.find(".content").empty().addClass("loading"),this.editorApi.postWithToken("csrf",{action:"edit",section:"new",sectiontitle:e,title:this.title,summary:mw.msg("newsectionsummary",e),text:this.body}).then((function(){return"ok"}),(function(e){return t.reject({type:"error",details:e})}))}}),e.exports=c},"./src/mobile.talk.overlays/TalkSectionOverlay.js":function(e,t,n){var i=mw.user,r=n("./src/mobile.startup/icons.js"),s=r.spinner().$el,o=n("./src/mobile.startup/mfExtend.js"),a=n("./src/mobile.startup/Overlay.js"),l=n("./src/mobile.startup/headers.js").header,c=n("./src/mobile.startup/util.js"),u=n("./src/mobile.talk.overlays/autosign.js"),d=n("./src/mobile.startup/Button.js"),h=n("./src/mobile.startup/lazyImages/lazyImageLoader.js");function p(e){var t=this.onBeforeExit.bind(this);this.editorApi=e.api,this.state={text:""},a.call(this,c.extend(!0,e,{className:"talk-overlay overlay",onBeforeExit:t,events:{click:function(e){"BUTTON"===e.target.tagName&&-1===e.target.className.indexOf("save-button")&&t((function(){}),(function(){e.preventDefault()}))},"input textarea":"onInputTextarea","click .save-button":"onSaveClick"}}))}o(p,a,{templatePartials:c.extend({},a.prototype.templatePartials,{content:c.template('\n<div class="content talk-section mw-parser-output">\n\t{{{section.text}}}\n\t<div class="comment">\n\t\t<div class="list-header">{{reply}}</div>\n\t\t<div class="comment-content">\n\t\t\t<textarea class="wikitext-editor"></textarea>\n\t\t\t<p class="license">\n\t\t\t\t{{info}}\n\t\t\t\t{{{licenseMsg}}}\n\t\t\t</p>\n\t\t</div>\n\t</div>\n</div>\n\t\t')}),defaults:c.extend({},a.prototype.defaults,{saveButton:new d({block:!0,tagName:"button",disabled:!0,additionalClassNames:"save-button",progressive:!0,label:c.saveButtonMessage()}),title:void 0,section:void 0,reply:mw.msg("mobile-frontend-talk-reply"),info:mw.msg("mobile-frontend-talk-reply-info")}),onInputTextarea:function(e){var t=e.target.value;this.state.text=t,t?this.$saveButton.prop("disabled",!1):this.$saveButton.prop("disabled",!0)},onBeforeExit:function(e,t){var n=mw.msg("mobile-frontend-editor-cancel-confirm");!this.state.text||window.confirm(n)?e():t()},preRender:function(){var e=this.options;this.options.headers=[l(e.section?e.section.line:"",[],r.back(),"initial-header")]},postRender:function(){h.loadImages(h.queryPlaceholders(this.$el[0])),a.prototype.postRender.apply(this),this.$el.find(".talk-section").prepend(s),this.$saveButton=this.options.saveButton.$el,this.$el.find(".comment-content").append(this.$saveButton),this.hideSpinner(),this._enableComments()},_enableComments:function(){this.$commentBox=this.$el.find(".comment"),i.isAnon()?this.$commentBox.remove():this.$textarea=this.$commentBox.find("textarea")},onSaveClick:function(){var e=this.state.text,t=this;e&&(this.showSpinner(),this.$saveButton.prop("disabled",!0),e="\n\n"+u(e),this.editorApi.postWithToken("csrf",{action:"edit",title:this.options.title,section:this.options.id,appendtext:e,redirect:!0}).then((function(){t.options.onSaveComplete&&t.options.onSaveComplete()}),(function(e,n){var i;i=n.error&&["readonly","blocked","autoblocked"].indexOf(n.error.code)>-1?n.error.info:mw.msg("mobile-frontend-editor-error"),t.hideSpinner(),mw.notify(i,{type:"error"}),t.$saveButton.prop("disabled",!1)})))}}),e.exports=p},"./src/mobile.talk.overlays/autosign.js":function(e,t){e.exports=function(e){return/~{3,5}/.test(e)?e:e+" ~~~~"}},"./src/mobile.talk.overlays/makeAddTopicForm.js":function(e,t,n){var i=n("./src/mobile.talk.overlays/AddTopicForm.js"),r=n("./src/mobile.talk.overlays/autosign.js");e.exports=function(e){var t=e.licenseMsg,n=e.onTextInput,s=e.subject,o=e.body,a=e.disabled;return new i({licenseMsg:t,disabled:a,subject:s,body:o,onTextInput:n?function(e,t){t&&(t=r(t)),n.call(this,e,t)}:void 0})}},"./tests/node-qunit/mobile.categories.overlays/CategoryGateway.test.js":function(e,t,n){(function(e){var t,i,r,s=n("./tests/node-qunit/utils/jQuery.js"),o=n("./tests/node-qunit/utils/dom.js"),a=n("./tests/node-qunit/utils/mw.js"),l=n("./tests/node-qunit/utils/mustache.js"),c=n("./tests/node-qunit/utils/oo.js"),u=n("./node_modules/sinon/lib/sinon.js");QUnit.module("MobileFrontend CategoryGateway.js",{beforeEach:function(){r=u.sandbox.create(),o.setUp(r,e),s.setUp(r,e),c.setUp(r,e),a.setUp(r,e),l.setUp(r,e),t=n("./src/mobile.startup/util.js"),i=n("./src/mobile.categories.overlays/CategoryGateway.js"),this.getSpy={get:r.stub().returns(t.Deferred().resolve({batchcomplete:!0,query:{pages:[{pageid:5,ns:0,title:"HelloWorld",categories:[{ns:14,title:"Category:Hello"}]}]}}))},this.postSpy={postWithToken:r.stub().returns(t.Deferred().resolve())}},afterEach:function(){s.tearDown(),r.restore()}}),QUnit.test("getCategories()",(function(e){var t=this,n=new i(this.getSpy),r=n.getCategories("HelloWorld");return e.notStrictEqual(r,!1,"result should not return false"),r.then((function(){e.strictEqual(n.canContinue,!1,"gateway should not continue"),e.ok(t.getSpy.get.calledWith({action:"query",prop:"categories",titles:"HelloWorld",clprop:"hidden",cllimit:50,formatversion:2}),"invalid data passed to get api request")}))})),QUnit.test("save()",(function(e){var t=this,n=new i(this.postSpy);return n.save("HelloWorld","[[Category:World]]").then((function(){e.ok(t.postSpy.postWithToken.calledWith("csrf",{action:"edit",title:"HelloWorld",appendtext:"[[Category:World]]",summary:mw.msg("mobile-frontend-categories-summary")}),"invalid data passed to post api request")}))}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.editor.overlay/EditorGateway.test.js":function(e,t,n){(function(e){var t,i,r,s,o,a,l,c,u,d,h,p,f,m,g,b,v,w,y,k,j=n("./src/mobile.startup/util.js"),x={title:"test",action:"edit",errorformat:"html",errorlang:void 0,errorsuselocal:1,formatversion:2,summary:"summary",captchaid:void 0,captchaword:void 0},E={type:"image",mime:"image/png",id:"1852528679",url:"/w/index.php?title=Especial:Captcha/image&wpCaptchaId=1852528679"},T={error:{code:"readonly",info:"The wiki is currently in read-only mode.",readonlyreason:"This wiki is currently being upgraded to a newer software version."}},q=n("./tests/node-qunit/utils/jQuery.js"),S=n("./tests/node-qunit/utils/dom.js"),_=n("./node_modules/sinon/lib/sinon.js"),C=n("./tests/node-qunit/utils/oo.js"),A=n("./tests/node-qunit/utils/mw.js");QUnit.module("MobileFrontend mobile.editor.overlay/EditorGateway",{beforeEach:function(){t=_.sandbox.create(),S.setUp(t,e),q.setUp(t,e),C.setUp(t,e),A.setUp(t,e),i=n("./src/mobile.editor.overlay/EditorGateway.js"),k=j.Deferred().resolve({query:{pages:[{revisions:[{timestamp:"2013-05-15T00:30:26Z",content:"section"}]}]}}),a=new mw.Api,o=new mw.Api,l=new mw.Api,c=new mw.Api,u=new mw.Api,d=new mw.Api,h=new mw.Api,p=new mw.Api,f=new mw.Api,m=new mw.Api,g=new mw.Api,b=new mw.Api,y=new mw.Api,v=new mw.Api,w=new mw.Api,t.stub(c,"postWithToken").returns(j.Deferred().resolve({edit:{result:"Failure",captcha:E}})),r=t.stub(a,"get").returns(k),t.stub(o,"get").returns(k),t.stub(y,"get").returns(k),t.stub(b,"get").returns(k),t.stub(v,"get").returns(k),t.stub(u,"get").returns(k),t.stub(h,"get").returns(k),t.stub(p,"get").returns(k),t.stub(m,"get").returns(k),t.stub(g,"get").returns(k),t.stub(f,"get").returns(k),t.stub(d,"get").returns(k),t.stub(c,"get").returns(k),t.stub(l,"get").returns(j.Deferred().resolve({error:{code:"rvnosuchsection"}})),t.stub(o,"postWithToken").returns(j.Deferred().resolve({error:{code:"error code"}})),t.stub(y,"postWithToken").returns(j.Deferred().reject()),s=t.stub(a,"postWithToken").returns(j.Deferred().resolve({edit:{result:"Success"}})),t.stub(v,"postWithToken").returns(j.Deferred().resolve({})),t.stub(b,"post").returns(j.Deferred().resolve({parse:{title:"test",text:{"*":"<h1>Heading 1</h1><h2>Heading 2</h2><p>test content</p>"},sections:{}}})),t.stub(w,"post").returns(j.Deferred().resolve({parse:{title:"test",text:{"*":"test content"},sections:{}}})),t.stub(g,"post").returns(j.Deferred().resolve({parse:{title:"test",text:{"*":"test content"},sections:{0:{line:"Test section",anchor:"Test_section"},1:{line:"Test section2",anchor:"Test_section2"}}}})),t.stub(m,"postWithToken").onFirstCall().returns(j.Deferred().resolve({edit:{result:"Success"}})),t.stub(d,"postWithToken").returns(j.Deferred().resolve({edit:{code:"abusefilter-warning-usuwanie-tekstu",info:"Hit AbuseFilter: Usuwanie dużej ilości tekstu",warning:"horrible desktop-formatted message",result:"Failure"}})),t.stub(u,"postWithToken").returns(j.Deferred().resolve({edit:{code:"abusefilter-disallow",info:"Scary filter",warning:"horrible desktop-formatted message",result:"Failure"}})),t.stub(h,"postWithToken").returns(j.Deferred().resolve({edit:{code:"abusefilter-something",info:"Scary filter",warning:"horrible desktop-formatted message",result:"Failure"}})),t.stub(p,"postWithToken").returns(j.Deferred().resolve({edit:{code:"testerror",result:"Failure"}})),t.stub(f,"postWithToken").returns(j.Deferred().reject("readonly",T))},afterEach:function(){q.tearDown(),t.restore()}}),QUnit.test("#getContent (no section)",(function(e){return new i({api:a,title:"MediaWiki:Test.css"}).getContent().then((function(){e.ok(r.calledWith({action:"query",prop:["revisions","info"],rvprop:["content","timestamp"],titles:"MediaWiki:Test.css",intestactions:"edit",intestactionsdetail:"full",formatversion:2}),"rvsection not passed to api request")}))})),QUnit.test("#getContent",(function(e){var t=new i({api:a,title:"test",sectionId:"1"});return t.getContent().then((function(n){return e.strictEqual(n.text,"section","return section content"),e.strictEqual(n.blockinfo,null),t.getContent()})).then((function(){e.strictEqual(r.callCount,1,"cache content")}))})),QUnit.test("#getContent, new page",(function(e){return new i({api:a,title:"test",isNewPage:!0}).getContent().then((function(t){e.strictEqual(t.text,"","return empty section"),e.strictEqual(t.blockinfo,void 0),e.notOk(r.called,"don't try to retrieve content using API")}))})),QUnit.test("#getContent, missing section",(function(e){var t=new i({api:l,title:"test",sectionId:"1"});e.rejects(t.getContent(),/^rvnosuchsection$/,"return error code")})),QUnit.test("#getBlockInfo",(function(e){var t=new i({api:a,title:"test"}),n={blockedby:"Test"},r={revisions:[{}],actions:{edit:[{code:"blocked",data:{blockinfo:n}}]}};e.strictEqual(n,t.getBlockInfo(r))})),QUnit.test("#save, success",(function(e){var t=new i({api:a,title:"test",sectionId:"1"});return t.getContent().then((function(){return t.setContent("section 1"),e.strictEqual(t.hasChanged,!0,"hasChanged is true"),t.save({summary:"summary"})})).then((function(){e.strictEqual(t.hasChanged,!1,"reset hasChanged"),e.strictEqual(s.calledWithMatch("csrf",j.extend({},x,{section:"1",text:"section 1",basetimestamp:"2013-05-15T00:30:26Z",starttimestamp:"2013-05-15T00:30:26Z"})),!0,"save first section")}))})),QUnit.test("#save, new page",(function(e){var t=new i({api:a,title:"Talk:test",isNewPage:!0});return t.getContent(),t.setContent("section 0"),t.save({summary:"summary"}).then((function(){e.strictEqual(t.hasChanged,!1,"reset hasChanged"),e.ok(s.calledWithMatch("csrf",j.extend({},x,{title:"Talk:test",text:"section 0",summary:"summary",captchaid:void 0,captchaword:void 0,basetimestamp:void 0,starttimestamp:void 0})),"save lead section")}))})),QUnit.test("#save, after #setPrependText",(function(e){var t=new i({api:a,title:"test"});return t.setPrependText("abc"),t.save({summary:"summary"}).then((function(){e.strictEqual(t.hasChanged,!1,"reset hasChanged"),e.ok(s.calledWithMatch("csrf",j.extend({},x,{prependtext:"abc"})),"prepend text")}))})),QUnit.test("#save, submit CAPTCHA",(function(e){var t=new i({api:a,title:"test",sectionId:"1"});return t.getContent().then((function(){t.setContent("section 1")})).then((function(){return t.save({summary:"summary",captchaId:123,captchaWord:"abc"})})).then((function(){e.strictEqual(t.hasChanged,!1,"reset hasChanged"),e.ok(s.calledWithMatch("csrf",j.extend({},x,{section:"1",text:"section 1",captchaid:123,captchaword:"abc",basetimestamp:"2013-05-15T00:30:26Z",starttimestamp:"2013-05-15T00:30:26Z"})),"save first section")}))})),QUnit.test("#save, request failure",(function(e){var t=new i({api:y,title:"test",sectionId:"1"});return t.getContent().then((function(){t.setContent("section 1"),e.rejects(t.save(),(function(t){return e.propEqual(t,{},"called with correct arguments"),!0}),"call fail")}))})),QUnit.test("#save, API failure",(function(e){var t=new i({api:o,title:"test",sectionId:"1"});return t.getContent().then((function(){t.setContent("section 1"),e.rejects(t.save(),(function(t){return e.propEqual(t,{error:{code:"error code"}},"called with correct arguments"),!0}),"call fail")}))})),QUnit.test("#save, CAPTCHA response with image URL",(function(e){var t=new i({api:c,title:"test",sectionId:"1"});return t.getContent().then((function(){t.setContent("section 1"),e.rejects(t.save(),(function(t){return e.propEqual(t,{edit:{result:"Failure",captcha:{type:"image",mime:"image/png",id:"1852528679",url:"/w/index.php?title=Especial:Captcha/image&wpCaptchaId=1852528679"}}},"called with correct arguments"),!0}),"call fail")}))})),QUnit.test("#save, AbuseFilter warning",(function(e){var t=new i({api:d,title:"test",sectionId:"1"});return t.getContent().then((function(){t.setContent("section 1"),e.rejects(t.save(),(function(t){return e.propEqual(t,{edit:{code:"abusefilter-warning-usuwanie-tekstu",info:"Hit AbuseFilter: Usuwanie dużej ilości tekstu",warning:"horrible desktop-formatted message",result:"Failure"}},"called with correct arguments"),!0}),"call fail")}))})),QUnit.test("#save, AbuseFilter disallow",(function(e){var t=new i({api:u,title:"test",sectionId:"1"});return t.getContent().then((function(){t.setContent("section 1"),e.rejects(t.save(),(function(t){return e.propEqual(t,{edit:{code:"abusefilter-disallow",info:"Scary filter",warning:"horrible desktop-formatted message",result:"Failure"}},"called with correct arguments"),!0}),"call fail")}))})),QUnit.test("#save, AbuseFilter other",(function(e){var t=new i({api:h,title:"test",sectionId:"1"});return t.getContent().then((function(){t.setContent("section 1"),e.rejects(t.save(),(function(t){return e.propEqual(t,{edit:{code:"abusefilter-something",info:"Scary filter",warning:"horrible desktop-formatted message",result:"Failure"}},"called with correct arguments"),!0}),"call fail")}))})),QUnit.test("#save, extension errors",(function(e){var t=new i({api:p,title:"test",sectionId:"1"});return t.getContent().then((function(){t.setContent("section 1"),e.rejects(t.save(),(function(t){return e.propEqual(t,{edit:{code:"testerror",result:"Failure"}},"called with correct arguments"),!0}),"call fail")}))})),QUnit.test("#save, read-only error",(function(e){var n=new i({api:f,title:"test",sectionId:"1"}),r=t.spy(),s=t.spy(),o=e.async(),a={error:{code:"readonly",info:"The wiki is currently in read-only mode.",readonlyreason:"This wiki is currently being upgraded to a newer software version."}};n.getContent().then((function(){return n.setContent("section 1"),n.save()})).then(r,s).then((function(){e.strictEqual(s.calledWith(a),!0),e.strictEqual(r.called,!1,"don't call resolve"),o()}))})),QUnit.test("#save, unknown errors",(function(e){var t=new i({api:v,title:"test",sectionId:"1"});return t.getContent().then((function(){t.setContent("section 1"),e.rejects(t.save(),(function(t){return e.propEqual(t,{},"called with correct arguments"),!0}),"call fail")}))})),QUnit.test("#save, without changes",(function(e){var t=new i({api:a,title:"test",sectionId:"1"});return t.getContent().then((function(){return t.setContent("section")})).then((function(){return e.strictEqual(t.hasChanged,!1,"hasChanged is false"),t.save({summary:"summary"})})).then((function(){e.ok(a.postWithToken.calledWithMatch("csrf",j.extend({},x,{section:"1",text:"section",basetimestamp:"2013-05-15T00:30:26Z",starttimestamp:"2013-05-15T00:30:26Z"})),"save first section")}))})),QUnit.test("#EditorGateway",(function(e){var n=new i({api:b,title:"Test",sectionId:"1"}),r=t.spy();return n.getPreview({text:"test content"}).then(r).then((function(){e.ok(b.post.calledWithMatch({text:"test content"})),e.ok(r.calledWith({line:"",id:"",text:"<h1>Heading 1</h1><h2>Heading 2</h2><p>test content</p>"}))}))})),QUnit.test("#EditorGateway, check without sectionLine",(function(e){return new i({api:w,title:"Test",sectionId:"1"}).getPreview({text:"test content"}).then((function(t){e.strictEqual(t.line,"","Ok, no section line returned")}))})),QUnit.test("#EditorGateway, check with sectionLine",(function(e){return new i({api:g,title:"Test",sectionId:"1"}).getPreview({text:"test content"}).then((function(t){e.strictEqual(t.line,"Test section","Ok, section line returned"),e.strictEqual(t.id,"Test_section","Ok, section ID returned")}))})),QUnit.test("#save, when token has expired",(function(e){var t=new i({api:m,title:"MediaWiki:Test.css"});return t.getContent().then((function(){return t.setContent("section 1"),t.save().then((function(){e.strictEqual(m.postWithToken.callCount,1,"check the spy was called twice")}))}))}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.editor.overlay/SourceEditorOverlay.test.js":function(e,t,n){(function(e){var t,i,r,s,o,a,l,c=n("./tests/node-qunit/utils/jQuery.js"),u=n("./node_modules/sinon/lib/sinon.js"),d=n("./src/mobile.startup/util.js"),h=n("./tests/node-qunit/utils/oo.js"),p=n("./tests/node-qunit/utils/dom.js"),f=n("./tests/node-qunit/utils/mw.js"),m=n("./tests/node-qunit/utils/mustache.js");QUnit.module("MobileFrontend mobile.editor.overlay/SourceEditorOverlay",{beforeEach:function(){t=u.sandbox.create(),p.setUp(t,e),c.setUp(t,e),f.setUp(t,e),m.setUp(t,e),h.setUp(t,e),t.stub(mw,"msg").withArgs("mobile-frontend-editor-continue").returns("Continue").withArgs("mobile-frontend-editor-save").returns("Save").withArgs("mobile-frontend-editor-publish").returns("Publish"),a=n("./src/mobile.editor.overlay/EditorGateway.js"),l=n("./src/mobile.editor.overlay/SourceEditorOverlay.js"),o=n("./src/mobile.editor.overlay/BlockMessageDetails.js"),t.stub(l.prototype,"log").returns(d.Deferred().resolve()),i=t.stub(o.prototype,"initialize"),r=t.stub(a.prototype,"getContent"),t.stub(mw.loader,"using").withArgs("moment").returns(d.Deferred().resolve()),t.stub(mw,"confirmCloseWindow").returns({release:function(){}}),t.stub(window,"scrollTo"),t.stub(mw.util,"getUrl").returns("/w/index.php?title=User:Test"),t.stub(mw.config,"get").withArgs("wgFormattedNamespaces").returns({2:"User"}).withArgs("wgNamespaceIds").returns({user:2}),t.stub(mw.Title,"makeTitle").returns({getUrl:function(){return"/w/index.php?title=User:Test"}}),r.returns(d.Deferred().resolve({text:"section 0",blockinfo:null})),s=d.Deferred().resolve({text:"\npreviewtest"}),t.stub(a.prototype,"getPreview").returns(s)},afterEach:function(){c.tearDown(),t.restore()}}),QUnit.test("#initialize, blocked user",(function(e){var n=d.Deferred().resolve({text:"section 0",blockinfo:{blockedby:"Test",blockexpiry:"infinity",blockreason:"Testreason"}}),r=e.async();t.stub(mw.Api.prototype,"get").returns(d.Deferred().resolve({parse:{text:"Testreason"}})),new l({title:"test.css"},n).getLoadingPromise().then((function(){}),(function(){r(),e.ok(i.calledWithMatch({partial:!1,creator:{name:"Test",url:"/w/index.php?title=User:Test"},expiry:null,duration:null,reason:"Testreason"}),"There is a drawer notice, that i am blocked from editing")}))})),QUnit.test("#initialize, with given page and section",(function(e){var t=new l({title:"test",sectionId:"0"});return e.strictEqual(t.gateway.title,"test"),e.strictEqual(t.gateway.isNewPage,void 0),e.strictEqual(t.gateway.oldId,void 0),e.strictEqual(t.gateway.sectionId,"0"),t.getLoadingPromise().then((function(){e.strictEqual(t.$content.val(),"section 0","load correct section")}))})),QUnit.test("#initialize, without a section",(function(e){var t=new l({title:"test.css"});return r().then((function(){e.strictEqual(t.gateway.title,"test.css"),e.strictEqual(t.gateway.isNewPage,void 0),e.strictEqual(t.gateway.oldId,void 0),e.strictEqual(t.gateway.sectionId,void 0)}))})),QUnit.test("#preview",(function(e){var t=new l({title:"test",sectionId:"0"});return t.onStageChanges(),s.then((function(){e.strictEqual(t.$preview.text(),"\n\npreviewtest","preview loaded correctly")}))})),QUnit.test("#initialize, as anonymous",(function(e){var t=new l({title:"Main_page",isAnon:!0});return r().then((function(){e.ok(t.$anonWarning.length>0,"Editorwarning (IP will be saved) visible."),e.ok(t.$el.find(".anonymous").length>0,"Continue login has a second class.")}))}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.editor.overlay/identifyLeadParagraph.test.js":function(e,t,n){(function(e){function t(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],i=!0,r=!1,s=void 0;try{for(var o,a=e[Symbol.iterator]();!(i=(o=a.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(e){r=!0,s=e}finally{try{i||null==a.return||a.return()}finally{if(r)throw s}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var r,s,o=n("./tests/node-qunit/utils/jQuery.js"),a=n("./tests/node-qunit/utils/dom.js"),l=n("./node_modules/sinon/lib/sinon.js");QUnit.module("MobileFrontend mobile.editor.overlay/identifyLeadParagraph",{beforeEach:function(){r=l.sandbox.create(),a.setUp(r,e),o.setUp(r,e),s=n("./src/mobile.editor.overlay/identifyLeadParagraph.js")},afterEach:function(){o.tearDown(),r.restore()}}),QUnit.test("identifyLeadParagraph",(function(e){for(var n,i,r,o,a,l,c=(i='<span id="coordinates"><span>0;0</span></span>',r='<div class="mw-stack">'.concat(n='<table class="infobox">1</table>',"</div>"),o='<div class="mw-stack">Empty</div>',a='<div class="mw-stack">'.concat(n).concat('<table class="infobox">2</table>',"</div>"),l='<p><b>First paragraph</b> <span> with info that links to a \n <a href="">Page</a></span> and some more content</p>',[["".concat('<table class="collapsible"><table class="mf-test-infobox"></table></table>',"<p>one</p>"),"p","Collapsible mf-infoboxes are not moved."],["".concat('<table class="collapsible"><table class="infobox"></table></table>',"<p>one</p>"),"p","Collapsible infoboxes are moved."],['<div><table class="mf-infobox"></table></div><p>one</p>',"p"],["".concat(n).concat(l),"p"],["".concat("<p></p>").concat("<p></p>").concat(n).concat(l),"p:last-of-type","Empty paragraphs are ignored"],["".concat('<p class="someParagraphClass">  \t\n<span> \t\r\n</span></p>').concat(n).concat(l),"p:last-of-type","T199282: lead paragraph should move when there is empty paragraph before infobox"],["".concat(n).concat('<p class="someParagraphClass">  \t\n<span> \t\r\n</span></p>'),null,"T199282: the empty paragraph should not be treated as lead paragraph"],["".concat(l).concat("<p></p>").concat(n).concat(l),"p:first-of-type","T188825: Infobox has to be first non-empty element"],["".concat(r).concat(l),"p","T170006: If the infobox is wrapped in a known container it can be moved"],["".concat(o).concat(l),"p","T170006: However if no infobox inside don't move."],["".concat(n).concat(o).concat(l),"p","T170006: When a stack and an infobox, ignore mw-stack"],["".concat(a).concat(l),"p","T170006: Multiple infoboxes will also be moved"],["".concat(n,"<p>").concat(i,"</p><p>First paragraph</p>"),"p:last-of-type","Paragraph with just coordinates in it is ignored"],["".concat(n,"<p>First paragraph with ").concat(i,"</p><p>Second paragraph</p>"),"p:first-of-type","Paragraph with coordinates in it is still the first paragraph"],["".concat(n,"<p><span>foo</span>").concat(i,"</p><p>Second paragraph</p>"),"p:first-of-type","Paragraph with non-empty nested child and coordinates in it is still the first paragraph"],["".concat(n,"<p>Lead <span>").concat(i,"</span> para</p><p>Not lead</p>"),"p:first-of-type","Paragraph with nested coordinates is still the first paragraph"]]),u=0;u<c.length;u++){var d=t(c[u],3),h=d[0],p=d[1],f=d[2],m=$("<section>").html(h),g=p?m.find(p)[0]:null;e.strictEqual(g,s(m),f)}}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.editor.overlay/parseBlockInfo.test.js":function(e,t,n){(function(e){var t,i,r,s,o=n("./node_modules/sinon/lib/sinon.js"),a=n("./tests/node-qunit/utils/dom.js"),l=n("./tests/node-qunit/utils/mw.js");QUnit.module("MobileFrontend mobile.editor.overlay/parseBlockInfo",{beforeEach:function(){t=o.sandbox.create(),l.setUp(t,e),a.setUp(t,e),e.window.moment=function(e){return{to:function(e){return e},format:function(e){return"LL"===e?"30 June 2020, 12:00 AM":"3 September 2020"},diff:function(){return"2020-06-30"===e?86900:4}}},t.stub(e.mw,"message").callsFake((function(e,t){return{escaped:function(){return"(".concat(e,": ").concat(t,")")}}})),s=n("./src/mobile.editor.overlay/parseBlockInfo.js"),r={blockid:123,blockedbyid:0}},afterEach:function(){t.restore()}}),QUnit.test("blockInfo",(function(e){r.blockexpiry="2020-06-30",i=new s(r),e.strictEqual(i.expiry,"(parentheses: 30 June 2020, 12:00 AM)","Short blocks should have date and time in expiry message")})),QUnit.test("blockInfo2",(function(e){r.blockexpiry="2020-09-03",i=new s(r),e.strictEqual(i.expiry,"(parentheses: 3 September 2020)","Long blocks should have only date in expiry message")}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.init/editorLoadingOverlay.test.js":function(e,t,n){(function(e){var t,i,r,s,o,a=n("./node_modules/sinon/lib/sinon.js"),l=n("./tests/node-qunit/utils/dom.js"),c=n("./tests/node-qunit/utils/jQuery.js"),u=n("./tests/node-qunit/utils/oo.js"),d=n("./tests/node-qunit/utils/mw.js"),h=n("./tests/node-qunit/utils/mustache.js");QUnit.module("MobileFrontend editorLoadingOverlay.js",{beforeEach:function(){r=a.sandbox.create(),l.setUp(r,e),c.setUp(r,e),u.setUp(r,e),d.setUp(r,e),h.setUp(r,e),r.stub(e.window,"scrollTo"),t=n("./src/mobile.init/editorLoadingOverlay.js"),i=n("./src/mobile.startup/OverlayManager.js"),(s=new OO.EventEmitter).getPath=r.stub().returns(""),s.back=r.spy(),r.stub(mw.loader,"require").withArgs("mediawiki.router").returns(s),o=new i(s,document.body)},afterEach:function(){c.tearDown(),r.restore()}}),QUnit.test("editorLoadingOverlay calls the callbacks",(function(e){var n=r.spy(),i=r.spy(),a=t(n,i);o.add(/^test$/,(function(){return a})),s.emit("route",{path:"test"}),e.strictEqual(n.callCount,1,"afterShow called"),e.strictEqual(i.callCount,0,"afterHide not called yet"),s.emit("route",{path:""}),e.strictEqual(n.callCount,1,"afterShow called only once"),e.strictEqual(i.callCount,1,"afterHide called")}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.languages.structured/LanguageSearcher.test.js":function(e,t,n){(function(e){var t,i,r=n("./tests/node-qunit/utils/jQuery.js"),s=n("./tests/node-qunit/utils/dom.js"),o=n("./tests/node-qunit/utils/mw.js"),a=n("./tests/node-qunit/utils/mustache.js"),l=n("./tests/node-qunit/utils/oo.js"),c=n("./node_modules/sinon/lib/sinon.js"),u=[{lang:"ar",url:"https://ar.wikipedia.org/wiki/%D8%A8%D8%A7%D8%B1%D8%A7%D9%83_%D8%A3%D9%88%D8%A8%D8%A7%D9%85%D8%A7",title:"باراك أوباما",autonym:"العربية"},{lang:"be",url:"https://be.wikipedia.org/wiki/%D0%91%D0%B0%D1%80%D0%B0%D0%BA_%D0%90%D0%B1%D0%B0%D0%BC%D0%B0",title:"Барак Абама",autonym:"беларуская"},{lang:"be-x-old",url:"https://be-x-old.wikipedia.org/wiki/%D0%91%D0%B0%D1%80%D0%B0%D0%BA_%D0%90%D0%B1%D0%B0%D0%BC%D0%B0",title:"Барак Абама",autonym:"беларуская (тарашкевіца)"},{lang:"ko",url:"https://ko.wikipedia.org/wiki/%EB%B2%84%EB%9D%BD_%EC%98%A4%EB%B0%94%EB%A7%88",title:"버락 오바마",autonym:"한국어"},{lang:"ru",url:"https://ru.wikipedia.org/wiki/%D0%9E%D0%B1%D0%B0%D0%BC%D0%B0,_%D0%91%D0%B0%D1%80%D0%B0%D0%BA",title:"Обама, Барак",autonym:"русский"},{lang:"uz",url:"https://uz.wikipedia.org/wiki/Barak_Obama",title:"Barak Obama",autonym:"oʻzbekcha/ўзбекча"},{lang:"zh",url:"https://zh.wikipedia.org/wiki/%E8%B4%9D%E6%8B%89%E5%85%8B%C2%B7%E5%A5%A5%E5%B7%B4%E9%A9%AC",title:"贝拉克·奥巴马",autonym:"中文"},{lang:"zh-min-nan",url:"https://zh-min-nan.wikipedia.org/wiki/Barack_Obama",title:"Barack Obama",langname:"Chinese",autonym:"Bân-lâm-gú"},{lang:"zh-yue",url:"https://zh-yue.wikipedia.org/wiki/%E5%A5%A7%E5%B7%B4%E9%A6%AC",title:"奧巴馬",autonym:"粵語"},{lang:"zu",url:"https://zu.wikipedia.org/wiki/Barack_Obama",title:"Barack Obama",autonym:"isiZulu"}],d=[{lang:"foo",url:"/w/index.php?title=Barack_Obama&variant=foo",autonym:"Foo"},{lang:"foo-x-piglatin",url:"/w/index.php?title=Barack_Obama&variant=foo-x-piglatin",autonym:"Igpay Atinlay"}],h={"zh-min-nan":1,zh:2,en:10,ko:1};function p(e,t){e.$el.find("input[type=search]").val(t).trigger("input")}QUnit.module("MobileFrontend LanguageSearcher.js",{beforeEach:function(){i=c.sandbox.create(),s.setUp(i,e),r.setUp(i,e),l.setUp(i,e),o.setUp(i,e),a.setUp(i,e),t=n("./src/mobile.languages.structured/LanguageSearcher.js"),i.stub(mw.storage,"get").withArgs("langMap").returns(JSON.stringify(h)),this.languageSearcher=new t({languages:u,variants:d,showSuggestedLanguages:!0,deviceLanguage:"en-us"})},afterEach:function(){r.tearDown(),i.restore()}}),QUnit.test("renders output",(function(e){e.strictEqual(this.languageSearcher.$el.find(".site-link-list.suggested-languages a").length,5,"There are 5 suggested languages including variants."),e.strictEqual(this.languageSearcher.$el.find(".site-link-list.all-languages a").length,7,"Seven languages are non-suggested.")})),QUnit.test("saves the language count when link is clicked",(function(e){var t=i.stub(mw.storage,"set");this.languageSearcher.$el.find("[lang=foo-x-piglatin]").trigger("click"),e.strictEqual(t.callCount,1,"mw.storage.set is called once"),e.deepEqual(t.getCall(0).args,["langMap",'{"zh-min-nan":1,"zh":2,"en":10,"ko":1,"foo-x-piglatin":1}'],"mw.storage.set is called with correct args")})),QUnit.test("without variants, input event filters languages",(function(e){var n=new t({languages:u,variants:!1,showSuggestedLanguages:!0,deviceLanguage:"en-us"});p(n,""),e.strictEqual(n.$el.find(".site-link-list a:not(.hidden)").length,10,"The search filter has been cleared. All 10 languages (including variants) are visible."),p(n,"abcdefghij"),e.strictEqual(n.$el.find(".site-link-list a:not(.hidden)").length,0,'No languages match "abcdefghij"'),p(n,"chin"),e.ok(1===n.$el.find(".site-link-list a:not(.hidden)").length&&n.$el.find(".site-link-list a:not(.hidden)").hasClass("zh-min-nan"),'One language (zh-min-nan) matches "Chin" (langname) and only that language is visible.')})),QUnit.test("with variants, input event filters languages",(function(e){p(this.languageSearcher,""),e.strictEqual(this.languageSearcher.$el.find(".site-link-list a:not(.hidden)").length,12,"The search filter has been cleared. All 12 languages (including variants) are visible."),p(this.languageSearcher,"abcdefghij"),e.strictEqual(this.languageSearcher.$el.find(".site-link-list a:not(.hidden)").length,0,'No languages match "abcdefghij"'),p(this.languageSearcher,"zh"),e.strictEqual(this.languageSearcher.$el.find(".site-link-list a:not(.hidden)").length,3,'Three languages match "zh" and only those languages are visible.'),p(this.languageSearcher,"ol"),e.ok(1===this.languageSearcher.$el.find(".site-link-list a:not(.hidden)").length&&this.languageSearcher.$el.find(".site-link-list a:not(.hidden)").hasClass("be-x-old"),'One language (be-x-old) matches "ol" and only that language is visible.'),p(this.languageSearcher,"chin"),e.ok(1===this.languageSearcher.$el.find(".site-link-list a:not(.hidden)").length&&this.languageSearcher.$el.find(".site-link-list a:not(.hidden)").hasClass("zh-min-nan"),'One language (zh-min-nan) matches "Chin" (langname) and only that language is visible.'),p(this.languageSearcher,"ўз"),e.strictEqual(this.languageSearcher.$el.find(".site-link-list a:not(.hidden)").length,1,'One language matches "ўз" and only that language is visible.'),p(this.languageSearcher,"foo"),e.strictEqual(this.languageSearcher.$el.find(".site-link-list a:not(.hidden)").length,2,'Two languages match "foo" and only those languages are visible.'),p(this.languageSearcher,"igpay"),e.strictEqual(this.languageSearcher.$el.find(".site-link-list a:not(.hidden)").length,1,'One language matches "igpay" and only that language is visible.')}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.languages.structured/util.test.js":function(e,t,n){(function(e){var t,i,r=n("./tests/node-qunit/utils/jQuery.js"),s=n("./tests/node-qunit/utils/dom.js"),o=n("./tests/node-qunit/utils/mw.js"),a=n("./node_modules/sinon/lib/sinon.js");QUnit.module("MobileFrontend mobile.languages.structured/util.test.js",{beforeEach:function(){this.apiLanguages=[{lang:"ar",url:"https://ar.wikipedia.org/wiki/%D8%A8%D8%A7%D8%B1%D8%A7%D9%83_%D8%A3%D9%88%D8%A8%D8%A7%D9%85%D8%A7",title:"باراك أوباما",dir:"rtl",autonym:"العربية"},{lang:"be",url:"https://be.wikipedia.org/wiki/%D0%91%D0%B0%D1%80%D0%B0%D0%BA_%D0%90%D0%B1%D0%B0%D0%BC%D0%B0",title:"Барак Абама",dir:"ltr",autonym:"беларуская"},{lang:"be-x-old",url:"https://be-x-old.wikipedia.org/wiki/%D0%91%D0%B0%D1%80%D0%B0%D0%BA_%D0%90%D0%B1%D0%B0%D0%BC%D0%B0",title:"Барак Абама",autonym:"беларуская (тарашкевіца)"},{lang:"es",url:"https://en.wikipedia.org/wiki/Barack_Obama",title:"Barack Obama",dir:"ltr",autonym:"Spanish"},{lang:"ko",url:"https://ko.wikipedia.org/wiki/%EB%B2%84%EB%9D%BD_%EC%98%A4%EB%B0%94%EB%A7%88",title:"버락 오바마",dir:"ltr",autonym:"한국어"},{lang:"ru",url:"https://ru.wikipedia.org/wiki/%D0%9E%D0%B1%D0%B0%D0%BC%D0%B0,_%D0%91%D0%B0%D1%80%D0%B0%D0%BA",title:"Обама, Барак",dir:"ltr",autonym:"русский"},{lang:"uz",url:"https://uz.wikipedia.org/wiki/Barak_Obama",title:"Barak Obama",dir:"ltr",autonym:"oʻzbekcha/ўзбекча"},{lang:"zh",url:"https://zh.wikipedia.org/wiki/%E8%B4%9D%E6%8B%89%E5%85%8B%C2%B7%E5%A5%A5%E5%B7%B4%E9%A9%AC",title:"贝拉克·奥巴马",dir:"ltr",autonym:"中文"},{lang:"zh-min-nan",url:"https://zh-min-nan.wikipedia.org/wiki/Barack_Obama",title:"Barack Obama",dir:"ltr",autonym:"Bân-lâm-gú"},{lang:"zh-yue",url:"https://zh-yue.wikipedia.org/wiki/%E5%A5%A7%E5%B7%B4%E9%A6%AC",title:"奧巴馬",dir:"ltr",autonym:"粵語"},{lang:"zu",url:"https://zu.wikipedia.org/wiki/Barack_Obama",title:"Barack Obama",dir:"ltr",autonym:"isiZulu"}],this.apiVariants=[{autonym:"不转换",lang:"zh",url:"/~bmansurov/mediawiki/index.php/3?variant=zh"},{autonym:"简体",lang:"zh-hans",url:"/~bmansurov/mediawiki/index.php/3?variant=zh-hans"}],this.deviceLanguage="en-us",this.frequentlyUsedLanguages={zh:2,ko:1},this.structuredLanguages={all:[{lang:"zh-min-nan",autonym:"Bân-lâm-gú",title:"Barack Obama",dir:"ltr",url:"https://zh-min-nan.wikipedia.org/wiki/Barack_Obama"},{lang:"zu",autonym:"isiZulu",title:"Barack Obama",dir:"ltr",url:"https://zu.wikipedia.org/wiki/Barack_Obama"},{lang:"uz",autonym:"oʻzbekcha/ўзбекча",title:"Barak Obama",dir:"ltr",url:"https://uz.wikipedia.org/wiki/Barak_Obama"},{lang:"es",autonym:"Spanish",title:"Barack Obama",dir:"ltr",url:"https://en.wikipedia.org/wiki/Barack_Obama"},{lang:"be",autonym:"беларуская",title:"Барак Абама",dir:"ltr",url:"https://be.wikipedia.org/wiki/%D0%91%D0%B0%D1%80%D0%B0%D0%BA_%D0%90%D0%B1%D0%B0%D0%BC%D0%B0"},{lang:"be-x-old",autonym:"беларуская (тарашкевіца)",title:"Барак Абама",dir:"ltr",url:"https://be-x-old.wikipedia.org/wiki/%D0%91%D0%B0%D1%80%D0%B0%D0%BA_%D0%90%D0%B1%D0%B0%D0%BC%D0%B0"},{lang:"ru",autonym:"русский",title:"Обама, Барак",dir:"ltr",url:"https://ru.wikipedia.org/wiki/%D0%9E%D0%B1%D0%B0%D0%BC%D0%B0,_%D0%91%D0%B0%D1%80%D0%B0%D0%BA"},{lang:"ar",autonym:"العربية",title:"باراك أوباما",dir:"rtl",url:"https://ar.wikipedia.org/wiki/%D8%A8%D8%A7%D8%B1%D8%A7%D9%83_%D8%A3%D9%88%D8%A8%D8%A7%D9%85%D8%A7"},{lang:"zh-yue",autonym:"粵語",title:"奧巴馬",dir:"ltr",url:"https://zh-yue.wikipedia.org/wiki/%E5%A5%A7%E5%B7%B4%E9%A6%AC"}],suggested:[{frequency:2,lang:"zh",autonym:"中文",title:"贝拉克·奥巴马",dir:"ltr",url:"https://zh.wikipedia.org/wiki/%E8%B4%9D%E6%8B%89%E5%85%8B%C2%B7%E5%A5%A5%E5%B7%B4%E9%A9%AC"},{frequency:1,lang:"ko",autonym:"한국어",title:"버락 오바마",dir:"ltr",url:"https://ko.wikipedia.org/wiki/%EB%B2%84%EB%9D%BD_%EC%98%A4%EB%B0%94%EB%A7%88"}]},i=a.sandbox.create(),s.setUp(i,e),r.setUp(i,e),o.setUp(i,e),i.stub(mw.storage,"get").withArgs("langMap").returns(JSON.stringify(this.frequentlyUsedLanguages)),t=n("./src/mobile.languages.structured/util.js"),this.saveSpy=i.stub(t,"saveFrequentlyUsedLanguages")},afterEach:function(){r.tearDown(),i.restore()}}),QUnit.test("#getFrequentlyUsedLanguages",(function(e){e.propEqual(t.getFrequentlyUsedLanguages(),this.frequentlyUsedLanguages,"Frequently used languages is correct.")})),QUnit.test("#saveLanguageUsageCount",(function(e){t.saveLanguageUsageCount("ko",t.getFrequentlyUsedLanguages()),e.ok(this.saveSpy.calledWith({zh:2,ko:2}),"Frequently used language is correctly saved.")})),QUnit.test("#getStructuredLanguages",(function(e){var n=t.getStructuredLanguages(this.apiLanguages,!1,this.frequentlyUsedLanguages,!0,this.deviceLanguage);e.propEqual(n,this.structuredLanguages,"Structured languages are correct, including sort order.")})),QUnit.test("#getStructuredLanguages device language",(function(e){var n=t.getStructuredLanguages(this.apiLanguages,!1,{},!0,"es-lx").suggested[0].lang;e.strictEqual(n,"es",'"es" is correctly selected as a suggested language even though the device language is "es-lx".')})),QUnit.test("#getStructuredLanguages variants",(function(e){var n={},i=t.getStructuredLanguages(this.apiLanguages,this.apiVariants,{},!0,this.deviceLanguage).suggested;this.apiVariants.forEach((function(e){n[e.lang]=e})),i.forEach((function(t){e.ok(Object.prototype.hasOwnProperty.call(n,t.lang),'Variant "'+t.lang+'" is in the list of suggested languages.')}))}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.mediaViewer/ImageCarousel.test.js":function(e,t,n){(function(e){var t,i,r=n("./src/mobile.startup/util.js"),s=n("./tests/node-qunit/utils/jQuery.js"),o=n("./tests/node-qunit/utils/dom.js"),a=n("./tests/node-qunit/utils/mw.js"),l=n("./tests/node-qunit/utils/oo.js"),c=n("./node_modules/sinon/lib/sinon.js"),u=n("./tests/node-qunit/utils/mustache.js");QUnit.module("MobileFrontend mobile.mediaViewer/ImageCarousel.js",{beforeEach:function(){t=c.sandbox.create(),o.setUp(t,e),s.setUp(t,e),l.setUp(t,e),a.setUp(t,e),u.setUp(t,e),i=n("./src/mobile.mediaViewer/ImageCarousel.js"),this.image={descriptionurl:"https://commons.wikimedia.org/wiki/File:The_Montgomery,_San_Francisco.jpg",thumbheight:1024,thumburl:"https://upload.wikimedia.org/wikipedia/commons/thumb/b/b1/The_Montgomery%2C_San_Francisco.jpg/676px-The_Montgomery%2C_San_Francisco.jpg",thumbwidth:676,url:"https://upload.wikimedia.org/wikipedia/commons/b/b1/The_Montgomery%2C_San_Francisco.jpg"},this.imageGateway={getThumb:function(){return r.Deferred().resolve({query:{pages:[{imageinfo:[this.image]}]}})}},this.router={getPath:function(){return"/media/File%3AA_cursiva.gif"}},this.thumbnails=[{filename:"foo",getFileName:function(){return""},getPath:function(){return""},getDescription:function(){return""}},{filename:"bar",getFileName:function(){return""},getPath:function(){return""},getDescription:function(){return""}}]},afterEach:function(){s.tearDown(),t.restore()}}),QUnit.test("Shows details bar and image with successful api response",(function(e){var t=new i({gateway:this.imageGateway,title:decodeURIComponent(this.image.url),caption:"The Montgomery in 2012.",router:this.router,eventBus:{on:function(){}}});return this.imageGateway.getThumb().then((function(){e.strictEqual(t.$el.find("img").length,1,"Image is present."),e.strictEqual(t.$el.find(".load-fail-msg").length,0,"Load error msg is not visible"),e.strictEqual(t.$el.find(".image-details.is-visible").length,1,"Details bar present")}))})),QUnit.test("Shows error message with failed api response",(function(e){var t={getThumb:function(){return r.Deferred().reject("Load Error")}},n=new i({gateway:t,title:decodeURIComponent(this.image.url),caption:"The Montgomery in 2012.",router:this.router,eventBus:{on:function(){}}});return t.getThumb().catch((function(){e.strictEqual(n.$el.find(".load-fail-msg").length,1,"Load error msg is visible"),e.strictEqual(n.$el.find(".image-details.is-visible").length,0,"Details bar is hidden")}))})),QUnit.test("Toggling of details is disabled when overlay has load failure",(function(e){var t={getThumb:function(){return r.Deferred().reject("Load Error")}},n=new i({gateway:t,title:decodeURIComponent(this.image.url),caption:"The Montgomery in 2012.",thumbnails:this.thumbnails,router:this.router,eventBus:{on:function(){}}});return t.getThumb().catch((function(){e.strictEqual(n.$el.find(".image-details.is-visible").length,0,"Details bar is hidden"),e.notStrictEqual(n.$el.find(".image-details"),"none","Slider buttons are shown"),e.notStrictEqual(n.$el.find(".prev"),"none","Slider buttons are still shown"),n.$el.find(".image-wrapper").trigger("click"),e.notStrictEqual(n.$el.find(".image-details"),"none","Slider buttons are shown"),e.notStrictEqual(n.$el.find(".prev"),"none","Slider buttons are still shown")}))})),QUnit.test("Toggling of details is enabled when overlay loads successfully",(function(e){var t=new i({gateway:this.imageGateway,title:decodeURIComponent(this.image.url),caption:"The Montgomery in 2012.",thumbnails:this.thumbnails,router:this.router,eventBus:{on:function(){}}});return this.imageGateway.getThumb().then((function(){e.strictEqual(t.$el.find(".image-details.is-visible").length,1,"Details bar is shown"),e.notStrictEqual(t.$el.find(".image-details").css("display"),"none","Ensure display none rule is not set"),e.notStrictEqual(t.$el.find(".prev").css("display"),"none","Slider buttons are shown"),t.$el.find(".image-wrapper").trigger("click"),e.strictEqual(t.$el.find(".image-details").css("display"),"none","Details bar is hidden"),e.strictEqual(t.$el.find(".slider-button").css("display"),"none","Slider buttons are hidden")}))}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.mediaViewer/ImageGateway.test.js":function(e,t,n){(function(e){var t,i,r,s=n("./node_modules/sinon/lib/sinon.js"),o=n("./tests/node-qunit/utils/dom.js"),a=n("./tests/node-qunit/utils/mw.js"),l=n("./tests/node-qunit/utils/jQuery.js"),c=n("./src/mobile.startup/util.js");QUnit.module("MobileFrontend mobile.mediaViewer/ImageGateway",{beforeEach:function(){t=s.sandbox.create(),o.setUp(t,e),l.setUp(t,e),a.setUp(t,e),i=n("./src/mobile.mediaViewer/ImageGateway.js"),r=i._findSizeBucket},afterEach:function(){l.tearDown(),t.restore()}}),QUnit.test("#findSizeBucket",(function(e){e.strictEqual(r(300),320,"value lower than bucket"),e.strictEqual(r(800),800,"exact value"),e.strictEqual(r(9999),2880,"value greater than last bucket")})),QUnit.test("ImageGateway#getThumb (missing page)",(function(e){var t=new i({api:{get:function(){return c.Deferred().resolve({query:{pages:[{title:"Hello",missing:!0}]}})}}});e.rejects(t.getThumb("Missing"),(function(e){return-1!==e.message.indexOf("The API failed")}),"A missing page throws an error which the client must handle")}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.special.nearby.scripts/NearbyGateway.test.js":function(e,t,n){(function(e){var t,i,r,s=n("./tests/node-qunit/utils/jQuery.js"),o=n("./tests/node-qunit/utils/dom.js"),a=n("./tests/node-qunit/utils/mw.js"),l=n("./tests/node-qunit/utils/oo.js"),c=n("./node_modules/sinon/lib/sinon.js");QUnit.module("MobileFrontend NearbyGateway.js",{beforeEach:function(){t=c.sandbox.create(),o.setUp(t,e),s.setUp(t,e),l.setUp(t,e),a.setUp(t,e),t.stub(mw.config,"get").withArgs("wgArticlePath").returns("/w/").withArgs("wgMFDisplayWikibaseDescriptions").returns({nearby:!0}).withArgs("wgMFMobileFormatterHeadings",["h1","h2","h3","h4","h5"]).returns(["h1","h2","h3","h4","h5"]),r=n("./src/mobile.startup/util.js"),i=n("./src/mobile.special.nearby.scripts/NearbyGateway.js");var u={ajax:function(){}};t.stub(mw,"msg").returns("$1"),this.nearbyGateway=new i({api:u}),t.stub(mw.language,"convertNumber").callsFake((function(e){return"1.20"===e?"1.2":String(e)})),t.stub(u,"ajax").callsFake((function(){return r.Deferred().resolve({query:{pages:[{pageid:20004112,ns:0,title:"The Montgomery (San Francisco)",thumbnail:{source:"https://upload.wikimedia.org/wikipedia/commons/thumb/b/b1/The_Montgomery%2C_San_Francisco.jpg/119px-The_Montgomery%2C_San_Francisco.jpg",width:119,height:180},pageimage:"The_Montgomery,_San_Francisco.jpg",coordinates:[{lat:37.787,lon:-122.41,primary:"",globe:"earth",dist:120200}]},{pageid:18618509,ns:0,title:"Wikimedia Foundation",thumbnail:{source:"https://upload.wikimedia.org/wikipedia/commons/thumb/c/c4/Wikimedia_Foundation_RGB_logo_with_text.svg/180px-Wikimedia_Foundation_RGB_logo_with_text.svg.png",width:180,height:180},pageimage:"Wikimedia_Foundation_RGB_logo_with_text.svg",coordinates:[{lat:37.787,lon:-122.51,primary:"",globe:"earth",dist:0}]},{pageid:9297443,ns:0,title:"W San Francisco",coordinates:[{lat:37.7854,lon:-122.61,primary:"",globe:"earth",dist:177400}]}]}})}))},afterEach:function(){s.tearDown(),t.restore()}}),QUnit.test("_distanceMessage()",(function(e){var t=this,n="mobile-frontend-nearby-distance",i="mobile-frontend-nearby-distance-meters";[[.4834,i,"490"],[.5,i,"500"],[.723,i,"730"],[.999,n,"1"],[1.2,n,"1.2"],[1.588,n,"1.59"],[1.123,n,"1.13"],[2.561,n,"2.6"],[10.8334,n,"10.9"]].forEach((function(n,i){t.nearbyGateway._distanceMessage(n[0]),e.propEqual(mw.msg.getCall(i).args,[n[1],n[2]])}))})),QUnit.test("getPages()",(function(e){return this.nearbyGateway.getPages({latitude:37.787,longitude:-122.51}).then((function(t){e.strictEqual(t.length,3),e.strictEqual(t[0].title,"Wikimedia Foundation"),e.strictEqual(t[0].thumbnail.isLandscape,!1),e.strictEqual(t[2].title,"W San Francisco"),e.strictEqual(t[2].thumbnail,!1),e.strictEqual(t[2].dist.toPrecision(6),"177.400")}))})),QUnit.test("getPagesAroundPage()",(function(e){return this.nearbyGateway.getPagesAroundPage("Wikimedia Foundation").then((function(t){e.strictEqual(t.length,2),e.strictEqual(t[1].title,"W San Francisco"),e.strictEqual(t[1].thumbnail,!1),e.strictEqual(t[1].dist.toPrecision(6),"177.400")}))}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.special.watchlist.scripts/WatchList.test.js":function(e,t,n){(function(e){var t,i,r,s=n("./tests/node-qunit/utils/jQuery.js"),o=n("./tests/node-qunit/utils/dom.js"),a=n("./tests/node-qunit/utils/mw.js"),l=n("./tests/node-qunit/utils/oo.js"),c=n("./node_modules/sinon/lib/sinon.js"),u=n("./tests/node-qunit/utils/mustache.js");QUnit.module("MobileFrontend WatchList.js",{beforeEach:function(){r=c.sandbox.create(),o.setUp(r,e),s.setUp(r,e),l.setUp(r,e),a.setUp(r,e),u.setUp(r,e),r.stub(e.mw.Title,"newFromText").returns({getUrl:function(){}}),r.stub(mw.user,"isAnon").returns(!1),r.stub(mw.loader,"require").withArgs("mediawiki.page.watch.ajax").returns({watchstar:function(){}}),t=n("./src/mobile.special.watchlist.scripts/WatchList.js"),i=n("./src/mobile.startup/Icon.js")},afterEach:function(){s.tearDown(),r.restore()}}),QUnit.test("In watched mode",(function(e){var n={get:r.stub()},s=new t({eventBus:{on:function(){},off:function(){}},api:n,pages:[{title:"Title 30"},{title:"Title 50"},{title:"Title 60",watched:!0}]}),o=new i({glyphPrefix:"wikimedia",name:"unStar-progressive"}).getGlyphClassName();s.scrollEndEventEmitter.disable(),e.ok(n.get.notCalled,"Callback avoided"),e.strictEqual(s.$el.find(".watch-this-article").length,3,"3 articles have watch stars..."),e.strictEqual(s.$el.find("."+o).length,3,"...and all are marked as watched.")}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.special.watchlist.scripts/WatchListGateway.test.js":function(e,t,n){(function(e){var t,i,r=n("./tests/node-qunit/utils/jQuery.js"),s=n("./tests/node-qunit/utils/dom.js"),o=n("./tests/node-qunit/utils/mw.js"),a=n("./tests/node-qunit/utils/oo.js"),l=n("./node_modules/sinon/lib/sinon.js"),c=n("./src/mobile.startup/util.js"),u={continue:{pageimages:{picontinue:9}},warnings:{query:{"*":"Formatting of continuation data will be changing soon. To continue using the current formatting, use the 'rawcontinue' parameter. To begin using the new format, pass an empty string for 'continue' in the initial query."}},query:{pages:[{pageid:2,ns:0,title:"Burrito",contentmodel:"wikitext",pagelanguage:"en",touched:"2014-12-17T10:06:49Z",lastrevid:552,length:33534},{pageid:3,ns:0,title:"Albert Einstein",contentmodel:"wikitext",pagelanguage:"en",touched:"2014-12-16T17:33:22Z",lastrevid:4,length:19},{pageid:9,ns:0,title:"Anne Dallas Dudley",contentmodel:"wikitext",pagelanguage:"en",touched:"2014-12-17T10:00:13Z",lastrevid:18,length:12663},{pageid:10,ns:0,title:"San Francisco",contentmodel:"wikitext",pagelanguage:"en",touched:"2014-12-17T10:04:55Z",lastrevid:546,length:373791},{pageid:708,ns:0,title:"Functional logic programming",contentmodel:"wikitext",pagelanguage:"en",touched:"2015-01-12T13:04:23Z",lastrevid:1307,length:1392,new:""},{pageid:720,ns:0,title:"Functional programming",contentmodel:"wikitext",pagelanguage:"en",touched:"2015-01-12T13:04:35Z",lastrevid:1319,length:54839,new:""},{ns:0,title:"zzzz",missing:!0,contentmodel:"wikitext",pagelanguage:"en"}]}};QUnit.module("MobileFrontend WatchListGateway.js",{beforeEach:function(){i=l.sandbox.create(),s.setUp(i,e),r.setUp(i,e),a.setUp(i,e),o.setUp(i,e),i.stub(mw.config,"get").withArgs("wgMFDisplayWikibaseDescriptions").returns({watchlist:!0}).withArgs("wgMFMobileFormatterHeadings",["h1","h2","h3","h4","h5"]).returns(["h1","h2","h3","h4","h5"]),i.stub(mw.util,"getUrl").callsFake((function(){})),t=n("./src/mobile.special.watchlist.scripts/WatchListGateway.js")},afterEach:function(){r.tearDown(),i.restore()}}),QUnit.test("loadWatchlist() loads results from the first page",(function(e){var n=new t(new mw.Api);return i.stub(mw.Api.prototype,"get").returns(c.Deferred().resolve(u)),n.loadWatchlist().then((function(t){var n=mw.Api.prototype.get.firstCall.args[0];e.strictEqual(n.continue,"","It should set the continue parameter"),e.strictEqual(t.length,7,"Got all the results"),e.strictEqual(t[0].displayTitle,"Albert Einstein","Sorted alphabetically")}))})),QUnit.test("loadWatchlist() loads results from the second page from last item of first",(function(e){var n=new t(new mw.Api,"Albert Einstein"),r=c.extend({},u,{continue:{watchlistraw:{gwrcontinue:"0|Albert Einstein"}}}),s=i.stub(mw.Api.prototype,"get").returns(c.Deferred().resolve(r));return n.loadWatchlist().then((function(t){var i=mw.Api.prototype.get.firstCall.args[0];return e.strictEqual(i.continue,"gwrcontinue||","It should set the continue parameter"),e.strictEqual(i.gwrcontinue,"0|Albert_Einstein","It should set the watchlistraw-specific continue parameter"),e.strictEqual(t.length,6,"Should have Albert removed from the results"),e.strictEqual(t[0].displayTitle,"Anne Dallas Dudley","First item should be Anne"),s.returns(c.Deferred().resolve(u)),n.loadWatchlist().then((function(t){e.strictEqual(t.length,7,"Albert should be in the results"),e.strictEqual(t[0].displayTitle,"Albert Einstein","First item should be Albert")}))}))})),QUnit.test("loadWatchlist() doesn't throw an error when no pages are returned",(function(e){var n=new t(new mw.Api);return i.stub(mw.Api.prototype,"get").returns(c.Deferred().resolve({batchcomplete:""})),n.loadWatchlist().then((function(t){e.propEqual(t,[])}))})),QUnit.test("loadWatchlist() marks pages as new if necessary",(function(e){var n=new t(new mw.Api);return i.stub(mw.Api.prototype,"get").returns(c.Deferred().resolve(u)),n.loadWatchlist().then((function(t){e.strictEqual(t[0].isMissing,!1,"Albert Einstein page isn't marked as new"),e.strictEqual(t[6].isMissing,!0,"zzzz page is marked as new")}))}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/Browser.test.js":function(e,t,n){(function(e){var t,i,r=n("./src/mobile.startup/Browser.js"),s=n("./tests/node-qunit/utils/dom.js"),o=n("./tests/node-qunit/utils/jQuery.js"),a=n("./node_modules/sinon/lib/sinon.js"),l=n("./tests/node-qunit/utils/mw.js");QUnit.module("MobileFrontend Browser.js",{beforeEach:function(){i=a.sandbox.create(),s.setUp(i,e),o.setUp(i,e),l.setUp(i,e),t=$(void 0)},afterEach:function(){o.tearDown(),i.restore()}}),QUnit.test("isIos()",(function(e){var n=new r("Mozilla/5.0 (iPad; CPU OS 7_0 like Mac OS X) AppleWebKit/537.51.1 (KHTML, like Gecko)",t),i=new r("Mozilla/5.0 (iPad; CPU OS 4_0 like Mac OS X) AppleWebKit/537.51.1 (KHTML, like Gecko)",t),s=new r("Mozilla/5.0 (iPad; CPU OS 5_0 like Mac OS X) AppleWebKit/537.51.1 (KHTML, like Gecko)",t),o=new r("Mozilla/5.0 (iPhone; CPU iPhone OS 8_0 like Mac OS X) AppleWebKit/537.51.1 (KHTML, like Gecko) Version/8.0 Mobile/11A465 Safari/9537.53",t);e.strictEqual(n.isIos(),!0),e.strictEqual(n.isIos(8),!1),e.strictEqual(n.isIos(4),!1),e.strictEqual(n.isIos(5),!1),e.strictEqual(o.isIos(),!0),e.strictEqual(o.isIos(8),!0),e.strictEqual(i.isIos(4),!0),e.strictEqual(s.isIos(5),!0)})),QUnit.test("Methods are cached",(function(e){var n=new r("Mozilla/5.0 (iPad; CPU OS 7_0 like Mac OS X) AppleWebKit/537.51.1 (KHTML, like Gecko)",t),i=new r("Mozilla/5.0 (iPhone; CPU iPhone OS 8_0 like Mac OS X) AppleWebKit/537.51.1 (KHTML, like Gecko) Version/8.0 Mobile/11A465 Safari/9537.53",t),s=new r("Android 2",t);function o(e,t){return e["__cache"+e[t].cacheId]}e.strictEqual(n.isIos(),!0),e.strictEqual(n.isIos(8),!1),e.strictEqual(s.isIos(8),!1),e.strictEqual(i.isIos(),!0),e.strictEqual(i.isIos(8),!0),e.strictEqual(Object.keys(o(n,"isIos")).length,2,"isIos on ipad cached as expected"),e.strictEqual(Object.keys(o(s,"isIos")).length,1,"isIos on android cached as expected"),e.strictEqual(Object.keys(o(i,"isIos")).length,2,"isIos on iphone cached as expected")})),QUnit.test("isWideScreen()",(function(e){var n=new r("Mozilla/5.0 (iPad; CPU OS 7_0 like Mac OS X) AppleWebKit/537.51.1 (KHTML, like Gecko)",t);i.stub(mw.config,"get").callsFake((function(){return"720px"})),e.strictEqual(n.isWideScreen(),!0)})),QUnit.test("supportsTouchEvents()",(function(e){var n=new r("Mozilla/5.0 (iPad; CPU OS 7_0 like Mac OS X) AppleWebKit/537.51.1 (KHTML, like Gecko)",t);window.ontouchstart=window.ontouchstart||void 0,e.strictEqual(n.supportsTouchEvents(),!0)})),QUnit.test("supportsGeoLocation()",(function(e){var n=new r("Mozilla/5.0 (iPad; CPU OS 7_0 like Mac OS X) AppleWebKit/537.51.1 (KHTML, like Gecko)",t);window.navigator.geolocation=window.navigator.geolocation||void 0,e.strictEqual(n.supportsGeoLocation(),!0)}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/Button.test.js":function(e,t,n){(function(e){var t,i,r=n("./node_modules/sinon/lib/sinon.js"),s=n("./tests/node-qunit/utils/dom.js"),o=n("./tests/node-qunit/utils/jQuery.js"),a=n("./tests/node-qunit/utils/oo.js"),l=n("./tests/node-qunit/utils/mw.js"),c=n("./tests/node-qunit/utils/mustache.js");QUnit.module("MobileFrontend Button.js",{beforeEach:function(){i=r.sandbox.create(),s.setUp(i,e),o.setUp(i,e),a.setUp(i,e),l.setUp(i,e),c.setUp(i,e),t=n("./src/mobile.startup/Button.js")},afterEach:function(){o.tearDown(),i.restore()}}),QUnit.test("creates a link if passed href option",(function(e){var n=new t({href:"https://www.foo.com"});e.strictEqual(n.$el[0].tagName,"A"),e.strictEqual(n.$el[0].getAttribute("href"),"https://www.foo.com")})),QUnit.test("does not add href attribute when not a link",(function(e){var n=new t({tagName:"div"});e.strictEqual(n.$el[0].tagName,"DIV"),e.strictEqual(n.$el[0].href,void 0)}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/CtaDrawer.test.html.js":function(e,t){e.exports={defaultURLs:'\n\t\t<div class=" drawer drawer-container__drawer position-fixed">\n\t\t\t<div\n\t\t\t\tclass=" mw-ui-icon mw-ui-icon-mf-expand mw-ui-icon-element cancel "\n\t\t\t> </div>\n\t\t\t<p> </p>\n\t\t\t<a href=" logIn " class=" mw-ui-button mw-ui-progressive ">\n\t\t\t\tLog in\n\t\t\t</a>\n\t\t\t<div class="cta-drawer__anchors">\n\t\t\t\t<a href=" signUp " class=" mw-ui-anchor mw-ui-progressive ">\n\t\t\t\t\tSign up\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t</div>\n\t',overrideURLs:'\n\t\t<div class=" drawer drawer-container__drawer position-fixed">\n\t\t\t<div\n\t\t\t\tclass=" mw-ui-icon mw-ui-icon-mf-expand mw-ui-icon-element cancel "\n\t\t\t> </div>\n\t\t\t<p> </p>\n\t\t\t<a href=" customLogIn " class=" mw-ui-button mw-ui-progressive ">\n\t\t\t\tcustom log in\n\t\t\t</a>\n\t\t\t<div class="cta-drawer__anchors">\n\t\t\t\t<a href=" customSignUp " class=" mw-ui-anchor mw-ui-progressive ">\n\t\t\t\t\tcustom sign up\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t</div>\n\t'}},"./tests/node-qunit/mobile.startup/CtaDrawer.test.js":function(e,t,n){(function(e){var t,i,r,s,o=n("./tests/node-qunit/utils/dom.js"),a=n("./tests/node-qunit/utils/jQuery.js"),l=n("./tests/node-qunit/utils/mw.js"),c=n("./tests/node-qunit/utils/mustache.js"),u=n("./tests/node-qunit/utils/oo.js"),d=n("./node_modules/sinon/lib/sinon.js");QUnit.module("MobileFrontend CtaDrawer.js",{beforeEach:function(){s=d.sandbox.create(),o.setUp(s,e),a.setUp(s,e),u.setUp(s,e),l.setUp(s,e),c.setUp(s,e),s.stub(e.mw,"msg").callsFake((function(e){switch(e){case"mobile-frontend-watchlist-cta-button-login":return"Log in";case"mobile-frontend-watchlist-cta-button-signup":return"Sign up"}return e})),s.stub(e.mw.util,"getUrl").callsFake((function(e,t){return t.type?"signUp":"logIn"})),i=n("./src/mobile.startup/Anchor.js"),r=n("./src/mobile.startup/Button.js"),t=n("./src/mobile.startup/CtaDrawer.js")},afterEach:function(){t=void 0,r=void 0,i=void 0,a.tearDown(),s.restore()}},(function(){QUnit.module("redirectParams()",(function(){QUnit.test("empty props, default URL",(function(n){var i=t.prototype.test.redirectParams;s.stub(e.mw.config,"get").callsFake((function(){return"pageName"})),n.propEqual(i({}),{returnto:"pageName"})})),QUnit.test("empty props, nondefault URL",(function(e){var n=t.prototype.test.redirectParams;e.propEqual(n({},"url"),{returnto:"url"})})),QUnit.test("nonempty props",(function(e){var n=t.prototype.test.redirectParams;e.propEqual(n({key:"val"},"url"),{key:"val",returnto:"url"})}))})),QUnit.module("signUpParams()",(function(){QUnit.test("empty props",(function(e){var n=t.prototype.test.signUpParams;e.propEqual(n({}),{type:"signup"})})),QUnit.test("nonempty props",(function(e){var n=t.prototype.test.signUpParams;e.propEqual(n({key:"val"}),{key:"val",type:"signup"})}))})),QUnit.module("HTML",(function(){QUnit.test("defaults",(function(e){var i=new t,r=new RegExp(n("./tests/node-qunit/mobile.startup/CtaDrawer.test.html.js").defaultURLs.replace(/\n/g," ").replace(/\s+/g,"\\s*"));d.assert.match(i.$el.find(".drawer").get(0).outerHTML.replace(/\n/g," "),r),e.ok(!0)})),QUnit.test("overrides",(function(e){var s=new t({progressiveButton:new r({progressive:!0,label:"custom log in",href:"customLogIn"}).options,actionAnchor:new i({progressive:!0,label:"custom sign up",href:"customSignUp"}).options}),o=new RegExp(n("./tests/node-qunit/mobile.startup/CtaDrawer.test.html.js").overrideURLs.replace(/\n/g," ").replace(/\s+/g,"\\s*"));d.assert.match(s.$el.find(".drawer").get(0).outerHTML.replace(/\n/g," "),o),e.ok(!0)}))}))}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/Drawer.test.js":function(e,t,n){(function(e){var t,i,r=n("./tests/node-qunit/utils/dom.js"),s=n("./tests/node-qunit/utils/jQuery.js"),o=n("./tests/node-qunit/utils/mw.js"),a=n("./tests/node-qunit/utils/mustache.js"),l=n("./tests/node-qunit/utils/oo.js"),c=n("./node_modules/sinon/lib/sinon.js");function u(e){c.assert.match(e.$el.find(".drawer")[0].className,/^((?!\bvisible\b).)*$/)}QUnit.module("MobileFrontend Drawer.js",{beforeEach:function(){i=c.sandbox.create(),r.setUp(i,e),s.setUp(i,e),l.setUp(i,e),o.setUp(i,e),a.setUp(i,e),t=n("./src/mobile.startup/Drawer.js")},afterEach:function(){t=void 0,s.tearDown(),i.restore()}}),QUnit.test("visible on show()",(function(e){var n=e.async(),i=function(){var t;t=r,c.assert.match(t.$el.find(".drawer")[0].className,/.*\bvisible\b.*/),e.ok(!0),n()},r=new t({});r.show().then(i).then((function(){r.show().then(i)}))})),QUnit.test("accepts onShow and events",(function(e){var n=e.async();new t({events:{"click .button":function(){}},onShow:function(){e.ok(!0),n()}}).show()})),QUnit.test("hidden on hide()",(function(e){var n=e.async(),i=new t({onBeforeHide:function(){u(i),e.ok(!0),n()}});i.hide()})),QUnit.test("hidden on mask click",(function(e){var n=e.async(),i=new t({onBeforeHide:function(){u(i),e.ok(!0),n()}});i.show(),i.$el.find(".drawer-container__mask")[0].dispatchEvent(new window.Event("click",{bubbles:!0}))})),QUnit.test("HTML is valid",(function(e){var n=new t({});e.strictEqual(n.$el.find(".drawer").get(0).outerHTML,'<div class="drawer drawer-container__drawer position-fixed"><div class="mw-ui-icon mw-ui-icon-mf-expand mw-ui-icon-element   cancel"></div></div>')}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/Overlay.test.js":function(e,t,n){(function(e){var t,i,r=n("./node_modules/sinon/lib/sinon.js"),s=n("./tests/node-qunit/utils/jQuery.js"),o=n("./src/mobile.startup/mfExtend.js"),a=n("./tests/node-qunit/utils/dom.js"),l=n("./tests/node-qunit/utils/mw.js"),c=n("./tests/node-qunit/utils/mustache.js"),u=n("./tests/node-qunit/utils/oo.js"),d=n("./src/mobile.startup/util.js");QUnit.module("MobileFrontend: Overlay.js",{beforeEach:function(){i=r.sandbox.create(),a.setUp(i,e),s.setUp(i,e),u.setUp(i,e),l.setUp(i,e),c.setUp(i,e),t=n("./src/mobile.startup/Overlay.js"),i.stub(e.window,"scrollTo"),d.getDocument().find("#mw-mf-viewport").length||(this.$viewport=d.parseHTML("<div>").attr("id","mw-mf-viewport").appendTo("body"))},afterEach:function(){this.$viewport&&this.$viewport.remove(),s.tearDown(),i.restore()}}),QUnit.test("Simple overlay",(function(e){var n=new t({heading:"<h2>Overlay Title</h2>"}).$el.find('h2:contains("Overlay Title")');e.strictEqual(n.length,1)})),QUnit.test("#make",(function(e){var n=t.make({heading:"Fresh from factory"},new t({className:"overlay-child",heading:"overlay in overlay"}));e.strictEqual(n.$el.find(".overlay-child").length,1,"there is an overlay in the overlay!"),e.strictEqual(n.$el.find(".overlay-title").eq(0).text().trim(),"Fresh from factory","First heading found"),e.strictEqual(n.$el.find(".overlay-content .overlay-title").text().trim(),"overlay in overlay","Second heading found in overlay-content")})),QUnit.test("HTML overlay",(function(e){function n(){t.apply(this,arguments)}o(n,t,{templatePartials:d.extend({},t.prototype.templatePartials,{content:d.template('<div class="content">YO</div>')})});var i=new n({heading:"Awesome"});e.strictEqual(i.$el.find("h2").html(),"Awesome"),e.strictEqual(i.$el.find(".content").text(),"YO")})),QUnit.test("headerActions property",(function(e){var n=[new t({}),new t({headerActions:[{$el:d.parseHTML("<div>")}]})];e.strictEqual(n[0].$el.find(".header-action").length,0,"Overlays do not have header actions by default"),e.strictEqual(n[1].$el.find(".header-action > *").length,1,"headerActions will be inserted into the header-action container")})),QUnit.test("onBeforeExit",(function(e){var n=[];[new t({}),new t({onBeforeExit:function(){}}),new t({onBeforeExit:function(e){e()}})].forEach((function(e){n.push(i.spy(e,"hide")),e.onExitClick(new Event("click"))})),e.strictEqual(n[0].calledOnce,!0,"Overlay 1 hide method called"),e.strictEqual(n[1].calledOnce,!1,"Overlay 2 does not call the exit function"),e.strictEqual(n[2].calledOnce,!0,"Overlay 3 calls the exit function")})),QUnit.test("Close overlay",(function(e){var n=new t({heading:"<h2>Title</h2>",content:"Text"});n.show(),n.hide(),e.strictEqual(n.$el[0].parentNode,null,"No longer in DOM")}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/OverlayManager.test.js":function(e,t,n){(function(e){var t,i,r,s,o,a,l=n("./node_modules/sinon/lib/sinon.js"),c=n("./tests/node-qunit/utils/dom.js"),u=n("./tests/node-qunit/utils/jQuery.js"),d=n("./tests/node-qunit/utils/oo.js"),h=n("./src/mobile.startup/util.js"),p=n("./tests/node-qunit/utils/mw.js"),f=n("./tests/node-qunit/utils/mustache.js");QUnit.module("MobileFrontend mobile.startup/OverlayManager",{beforeEach:function(){a=l.sandbox.create(),c.setUp(a,e),d.setUp(a,e),u.setUp(a,e),p.setUp(a,e),f.setUp(a,e),a.stub(e.window,"scrollTo"),t=n("./src/mobile.startup/OverlayManager.js"),i=n("./src/mobile.startup/Overlay.js"),o=function(e){return $.Event("route",e)},this.createFakeOverlay=function(e){var t=new OO.EventEmitter;return t.show=a.spy(),t.hide=function(){return this.emit("hide"),!0},t.$el=h.parseHTML("<div>"),a.spy(t,"hide"),h.extend(t,e),t},(r=new OO.EventEmitter).getPath=function(){return""},r.back=a.spy(),a.stub(mw.loader,"require").withArgs("mediawiki.router").returns(r),s=new t(r,document.body),t.test.__clearCache()},afterEach:function(){u.tearDown(),a.restore()}}),QUnit.test("#getSingleton (hash present and overlay not managed)",(function(e){var n=a.spy(window.history,"replaceState");a.stub(r,"getPath").returns("#/editor/0");var i=t.getSingleton();e.ok(i instanceof t,"singleton exists"),e.strictEqual(n.calledOnce,!0,"If a page is loaded with a hash fragment a new entry is placed before it to allow the user to go back.")})),QUnit.test("#getSingleton (hash present and overlay managed)",(function(e){window.history.replaceState(t.test.MANAGED_STATE,null,window.location.href);var n=a.spy(window.history,"replaceState");a.stub(r,"getPath").returns("#/editor/0"),t.getSingleton(),e.strictEqual(n.calledOnce,!1,"If the history entry was added/removed by overlay manager, no URI correct occurs.")})),QUnit.test("#getSingleton",(function(e){var n=t.getSingleton();e.ok(n instanceof t,"singleton exists"),e.strictEqual(n,t.getSingleton(),"same object returned each time")})),QUnit.test("#add",(function(e){var t=this.createFakeOverlay();s.add(/^test$/,(function(){return t})),r.emit("route",{path:"test"}),e.strictEqual(t.show.callCount,1,"show registered overlay")})),QUnit.test("#show",(function(e){var t=this.createFakeOverlay(),n=a.spy(s,"_show");s.add(/^showTest$/,(function(){return t})),r.emit("route",{path:"showTest"}),e.strictEqual(n.callCount,1,"OverlayManager.show called on route change")})),QUnit.test("#add, with current path",(function(e){var t=this.createFakeOverlay(),n=h.Deferred();return r.getPath=a.stub().returns("baha"),s.add(/^baha$/,(function(){return t})),h.docReady((function(){n.resolve()})),n.then((function(){e.strictEqual(t.show.callCount,1,"show registered overlay")}))})),QUnit.test("#add, with string literal (matching)",(function(e){var t=h.Deferred(),n=this.createFakeOverlay();return t.show=a.spy(),s.add("[.*+?^${}()|[][(foo)",(function(){return n})),r.emit("route",{path:"[.*+?^${}()|[][(foo)"}),t.resolve(n),t.then((function(){e.strictEqual(n.show.callCount,1,"show called for string that matches")}))})),QUnit.test("#add, with string literal (not matching)",(function(e){var t=h.Deferred(),n=this.createFakeOverlay();return t.show=a.spy(),s.add("[.*+?^${}()|[](foo)",(function(){return t})),r.emit("route",{path:"(bar)"}),t.resolve(n),t.then((function(){e.strictEqual(n.show.callCount,0,"show not called for string that doesn't match")}))})),QUnit.test("#replaceCurrent",(function(e){var n=new t(r,document.body),i=this.createFakeOverlay(),o=this.createFakeOverlay();e.throws((function(){n.replaceCurrent({})}),"throws exceptions if you replace an empty stack"),s.add(/^test$/,(function(){return i})),r.emit("route",{path:"test"}),s.replaceCurrent(o),e.strictEqual(i.hide.callCount,1,"hide overlay"),e.strictEqual(o.show.callCount,1,"show another overlay"),r.emit("route",{path:""}),e.strictEqual(o.hide.callCount,1,"hide another overlay")})),QUnit.test("route with params",(function(e){var t=this.createFakeOverlay(),n=a.stub().returns(t);s.add(/^sam\/(\d+)$/,n),r.emit("route",{path:"sam/123"}),e.ok(n.calledWith("123"),"pass params from the route")})),QUnit.test("hide when route changes",(function(e){var t=this.createFakeOverlay(),n=a.stub().returns(t);s.add(/^jon$/,n),r.emit("route",{path:"jon"}),r.emit("route",{path:""}),r.emit("route",{path:"jon"}),r.emit("route",{path:"other"}),e.strictEqual(t.hide.callCount,2,"hide overlay"),e.ok(t.hide.getCall(0).notCalledWith(!0),"don't force hide (first)"),e.ok(t.hide.getCall(1).notCalledWith(!0),"don't force hide (second)")})),QUnit.test("go back (change route) if overlay hidden but not by route change",(function(e){var t=this.createFakeOverlay(),n=a.stub().returns(t);s.add(/^joakino$/,n),r.emit("route",{path:"joakino"}),a.stub(r,"getPath").returns("joakino"),t.hide(),e.strictEqual(r.back.callCount,1,"route back is called")})),QUnit.test("go back if overlayManager still matches",(function(e){var t=this.createFakeOverlay(),n=a.stub().returns(t);s.add(/^media\/(.*)$/,n),r.emit("route",{path:"media/foo"}),a.stub(r,"getPath").returns("media/bar"),t.hide(),e.strictEqual(r.back.callCount,1,"route back is called")})),QUnit.test("go back if overlayManager still matches (non-regex)",(function(e){var t=this.createFakeOverlay(),n=a.stub().returns(t);s.add("^foo$",n),r.emit("route",{path:"^foo$"}),a.stub(r,"getPath").onCall(0).returns("^foo$").onCall(1).returns("foo"),t.hide(),e.strictEqual(r.back.callCount,1,"route back is called"),r.emit("route",{path:"^foo$"}),t.hide(),e.strictEqual(r.back.callCount,2,"and route back is called again")})),QUnit.test("do not go back (change route) if overlay hidden by change in route",(function(e){var t=this.createFakeOverlay(),n=a.stub().returns(t);s.add(/^joakino$/,n),r.emit("route",{path:"joakino"}),a.stub(r,"getPath").returns("section_anchor"),t.hide(),e.strictEqual(r.back.callCount,0,"route back is not called if the hash has already changed from what it was for the overlay")})),QUnit.test("preventDefault called when you cancel an exit request",(function(e){var n=h.parseHTML("<div>"),s=new t(r,n[0]),l=o({path:""}),c=a.spy(l,"preventDefault");s.add(/^canceloverlay$/,(function(){return new i({onBeforeExit:function(e,t){t()}})})),r.emit("route",o({path:"canceloverlay"})),r.emit("route",l),e.strictEqual(c.calledOnce,!0,"Prevent default was called when the user attempted to go back, preventing an address bar change.")})),QUnit.test("Browser back can be overidden",(function(e){var n=new i({}),s=e.async(),a=h.parseHTML("<div>"),l=new i({onBeforeExit:function(){}}),c=new t(r,a[0]);c.add(/^proceed$/,(function(){return n})),c.add(/^youcannotpass$/,(function(){return l})),r.emit("route",o({path:"proceed"})),e.strictEqual(a.find(n.$el).length,1,"escapable overlay is displayed"),r.emit("route",o({path:"youcannotpass"})),setTimeout((function(){e.strictEqual(a.find(n.$el).length,0,"escapable overlay is no longer displayed"),e.strictEqual(a.find(l.$el).length,1,"cannot go back overlay is now the overlay on display"),r.emit("route",o({path:"proceed"})),setTimeout((function(){e.strictEqual(a.find(l.$el).length,1,"cannot go back overlay is still the overlay on display (cannot exit!)"),e.strictEqual(a.find(n.$el).length,0,"Escapeable overlay is not displayed"),e.strictEqual(c.stack[0].overlay,l,"Cannot go back overlay remains on the top of the stack"),s()}),0)}),0)})),QUnit.test("stacked overlays",(function(e){var t=this.createFakeOverlay(),n=a.stub().returns(t),i=this.createFakeOverlay(),o=a.stub().returns(i);s.add(/^parent$/,o),s.add(/^child$/,n),r.emit("route",{path:"parent"}),e.strictEqual(i.show.callCount,1,"show parent"),r.emit("route",{path:"child"}),e.strictEqual(i.hide.callCount,1,"hide parent"),e.strictEqual(t.show.callCount,1,"show child"),r.emit("route",{path:"parent"}),e.strictEqual(t.hide.callCount,1,"hide child"),e.strictEqual(i.show.callCount,2,"show parent again"),e.strictEqual(o.callCount,1,"create parent only once")})),QUnit.test("prevent route change",(function(e){var t=this.createFakeOverlay({hide:a.stub().returns(!1)}),n=a.stub().returns(t),i={path:"",preventDefault:a.spy()};s.add(/^rob$/,n),r.emit("route",{path:"rob"}),r.emit("route",i),e.strictEqual(i.preventDefault.called,!1,"Previously extending hide could prevent closes, this behaviour changed in I2668b6e54a6d54e820d60e4b56028338908ad55f")})),QUnit.test("stack increases and decreases at right times",(function(e){var t=this;s.add(/^test\/(\d+)$/,(function(){return t.createFakeOverlay()})),r.emit("route",{path:"test/0"}),e.strictEqual(s.stack.length,1,"stack is correct size"),r.emit("route",{path:"test/1"}),e.strictEqual(s.stack.length,2,"stack is correct size"),r.emit("route",{path:"test/0"}),e.strictEqual(s.stack.length,1,"stack decreases when going back to already visited overlay")})),QUnit.test("replace overlay when route event path is equal to current path",(function(e){var t=this;s.add(/^test\/(\d+)$/,(function(){return t.createFakeOverlay()})),r.emit("route",{path:"test/0"}),e.strictEqual(s.stack.length,1,"stack is correct size"),r.emit("route",{path:"test/0"}),e.strictEqual(s.stack.length,1,"stack is correct size (did not increase upon reload)")}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/Page.test.js":function(e,t,n){(function(e){var t,i,r=n("./tests/node-qunit/utils/dom.js"),s=n("./tests/node-qunit/utils/jQuery.js"),o=n("./tests/node-qunit/utils/mw.js"),a=n("./tests/node-qunit/utils/mustache.js"),l=n("./tests/node-qunit/utils/oo.js"),c=n("./node_modules/sinon/lib/sinon.js");QUnit.module("MobileFrontend Page.js",{beforeEach:function(){i=c.sandbox.create(),r.setUp(i,e),o.setUp(i,e),a.setUp(i,e),s.setUp(i,e),l.setUp(i,e),t=n("./src/mobile.startup/Page.js")},afterEach:function(){s.tearDown(),i.restore()}}),QUnit.test("#isMainPage",(function(e){var n=new t({title:"Main Page",isMainPage:!0}),i=new t({title:"Foo"});e.strictEqual(n.isMainPage(),!0,"check main page flag is updated"),e.strictEqual(i.isMainPage(),!1,"check not marked as main page")}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/PageGateway.test.js":function(e,t,n){(function(e){var t,i,r,s,o=n("./node_modules/sinon/lib/sinon.js"),a=n("./tests/node-qunit/utils/dom.js"),l=n("./tests/node-qunit/utils/mw.js"),c=n("./tests/node-qunit/utils/mustache.js"),u=n("./tests/node-qunit/utils/oo.js"),d=n("./tests/node-qunit/utils/jQuery.js"),h=n("./tests/node-qunit/utils/PageInputs.html.js"),p=h.page,f=h.page2,m=n("./tests/node-qunit/utils/PageGateway.responses.js");QUnit.module("MobileFrontend PageGateway",{beforeEach:function(){s=o.sandbox.create(),a.setUp(s,e),d.setUp(s,e),l.setUp(s,e),c.setUp(s,e),u.setUp(s,e),t=n("./src/mobile.startup/util.js"),i=n("./src/mobile.startup/PageGateway.js"),this.api=new mw.Api,r=new i(this.api)},afterEach:function(){d.tearDown(),s.restore()}}),QUnit.test("#getPageLanguages (response)",(function(e){return s.stub(this.api,"get").returns(t.Deferred().resolve(m.getPageLanguagesResponse.input)),r.getPageLanguages("Test").then((function(t){e.propEqual(t.languages,m.getPageLanguagesResponse.output.languages,"return augmented language links"),e.propEqual(t.variants,m.getPageLanguagesResponse.output.variants,"return augmented language variant links")}))})),QUnit.test("#getPageLanguages (call)",(function(e){var n=s.stub(this.api,"get").returns(t.Deferred().reject());s.stub($,"ajax").returns(t.Deferred().resolve()),r.getPageLanguages("Title","fr"),e.ok(n.calledWith(m.getPageLanguagesCall.output))})),QUnit.test("#_getAPIResponseFromHTML",(function(e){var n=r._getAPIResponseFromHTML(t.parseHTML(p));e.propEqual(m.getAPIResponseFromHTML.input,n)})),QUnit.test("#getSectionsFromHTML malformed (h2 before h1)",(function(e){var n=r.getSectionsFromHTML(t.parseHTML(f));e.propEqual(n,[{line:"A1",level:"2",anchor:"1.0",text:'<h3 id="">A2.1</h3>\n',subsections:[{line:"A2.1",level:"3",anchor:"",text:"",subsections:[]}]},{line:"A2.2",level:"2",anchor:"",text:"",subsections:[]},{line:"A2",level:"1",anchor:"",text:'<h2 id="">A2.1</h2>\n',subsections:[{line:"A2.1",level:"2",anchor:"",text:"",subsections:[]}]}])}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/PageHTMLParser.test.js":function(e,t,n){(function(e){var t,i,r,s,o,a,l,c=n("./tests/node-qunit/utils/dom.js"),u=n("./tests/node-qunit/utils/jQuery.js"),d=n("./tests/node-qunit/utils/mw.js"),h=n("./tests/node-qunit/utils/mustache.js"),p=n("./tests/node-qunit/utils/oo.js"),f=n("./node_modules/sinon/lib/sinon.js"),m='<div class="mw-parser-output">';QUnit.module("MobileFrontend PageHTMLParser.js",{beforeEach:function(){r=f.sandbox.create(),c.setUp(r,e),d.setUp(r,e),h.setUp(r,e),u.setUp(r,e),p.setUp(r,e),t=n("./src/mobile.startup/PageHTMLParser.js"),i=n("./src/mobile.startup/util.js"),s=new t(i.parseHTML(m).html('<p>lead</p><div class="ambox">a0</div>')),o=new t(i.parseHTML(m).html('\n\t\t\t\t<div class="mf-section-0">\n\t\t\t\t\t<div class="ambox">a0</div>\n\t\t\t\t\t<p>lead</p>\n\t\t\t\t</div>\n\t\t\t\t<h2 class="section-heading">1</h2>\n\t\t\t\t<div class="mf-section-1">\n\t\t\t\t\t<div class="ambox">a1</div>\n\t\t\t\t\t<h3>1.1</h3>\n\t\t\t\t\t<div class="ambox">a1.1</div>\n\t\t\t\t</div>\n\t\t\t')),a=new t(i.parseHTML(m).html('\n\t\t\t\t<p>lead</p>\n\t\t\t\t<div class="ambox">a0</div>\n\t\t\t\t<h2>1</h2>\n\t\t\t\t<div class="ambox">a1</div>\n\t\t\t\t<h3>1.1</h3>\n\t\t\t\t<div class="ambox">a1.1</div>\n\t\t\t')),l=new t(i.parseHTML(m).html('\n\t\t\t\t<div class="mf-section-0">\n\t\t\t\t\t<p>lead</p>\n\t\t\t\t\t<div class="ambox">a0</div>\n\t\t\t\t</div>\n\n\t\t\t\t<h2 class="section-heading">1</h2>\n\t\t\t\t<div class="mf-section-1">\n\t\t\t\t\t<div class="ambox">a1</div>\n\n\t\t\t\t\t<h3>1.1</h3>\n\t\t\t\t\t<div class="ambox">a1.1</div>\n\n\t\t\t\t\t<h4>1.1.1</h4>\n\t\t\t\t\t<div class="ambox">a1.1.1</div>\n\n\t\t\t\t\t<h4>1.1.2</h4>\n\t\t\t\t\t<div class="ambox">a1.1.2</div>\n\n\t\t\t\t\t<h3>1.2</h3>\n\t\t\t\t\t<div class="ambox">a1.1</div>\n\t\t\t\t</div>\n\n\t\t\t\t<h2 class="section-heading">2</h2>\n\t\t\t\t<div class="mf-section-6"><div class="ambox">a2</div></div>\n\n\t\t\t\t<h2 class="section-heading">3</h2>\n\t\t\t\t<div class="mf-section-7"><div class="ambox">a3</div></div>\n\n\t\t\t\t<h2 class="section-heading">Section with nested Ambox</h2>\n\t\t\t\t<div class="mf-section-8">\n\t\t\t\t\t<div class="ambox">\n\t\t\t\t\t\t<p>nested-ambox-parent,</p>\n\t\t\t\t\t\t<div class="ambox">nested-ambox-1,</div>\n\t\t\t\t\t\t<div class="ambox">nested-ambox-2</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<h2 class="section-heading">Sub-section with nested Ambox</h2>\n\t\t\t\t<div class="mf-section-9">\n\t\t\t\t\t<div class="ambox">\n\t\t\t\t\t\t<p>nested-ambox-parent,</p>\n\t\t\t\t\t\t<div class="ambox">nested-ambox-1,</div>\n\t\t\t\t\t\t<div class="ambox">nested-ambox-2</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<h3>subsection heading</h3>\n\n\t\t\t\t\t<h3>Another subsection heading</h3>\n\t\t\t\t</div>\n\t\t\t'))},afterEach:function(){u.tearDown(),r.restore()}}),QUnit.test("#findInSectionLead",(function(e){[[0,"a0","lead section"],[1,"a1","h2"],[2,"a1.1","h3"],[3,"","h4","selector does not match",".foo"],[111,"","Non-existent section"]].forEach((function(t,n){var i=t[0],r=t[1],s=t[2],o=t[3]||".ambox";e.strictEqual(a.findChildInSectionLead(i,o).text(),r,"Found correct text in desktop test "+n+" case: "+s)})),[[0,"a0","lead section"],[3,"","h4","selector does not match",".foo"],[111,"","Non-existent section"]].forEach((function(t){e.strictEqual(s.findChildInSectionLead(t[0],t[3]||".ambox").text(),t[1],"Stub: Found correct text in desktop test case:"+t[2])})),[[0,"a0","lead section"],[1,"a1","h2"],[2,"a1.1","h3"],[3,"a1.1.1","h4"],[3,"","h4","selector does not match",".foo"],[7,"a3","h2 later"],[111,"","Non-existent section"]].forEach((function(t){e.strictEqual(l.findChildInSectionLead(t[0],t[3]||".ambox").text(),t[1],"Mobile: Found correct text in test case:"+t[2])})),[[0,"a0","lead section"],[1,"a1","h2"],[2,"a1.1","h3"],[111,"","Non-existent section"]].forEach((function(t){e.strictEqual(o.findChildInSectionLead(t[0],t[3]||".ambox").text(),t[1],"Mobile with table of contents: Found correct text in test case:"+t[2])})),[[8,".ambox",/[\s]*nested-ambox-parent,[\s]*nested-ambox-1,\s*nested-ambox-2[\s]*/,"Nested elements in section"],[9,".ambox",/[\s]*nested-ambox-parent,[\s]*nested-ambox-1,[\s]*nested-ambox-2[\s]*/,"Nested elements in subsection"]].forEach((function(e){var t=l.findChildInSectionLead(e[0],e[1]);f.assert.match(t.not(t.children()).text(),e[2])}))})),QUnit.test("#getThumbnails",(function(e){var n,r=new t(i.parseHTML('<div><a href="/wiki/File:Cyanolimnas_cerverai_by_Allan_Brooks_cropped.jpg" class="image view-border-box"><img alt="Cyanolimnas cerverai by Allan Brooks cropped.jpg" src="//upload.wikimedia.org/wikipedia/commons/thumb/0/0d/Cyanolimnas_cerverai_by_Allan_Brooks_cropped.jpg/300px-Cyanolimnas_cerverai_by_Allan_Brooks_cropped.jpg" width="300" height="303" data-file-width="454" data-file-height="459"></a></div>')),s=new t(i.parseHTML("<div></div>")),o=new t(i.parseHTML('<div><a href="/wikpa/index.php?title=File:Cyanolimnas_cerverai_by_Allan_Brooks_cropped.jpg" class="image view-border-box"><img alt="Cyanolimnas cerverai by Allan Brooks cropped.jpg" src="//upload.wikimedia.org/wikipedia/commons/thumb/0/0d/Cyanolimnas_cerverai_by_Allan_Brooks_cropped.jpg/300px-Cyanolimnas_cerverai_by_Allan_Brooks_cropped.jpg" width="300" height="303" data-file-width="454" data-file-height="459"></a></div>'));n=r.getThumbnails();var a=new t(i.parseHTML('<div><a href="/wikpa/index.php?title=File:Cyanolimnas_cerverai_by_Allan_Brooks_cropped.jpg" class="image view-border-box noviewer"><img alt="Cyanolimnas cerverai by Allan Brooks cropped.jpg" src="//upload.wikimedia.org/wikipedia/commons/thumb/0/0d/Cyanolimnas_cerverai_by_Allan_Brooks_cropped.jpg/300px-Cyanolimnas_cerverai_by_Allan_Brooks_cropped.jpg" width="300" height="303" data-file-width="454" data-file-height="459"></a></div>')),l=new t(i.parseHTML('<div><a href="/wikpa/index.php?title=File:Cyanolimnas_cerverai_by_Allan_Brooks_cropped.jpg" class="image view-border-box"><img alt="Cyanolimnas cerverai by Allan Brooks cropped.jpg" class="metadata" src="//upload.wikimedia.org/wikipedia/commons/thumb/0/0d/Cyanolimnas_cerverai_by_Allan_Brooks_cropped.jpg/300px-Cyanolimnas_cerverai_by_Allan_Brooks_cropped.jpg" width="300" height="303" data-file-width="454" data-file-height="459"></a></div>')),c=new t(i.parseHTML('<div class="noviewer"><a href="/wikpa/index.php?title=File:Cyanolimnas_cerverai_by_Allan_Brooks_cropped.jpg" class="image view-border-box"><img alt="Cyanolimnas cerverai by Allan Brooks cropped.jpg" src="//upload.wikimedia.org/wikipedia/commons/thumb/0/0d/Cyanolimnas_cerverai_by_Allan_Brooks_cropped.jpg/300px-Cyanolimnas_cerverai_by_Allan_Brooks_cropped.jpg" width="300" height="303" data-file-width="454" data-file-height="459"></a></div>')),u=new t(i.parseHTML('<div><a href="/wiki/File:Design_portal_logo.jpg" class="image"><span class="lazy-image-placeholder" style="width: 28px;height: 28px;" data-src="//upload.wikimedia.org/wikipedia/commons/thumb/3/3b/Design_portal_logo.jpg/28px-Design_portal_logo.jpg" data-alt="icon" data-width="28" data-height="28" data-class="noviewer">&nbsp;</span></a></div>')),d=new t(i.parseHTML('<div><a href="/wiki/File:Design_portal_logo.jpg" class="image"><span class="lazy-image-placeholder" style="width: 28px;height: 28px;" data-src="//upload.wikimedia.org/wikipedia/commons/thumb/3/3b/Design_portal_logo.jpg/28px-Design_portal_logo.jpg" data-alt="icon" data-width="28" data-height="28" data-class="wot noviewerz bar">&nbsp;</span></a></div>')),h=new t(i.parseHTML('<div><table class="plainlinks metadata ambox ambox-content ambox-Unreferenced" role="presentation"><tr><td class="mbox-image"><div style="width:52px"><a href="/wiki/File:Question_book-new.svg" class="image"><span class="lazy-image-placeholder" style="width: 50px;height: 39px;" data-src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/99/Question_book-new.svg/50px-Question_book-new.svg.png" data-alt="" data-width="50" data-height="39" data-srcset="https://upload.wikimedia.org/wikipedia/commons/thumb/9/99/Question_book-new.svg/75px-Question_book-new.svg.png 1.5x, https://upload.wikimedia.org/wikipedia/commons/thumb/9/99/Question_book-new.svg/100px-Question_book-new.svg.png 2x"> </span></a></div></td></tr></table>'));e.strictEqual(n.length,1,"Found expected number of thumbnails."),e.strictEqual(n[0].getFileName(),"File:Cyanolimnas_cerverai_by_Allan_Brooks_cropped.jpg","Found expected filename."),n=s.getThumbnails(),e.strictEqual(n.length,0,"This page has no thumbnails."),n=o.getThumbnails(),e.strictEqual(n.length,1,"Found expected number of thumbnails."),e.strictEqual(n[0].getFileName(),"File:Cyanolimnas_cerverai_by_Allan_Brooks_cropped.jpg","Found expected filename."),n=a.getThumbnails(),e.strictEqual(n.length,0,"This page has no thumbnails."),n=l.getThumbnails(),e.strictEqual(n.length,0,"This page has no thumbnails."),n=c.getThumbnails(),e.strictEqual(n.length,0,"Images inside a container with the class are not included. Images inside tables for example."),n=u.getThumbnails(),e.strictEqual(n.length,0,"Consider whether the class is on an image which has not been lazy loaded."),n=h.getThumbnails(),e.strictEqual(n.length,0,"Consider whether the lazy loaded image is inside a .metadata container."),n=d.getThumbnails(),e.strictEqual(n.length,1,"Thumbnail found if there is a typo.")}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/ScrollEndEventEmitter.test.js":function(e,t,n){(function(e){var t,i,r=n("./node_modules/sinon/lib/sinon.js"),s=n("./tests/node-qunit/utils/oo.js");QUnit.module("MobileFrontend ScrollEndEventEmitter.js",{beforeEach:function(){t=r.sandbox.create(),s.setUp(t,e),i=n("./src/mobile.startup/ScrollEndEventEmitter.js")},afterEach:function(){t.restore()}}),QUnit.test("initializes properly",(function(e){var t={on:r.spy()},n=new i(t,500),s=new i(t);e.strictEqual(n.enabled,!0,"Emission is enabled by default"),e.strictEqual(n.threshold,500,"Threshold is saved"),e.strictEqual(s.threshold,100,"Without a threshold we get a default"),e.strictEqual(t.on.withArgs("scroll:throttled",n._scrollHandler).calledOnce,!0,"Scrolling handler is bound")})),QUnit.test("emits scroll end event",(function(e){var n={on:function(e,t){this.handler=t},off:function(){}},r=new i(n);t.stub(r,"scrollNearEnd").returns(!0),r.setElement({}),r.on(i.EVENT_SCROLL_END,(function(){e.ok(!0,"scroll end event emitted")})),n.handler()})),QUnit.test("doesn't emit when disabled",(function(e){var n=t.spy(i.prototype,"emit"),r={on:function(e,t){this.handler=t},off:function(){}},s=new i(r);s.setElement({}),s.disable(),r.handler(),e.strictEqual(n.called,!1,"emit should not be called")}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/Section.test.js":function(e,t,n){(function(e){var t,i,r=n("./node_modules/sinon/lib/sinon.js"),s=n("./tests/node-qunit/utils/dom.js"),o=n("./tests/node-qunit/utils/jQuery.js"),a=n("./tests/node-qunit/utils/mustache.js"),l=n("./tests/node-qunit/utils/oo.js");QUnit.module("MobileFrontend Section.js",{beforeEach:function(){i=r.sandbox.create(),s.setUp(i,e),o.setUp(i,e),a.setUp(i,e),l.setUp(i,e),t=n("./src/mobile.startup/Section.js")},afterEach:function(){o.tearDown(),i.restore()}}),QUnit.test("initialize with options",(function(e){var n=new t({level:"1",line:"Line",text:"Text",hasReferences:!0,id:"ID",anchor:"Anchor"});e.strictEqual(n.line,"Line","line is set"),e.strictEqual(n.text,"Text","text is set"),e.strictEqual(n.hasReferences,!0,"hasReferences is set"),e.strictEqual(n.id,"ID","id is set"),e.strictEqual(n.anchor,"Anchor","anchor is set"),e.strictEqual(n.subsections.length,0,"Subsections are empty")})),QUnit.test("initialize with subsections",(function(e){var n=new t({subsections:[{level:"",line:"Line",text:"Text",hasReferences:!0,id:"ID",anchor:"Anchor"}]}),i=n.subsections[0];e.strictEqual(n.subsections.length,1,"Subsection is added to array"),e.ok(i instanceof t,"Subsections are instances of Section"),e.strictEqual(i.line,"Line","line is set"),e.strictEqual(i.text,"Text","text is set"),e.strictEqual(i.hasReferences,!0,"hasReferences is set"),e.strictEqual(i.id,"ID","id is set"),e.strictEqual(i.anchor,"Anchor","anchor is set"),e.strictEqual(i.subsections.length,0,"Subsection children are empty")}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/Toggler.test.js":function(e,t,n){(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i,r,s,o=n("./node_modules/sinon/lib/sinon.js"),a=n("./tests/node-qunit/utils/dom.js"),l=n("./tests/node-qunit/utils/jQuery.js"),c=n("./tests/node-qunit/utils/oo.js"),u=n("./tests/node-qunit/utils/mw.js"),d=n("./tests/node-qunit/utils/mustache.js");QUnit.module("MobileFrontend Toggler.js",{beforeEach:function(){i=o.sandbox.create(),a.setUp(i,e),l.setUp(i,e),c.setUp(i,e),u.setUp(i,e),d.setUp(i,e),r=n("./src/mobile.startup/Browser.js").getSingleton(),s=n("./src/mobile.startup/Toggler.js"),i.stub(mw.config,"get").withArgs("wgMFCollapseSectionsByDefault").returns(!0),i.stub(r,"isWideScreen").returns(!1),this.page={title:"Toggle test"},this.$container=$("<section>").html('\n\t\t<h2>\n\t\t\t<span class="mw-headline" id="First_Section">First Section</span>\n\t\t</h2>\n\t\t<section>\n\t\t\t<p>Text</p>\n\t\t</section>\n\t\t<h2 id="section_1">\n\t\t\t<span class="mw-headline"><a href="#foo">Dummy Link</a></span>\n\t\t</h2>\n\t\t<section></section>\n\t\t<h2><span class="mw-headline">References</span></h2>\n\t\t<section data-is-reference-section="1">\n\t\t\t<ol class="references">\n\t\t\t\t<li id="cite_note-1">\n\t\t\t\t\t<span class="mw-cite-backlink">\n\t\t\t\t\t\t<a href="#cite_ref-1">↑</a>\n\t\t\t\t\t</span> <span class="reference-text">hello</span>\n\t\t\t\t</li>\n\t\t\t</ol>\n\t\t</section>\n'),this.$section0=this.$container.find("h2").eq(0),this.title=this.page.title,this.headline=this.$section0.find("span").attr("id"),this._session=mw.storage.session,mw.storage.session={get:function(){},set:function(){},remove:function(){}}},afterEach:function(){mw.storage.remove("expandSections"),mw.storage.session.remove("expandedSections"),mw.storage.session=this._session,l.tearDown(),i.restore()}}),QUnit.test("Mobile mode - Toggle section",(function(e){var t=new s({eventBus:new OO.EventEmitter,$container:this.$container,prefix:"",page:this.page}),n=this.$section0,i=this.$container.find(".collapsible-block").eq(0);t.toggle(n,this.page),e.strictEqual(n.hasClass("open-block"),!0,"open-block class present"),t.toggle(n,this.page),e.strictEqual(i.hasClass("open-block"),!1,"check content gets closed on a toggle"),e.strictEqual(n.hasClass("open-block"),!1,"check section is closed"),t.toggle(n,this.page),e.strictEqual(i.hasClass("open-block"),!0,"check content reopened"),e.strictEqual(n.hasClass("open-block"),!0,"check section has reopened")})),QUnit.test("Mobile mode - Clicking a hash link to reveal an already open section",(function(e){var t=new s({eventBus:new OO.EventEmitter,$container:this.$container,prefix:"",page:this.page});t.toggle(this.$section0,this.page),e.strictEqual(this.$section0.hasClass("open-block"),!0,"check section is open"),t.reveal("First_Section",this.$container),e.strictEqual(this.$section0.hasClass("open-block"),!0,"check section is still open")})),QUnit.test("Mobile mode - Reveal element",(function(e){var t=new s({eventBus:new OO.EventEmitter,$container:this.$container,prefix:"",page:this.page});t.toggle(this.$section0,this.page),t.reveal("First_Section"),e.strictEqual(this.$container.find(".collapsible-block").eq(0).hasClass("open-block"),!0,"check content is visible"),e.strictEqual(this.$section0.hasClass("open-block"),!0,"check section is open")})),QUnit.test("Mobile mode - Clicking hash links",(function(e){new s({eventBus:new OO.EventEmitter,$container:this.$container,prefix:"",page:this.page}).toggle(this.$section0,this.page),this.$container.find('[href="#First_Section"]').trigger("click"),e.strictEqual(this.$container.find(".collapsible-block").eq(0).hasClass("open-block"),!0,"check content is visible"),e.strictEqual(this.$section0.hasClass("open-block"),!0,"check section is open")})),QUnit.test("Mobile mode - Tap event toggles section",(function(e){var t=new s({eventBus:new OO.EventEmitter,$container:this.$container,prefix:"",page:this.page}),n=this.$container.find(".collapsible-block").eq(1);t.toggle(this.$section0,this.page),e.strictEqual(n.hasClass("open-block"),!1,"check content is hidden at start"),this.$container.find("#section_1").trigger("click"),e.strictEqual(n.hasClass("open-block"),!0,"check content is shown on a toggle")})),QUnit.test("Accessibility - Verify ARIA attributes",(function(e){var t=new s({eventBus:new OO.EventEmitter,$container:this.$container,prefix:"",page:this.page}),n=this.$container.find("#section_1"),i=this.$container.find(".mw-headline").eq(1),r=this.$container.find(".collapsible-block").eq(1);t.toggle(this.$section0,this.page),e.strictEqual(r.hasClass("open-block"),!1,"check content is hidden at start"),e.strictEqual(i.attr("aria-expanded"),"false","check aria-expanded is false at start"),n.trigger("click"),e.strictEqual(r.hasClass("open-block"),!0,"check content is visible after toggling"),e.strictEqual(i.attr("aria-expanded"),"true","check aria-expanded is true after toggling"),n.trigger("click"),e.strictEqual(r.hasClass("open-block"),!1,"check content is hidden after toggling"),e.strictEqual(i.attr("aria-expanded"),"false","check aria-expanded is false after toggling")})),QUnit.test("Tablet mode - Open by default",(function(e){r.isWideScreen.returns(!0),new s({eventBus:new OO.EventEmitter,$container:this.$container,prefix:"",page:this.page}),e.strictEqual(this.$container.find(".collapsible-block").eq(1).hasClass("open-block"),!0,"check section is visible at start"),e.strictEqual(this.$container.find(".collapsible-block").eq(2).hasClass("open-block"),!1,"check reference section is hidden at start")})),QUnit.test("Tablet mode - Open by default 2",(function(e){mw.config.get.withArgs("wgMFCollapseSectionsByDefault").returns(!1),new s({eventBus:new OO.EventEmitter,$container:this.$container,prefix:"",page:this.page}),e.strictEqual(this.$container.find(".collapsible-block").eq(1).hasClass("open-block"),!0,"check section is visible at start")})),QUnit.test("Accessibility - Pressing space/ enter toggles a heading",(function(e){var t=this.$container.find("#section_1"),n=$.Event("keypress");r.isWideScreen.returns(!1),mw.config.get.withArgs("wgMFCollapseSectionsByDefault").returns(!0),new s({eventBus:new OO.EventEmitter,$container:this.$container,prefix:"",page:this.page});var i=this.$container.find(".collapsible-block").eq(1);e.strictEqual(i.hasClass("open-block"),!1,"check content is hidden at start"),n.which=32,t.trigger(n),e.strictEqual(i.hasClass("open-block"),!0,"check content is shown after pressing space"),n.which=13,t.trigger(n),e.strictEqual(i.hasClass("open-block"),!1,"check content is hidden after pressing enter")})),QUnit.test("Clicking a link within a heading isn't triggering a toggle",(function(e){var t=$("#section_1"),n=$(".collapsible-block").eq(1);new s({eventBus:new OO.EventEmitter,$container:this.$container,prefix:"",page:this.page}),e.strictEqual(n.hasClass("open-block"),!1,"check content is hidden at start"),t.find("> a").eq(0).trigger("mouseup"),e.strictEqual(n.hasClass("open-block"),!1,"check content is still being hidden after clicking on the link")})),QUnit.test("Toggling a section stores its state.",(function(e){var n=new s({eventBus:new OO.EventEmitter,$container:this.$container,prefix:"",page:this.page}),r=this.$container.find("h2"),o=s._getExpandedSections(this.page),a=i.spy(mw.storage.session,"set");e.strictEqual($.isEmptyObject(o[this.title]),!0,"no user setting about an expanded section exists already"),n.toggle(r,this.page);var l=JSON.parse(a.getCall(0).args[1]);e.strictEqual(t(l[this.title][this.headline]),"number","the just toggled section state has been saved"),n.toggle(r,this.page);var c=JSON.parse(a.getCall(1).args[1]);e.strictEqual(c[this.title][this.headline],void 0,"the just toggled section state has been removed")})),QUnit.test("Check for and remove obsolete stored sections.",(function(e){var n={};n[this.title]={},n[this.title][this.headline]=new Date(1990,1,1).getTime(),i.stub(mw.storage.session,"get").callsFake((function(){return JSON.stringify(n)}));var r=s._getExpandedSections(this.page);e.strictEqual(t(r[this.title][this.headline]),"number","manually created section state has been saved correctly");var o=i.spy(mw.storage.session,"set");s._cleanObsoleteStoredSections(this.page);var a=JSON.stringify(["expandedSections",'{"Toggle test":{}}']);e.strictEqual(JSON.stringify(o.getCall(0).args),a,"section, whose store time is manually changed to an older date,has been removed from storage correctly")})),QUnit.test("Expanding already expanded section does not toggle it.",(function(e){var n=new s({eventBus:new OO.EventEmitter,$container:this.$container,prefix:"",page:this.page}),r=this.$container.find("h2"),o=s._getExpandedSections(this.page);e.strictEqual($.isEmptyObject(o[this.title]),!0,"no expanded sections are stored in localStorage yet"),e.strictEqual(r.hasClass("open-block"),!1,"section does not have open-block class");var a=i.spy(mw.storage.session,"set");n.toggle(r,this.page),e.strictEqual(r.hasClass("open-block"),!0,"revealed section has open-block class"),s._getExpandedSections(this.page);var l=JSON.parse(a.getCall(0).args[1]);e.strictEqual(t(l[this.title][this.headline]),"number","manually revealed section state has been correctly saved in localStorage"),s._expandStoredSections(n,this.$container,this.page),e.strictEqual(r.hasClass("open-block"),!0,"already revealed section still has open-block class after expanding sections")})),QUnit.test("MobileFrontend toggle.js - Expand stored sections.",(function(e){var n=this.$container.find("h2").eq(0),r=s._getExpandedSections(this.page);this.$container.find("h2").addClass("section-heading"),e.strictEqual(n.hasClass("open-block"),!1,"Section is collapsed."),e.strictEqual($.isEmptyObject(r[this.title]),!0,"no user setting about an expanded section exists already"),r[this.title][this.headline]=(new Date).getTime(),i.stub(mw.storage.session,"get").callsFake((function(){return JSON.stringify(r)}));var o=s._getExpandedSections(this.page);e.strictEqual(t(o[this.title][this.headline]),"number","manually created section state has been saved correctly"),new s({eventBus:new OO.EventEmitter,$container:this.$container,prefix:"",page:this.page});var a=s._getExpandedSections(this.page);e.strictEqual(t(a[this.title][this.headline]),"number","manually created section state is still active after toggle.init()"),e.strictEqual(n.hasClass("open-block"),!0,"Saved section has been auto expanded.")}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/View.test.js":function(e,t,n){(function(e){var t,i,r=n("./tests/node-qunit/utils/mw.js"),s=n("./tests/node-qunit/utils/mustache.js"),o=n("./tests/node-qunit/utils/jQuery.js"),a=n("./tests/node-qunit/utils/dom.js"),l=n("./src/mobile.startup/mfExtend.js"),c=n("./src/mobile.startup/util.js"),u=n("./tests/node-qunit/utils/oo.js"),d=n("./node_modules/sinon/lib/sinon.js");QUnit.module("MobileFrontend mobile.startup/View",{beforeEach:function(){i=d.sandbox.create(),a.setUp(i,e),o.setUp(i,e),u.setUp(i,e),r.setUp(i,e),s.setUp(i,e),t=n("./src/mobile.startup/View.js")},afterEach:function(){o.tearDown(),i.restore()}}),QUnit.test("View",(function(e){var n=document.createElement("div"),i=new t({el:n});e.strictEqual(i.$el[0].outerHTML,'<div class="view-border-box"></div>',"Views use el and treat as CSS selector. view border box by default"),e.strictEqual(i.$el[0].tagName.toUpperCase(),"DIV","assign proper jQuery object to $el")})),QUnit.test("View, jQuery proxy functions",(function(e){var n=new t({el:"body"});["append","prepend","appendTo","prependTo","after","before","insertAfter","insertBefore","remove","detach"].forEach((function(t){var r=i.stub(n.$el,t);n[t]("test",1),e.ok(r.calledWith("test",1)),r.restore()}))})),QUnit.test("View#preRender",(function(e){function n(){t.apply(this,arguments)}l(n,t,{template:c.template("<p>{{text}}</p>"),preRender:function(){this.options.text="hello"}});var i=new n;e.strictEqual(i.$el.html(),"<p>hello</p>","manipulate template data")})),QUnit.test("View#postRender",(function(e){var n=i.spy();function r(){t.apply(this,arguments)}l(r,t,{postRender:function(){n()}}),new r,e.strictEqual(n.callCount,1,"invoke postRender")})),QUnit.test("View#delegateEvents",(function(e){function n(n){t.call(this,c.extend({events:{"click p span":function(t){t.preventDefault(),e.ok(!0,"Span was clicked and handled")},"click p":"onParagraphClick",click:"onClick"}},n))}l(n,t,{template:c.template("<p><span>test</span></p>"),onParagraphClick:function(t){t.preventDefault(),e.ok(!0,"Paragraph was clicked and handled")},onClick:function(t){t.preventDefault(),e.ok(!0,"View was clicked and handled")}});var i=new n;i.appendTo("body"),i.$el.find("span").trigger("click"),i.$el.find("p").trigger("click"),i.$el.trigger("click"),i.undelegateEvents(),i.$el.find("span").trigger("click"),i.$el.find("p").trigger("click"),i.$el.trigger("click")})),QUnit.test("View#render (with isTemplateMode)",(function(e){var n=$("<div>");function i(){t.apply(this,arguments)}function r(){t.call(this,{className:"bar"})}l(i,t,{template:c.template('<p class="foo"><span>{{text}}</span></p>'),isTemplateMode:!0}),l(r,t,{template:c.template('<p class="foo"><span>test</span></p>')});var s=new i,o=s.$el.text(),a=new r;s.render(),a.render(),s.$el.appendTo(n),s.render({text:"hello"}),e.ok(s.$el.hasClass("foo")),e.ok(a.$el.hasClass("bar")),e.strictEqual(o,"","first run, no text defined"),e.strictEqual(s.$el.text(),"hello","second run, text has been defined"),e.strictEqual(s.$el.parent(n).length,1,"A re-rendered view thats attached to the DOM remains attached to the DOM")})),QUnit.test("View#render events (with isTemplateMode)",(function(e){function n(e){t.call(this,c.extend({events:{"click span":"onClick"}},e))}l(n,t,{onClick:function(){this.$el.empty().text("hello world")},template:c.template('<p class="foo"><span>test</span></p>'),isTemplateMode:!0});var i=new n;i.$el.find("span").trigger("click"),e.strictEqual(i.$el.text(),"hello world","event was called"),e.strictEqual(i.$el.find("span").length,0,"span disappeared");var r=new n;r.render(),r.$el.find("span").trigger("click"),e.strictEqual(r.$el.text(),"hello world","event was called"),e.strictEqual(r.$el.find("span").length,0,"span disappeared")})),QUnit.test("View with className option",(function(e){[[new t,"view-border-box","className not defined on a normal View without options and isBorderBox is default"],[new t({}),"view-border-box","className not defined on a normal View with empty options and isBorderBox is default"],[new t({className:"banana"}),"banana view-border-box","option is passed to View (along with default isBorderBox property)"],[new t({isBorderBox:!1}),void 0,"Passing isBorderBox option removes default view-border-box class"],[new t({isBorderBox:!0}),"view-border-box","Passing isBorderBox option as true retains default view-border-box class"]].forEach((function(t){e.strictEqual(t[0].$el.attr("class"),t[1],t[2])}))})),QUnit.test("View.make()",(function(e){var n=t.make({className:"foo"},[c.parseHTML("<div>").text("hello")]);e.strictEqual(n.$el.find("> div").text().trim(),"hello","view created with element")}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/amcOutreach/AmcEnableForm.test.js":function(e,t,n){(function(e){var t,i,r=n("./tests/node-qunit/utils/jQuery.js"),s=n("./tests/node-qunit/utils/dom.js"),o=n("./tests/node-qunit/utils/oo.js"),a=n("./tests/node-qunit/utils/mw.js"),l=n("./tests/node-qunit/utils/mustache.js"),c=n("./node_modules/sinon/lib/sinon.js");QUnit.module("MobileFrontend amcOutreach/AmcEnableForm.js",{beforeEach:function(){i=c.sandbox.create(),s.setUp(i,e),r.setUp(i,e),o.setUp(i,e),a.setUp(i,e),l.setUp(i,e),t=n("./src/mobile.startup/amcOutreach/AmcEnableForm.js")},afterEach:function(){r.tearDown(),i.restore()}}),QUnit.test("renders correctly",(function(e){var n=new t({postUrl:"https://foo.com",fields:[{name:"f1name",value:"f1value"},{name:"f2name",value:"f2value"}],buttonLabel:"Submit"});e.strictEqual(n.$el.is("form"),!0,"Form is rendered"),e.strictEqual(n.$el.attr("action"),"https://foo.com","Form action is passed in postUrl"),e.strictEqual(n.$el.attr("method"),"POST","Form method is POST"),e.strictEqual(n.$el.find("input[name='f1name'][value='f1value']").length,1,"Field 1 is rendered"),e.strictEqual(n.$el.find("input[name='f2name'][value='f2value']").length,1,"Field 2 is rendered"),e.strictEqual(n.$el.find("button").length,1,"Submit button is rendered"),e.strictEqual(n.$el.find("button").text(),"Submit","Submit button has label")}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/amcOutreach/amcOutreachDrawer.test.js":function(e,t,n){(function(e){var t,i,r,s=n("./tests/node-qunit/utils/jQuery.js"),o=n("./tests/node-qunit/utils/dom.js"),a=n("./tests/node-qunit/utils/oo.js"),l=n("./tests/node-qunit/utils/mw.js"),c=n("./tests/node-qunit/utils/mustache.js"),u=n("./node_modules/sinon/lib/sinon.js");QUnit.module("MobileFrontend amcOutreachDrawer.js",{beforeEach:function(){r=u.sandbox.create(),o.setUp(r,e),s.setUp(r,e),a.setUp(r,e),l.setUp(r,e),c.setUp(r,e),t=n("./src/mobile.startup/amcOutreach/amcOutreachDrawer.js"),i=n("./src/mobile.startup/Drawer.js"),r.stub(e.window.HTMLFormElement.prototype,"submit"),this.promoCampaign={makeActionIneligible:u.stub().returns(!0)},this.toast={showOnPageReload:u.stub(),show:u.stub()}},afterEach:function(){s.tearDown(),r.restore()}}),QUnit.test("returns a drawer",(function(e){var n=t("onLoad",this.promoCampaign,(function(){return{parse:function(){return"parse"},text:function(){return""}}}),{getUrl:function(){return"getUrl"}},this.toast,"token",(function(){}),"");e.strictEqual(n instanceof i,!0,"it initializes the correct class")})),QUnit.test("calls promoCampaign.makeActionIneligible and onBeforeHide callback when dismissed",(function(e){var n=this,r=e.async(),s=u.stub(),o=t("onLoad",this.promoCampaign,(function(){return{parse:function(){return"parse"},text:function(){return""}}}),{getUrl:function(){return"getUrl"}},this.toast,"token",s,"");e.strictEqual(this.promoCampaign.makeActionIneligible.notCalled,!0,"not called before dismissal"),e.strictEqual(s.notCalled,!0,"onBeforeHide not called before dismissal"),o.$el.find(".cancel").first().trigger("click"),setTimeout((function(){e.strictEqual(n.promoCampaign.makeActionIneligible.calledWith("onLoad"),!0,"promoCampaign.makeActionIneligible after dismissal"),e.strictEqual(s.called,!0,"onBeforeHide called after dismissal"),r()}),i.prototype.minHideDelay)})),QUnit.test("calls promoCampaign.makeActionIneligible and toast.showOnPageReload when user enables",(function(e){var n=u.stub(),i=t("onLoad",this.promoCampaign,(function(){return{parse:function(){return"parse"},text:function(){return""}}}),{getUrl:function(){return"getUrl"}},this.toast,"token",n,"");e.strictEqual(this.promoCampaign.makeActionIneligible.notCalled,!0,"promoCampaign.makeActionIneligible not called before form submission"),e.strictEqual(this.toast.showOnPageReload.notCalled,!0,"toast.showOnPageReload not called before form submission"),i.$el.find("form").trigger("submit"),e.strictEqual(this.promoCampaign.makeActionIneligible.calledWith("onLoad"),!0,"promoCampaign.makeActionIneligible called on form submission"),e.strictEqual(this.toast.showOnPageReload.called,!0,"toast.showOnPageReload called on form submission"),e.strictEqual(n.notCalled,!0,"onBeforeHide not called on form submission")}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/cache.test.js":function(e,t,n){var i=new(0,n("./src/mobile.startup/cache.js").MemoryCache);QUnit.module("MobileFrontend cache.js"),QUnit.test("cache set() and get()",(function(e){i.set("key","value"),e.strictEqual(i.get("key"),"value")}))},"./tests/node-qunit/mobile.startup/extendSearchParams.test.js":function(e,t,n){(function(e){var t,i,r=n("./tests/node-qunit/utils/jQuery.js"),s=n("./tests/node-qunit/utils/mw.js"),o=n("./tests/node-qunit/utils/dom.js"),a=n("./node_modules/sinon/lib/sinon.js");QUnit.module("MobileFrontend extendSearchParams.js",{beforeEach:function(){t=a.sandbox.create(),s.setUp(t,e),o.setUp(t,e),r.setUp(t,e),t.stub(mw.config,"get").withArgs("wgMFSearchAPIParams").returns({foo:"bar"}).withArgs("wgMFDisplayWikibaseDescriptions").returns({search:!0,nearby:!1}).withArgs("wgMFQueryPropModules").returns(["baz"]),i=n("./src/mobile.startup/extendSearchParams.js")},afterEach:function(){r.tearDown(),t.restore()}}),QUnit.test("it throws if the feature is invalid",(function(e){var t=new Error('"foo" isn\'t a feature that shows Wikibase descriptions.');e.throws((function(){i("foo",{})}),t)})),QUnit.test("it extends the parameters",(function(e){var t=i("search",{qux:"quux",prop:["corge"]});e.propEqual(t,{action:"query",formatversion:2,qux:"quux",foo:"bar",prop:["corge","baz","description"]})})),QUnit.test("it doesn't include Wikibase-specific parameters if the feature is disabled",(function(e){var t=i("nearby",{qux:"quux"});e.strictEqual(t.prop.indexOf("description"),-1),e.strictEqual(t.wbptterms,void 0)})),QUnit.test("it adds the MobileFrontend configuration to given terms types",(function(e){var t=i("search",{wbptterms:"grault"});e.strictEqual(t.wbptterms,"grault",'The given "wbptterms" is added to the default.')})),QUnit.test("it prioritizes MobileFrontend configuration",(function(e){var t=i("search",{foo:"quux"});e.propEqual(t,{action:"query",formatversion:2,foo:"bar",prop:["baz","description"]},'The value of "foo" is overridden by the configuration.')})),QUnit.test("it is variadic",(function(e){var t=i("search",{baz:"qux"},{quux:"corge"});e.propEqual(t,{action:"query",formatversion:2,foo:"bar",baz:"qux",quux:"corge",prop:["baz","description"]})}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/icons.test.js":function(e,t,n){(function(e){var t,i,r,s=n("./node_modules/sinon/lib/sinon.js"),o=n("./tests/node-qunit/utils/dom.js"),a=n("./tests/node-qunit/utils/jQuery.js"),l=n("./tests/node-qunit/utils/mw.js"),c=n("./tests/node-qunit/utils/mustache.js"),u=n("./tests/node-qunit/utils/oo.js");QUnit.module("MobileFrontend icons.js",{beforeEach:function(){t=s.sandbox.create(),o.setUp(t,e),a.setUp(t,e),u.setUp(t,e),l.setUp(t,e),c.setUp(t,e),i=n("./src/mobile.startup/icons.js"),r=t.spy(i,"Icon")},afterEach:function(){t.restore(),a.tearDown()}}),QUnit.test("#cancel()",(function(e){i.cancel(),e.propEqual(r.getCall(0).args[0],{tagName:"button",name:i.CANCEL_GLYPH+"-base20",additionalClassNames:"cancel",label:mw.msg("mobile-frontend-overlay-close"),isTypeButton:!0},"Options are passed down")})),QUnit.test("#cancel(variant)",(function(e){i.cancel("gray"),e.propEqual(r.getCall(0).args[0],{tagName:"button",name:i.CANCEL_GLYPH+"-gray",additionalClassNames:"cancel",label:mw.msg("mobile-frontend-overlay-close"),isTypeButton:!0},"Options are passed down")})),QUnit.test("#spinner()",(function(e){i.spinner({foo:"will be passed down",additionalClassNames:"will-not-be-ignored"}),e.propEqual(r.getCall(0).args[0],{foo:"will be passed down",additionalClassNames:"will-not-be-ignored",name:"spinner",label:mw.msg("mobile-frontend-loading-message")},"Options are passed down")}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/languageOverlay/getDeviceLanguage.test.js":function(e,t,n){var i,r=n("./src/mobile.startup/languageOverlay/getDeviceLanguage.js"),s=n("./node_modules/sinon/lib/sinon.js");QUnit.module("MobileFrontend getDeviceLanguage",{beforeEach:function(){i=s.sandbox.create()},afterEach:function(){i.restore()}}),QUnit.test("returns language code of device in lowercase",(function(e){[[{},void 0],[{languages:["en-US"]},"en-us"],[{language:"en-US"},"en-us"],[{userLanguage:"en-US"},"en-us"],[{browserLanguage:"en-US"},"en-us"],[{systemLanguage:"en-US"},"en-us"]].forEach((function(t){var n=r(t[0]);e.strictEqual(n,t[1],"returns correct code")}))}))},"./tests/node-qunit/mobile.startup/languageOverlay/languageOverlay.test.js":function(e,t,n){(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i,r,s,o="object"!==("undefined"==typeof window?"undefined":t(window)),a=n("./src/mobile.startup/moduleLoaderSingleton.js"),l=n("./src/mobile.startup/util.js"),c=n("./tests/node-qunit/utils/jQuery.js"),u=n("./tests/node-qunit/utils/dom.js"),d=n("./tests/node-qunit/utils/oo.js"),h=n("./tests/node-qunit/utils/mw.js"),p=n("./tests/node-qunit/utils/mustache.js"),f=n("./node_modules/sinon/lib/sinon.js");QUnit.module("MobileFrontend languageOverlay.js",{beforeEach:function(){s=f.sandbox.create(),u.setUp(s,e),c.setUp(s,e),d.setUp(s,e),h.setUp(s,e),p.setUp(s,e),r=n("./src/mobile.languages.structured/LanguageSearcher.js"),i=n("./src/mobile.startup/languageOverlay/languageOverlay.js"),s.stub(mw,"msg").withArgs("mobile-frontend-language-heading").returns("").withArgs("mobile-frontend-loading-message").returns("⌛").withArgs("mobile-frontend-languages-structured-overlay-all-languages-header").returns("").withArgs("mobile-frontend-languages-structured-overlay-suggested-languages-header").returns(""),s.stub(mw.loader,"using").withArgs("mobile.languages.structured").returns(l.Deferred().resolve()),o&&(e.navigator=e.navigator||void 0,s.stub(e,"navigator").callsFake((function(){}))),s.stub(a,"require").withArgs("mobile.languages.structured/LanguageSearcher").returns(r)},afterEach:function(){c.tearDown(),s.restore()}}),QUnit.test("#constructor",(function(e){var t=l.Deferred().resolve({languages:[],variants:[]}),n={getPageLanguages:function(){return t}},r=i(n);return e.strictEqual(r.$el.find(".overlay-content > .promised-view").text(),"⌛","loading view rendered in .overlay-content"),i.test.loadLanguageSearcher(n).then((function(){e.strictEqual(r.$el.find(".overlay-content > .promised-view").length,0,"promisedView has fulfilled its promise"),e.strictEqual(r.$el.find(".overlay-content > .language-searcher").length,1,"loaded view rendered in .overlay-content")}))}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/lazyImages/lazyImageLoader.test.js":function(e,t,n){(function(e){var t,i=n("./tests/node-qunit/utils/jQuery.js"),r=n("./tests/node-qunit/utils/dom.js"),s=n("./src/mobile.startup/lazyImages/lazyImageLoader.js"),o=n("./tests/node-qunit/utils/mw.js"),a=n("./node_modules/sinon/lib/sinon.js");QUnit.module("MobileFrontend lazyImageLoader.js",{beforeEach:function(){t=a.sandbox.create(),r.setUp(t,e),i.setUp(t,e),o.setUp(t,e)},afterEach:function(){i.tearDown(),t.restore()}},(function(){QUnit.test("#queryPlaceholders() empty",(function(e){var t=document.createElement("div"),n=s.queryPlaceholders(t);e.propEqual(n,[],"The result is empty.")})),QUnit.test("#queryPlaceholders() nonempty",(function(e){var t=document.createElement("div"),n=document.createElement("div");n.className=s.test.placeholderClass,t.appendChild(n);var i=s.queryPlaceholders(t);e.propEqual(i,[n],"The result is nonempty.")})),QUnit.test("#loadImage() copy attributes",(function(e){var t={width:"1",height:"2",class:"class",alt:"alt",src:"/src",srcset:"/srcset",usemap:"#map"},n=document.createElement("div");n.className=s.test.placeholderClass,n.style.width="3px",Object.keys(t).forEach((function(e){n.setAttribute("data-"+e,t[e])}));var i=s.loadImage(n);Object.keys(t).forEach((function(n){e.strictEqual(i.image.getAttribute(n),t[n],n+" is set.")})),e.strictEqual(i.image.style.width,"3px","Style from placeholder is set.")})),QUnit.test("#loadImage() loaded",(function(e){var t=document.createElement("div"),n=s.loadImage(t);return n.image.dispatchEvent(new Event("load")),n.promise.then((function(t){e.strictEqual(t,"load","Promise resolves on load.")}))})),QUnit.test("#loadImage() load error",(function(e){var t=document.createElement("div"),n=s.loadImage(t);return n.image.dispatchEvent(new Event("error")),n.promise.then((function(t){e.strictEqual(t,"error","Promise resolves even on error.")}))})),QUnit.test("#loadImages() empty",(function(e){return s.loadImages([]).then((function(){e.ok(!0,"Promise resolves.")}))})),QUnit.test("#loadImages() nonempty",(function(n){var i=document.createElement("div"),r=new Image;t.stub(e,"Image").returns(r);var o=s.loadImages([i]).then((function(){n.ok(!0,"Promise resolves.")}));return r.dispatchEvent(new Event("load")),o})),QUnit.test("#loadImages() plural",(function(n){var i=document.createElement("div"),r=new Image;t.stub(e,"Image").returns(r);var o=s.loadImages([i,i]).then((function(){n.ok(!0,"Promise resolves.")}));return r.dispatchEvent(new Event("load")),o})),QUnit.test("#loadImages() one fails to load, one succeeds",(function(n){var i=document.createElement("div"),r=new Image,o=new Image;t.stub(e,"Image").onFirstCall().returns(r).onSecondCall().returns(o);var a=s.loadImages([i,i]).then((function(){n.ok(!0,"Promise resolves.")}));return r.dispatchEvent(new Event("error")),o.dispatchEvent(new Event("load")),a}))}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/mfExtend.test.js":function(e,t,n){(function(e){var t,i,r=n("./node_modules/sinon/lib/sinon.js"),s=n("./tests/node-qunit/utils/oo.js");QUnit.module("MobileFrontend mfExtend.test.js",{beforeEach:function(){i=r.sandbox.create(),s.setUp(i,e),t=n("./src/mobile.startup/mfExtend.js")},afterEach:function(){i.restore()}}),QUnit.test("mfExtend() - extending from constructor",(function(e){function n(){}function i(){}t(n,i,{}),e.strictEqual(n.prototype instanceof i,!0)})),QUnit.test("mfExtend() - extending from object",(function(e){var n=new function(){this.protoMethod=function(){return!0}};function i(){}t(i,n);var r=new i;e.strictEqual(r.protoMethod(),!0)})),QUnit.test("mfExtend() - extending from constructor with overrides",(function(e){function n(){}t(n,(function(){this.protoMethod=function(){return!0}}),{protoMethod:function(){return!1}});var i=new n;e.strictEqual(i.protoMethod(),!1)}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/moduleLoader.test.js":function(e,t,n){(function(e){var t,i,r=n("./tests/node-qunit/utils/oo.js"),s=n("./node_modules/sinon/lib/sinon.js");QUnit.module("MobileFrontend ModuleLoader",{beforeEach:function(){i=s.sandbox.create(),r.setUp(i,e),t=n("./src/mobile.startup/moduleLoader.js"),this.loader=new t},afterEach:function(){i.restore()}}),QUnit.test("#require",(function(e){this.loader.define("foo",1),this.loader.define("bar",5),e.strictEqual(this.loader.require("foo"),1,"Returns appropriate module"),e.strictEqual(this.loader.require("bar"),5,"Returns appropriate module"),e.throws((function(){this.loader.require("undefinedmodule")}),"Cannot require an undefined module."),e.throws((function(){this.loader.require("mobile.modules/Foo")}),"Cannot require an undefined export on a known module.")})),QUnit.test("#define",(function(e){var t=this.loader;t.define("foo",1),t.define("bar",5),e.throws((function(){t.define("bar",50)}),"Cannot define two modules with the same name"),e.strictEqual(this.loader.require("bar"),5,"Returns first definition of module.")}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/page/pageJSONParser.test.js":function(e,t,n){(function(e){var t,i,r,s=n("./tests/node-qunit/utils/dom.js"),o=n("./tests/node-qunit/utils/jQuery.js"),a=n("./tests/node-qunit/utils/mw.js"),l=n("./tests/node-qunit/utils/oo.js"),c=n("./node_modules/sinon/lib/sinon.js");QUnit.module("MobileFrontend pageJSONParser",{beforeEach:function(){r=c.sandbox.create(),s.setUp(r,e),a.setUp(r,e),o.setUp(r,e),l.setUp(r,e),t=n("./src/mobile.startup/Page.js"),i=n("./src/mobile.startup/page/pageJSONParser.js")},afterEach:function(){o.tearDown(),r.restore()}}),QUnit.test(".parse()",(function(e){var n=new t({title:'<script>alert("oops, XSS possible!");<\/script>'});e.strictEqual(n.getDisplayTitle(),"&lt;script&gt;alert(&quot;oops, XSS possible!&quot;);&lt;/script&gt;","Check against XSS in Page.js constructor displaytitle (when title set)"),[{thumbnail:!1,title:'<script>alert("oops, XSS possible!");<\/script>',terms:!1,testDesc:"Check against XSS in pageJSONParser.parse displaytitle (when title set)"},{thumbnail:!1,pageprops:[],terms:{label:['<script>alert("oops, XSS possible!");<\/script>']},testDesc:"Check against XSS in pageJSONParser.parse displaytitle (when Wikibase label set)"}].forEach((function(t){var n=i.parse(t);e.strictEqual(n.getDisplayTitle(),"&lt;script&gt;alert(&quot;oops, XSS possible!&quot;);&lt;/script&gt;",t.testDesc)}))}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/promisedView.test.js":function(e,t,n){(function(e){var t,i,r,s,o=n("./src/mobile.startup/util.js"),a=n("./tests/node-qunit/utils/jQuery.js"),l=n("./tests/node-qunit/utils/dom.js"),c=n("./tests/node-qunit/utils/oo.js"),u=n("./tests/node-qunit/utils/mw.js"),d=n("./tests/node-qunit/utils/mustache.js"),h=n("./node_modules/sinon/lib/sinon.js");QUnit.module("MobileFrontend promisedView.js",{beforeEach:function(){r=h.sandbox.create(),l.setUp(r,e),a.setUp(r,e),c.setUp(r,e),u.setUp(r,e),d.setUp(r,e),i=n("./src/mobile.startup/View.js"),t=n("./src/mobile.startup/promisedView.js"),(s=new i({isBorderBox:!1,className:"test"})).append("😃"),r.stub(mw,"msg").withArgs("mobile-frontend-loading-message").returns("⌛")},afterEach:function(){a.tearDown(),r.restore()}}),QUnit.test("#constructor happyView",(function(e){var n=o.Deferred(),i=t(n);return e.strictEqual(i.$el.text(),"⌛","the view is waiting to resolve"),e.ok(i.$el.hasClass("promised-view"),"parent element has loading class when loading"),n.resolve(s),n.then((function(){e.strictEqual(i.$el.attr("class"),"test","fully replaces its parent element with happyView's parent element"),e.strictEqual(i.$el.text(),"😃","the view resolved correctly")}))})),QUnit.test("#constructor when promise rejects but not to a sadView",(function(e){var n=o.Deferred().reject(new Error("fake test error")),i=t(n);return e.strictEqual(i.$el.text(),"⌛","the view is waiting to resolve"),e.ok(i.$el.hasClass("promised-view"),"parent element has loading class when loading"),n.catch((function(){e.strictEqual(i.$el.text(),"⌛","the view still shows the loading icon")}))})),QUnit.test("#constructor when promise rejects to a sadView",(function(e){var n=new i({isBorderBox:!1,className:"error"}),r=o.Deferred().reject(n),s=t(r);return n.append("😭"),e.strictEqual(s.$el.text(),"⌛","the view is waiting to resolve"),e.ok(s.$el.hasClass("promised-view"),"parent element has loading class when loading"),r.catch((function(){e.strictEqual(s.$el.attr("class"),"error","fully replaces its parent element with sadView's parent element"),e.strictEqual(s.$el.text(),"😭","the view resolved correctly")}))}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/promoCampaign/promoCampaign.test.js":function(e,t,n){(function(e){var t,i,r=n("./tests/node-qunit/utils/jQuery.js"),s=n("./tests/node-qunit/utils/dom.js"),o=n("./tests/node-qunit/utils/oo.js"),a=n("./tests/node-qunit/utils/mw.js"),l=n("./tests/node-qunit/utils/mustache.js"),c=n("./node_modules/sinon/lib/sinon.js"),u={onLoad:"onLoad"},d="mobile-frontend-campaign-name-ineligible-onLoad";QUnit.module("MobileFrontend promoCampaign.js",{beforeEach:function(){i=c.sandbox.create(),s.setUp(i,e),r.setUp(i,e),o.setUp(i,e),a.setUp(i,e),l.setUp(i,e),t=n("./src/mobile.startup/promoCampaign/promoCampaign.js"),this.onShow=c.stub(),this.storage={get:c.stub(),set:c.stub()}},afterEach:function(){r.tearDown(),i.restore()}}),QUnit.test("#showIfEligible throws when invalid",(function(e){this.storage.get.withArgs(u.onLoad).returns(null);var n=t(this.onShow,u,"campaign-name",!0,!0,this.storage);e.throws((function(){n.showIfEligible("not a valid action")}),"Throws when action not valid"),e.strictEqual(this.onShow.called,!1,"onShow is not called")})),QUnit.test("#showIfEligible when campaign off",(function(e){this.storage.get.withArgs(u.onLoad).returns(null),t(this.onShow,u,"campaign-name",!1,!0,this.storage).showIfEligible(u.onLoad),e.strictEqual(this.onShow.called,!1,"onShow is not called")})),QUnit.test("#showIfEligible when user ineligible",(function(e){this.storage.get.withArgs(u.onLoad).returns(null),t(this.onShow,u,"campaign-name",!0,!1,this.storage).showIfEligible(u.onLoad),e.strictEqual(this.onShow.called,!1,"onShow is not called")})),QUnit.test("#showIfEligible when storage is not available",(function(e){this.storage.get.withArgs(u.onLoad).returns(!1),t(this.onShow,u,"campaign-name",!1,!0,this.storage).showIfEligible(u.onLoad),e.strictEqual(this.onShow.called,!1,"onShow is not called")})),QUnit.test("#showIfEligible when storage key is ineligible",(function(e){this.storage.get.withArgs(u.onLoad).returns("~"),t(this.onShow,u,"campaign-name",!0,!0,this.storage).showIfEligible(u.onLoad),e.strictEqual(this.onShow.called,!1,"onShow is not called")})),QUnit.test("#showIfEligible when eligible",(function(e){this.storage.get.withArgs(d).returns(null),t(this.onShow,u,"campaign-name",!0,!0,this.storage).showIfEligible(u.onLoad),e.strictEqual(this.onShow.called,!0,"onShow"),e.strictEqual(this.onShow.calledWithExactly(u.onLoad),!0,"onShow called with additional args")})),QUnit.test("#showIfEligible when eligible and passed additional args",(function(e){this.storage.get.withArgs(d).returns(null),t(this.onShow,u,"campaign-name",!0,!0,this.storage).showIfEligible(u.onLoad,1,2,3),e.strictEqual(this.onShow.called,!0,"onShow"),e.strictEqual(this.onShow.calledWithExactly(u.onLoad,1,2,3),!0,"onShow called with additional args")})),QUnit.test("#makeActionIneligible when successful",(function(e){this.storage.get.withArgs(d).returns(null),this.storage.set.withArgs(d,"~").returns(!0);var n=t(this.onShow,u,"campaign-name",!0,!0,this.storage).makeActionIneligible(u.onLoad);e.strictEqual(n,!0,"returns result from mw storage"),e.strictEqual(this.storage.set.calledOnce,!0,"set called once"),e.strictEqual(this.storage.set.calledWith(d,"~"),!0,"set called with correct value")})),QUnit.test("#makeActionIneligible when unsuccessful",(function(e){this.storage.get.withArgs(d).returns(null),this.storage.set.withArgs(d).returns(!1);var n=t(this.onShow,u,"campaign-name",!0,!0,this.storage).makeActionIneligible(u.onLoad);e.strictEqual(n,!1,"returns result from mw storage")})),QUnit.test("#makeActionIneligible when invalid action",(function(e){this.storage.get.withArgs(d).returns(null);var n=t(this.onShow,u,"campaign-name",!0,!0,this.storage);e.throws((function(){n.makeActionIneligible("not a valid action")}),"Throws when invalid action")})),QUnit.test("#makeAllActionsIneligible",(function(e){this.storage.get.withArgs(d).returns(null),t(this.onShow,u,"campaign-name",!0,!0,this.storage).makeAllActionsIneligible(),e.strictEqual(this.storage.set.calledOnce,!0,"set called once"),e.strictEqual(this.storage.set.calledWith(d,"~"),!0,"set called with correct value")})),QUnit.test("#isCampaignActive when true",(function(e){var n=t(this.onShow,u,"campaign-name",!0,!0,this.storage);e.strictEqual(n.isCampaignActive(),!0,"isCampaignActive returns true when true")})),QUnit.test("#isCampaignActive when false",(function(e){var n=t(this.onShow,u,"campaign-name",!1,!0,this.storage);e.strictEqual(n.isCampaignActive(),!1,"isCampaignActive returns false when false")}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/references/ReferencesHtmlScraperGateway.test.js":function(e,t,n){(function(e){var t,i,r,s,o,a,l,c=n("./node_modules/sinon/lib/sinon.js"),u=n("./src/mobile.startup/references/ReferencesGateway.js"),d=n("./tests/node-qunit/utils/PageInputs.html.js").referencesPage,h=n("./src/mobile.startup/util.js"),p=n("./tests/node-qunit/utils/oo.js"),f=n("./tests/node-qunit/utils/dom.js"),m=n("./tests/node-qunit/utils/jQuery.js"),g=n("./tests/node-qunit/utils/mw.js");QUnit.module("MobileFrontend ReferencesHtmlScraperGateway.test.js",{beforeEach:function(){s=c.sandbox.create(),f.setUp(s,e),m.setUp(s,e),p.setUp(s,e),g.setUp(s,e),o=n("./src/mobile.startup/Page.js"),a=n("./src/mobile.startup/PageHTMLParser.js"),l=n("./src/mobile.startup/references/ReferencesHtmlScraperGateway.js"),t=new o({title:"Reftest"}),i=new a(h.parseHTML("<div>").html(d)),r=new l(new mw.Api)},afterEach:function(){m.tearDown(),s.restore()}}),QUnit.test("getReference() checking good reference",(function(e){return r.getReference("#cite_note-1",t,i).then((function(t){e.strictEqual(t.text,"hello")}))})),QUnit.test("getReference() checking bad reference",(function(e){return r.getReference("#cite_note-bad",t,i).catch((function(t){e.strictEqual(t,u.ERROR_NOT_EXIST,"When bad id given false returned.")}))})),QUnit.test("getReference() checking encoded reference",(function(e){return r.getReference("#cite_note-Obama_1995,_2004,_pp._9%E2%80%9310-11",t,i).then((function(t){e.strictEqual(t.text,"found","If an encoded ID parameter is given it still resolves correctly.")}))})),QUnit.test("getReference() adds an extra class for external links",(function(e){return r.getReference("#cite_note-2",t,i).then((function(t){e.notStrictEqual(t.text.indexOf(r.EXTERNAL_LINK_CLASS),-1)}))}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/references/references.test.js":function(e,t,n){(function(e){var t,i,r,s,o,a,l,c,u=n("./node_modules/sinon/lib/sinon.js"),d=n("./tests/node-qunit/utils/oo.js"),h=n("./tests/node-qunit/utils/dom.js"),p=n("./tests/node-qunit/utils/jQuery.js"),f=n("./tests/node-qunit/utils/mw.js"),m=n("./tests/node-qunit/utils/mustache.js"),g=n("./src/mobile.startup/util.js"),b=n("./src/mobile.startup/references/ReferencesGateway.js");QUnit.module("MobileFrontend: references",{beforeEach:function(){t=u.sandbox.create(),h.setUp(t,e),p.setUp(t,e),d.setUp(t,e),f.setUp(t,e),m.setUp(t,e),l=n("./src/mobile.startup/Page.js"),c=n("./src/mobile.startup/PageHTMLParser.js"),a=n("./src/mobile.startup/Drawer.js"),o=n("./src/mobile.startup/references/references.js"),r={getReference:function(){}},s=new c(g.parseHTML("<div>")),i=new l({title:"reference test"})},afterEach:function(){p.tearDown(),t.restore()}}),QUnit.test("Bad reference not shown",(function(e){var n=g.Deferred().reject(b.ERROR_NOT_EXIST).promise(),l=t.spy(a.prototype,"show");return t.stub(r,"getReference").returns(n),o.showReference("#cite_note-bad",i,"1",s,r),n.catch((function(){e.strictEqual(l.callCount,0,"Show is not called.")}))})),QUnit.test("Good reference causes render",(function(e){var n=g.Deferred().resolve({text:"I am a reference"}).promise(),l=t.spy(a.prototype,"render"),c=e.async();return t.stub(r,"getReference").returns(n),o.showReference("#cite_note-good",i,"1",s,r),n.then((function(){e.strictEqual(l.callCount,1,"Render is called."),c()}))})),QUnit.test("Reference failure renders error in drawer",(function(e){var n=g.Deferred().reject(b.ERROR_OTHER).promise(),l=t.spy(a.prototype,"render"),c=e.async();return t.stub(r,"getReference").returns(n),o.showReference("#cite_note-bad",i,"1",s,r),n.catch((function(){e.strictEqual(l.callCount,1,"Render is called."),c()}))})),QUnit.test("makeOnNestedReferenceClickHandler runs when associated with link",(function(e){var n=t.spy(),i=document.createElement("sup"),r=document.createElement("a"),s={currentTarget:i},a={currentTarget:document.createElement("div")},l=o.test.makeOnNestedReferenceClickHandler(n);i.appendChild(r),r.setAttribute("href","https://wikipedia.org"),r.textContent="hello",l(s),e.strictEqual(n.calledOnce,!0,"The spy is called with a sup"),l(a),e.strictEqual(n.calledOnce,!0,"The spy was not called with a div")}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/search/MobileWebSearchLogger.test.js":function(e,t,n){(function(e){var t,i=n("./node_modules/sinon/lib/sinon.js"),r=n("./tests/node-qunit/utils/mw.js"),s=n("./src/mobile.startup/search/MobileWebSearchLogger.js");QUnit.module("MobileFrontend: MobileWebSearchLogger",{beforeEach:function(){t=i.sandbox.create(),r.setUp(t,e),this.logger=new s,this.spy=t.stub(mw,"track")},afterEach:function(){t.restore()}}),QUnit.test("it should log when the search is shown",(function(e){this.logger.onSearchShow(),this.logger.onSearchStart(),e.ok(this.spy.calledWith("mf.schemaMobileWebSearch",{action:"session-start",userSessionToken:this.logger.userSessionToken,searchSessionToken:this.logger.searchSessionToken,timeOffsetSinceStart:0}),"Search start is logged correctly.")})),QUnit.test("it should log when the search API request completes",(function(e){this.logger.onSearchShow(),this.logger.onSearchStart(),this.logger.onSearchResults({results:["result1","result2"]});var t=mw.track.getCall(1).args[1];e.strictEqual(t.action,"impression-results"),e.strictEqual(t.resultSetType,"prefix"),e.strictEqual(t.numberOfResults,2),e.strictEqual(t.userSessionToken,this.logger.userSessionToken),e.strictEqual(t.searchSessionToken,this.logger.searchSessionToken)})),QUnit.test("it should refresh the user session token when the search is shown again",(function(e){this.logger.onSearchShow(),this.logger.onSearchStart(),this.logger.onSearchShow(),this.logger.onSearchStart(),e.notStrictEqual(mw.track.getCall(0).args[1].userSessionToken,mw.track.getCall(1).args[1].userSessionToken)})),QUnit.test("it should log when the user clicks a result",(function(e){this.logger.onSearchShow(),this.logger.onSearchStart(),this.logger.onSearchResults({results:[]}),this.logger.onSearchResultClick({resultIndex:0});var t=mw.track.getCall(2).args[1];e.strictEqual(t.action,"click-result"),e.strictEqual(t.clickIndex,1)})),QUnit.test("it should refresh the search session token when the search API request completes again",(function(e){var t={results:[]};this.logger.onSearchShow(),this.logger.onSearchStart(),this.logger.onSearchResults(t),this.logger.onSearchStart(),this.logger.onSearchResults(t),e.notStrictEqual(mw.track.getCall(1).args[1].searchSessionToken,mw.track.getCall(3).args[1].searchSessionToken)}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/search/SearchGateway.test.js":function(e,t,n){(function(e){var t,i,r=n("./tests/node-qunit/utils/jQuery.js"),s=n("./tests/node-qunit/utils/dom.js"),o=n("./tests/node-qunit/utils/mw.js"),a=n("./tests/node-qunit/utils/oo.js"),l=n("./node_modules/sinon/lib/sinon.js"),c=n("./src/mobile.startup/util.js");QUnit.module("MobileFrontend: SearchGateway",{beforeEach:function(){i=l.sandbox.create(),s.setUp(i,e),r.setUp(i,e),a.setUp(i,e),o.setUp(i,e),t=n("./src/mobile.startup/search/SearchGateway.js"),i.stub(mw.util,"getUrl").returns("Title"),i.stub(mw.config,"get").callsFake((function(e){switch(e){case"wgMFDisplayWikibaseDescriptions":return{search:""};case"wgMFSearchGenerator":return{prefix:""}}})),this.gateway=new t(new mw.Api),i.stub(this.gateway.api,"get").callsFake((function(){return c.Deferred().resolve({warnings:{query:{"*":'Formatting of continuation data will be changing soon. To continue using the current formatting, use the "rawcontinue" parameter. To begin using the new format, pass an empty string for "continue" in the initial query.'}},query:{pages:{2:{index:1,pageid:2,ns:0,title:"Claude Monet",thumbnail:{source:"http://127.0.0.1:8080/images/thumb/5/54/Claude_Monet%2C_Impression%2C_soleil_levant.jpg/80px-Claude_Monet%2C_Impression%2C_soleil_levant.jpg",width:80,height:62}},60:{index:2,pageid:60,ns:0,title:"Barack Obama",thumbnail:{source:"http://127.0.0.1:8080/images/thumb/8/8d/President_Barack_Obama.jpg/64px-President_Barack_Obama.jpg",width:64,height:80}}}}})}))},afterEach:function(){t=void 0,r.tearDown(),i.restore()}},(function(){QUnit.test("._highlightSearchTerm",(function(e){var t=this.gateway;[["Hello World","Hel","<strong>Hel</strong>lo World"],["Hello kitty","el","Hello kitty"],["Hello worl","hel","<strong>Hel</strong>lo worl"],["Belle & Sebastian","Belle & S","<strong>Belle &amp; S</strong>ebastian"],["Belle & the Beast","Belle &amp;","Belle &amp; the Beast"],["with ? in it","with ?","<strong>with ?</strong> in it"],["Title with ? in it","with ?","Title with ? in it"],["AT&T","a","<strong>A</strong>T&amp;T"],["AT&T","at&","<strong>AT&amp;</strong>T"],["<tag","&lt;tag","&lt;tag"],["& this is a weird title","&","<strong>&amp;</strong> this is a weird title"],["& this is a weird title","&a","&amp; this is a weird title"],["&lt;t","<t","&amp;lt;t"],['<script>alert("FAIL")<\/script> should be safe','<script>alert("FAIL"','<strong>&lt;script&gt;alert("FAIL"</strong>)&lt;/script&gt; should be safe']].forEach((function(n,i){e.strictEqual(t._highlightSearchTerm(n[0],n[1]),n[2],"highlightSearchTerm test "+i)}))})),QUnit.test("show redirect targets",(function(e){return this.gateway.search("barack").then((function(t){e.strictEqual(t.query,"barack"),e.strictEqual(t.results.length,2),e.strictEqual(t.results[0].displayTitle,"Claude Monet"),e.strictEqual(t.results[0].thumbnail.width,80),e.strictEqual(t.results[1].displayTitle,"<strong>Barack</strong> Obama"),e.strictEqual(t.results[1].title,"Barack Obama")}))})),QUnit.module("MobileFrontend SearchGateway (Wikidata Descriptions)",{beforeEach:function(){i.stub(mw.Api.prototype,"get").returns(c.Deferred().resolve({query:{pages:{2:{pageid:2,ns:0,title:"Brad Pitt",index:2,description:"American actor"},4:{pageid:4,ns:0,title:"Bradley Cooper",index:3,description:"American actor and film producer"},5:{pageid:5,ns:0,title:"Braddy",index:1}}}}))}}),QUnit.test("Wikidata Description in search results",(function(e){return new t(new mw.Api).search("brad").then((function(t){var n=t.results;e.strictEqual(n[0].wikidataDescription,void 0,"Braddy does not have a Wikidata description."),e.strictEqual(n[1].wikidataDescription,"American actor","Yes, Brad Pitt is an actor."),e.strictEqual(n[2].wikidataDescription,"American actor and film producer","Yes, Cooper is an actor.")}))}))}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/search/SearchOverlay.test.js":function(e,t,n){(function(e){var t,i,r,s,o,a,l=n("./tests/node-qunit/utils/jQuery.js"),c=n("./tests/node-qunit/utils/dom.js"),u=n("./tests/node-qunit/utils/oo.js"),d=n("./tests/node-qunit/utils/mw.js"),h=n("./tests/node-qunit/utils/mustache.js"),p=n("./node_modules/sinon/lib/sinon.js");QUnit.module("MobileFrontend mobile.startup/SearchOverlay.js",{beforeEach:function(){s=p.sandbox.create(),c.setUp(s,e),l.setUp(s,e),u.setUp(s,e),d.setUp(s,e),h.setUp(s,e),o=new mw.Api,s.stub(e.window,"scrollTo").callsFake((function(){})),i=n("./src/mobile.startup/search/SearchGateway.js"),r=s.spy(),t=n("./src/mobile.startup/search/SearchOverlay.js"),a={placeholderMsg:"Search for bananas",api:o,onBeforeExit:r,gateway:new i(o)}},afterEach:function(){l.tearDown(),s.restore()}}),QUnit.test("renders correctly",(function(e){var n=new t(a);e.strictEqual(n.$el.find(".overlay-title").length,1,"It contains an overlay title"),e.strictEqual(n.$el.find(".search-results-view").length,1,"It contains a SearchResultsView"),e.strictEqual(n.$el.find(".results-list-container").length,1,"Contains search results container")})),QUnit.test("resetSearch",(function(e){var n=new t(a);n.resetSearch(),e.strictEqual(n.$el.find(".search-results-view").is("visible"),!1,"All children are now hidden")})),QUnit.test("onClickOverlayContent",(function(e){new t(a).onClickOverlayContent(),e.strictEqual(r.called,!0,"Click handler triggers close of overlay")}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/search/SearchResultsView.test.js":function(e,t,n){(function(e){var t,i,r=n("./tests/node-qunit/utils/jQuery.js"),s=n("./tests/node-qunit/utils/dom.js"),o=n("./tests/node-qunit/utils/oo.js"),a=n("./tests/node-qunit/utils/mw.js"),l=n("./tests/node-qunit/utils/mustache.js"),c=n("./node_modules/sinon/lib/sinon.js");QUnit.module("MobileFrontend mobile.startup/SearchResultsView.js",{beforeEach:function(){i=c.sandbox.create(),s.setUp(i,e),r.setUp(i,e),o.setUp(i,e),a.setUp(i,e),l.setUp(i,e),i.stub(e.mw,"msg").withArgs("mobile-frontend-search-feedback-prompt").returns("mobile-frontend-search-feedback-prompt"),i.stub(e.mw.config,"get").withArgs("wgCirrusSearchFeedbackLink").returns("https://wikipedia.org"),t=n("./src/mobile.startup/search/SearchResultsView.js")},afterEach:function(){r.tearDown(),i.restore()}}),QUnit.test("renders correctly",(function(e){var n=new t({});e.strictEqual(n.$el.find(".overlay-header").length,1,"It contains an overlay title"),e.strictEqual(n.$el.find(".results").length,1,"It contains results"),e.strictEqual(n.$el.find(".search-feedback").text().trim().indexOf("mobile-frontend-search-feedback-prompt"),0,"It contains the feedback link"),e.strictEqual(n.$el.find(".search-feedback a").attr("href"),"https://wikipedia.org","It links to the feedback link")}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/time.test.js":function(e,t,n){var i=n("./src/mobile.startup/time.js");QUnit.module("MobileFrontend time.js"),QUnit.test("timeAgo()",(function(e){e.propEqual(i.timeAgo(40),{value:40,unit:"seconds"}),e.propEqual(i.timeAgo(149),{value:2,unit:"minutes"}),e.propEqual(i.timeAgo(150),{value:3,unit:"minutes"}),e.propEqual(i.timeAgo(7500),{value:2,unit:"hours"}),e.propEqual(i.timeAgo(9e4),{value:1,unit:"days"}),e.propEqual(i.timeAgo(9e6),{value:3,unit:"months"}),e.propEqual(i.timeAgo(32e6),{value:1,unit:"years"}),e.propEqual(i.timeAgo(102e6),{value:3,unit:"years"})}))},"./tests/node-qunit/mobile.startup/util.test.js":function(e,t,n){(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i,r,s=n("./tests/node-qunit/utils/dom.js"),o=n("./tests/node-qunit/utils/mw.js"),a=n("./tests/node-qunit/utils/jQuery.js"),l=n("./tests/node-qunit/utils/oo.js"),c=n("./node_modules/sinon/lib/sinon.js");QUnit.module("MobileFrontend util.js",{beforeEach:function(){r=c.sandbox.create(),s.setUp(r,e),o.setUp(r,e),a.setUp(r,e),l.setUp(r,e),i=n("./src/mobile.startup/util.js")},afterEach:function(){a.tearDown(),r.restore()}}),QUnit.test("Promise.all() success",(function(e){var t=i.Deferred(),n=i.Deferred();return t.resolve("a"),n.resolve("b"),i.Promise.all([t,n]).then((function(t,n){e.strictEqual(t,"a","All promises resolved (yay)"),e.strictEqual(n,"b","All promises resolved (yay)")}))})),QUnit.test("Promise.all() reject",(function(e){var t=i.Deferred(),n=i.Deferred();return t.resolve("a"),n.reject("b"),i.Promise.all([t,n]).catch((function(t){e.strictEqual(t,"b","The promise rejects")}))})),QUnit.test("escapeSelector()",(function(e){e.strictEqual(i.escapeSelector("#selector-starts-with-hash"),"\\#selector-starts-with-hash")})),QUnit.test("grep()",(function(e){e.propEqual(i.grep([1,2],(function(e){return e>1})),[2])})),QUnit.test("docReady()",(function(e){var t=e.async();i.docReady((function(){e.ok("docReady calls the callback eventually"),t()}))})),QUnit.test("Deferred() - resolve",(function(e){var t=new i.Deferred;return t.resolve("response"),t.then((function(t){e.strictEqual(t,"response")}))})),QUnit.test("Deferred() - reject",(function(e){var t=new i.Deferred;return t.reject("response"),t.catch((function(t){e.strictEqual(t,"response")}))})),QUnit.test("getDocument()",(function(e){e.strictEqual(i.getDocument().length,1)})),QUnit.test("getWindow()",(function(e){e.strictEqual(i.getWindow().length,1)})),QUnit.test("parseHTML()",(function(e){var n=i.parseHTML("<p>element content</p>",document);e.strictEqual("object"===t(n),!0),e.strictEqual(n[0].innerHTML,"element content")})),QUnit.test("isNumeric()",(function(e){e.strictEqual(i.isNumeric(123),!0),e.strictEqual(i.isNumeric("123"),!0),e.strictEqual(i.isNumeric("The string 123 is true? I don't like it."),!1),e.strictEqual(i.isNumeric(NaN),!1)})),QUnit.test("extend()",(function(e){var t={a:"apple"};i.extend(t,{b:"banana"}),e.strictEqual(JSON.stringify(t),'{"a":"apple","b":"banana"}')})),QUnit.test("escapeHash()",(function(e){e.strictEqual(i.escapeHash("#escape:...hash"),"#escape\\:\\.\\.\\.hash")})),QUnit.test("isModifiedEvent() - true",(function(e){var t=document.createElement("div");t.addEventListener("click",(function(t){e.strictEqual(i.isModifiedEvent(t),!0)})),t.dispatchEvent(new window.MouseEvent("click",{ctrlKey:!0}))})),QUnit.test("isModifiedEvent() - false",(function(e){var t=document.createElement("div");t.addEventListener("click",(function(t){e.strictEqual(i.isModifiedEvent(t),!1)})),t.dispatchEvent(new window.MouseEvent("click"))})),QUnit.test("repeatEvent",(function(e){var t=new OO.EventEmitter,n=new OO.EventEmitter;i.repeatEvent(n,t,"test"),t.on("test",(function(t){e.strictEqual(t,"test data","proxy responds to source events correctly")})),n.emit("test","test data")}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/watchstar/Watchstar.test.js":function(e,t,n){(function(e){var t,i,r,s=n("./tests/node-qunit/utils/dom.js"),o=n("./tests/node-qunit/utils/jQuery.js"),a=n("./node_modules/sinon/lib/sinon.js"),l=n("./tests/node-qunit/utils/mw.js"),c=n("./tests/node-qunit/utils/mustache.js"),u=n("./tests/node-qunit/utils/oo.js");QUnit.module("MobileFrontend Watchstar.js",{beforeEach:function(){r=a.sandbox.create(),s.setUp(r,e),o.setUp(r,e),l.setUp(r,e),c.setUp(r,e),u.setUp(r,e),i=r.spy(),r.stub(e.mw.loader,"require").withArgs("mediawiki.page.watch.ajax").returns({watchstar:i}),r.stub(e.mw.Title,"newFromText").returns({getUrl:function(){}}),t=n("./src/mobile.startup/watchstar/watchstar.js")},afterEach:function(){o.tearDown(),r.restore()}}),QUnit.test("Render a watchstar",(function(e){var n={title:"Foo"},r=t({page:n,isWatched:!0}),s=t({page:n,isWatched:!1});e.ok(i.calledTwice,"The core function was called twice."),e.strictEqual(r.$el.attr("class").indexOf("watched")>-1,!0,"Watched class is correct."),e.strictEqual(s.$el.attr("class").indexOf("watched"),-1,"Unwatched class is correct.")}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/watchstar/WatchstarGateway.test.js":function(e,t,n){(function(e){var t,i=n("./src/mobile.startup/watchstar/WatchstarGateway.js"),r=n("./tests/node-qunit/utils/dom.js"),s=n("./tests/node-qunit/utils/jQuery.js"),o=n("./node_modules/sinon/lib/sinon.js"),a=n("./tests/node-qunit/utils/mw.js"),l=n("./src/mobile.startup/util.js"),c={batchcomplete:!0,query:{pages:[{pageid:123,ns:0,title:"An unwatched page",contentmodel:"wikitext",pagelanguage:"en",pagelanguagehtmlcode:"en",pagelanguagedir:"ltr",touched:"2018-05-01T01:39:12Z",lastrevid:10,length:3,new:!0,watched:!1},{pageid:456,ns:0,title:"A watched page",contentmodel:"wikitext",pagelanguage:"en",pagelanguagehtmlcode:"en",pagelanguagedir:"ltr",touched:"2018-05-01T01:43:31Z",lastrevid:24,length:3,new:!0,watched:!0}]}};QUnit.module("MobileFrontend: WatchstarGateway.js",{beforeEach:function(){t=o.sandbox.create(),r.setUp(t,e),s.setUp(t,e),a.setUp(t,e)},afterEach:function(){s.tearDown(),t.restore()}}),QUnit.test("getStatuses(nonempty)",(function(e){var n={get:function(){}},r=t.mock(n);return r.expects("get").withArgs(t.match.has("pageids")).once().returns(l.Deferred().resolve({batchcomplete:!0,query:{pages:[c.query.pages[0]]}})),r.expects("get").withArgs(t.match.has("titles")).once().returns(l.Deferred().resolve({batchcomplete:!0,query:{pages:[c.query.pages[1]]}})),new i(n).getStatuses(["123"],["A watched page"]).then((function(t){e.propEqual(t,{"An unwatched page":!1,"A watched page":!0},"The correct result is returned."),r.verify()}))})),QUnit.test("getStatuses(empty)",(function(e){var n={get:function(){}},r=t.mock(n).expects("get").never();return new i(n).getStatuses([],[]).then((function(t){e.propEqual(t,{},"An empty result is returned."),r.verify()}))})),QUnit.test("getStatusesByID(nonempty)",(function(e){var n={get:function(){}},r=t.mock(n).expects("get").once().returns(l.Deferred().resolve(c));return new i(n).getStatusesByID(["123",456]).then((function(t){e.propEqual(t,{"An unwatched page":!1,"A watched page":!0},"The correct result is returned."),r.verify()}))})),QUnit.test("getStatusesByID(empty)",(function(e){var n={get:function(){}},r=t.mock(n).expects("get").never();return new i(n).getStatusesByID([]).then((function(t){e.propEqual(t,{},"An empty result is returned."),r.verify()}))})),QUnit.test("getStatusesByTitle(nonempty)",(function(e){var n={get:function(){}},r=t.mock(n).expects("get").once().returns(l.Deferred().resolve(c));return new i(n).getStatusesByTitle(["An unwatched page","An unwatched page"]).then((function(t){e.propEqual(t,{"An unwatched page":!1,"A watched page":!0},"The correct result is returned."),r.verify()}))})),QUnit.test("getStatusesByTitle(empty)",(function(e){var n={get:function(){}},r=t.mock(n).expects("get").never();return new i(n).getStatusesByTitle([]).then((function(t){e.propEqual(t,{},"An empty result is returned."),r.verify()}))})),QUnit.test("_unmarshalGetResponse(nonempty)",(function(e){var t=new i(new mw.Api)._unmarshalGetResponse(c);e.propEqual(t,{"An unwatched page":!1,"A watched page":!0},"GET API:Info nonempty responses are unmarshalled correctly.")})),QUnit.test("_unmarshalGetResponse(empty)",(function(e){var t=new i(new mw.Api)._unmarshalGetResponse({});e.propEqual(t,{},"GET API:Info empty responses are unmarshalled correctly.")}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.startup/watchstar/WatchstarPageList.test.js":function(e,t,n){(function(e){var t,i,r,s,o,a=n("./src/mobile.startup/util.js"),l=n("./tests/node-qunit/utils/dom.js"),c=n("./tests/node-qunit/utils/jQuery.js"),u=n("./node_modules/sinon/lib/sinon.js"),d=n("./tests/node-qunit/utils/mw.js"),h=n("./tests/node-qunit/utils/mustache.js"),p=n("./tests/node-qunit/utils/oo.js"),f={query:{pages:[{pageid:30,title:"Title 30",watched:!0},{pageid:50,title:"Title 50",watched:!1}]}};QUnit.module("MobileFrontend mobile.startup/WatchstarPageList",{beforeEach:function(){o=u.sandbox.create(),l.setUp(o,e),c.setUp(o,e),d.setUp(o,e),h.setUp(o,e),p.setUp(o,e),o.stub(e.mw.loader,"require").withArgs("mediawiki.page.watch.ajax").returns({watchstar:function(){}}),o.stub(e.mw.Title,"newFromText").returns({getUrl:function(){}}),r=n("./src/mobile.startup/watchstar/WatchstarPageList.js"),t=mw.user,i=n("./src/mobile.startup/Icon.js"),s=new i({glyphPrefix:"wikimedia",name:"unStar-progressive"}).getGlyphClassName(),o.stub(t,"isAnon").returns(!1)},afterEach:function(){c.tearDown(),o.restore()}}),QUnit.test("Watchlist status check if no ids",(function(e){var t=e.async(),n=new mw.Api,i=o.stub(n,"get").returns(a.Deferred().resolve(f)),s=new r({api:n,pages:[{title:"Title 0"},{title:"Title 1"}]});window.setTimeout((function(){s.getPages([],[]).then((function(){e.ok(i.calledWith({formatversion:2,action:"query",prop:"info",inprop:"watched",titles:["Title 0","Title 1"]}),"A request to API was made to retrieve the statuses"),e.strictEqual(s.$el.find(".watch-this-article").length,2,"2 articles have watch stars"),t()}))}),0)})),QUnit.test("Checks watchlist status once",(function(e){var t=e.async(),n=new mw.Api,i=o.stub(n,"get").returns(a.Deferred().resolve(f)),l=new r({api:n,pages:[{id:30,title:"Title 30"},{id:50,title:"Title 50"}]});window.setTimeout((function(){l.getPages([30,50],[]).then((function(){e.strictEqual(i.callCount,2,"run callback twice (inside postRender and this call) - no caching occurs"),e.ok(i.calledWith({formatversion:2,action:"query",prop:"info",inprop:"watched",pageids:[30,50]}),"A request to API was made to retrieve the statuses"),e.strictEqual(l.$el.find(".watch-this-article").length,2,"2 articles have watch stars"),e.strictEqual(l.$el.find("."+s).length,1,"1 article is marked as watched"),t()}))}),0)}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.talk.overlays/AddTopicForm.test.js":function(e,t,n){(function(e){var t,i,r=n("./src/mobile.startup/util.js"),s=n("./tests/node-qunit/utils/jQuery.js"),o=n("./tests/node-qunit/utils/dom.js"),a=n("./tests/node-qunit/utils/mw.js"),l=n("./tests/node-qunit/utils/oo.js"),c=n("./node_modules/sinon/lib/sinon.js");QUnit.module("MobileFrontend AddTopicForm",{beforeEach:function(){i=c.sandbox.create(),o.setUp(i,e),s.setUp(i,e),l.setUp(i,e),a.setUp(i,e),t=n("./src/mobile.talk.overlays/AddTopicForm.js")},afterEach:function(){s.tearDown(),i.restore()}}),QUnit.test("makePanel()",(function(e){var n=t.test.makePanel(r.parseHTML("<span>").text("Hello world"));e.strictEqual(n.$el.hasClass("panel"),!0,"A Panel is created"),e.strictEqual(n.$el.find("span").text(),"Hello world","The panel has he element inside")})),QUnit.test("AddTopicForm",(function(e){var n=i.spy(),r=new t({subject:" Subject",body:"Body",disabled:!1,licenseMsg:"MobileFrontend <strong>fun</strong> license"}),s=new t({subject:" Subject",body:"Body",disabled:!1,licenseMsg:"MobileFrontend <strong>fun</strong> license",onTextInput:function(e,t){n(e,t)}});try{r.$el.find("textarea").trigger("input"),e.ok(!0,"If form has no onTextInput event handler does not execute")}catch(t){e.ok(!1,"If form has no onTextInput no exception is meant to be thrown")}e.strictEqual(s.$el.find("input").val()," Subject","Subject input created"),e.strictEqual(s.$el.find("textarea").val(),"Body","textarea created"),e.strictEqual(s.$el.find("p strong").text(),"fun","licenseMsg accepts HTML"),e.strictEqual(n.calledOnce,!1,"Spy not called to begin with"),s.$el.find("textarea").trigger("input"),e.strictEqual(n.calledOnce,!0,"Spy got called after textarea input"),e.propEqual(n.args[0],["Subject","Body"],"Spy got called with expected (and trimmed arguments)")}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.talk.overlays/TalkSectionAddOverlay.test.js":function(e,t,n){(function(e){var t,i,r=n("./src/mobile.startup/util.js"),s=n("./tests/node-qunit/utils/jQuery.js"),o=n("./tests/node-qunit/utils/dom.js"),a=n("./tests/node-qunit/utils/mw.js"),l=n("./tests/node-qunit/utils/mustache.js"),c=n("./tests/node-qunit/utils/oo.js"),u=n("./node_modules/sinon/lib/sinon.js");QUnit.module("MobileFrontend TalkSectionAddOverlay",{beforeEach:function(){i=u.sandbox.create(),o.setUp(i,e),s.setUp(i,e),c.setUp(i,e),a.setUp(i,e),l.setUp(i,e),t=n("./src/mobile.talk.overlays/TalkSectionAddOverlay.js")},afterEach:function(){s.tearDown(),i.restore()}}),QUnit.test("save()",(function(e){var n=new t({api:{postWithToken:i.stub().returns(r.Deferred().resolve())},title:"Talk:No exist"});return n.$el.find("input").val("Testtitle"),n.$el.find("textarea").val("Testcontent"),e.strictEqual(n.$el.find("input").val(),"Testtitle","Testtitle set"),e.strictEqual(n.$el.find("textarea").val(),"Testcontent","Testcontent set"),n.save().then((function(t){e.strictEqual(t,"ok","The new discussion was saved"),e.strictEqual(n._saveHit,!0,"The save was recognized")}))}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.talk.overlays/TalkSectionOverlay.test.js":function(e,t,n){(function(e){var t,i,r=n("./src/mobile.startup/util.js"),s=n("./tests/node-qunit/utils/jQuery.js"),o=n("./tests/node-qunit/utils/dom.js"),a=n("./tests/node-qunit/utils/mw.js"),l=n("./tests/node-qunit/utils/mustache.js"),c=n("./tests/node-qunit/utils/oo.js"),u=n("./node_modules/sinon/lib/sinon.js");QUnit.module("MobileFrontend TalkSectionOverlay.js - logged in",{beforeEach:function(){i=u.sandbox.create(),o.setUp(i,e),s.setUp(i,e),c.setUp(i,e),a.setUp(i,e),l.setUp(i,e),t=n("./src/mobile.talk.overlays/TalkSectionOverlay.js"),this.toastStub=i.stub(mw,"notify")},afterEach:function(){s.tearDown(),i.restore()}}),QUnit.test("Check comment box for logged in users",(function(e){var n=new t({api:{},section:"Test"});e.ok(n.$el.find(".comment").length>0,"There is a visible comment box")})),QUnit.test("Check disabled property on textarea",(function(e){var n=new t({api:{},section:"Test"});e.strictEqual(n.$saveButton.prop("disabled"),!0,"`disabled` at start."),n.onInputTextarea({target:{value:"Test"}}),e.strictEqual(n.$saveButton.prop("disabled"),!1,"`disabled` removed after comment box gets input value.")})),QUnit.test("Check api request on save",(function(e){var n=r.Deferred().resolve(),s=i.stub().returns(n),o=new t({api:{postWithToken:s},title:"Talk:Test",id:1,section:"Test"});return o.state.text="Testcomment",o.onSaveClick(),n.then((function(){e.ok(s.calledWith("csrf",{action:"edit",title:"Talk:Test",section:1,appendtext:"\n\nTestcomment ~~~~",redirect:!0}),"Save request passes!")}))})),QUnit.module("MobileFrontend TalkSectionOverlay.js - anonymous (logged out)",{beforeEach:function(){i=u.sandbox.create(),o.setUp(i,e),s.setUp(i,e),c.setUp(i,e),a.setUp(i,e),l.setUp(i,e),t=n("./src/mobile.talk.overlays/TalkSectionOverlay.js"),i.stub(mw.user,"isAnon").returns(!1)},afterEach:function(){s.tearDown(),i.restore()}}),QUnit.test("Check comment box for logged out users",(function(e){var n=new t({api:{},section:"Test"});e.ok(n.$el.find(".comment").length>0,"There is a visible comment box")}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/mobile.talk.overlays/autosign.test.js":function(e,t,n){var i=n("./src/mobile.talk.overlays/autosign.js");QUnit.module("MobileFrontend autosign.js"),QUnit.test("#autosign",(function(e){[["foo","foo ~~~~"],["foo ~~~","foo ~~~"],["foo ~~~~~","foo ~~~~~"],["foo ~~~~","foo ~~~~"],["foo ~~~~ yolo","foo ~~~~ yolo"],["~~~~ yolo","~~~~ yolo"]].forEach((function(t){e.strictEqual(i(t[0]),t[1],"Autosigning works as expected")}))}))},"./tests/node-qunit/mobile.talk.overlays/makeAddTopicForm.test.js":function(e,t,n){(function(e){var t,i,r=n("./tests/node-qunit/utils/jQuery.js"),s=n("./tests/node-qunit/utils/dom.js"),o=n("./tests/node-qunit/utils/mw.js"),a=n("./tests/node-qunit/utils/oo.js"),l=n("./node_modules/sinon/lib/sinon.js");QUnit.module("MobileFrontend makeAddTopicForm",{beforeEach:function(){i=l.sandbox.create(),s.setUp(i,e),r.setUp(i,e),a.setUp(i,e),o.setUp(i,e),t=n("./src/mobile.talk.overlays/makeAddTopicForm.js")},afterEach:function(){r.tearDown(),i.restore()}}),QUnit.test("makeAddTopicForm",(function(e){var n=i.spy(),r=t({licenseMsg:"foo",disabled:!1,subject:"sub",body:"body"}),s=t({licenseMsg:"foo",disabled:!1,subject:"sub",body:"body",onTextInput:function(e,t){n(t)}});e.strictEqual(r.$el.hasClass("add-topic-form"),!0,"The onTextInput parameter is optional"),r.$el.find("textarea").trigger("input"),s.$el.find("textarea").trigger("input"),s.$el.find("textarea").val(""),s.$el.find("textarea").trigger("input"),e.strictEqual(s.$el.hasClass("add-topic-form"),!0,"Form has the expected class name"),e.strictEqual(n.args[0][0],"body ~~~~","Check onTextInput is executed and signed when callback is run."),e.strictEqual(n.args[1][0],"","Check onTextInput does not autosign if body empty.")}))}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./tests/node-qunit/utils/PageGateway.responses.js":function(e,t){e.exports={getPageHeadings:{input:{mobileview:{id:-1,displaytitle:"Test",revId:42,lastmodifiedby:{name:"bob",gender:"unknown"},protection:[],lastmodified:"2013-10-28T18:49:56Z",languagecount:10,sections:[{id:0,text:""},{level:"1",line:"1",anchor:"1",id:1,text:"<p>Text of 1\n</p>"},{level:"2",line:"<i>1.1</i>",anchor:"1.1",id:2,text:"<p>Text of 1.1\n</p>"},{level:"1",line:"2",anchor:"2",id:3,text:"<p>Text of 2\n</p>"},{level:"2",line:"2.1",anchor:"2.1",id:4,text:"<p>Text of 2.1\n</p>"}]}},output:{historyUrl:"Test:History",lastModifiedUserName:"bob",lastModifiedUserGender:"unknown",lastModifiedTimestamp:1382986196,title:"Test",revId:42,displayTitle:"Test",id:-1,protection:{edit:["*"]},isMainPage:!1,languageCount:10,hasVariants:!1,lead:"",sections:[{level:"1",line:"1",anchor:"1",id:1,text:'<p>Text of 1\n</p><h2 id="1.1"><i>1.1</i></h2>\n<p>Text of 1.1\n</p>',subsections:[{level:"2",line:"<i>1.1</i>",anchor:"1.1",id:2,text:"<p>Text of 1.1\n</p>",subsections:[]}]},{level:"1",line:"2",anchor:"2",id:3,text:'<p>Text of 2\n</p><h2 id="2.1">2.1</h2>\n<p>Text of 2.1\n</p>',subsections:[{level:"2",line:"2.1",anchor:"2.1",id:4,text:"<p>Text of 2.1\n</p>",subsections:[]}]}]}},getPageLanguagesResponse:{input:{query:{pages:[{pageid:94,ns:0,title:"San Francisco",langlinks:[{lang:"es",url:"http://es.wikipedia.org/wiki/San_Francisco_(California)",title:"San Francisco (California)",autonym:"español"},{lang:"pl",url:"http://pl.wikipedia.org/wiki/San_Francisco",title:"San Francisco",autonym:"polski"},{lang:"sr",url:"http://sr.wikipedia.org/wiki/%D0%A1%D0%B0%D0%BD_%D0%A4%D1%80%D0%B0%D0%BD%D1%86%D0%B8%D1%81%D0%BA%D0%BE",title:"Сан Франциско",autonym:"српски / srpski"}]}],general:{variants:[{code:"sr",name:"sr"},{code:"sr-ec",name:"Ћирилица"},{code:"sr-el",name:"Latinica"}],variantarticlepath:"/$2/$1"},languages:[{code:"sr",name:"српски / srpski"},{code:"sr-ec",name:"српски (ћирилица)"},{code:"sr-el",name:"srpski (latinica)‎"},{code:"es",name:"español"},{code:"pl",name:"polski"}]},limits:{langlinks:500}},output:{languages:[{lang:"es",url:"http://es.wikipedia.org/wiki/San_Francisco_(California)",title:"San Francisco (California)",autonym:"español"},{lang:"pl",url:"http://pl.wikipedia.org/wiki/San_Francisco",title:"San Francisco",autonym:"polski"},{lang:"sr",url:"http://sr.wikipedia.org/wiki/%D0%A1%D0%B0%D0%BD_%D0%A4%D1%80%D0%B0%D0%BD%D1%86%D0%B8%D1%81%D0%BA%D0%BE",title:"Сан Франциско",autonym:"српски / srpski"}],variants:[{lang:"sr",autonym:"sr",url:"/sr/Test"},{lang:"sr-ec",autonym:"Ћирилица",url:"/sr-ec/Test"},{lang:"sr-el",autonym:"Latinica",url:"/sr-el/Test"}]}},getPageLanguagesCall:{output:{action:"query",meta:"siteinfo",siprop:"general",prop:"langlinks",llprop:"url|autonym|langname",llinlanguagecode:"fr",lllimit:"max",titles:"Title",formatversion:2}},getAPIResponseFromHTML:{input:[{line:"A1",level:"1",anchor:"1.0",text:""},{line:"A2.1",level:"2",anchor:"",text:""},{line:"A2.2",level:"2",anchor:"",text:""},{line:"A2",level:"1",anchor:"",text:""},{line:"A2.1",level:"2",anchor:"",text:""}]}}},"./tests/node-qunit/utils/PageInputs.html.js":function(e,t){e.exports={referencesPage:'<div id="mfe-test-references">\n<sup id="cite_ref-1" class="reference">\n\t<a href="#cite_note-1">[1]</a>\n</sup>\n<p>\n\tsup with encoded href attribute\n\t<sup id="cite_ref-Obama_1995,_2004,_pp._9–10_11-0" class="reference">\n\t\t<a href="#cite_note-Obama_1995,_2004,_pp._9%E2%80%9310-11">[11]</a>\n\t</sup>\n</p>\n<ol class="references">\n\t<li id="cite_note-1">\n\t\t<span class="mw-cite-backlink">\n\t\t\t<a href="#cite_ref-1">↑</a>\n\t\t</span> <span class="reference-text">hello</span>\n\t</li>\n\t<li id="cite_note-Obama_1995,_2004,_pp._9–10-11">\n\t\t<span class="mw-cite-backlink">\n\t\t\t<a href="#cite_ref-1">↑</a>\n\t\t</span> <span class="reference-text">found</span>\n\t</li>\n\t<li id="cite_note-2">\n\t\t<span class="mw-cite-backlink">\n\t\t\t<a href="#cite_ref-1">^</a>\n\t\t</span>\n\t\t<span class="reference-text">\n\t\t\t<a class="external text" href="">Hi there</a>\n\t\t</span>\n\t</li>\n</ol>\n</div>',page:'<div>\n\t<h1><span class="mw-headline" id="1.0">A1</span></h1>\n\t<h2><span class="mw-headline">A2.1</span></h2>\n\t<h2><span class="mw-headline">A2.2</span></h2>\n\t<h1><span class="mw-headline">A2</span></h1>\n\t<h2><span class="mw-headline">A2.1</span><span>[<a href="#">edit</a>]</span></h2>\n\t<h1>Not to be shown in the TOC<span class="placeholder"></span></h1>\n</div>',page2:'<div>\n<h2><span class="mw-headline" id="1.0">A1</span></h2>\n<h3><span class="mw-headline">A2.1</span></h3>\n<h2><span class="mw-headline">A2.2</span></h2>\n<h1><span class="mw-headline">A2</span></h1>\n<h2><span class="mw-headline">A2.1</span></h2>\n</div>'}},"./tests/node-qunit/utils/blank.js":function(e,t){e.exports=function(){}},"./tests/node-qunit/utils/dom.js":function(e,t,n){e.exports=n("./node_modules/@wikimedia/mw-node-qunit/index.js").dom},"./tests/node-qunit/utils/jQuery.js":function(e,t,n){e.exports=n("./node_modules/@wikimedia/mw-node-qunit/index.js").jQuery},"./tests/node-qunit/utils/mustache.js":function(e,t,n){e.exports=n("./node_modules/@wikimedia/mw-node-qunit/index.js").mustache},"./tests/node-qunit/utils/mw.js":function(e,t,n){e.exports=n("./node_modules/@wikimedia/mw-node-qunit/index.js").mw},"./tests/node-qunit/utils/oo.js":function(e,t,n){e.exports=n("./node_modules/@wikimedia/mw-node-qunit/index.js").oojs},0:function(e,t,n){n("./tests/node-qunit/mobile.categories.overlays/CategoryGateway.test.js"),n("./tests/node-qunit/mobile.editor.overlay/EditorGateway.test.js"),n("./tests/node-qunit/mobile.editor.overlay/identifyLeadParagraph.test.js"),n("./tests/node-qunit/mobile.editor.overlay/parseBlockInfo.test.js"),n("./tests/node-qunit/mobile.editor.overlay/SourceEditorOverlay.test.js"),n("./tests/node-qunit/mobile.init/editorLoadingOverlay.test.js"),n("./tests/node-qunit/mobile.languages.structured/LanguageSearcher.test.js"),n("./tests/node-qunit/mobile.languages.structured/util.test.js"),n("./tests/node-qunit/mobile.mediaViewer/ImageCarousel.test.js"),n("./tests/node-qunit/mobile.mediaViewer/ImageGateway.test.js"),n("./tests/node-qunit/mobile.special.nearby.scripts/NearbyGateway.test.js"),n("./tests/node-qunit/mobile.special.watchlist.scripts/WatchList.test.js"),n("./tests/node-qunit/mobile.special.watchlist.scripts/WatchListGateway.test.js"),n("./tests/node-qunit/mobile.startup/amcOutreach/AmcEnableForm.test.js"),n("./tests/node-qunit/mobile.startup/amcOutreach/amcOutreachDrawer.test.js"),n("./tests/node-qunit/mobile.startup/Browser.test.js"),n("./tests/node-qunit/mobile.startup/Button.test.js"),n("./tests/node-qunit/mobile.startup/cache.test.js"),n("./tests/node-qunit/mobile.startup/CtaDrawer.test.js"),n("./tests/node-qunit/mobile.startup/Drawer.test.js"),n("./tests/node-qunit/mobile.startup/extendSearchParams.test.js"),n("./tests/node-qunit/mobile.startup/icons.test.js"),n("./tests/node-qunit/mobile.startup/languageOverlay/getDeviceLanguage.test.js"),n("./tests/node-qunit/mobile.startup/languageOverlay/languageOverlay.test.js"),n("./tests/node-qunit/mobile.startup/lazyImages/lazyImageLoader.test.js"),n("./tests/node-qunit/mobile.startup/mfExtend.test.js"),n("./tests/node-qunit/mobile.startup/moduleLoader.test.js"),n("./tests/node-qunit/mobile.startup/Overlay.test.js"),n("./tests/node-qunit/mobile.startup/OverlayManager.test.js"),n("./tests/node-qunit/mobile.startup/Page.test.js"),n("./tests/node-qunit/mobile.startup/page/pageJSONParser.test.js"),n("./tests/node-qunit/mobile.startup/PageGateway.test.js"),n("./tests/node-qunit/mobile.startup/PageHTMLParser.test.js"),n("./tests/node-qunit/mobile.startup/promisedView.test.js"),n("./tests/node-qunit/mobile.startup/promoCampaign/promoCampaign.test.js"),n("./tests/node-qunit/mobile.startup/references/references.test.js"),n("./tests/node-qunit/mobile.startup/references/ReferencesHtmlScraperGateway.test.js"),n("./tests/node-qunit/mobile.startup/ScrollEndEventEmitter.test.js"),n("./tests/node-qunit/mobile.startup/search/MobileWebSearchLogger.test.js"),n("./tests/node-qunit/mobile.startup/search/SearchGateway.test.js"),n("./tests/node-qunit/mobile.startup/search/SearchOverlay.test.js"),n("./tests/node-qunit/mobile.startup/search/SearchResultsView.test.js"),n("./tests/node-qunit/mobile.startup/Section.test.js"),n("./tests/node-qunit/mobile.startup/time.test.js"),n("./tests/node-qunit/mobile.startup/Toggler.test.js"),n("./tests/node-qunit/mobile.startup/util.test.js"),n("./tests/node-qunit/mobile.startup/View.test.js"),n("./tests/node-qunit/mobile.startup/watchstar/Watchstar.test.js"),n("./tests/node-qunit/mobile.startup/watchstar/WatchstarGateway.test.js"),n("./tests/node-qunit/mobile.startup/watchstar/WatchstarPageList.test.js"),n("./tests/node-qunit/mobile.talk.overlays/AddTopicForm.test.js"),n("./tests/node-qunit/mobile.talk.overlays/autosign.test.js"),n("./tests/node-qunit/mobile.talk.overlays/makeAddTopicForm.test.js"),n("./tests/node-qunit/mobile.talk.overlays/TalkSectionAddOverlay.test.js"),e.exports=n("./tests/node-qunit/mobile.talk.overlays/TalkSectionOverlay.test.js")},jquery:function(e,t){!function(){e.exports=this.jquery}()},jsdom:function(e,t){!function(){e.exports=this.jsdom}()},oojs:function(e,t){!function(){e.exports=this.oojs}()}},[[0,0]]]);
//# sourceMappingURL=tests.mobilefrontend.js.map.json